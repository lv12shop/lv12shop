<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª | Ù…ØªØ¬Ø± LV12</title>
  <link rel="icon" href="/lv12.png" />
<link rel="image_src" href="https://www.lv12shop.shop/lv12.png" />

<meta property="og:title" content="Ù…ØªØ¬Ø± LV12 - ØªØ³ÙˆÙ‚ Ø°ÙƒÙŠ ÙˆØ³Ø±ÙŠØ¹" />
<meta property="og:description" content="Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø© ØªØ³ÙˆÙ‚ Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª - Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…ÙŠØ²Ø© ÙˆØ´Ø­Ù† Ø³Ø±ÙŠØ¹ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª." />
<meta property="og:image" content="https://www.lv12shop.shop/lv12.png" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://www.lv12shop.shop" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Ù…ØªØ¬Ø± LV12 - ØªØ³ÙˆÙ‚ Ø°ÙƒÙŠ ÙˆØ³Ø±ÙŠØ¹" />
<meta name="twitter:description" content="Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø© ØªØ³ÙˆÙ‚ Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª - Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…ÙŠØ²Ø© ÙˆØ´Ø­Ù† Ø³Ø±ÙŠØ¹ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª." />
<meta name="twitter:image" content="https://www.lv12shop.shop/lv12.png" />

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "LV12 Shop",
  "url": "https://www.lv12shop.shop",
  "logo": "https://www.lv12shop.shop/lv12.png"
}
</script>

  <meta name="description" content="Ø§Ø³ØªØ¹Ø±Ø¶ Ø³Ù„Ø© Ù…Ø´ØªØ±ÙŠØ§ØªÙƒ ÙÙŠ Ù…ØªØ¬Ø± LV12 â€” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŒ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±ØŒ ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶ Ù‚Ø¨Ù„ Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù…Ø§Ù†.">
  <meta name="keywords" content="LV12, Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª, Ù…ØªØ¬Ø±, ØªØ³ÙˆÙ‚ Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†, Ø¹Ø±ÙˆØ¶, Ù…Ù†ØªØ¬Ø§Øª, Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª, Ø®ØµÙˆÙ…Ø§Øª, Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ, Ø´Ø±Ø§Ø¡ Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†">
  <meta name="robots" content="index, follow">
  <meta name="author" content="LV12 Shop">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "LV12 Shop",
  "url": "https://lv12shop.shop",
  "logo": "https://lv12shop.shop/lv12.png",
  "sameAs": [
    "https://www.facebook.com/",
    "https://www.instagram.com/"
  ]
}
</script>

  <meta property="og:title" content="ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª | Ù…ØªØ¬Ø± LV12">
  <meta property="og:description" content="ØªØ³ÙˆÙ‚ Ø¨Ø³Ù‡ÙˆÙ„Ø©! ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ù‚Ø¨Ù„ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://lv12shop.shop/cart.html">
  <meta property="og:image" content="https://lv12shop.shop/lv12.png">
  <meta property="og:locale" content="ar_AR">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª | Ù…ØªØ¬Ø± LV12">
  <meta name="twitter:description" content="Ø±Ø§Ø¬Ø¹ Ù…Ø´ØªØ±ÙŠØ§ØªÙƒ ÙˆØ£ÙƒÙ…Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ Ù…ØªØ¬Ø± LV12.">
  <meta name="twitter:image" content="https://lv12shop.shop/lv12.png">

  <link rel="icon" href="/lv12.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/lv12.png">
  <meta name="theme-color" content="#2563eb">

  <link rel="manifest" href="/manifest.json">

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <meta name="referrer" content="no-referrer-when-downgrade">

  <style>
    body { 
      font-family: "Cairo", sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-attachment: fixed;
      color: #0f172a; 
      min-height: 100vh;
    }
    
    .payment-option:has(input:checked) {
      border-color: #3b82f6;
      background: linear-gradient(135deg, #eff6ff, #dbeafe);
      transform: scale(1.02);
    }
    
    .cart-item {
      background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,250,252,0.95));
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 20px;
      padding: 20px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .cart-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #06b6d4);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    
    .cart-item:hover::before {
      transform: scaleX(1);
    }
    
    .cart-item:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    }
    
    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255,255,255,0.8);
      border-radius: 12px;
      padding: 4px;
    }
    
    .quantity-btn {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: none;
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .quantity-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(59,130,246,0.4);
    }
    
    .toast { 
      position: fixed; 
      bottom: 20px; 
      left: 50%; 
      transform: translateX(-50%); 
      z-index: 60; 
      padding: 16px 24px; 
      border-radius: 16px; 
      color: #fff; 
      display: none;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-slide-in {
      animation: slideIn 0.5s ease-out;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <header class="bg-white shadow sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3 cursor-pointer" onclick="location.href='shop.html'">
        <img src="lv12.ico" class="w-10 h-10 rounded-md" />
        <div>
          <div class="text-lg font-bold text-blue-700">LV12</div>
          <div class="text-xs small-muted">ØªØ³ÙˆÙ‚ Ø¨Ø«Ù‚Ø© ÙˆØ³Ø±Ø¹Ø©</div>
        </div>
      </div>
<span id="walletBalance" class="text-green-600 font-bold"></span>

      <div class="flex items-center gap-4">
        <div id="userArea" class="text-sm small-muted"></div>
        <a id="backToShop" class="btn-primary inline-flex items-center gap-2" href="shop.html">ğŸ›ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ³ÙˆÙ‚</a>
      </div>
    </div>
  </header>


<style>
#mainHeader {
  transform: none !important;
  left: 0 !important;
  right: 0 !important;
}
</style>



<button id="floatingSearchBtn"
  class="fixed bottom-20 right-5 sm:right-8 bg-gradient-to-r from-blue-600 to-indigo-600 text-white 
         font-bold px-5 py-3 rounded-full shadow-xl hover:scale-105 transition-all duration-300 
         z-[9999] flex items-center gap-2 text-sm sm:text-base">
  ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬
</button>
<div id="searchOverlay"
  class="hidden fixed inset-0 bg-black/60 backdrop-blur-md flex items-start justify-center z-[20000] pt-16 transition-all">

  <div class="bg-white w-[92%] sm:w-[460px] rounded-3xl p-6 shadow-2xl border border-blue-200 
              animate-[fadeIn_0.35s_ease] relative">

    <button id="closeSearchOverlay"
      class="absolute top-3 left-3 text-red-500 text-xl hover:scale-125 transition">âœ–</button>

    <h3 class="text-center text-blue-700 font-extrabold text-xl mb-4">Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ ğŸ”</h3>

    <div class="flex gap-2">
      <input type="text" id="popupSearchInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ù‡Ù†Ø§..."
        class="w-full border border-blue-300 rounded-full px-4 py-3 text-gray-700 text-sm 
               focus:ring-4 focus:ring-blue-300/40 focus:outline-none shadow-inner">
      <button id="startSearchBtn"
        class="bg-blue-600 text-white px-4 py-2 rounded-full shadow hover:scale-105 transition">
        Ø¨Ø­Ø«
      </button>
    </div>

    <div id="popupSuggestions"
      class="hidden mt-3 bg-white border border-blue-100 rounded-2xl shadow-xl max-h-72 overflow-y-auto p-1">
    </div>

  </div>
</div>



<style>
@keyframes fadeIn { from { opacity: 0; transform: scale(.95); } to { opacity: 1; transform: scale(1); } }
@keyframes fadeOut { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(.95); } }
.animate-fade-out { animation: fadeOut .3s ease forwards; }

.suggestion-item {
  padding: 10px 14px;
  display: flex;
  gap: 10px;
  align-items: center;
  border-bottom: 1px solid #e5e7eb;
  cursor: pointer;
  transition: .25s;
}
.suggestion-item:hover {
  background: #eff6ff;
}
</style>


<script>
const floatingBtn = document.getElementById("floatingSearchBtn");
const overlay = document.getElementById("searchOverlay");
const closeBtn = document.getElementById("closeSearchOverlay");
const searchInput = document.getElementById("popupSearchInput");
const suggestionsBox = document.getElementById("popupSuggestions");
const searchBtn = document.getElementById("startSearchBtn");

floatingBtn?.addEventListener("click", () => {
  overlay.classList.remove("hidden", "animate-fade-out");
  overlay.classList.add("flex");
  setTimeout(() => searchInput.focus(), 150);
});

closeBtn?.addEventListener("click", closeSearch);
overlay?.addEventListener("click", (e) => { if (e.target === overlay) closeSearch(); });

function closeSearch() {
  overlay.classList.add("animate-fade-out");
  setTimeout(() => overlay.classList.add("hidden"), 280);
  suggestionsBox.classList.add("hidden");
}

function levenshtein(a, b) {
  const m = a.length, n = b.length;
  const dp = Array.from({ length: m + 1 }, () => Array(n + 1).fill(0));

  for (let i = 0; i <= m; i++) dp[i][0] = i;
  for (let j = 0; j <= n; j++) dp[0][j] = j;

  for (let i = 1; i <= m; i++) {
    for (let j = 1; j <= n; j++) {
      dp[i][j] = Math.min(
        dp[i-1][j] + 1,
        dp[i][j-1] + 1,
        dp[i-1][j-1] + (a[i-1] === b[j-1] ? 0 : 1)
      );
    }
  }
  return dp[m][n];
}
searchBtn?.addEventListener("click", () => {
  const q = searchInput.value.trim();
  if (q.length > 0) openSearchResultsPage(q);
});
searchInput?.addEventListener("input", async () => {
  const query = searchInput.value.trim().toLowerCase();
  if (!query) return suggestionsBox.classList.add("hidden");
  const { data: products, error } = await supabase
    .from("products")
    .select(`
      id,
      name,
      price,
      product_images(image_url, is_primary)
    `);

  if (error || !products) return;

  let results = products.filter(p =>
    p.name?.toLowerCase().includes(query) ||
    levenshtein(p.name?.toLowerCase(), query) <= 2
  );

  results = results.map(p => ({
    ...p,
    img:
      p.product_images?.find(i => i.is_primary)?.image_url ||
      p.product_images?.[0]?.image_url ||
      "/placeholder.png"
  }));

  if (!results.length) {
    suggestionsBox.innerHTML = `
      <div class="p-3 text-center text-red-600">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>
    `;
    return suggestionsBox.classList.remove("hidden");
  }

  suggestionsBox.innerHTML = results
    .map(
      p => `
      <div class="suggestion-item flex items-center gap-3 cursor-pointer"
           onclick="goToProduct(${p.id})">

        <img src="${p.img}" 
             class="w-12 h-12 object-cover rounded border">

        <div>
          <div class="font-bold text-blue-900 text-sm">${p.name}</div>
          <div class="text-blue-600 text-xs">${p.price} Ø¬.Ù…</div>
        </div>
      </div>
    `
    )
    .join("");

  suggestionsBox.classList.remove("hidden");
});
function openSearchResultsPage(query) {
  window.location.href = `search.html?q=${encodeURIComponent(query)}`;
}


function goToProduct(id) {
  window.location.href = `product.html?id=${id}`;
}
</script>


<nav id="mainNav"
  class="fixed bottom-0 left-0 w-full 
        bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900
        text-white border-t border-blue-900/30
        shadow-[0_-4px_20px_rgba(0,0,0,0.35)]
        z-[99999] transition-all duration-300">

  <div class="max-w-6xl mx-auto flex justify-around items-center px-4 py-2
              text-[11px] sm:text-[14px] font-semibold select-none">

    <a href="shop.html" id="nav-home" class="nav-link-new group">
      <svg class="nav-icon group-hover:scale-110" viewBox="0 0 24 24" fill="currentColor">
        <path d="M3 9.75L12 3l9 6.75V21H4V9.75z"/>
      </svg>
      <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </a>

    <a href="cart.html" id="nav-cart" class="nav-link-new group relative">
      <svg class="nav-icon group-hover:scale-110" viewBox="0 0 24 24" fill="currentColor">
        <path d="M7 4H5L3 8H1v2h3l3.6 7.59L5.24 17A3 3 0 0 0 8 21h11v-2H8l1.1-2h8.45A3 3 0 0 0 20 15l2-9H6.31L5.36 4z"/>
      </svg>
      <span>Ø§Ù„Ø³Ù„Ø©</span>
      <span id="cartBadge"
        class="absolute -top-1 right-2 bg-red-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden">0</span>
    </a>

    <a href="wallet.html" id="nav-wallet" class="nav-link-new group relative">
      <svg id="walletIcon" class="nav-icon group-hover:scale-110 transition"
           fill="currentColor" viewBox="0 0 24 24">
        <path d="M21 7H5V5h16v2zm0 2v10H3V7h2v2h16zM7 15h8v2H7v-2z"/>
      </svg>
      <span>Ø§Ù„Ù…Ø­ÙØ¸Ø©</span>
      <span id="walletBalance"
        class="absolute -top-2 right-2 bg-green-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-lg">0 Ø¬.Ù…</span>
    </a>

    <a href="my-orders.html" id="nav-orders" class="nav-link-new group">
      <svg class="nav-icon group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
        <path d="M3 6v14h14V18H5V6H3zm17-2H8v12h12V4zm-2 8h-8V6h8v6z"/>
      </svg>
      <span>Ø·Ù„Ø¨Ø§ØªÙŠ</span>
    </a>

    <a id="nav-menu" class="nav-link-new group">
      <svg class="nav-icon group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
        <path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/>
      </svg>
      <span>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span>
    </a>

  </div>
</nav>


<div id="menuOverlay"
  class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-[99990]"></div>

<div id="sideMenu"
  class="fixed top-0 right-0 w-72 h-full bg-[#0d0d0f] shadow-2xl z-[99999]
  translate-x-full transition-all duration-300 p-6 border-l border-[#222]">

  <button id="closeMenu" class="text-2xl text-red-500 mb-6 font-bold">âœ–</button>

  <h3 class="text-xl font-bold text-gray-200 mb-4">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3>

  <ul class="space-y-3 text-lg font-semibold text-gray-300">

    <li><a href="shop.html" class="block hover:text-blue-400">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
    <li><a href="about.html" class="block hover:text-blue-400">â„¹ï¸ Ù…Ù† Ù†Ø­Ù†</a></li>
    <li><a href="support.html" class="block hover:text-blue-400">ğŸ“ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a></li>
    <li><a href="shipping-policy.html" class="block hover:text-blue-400">ğŸšš Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø´Ø­Ù†</a></li>
    <li><a href="return-policy.html" class="block hover:text-blue-400">ğŸ”„ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a></li>

    <hr class="border-gray-700">

    <li><a href="profile.html" class="block hover:text-blue-400">ğŸ‘¤ Ù…Ù„ÙÙŠ</a></li>
<ul class="space-y-3 text-lg font-semibold text-gray-300">

  <div id="userAreaMenu"
       class="mb-4 p-3 rounded-lg bg-[#111] border border-gray-700">
  </div>


  </ul>
</div>

<script>
const navMenu     = document.getElementById("nav-menu");
const sideMenu    = document.getElementById("sideMenu");
const closeMenu   = document.getElementById("closeMenu");
const menuOverlay = document.getElementById("menuOverlay");

navMenu.addEventListener("click", () => {
  sideMenu.classList.remove("translate-x-full");
  menuOverlay.classList.remove("hidden");
});

closeMenu.addEventListener("click", () => {
  sideMenu.classList.add("translate-x-full");
  menuOverlay.classList.add("hidden");
});

menuOverlay.addEventListener("click", () => {
  sideMenu.classList.add("translate-x-full");
  menuOverlay.classList.add("hidden");
});
</script>




  <main class="flex-1 max-w-7xl mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-3 gap-8">
    <section class="lg:col-span-2">
      <div class="bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-100">
        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
              ğŸ›ï¸
            </div>
            <div>
              <h2 class="text-2xl font-bold">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
              <p class="text-blue-100 text-sm">Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªØ¹Ø¯ÙŠÙ„ Ù…Ø´ØªØ±ÙŠØ§ØªÙƒ</p>
            </div>
          </div>
        </div>
        
        <div class="p-6">
          <div id="cartList" class="space-y-4"></div>

          <div id="empty" class="text-center py-12 hidden">
            <div class="w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center text-4xl">
              ğŸ›ï¸
            </div>
            <h3 class="text-xl font-bold text-gray-600 mb-2">Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©</h3>
            <p class="text-gray-500 mb-4">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø±Ø§Ø¦Ø¹Ø© Ø¥Ù„Ù‰ Ø³Ù„ØªÙƒ</p>
            <a href="shop.html" class="inline-flex items-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-3 rounded-xl font-semibold hover:shadow-lg transition-all">
              ğŸ›ï¸ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†
            </a>
          </div>
        </div>
        
        <div class="bg-gradient-to-r from-amber-50 to-orange-50 border-t border-amber-200 p-4">
          <div class="flex items-start gap-3">
            <div class="w-8 h-8 bg-amber-500 rounded-full flex items-center justify-center text-white text-sm font-bold">
              â„¹ï¸
            </div>
            <div class="text-sm text-amber-800">
              <p class="font-semibold mb-1">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„:</p>
              <p>â€¢ ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙˆØµÙŠÙ„: <span class="font-bold">10% Ù„ÙƒÙ„ Ù‚Ø·Ø¹Ø©</span></p>
              <p>â€¢ Ù…Ø¯Ø© Ø§Ù„ØªÙˆØµÙŠÙ„: <span class="font-bold">Ø­ØªÙ‰ 3 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„</span></p>
              <p>â€¢ Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <aside class="space-y-6">
      <div class="bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-100">
        <div class="bg-gradient-to-r from-emerald-600 to-teal-600 text-white p-6">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
              ğŸ“Š
            </div>
            <h3 class="text-xl font-bold">Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h3>
          </div>
        </div>
        
        <div class="p-6 space-y-4">
          <div class="space-y-3">
            <div class="flex justify-between items-center py-2 border-b border-gray-100">
              <span class="text-gray-600">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù</span>
              <span id="itemCount" class="font-semibold">0</span>
            </div>
            <div class="flex justify-between items-center py-2 border-b border-gray-100">
              <span class="text-gray-600">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</span>
              <span id="subtotal" class="font-semibold">0 Ø¬.Ù…</span>
            </div>
            <div class="flex justify-between items-center py-2 border-b border-gray-100">
              <span class="text-gray-600">Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span>
              <span id="deliveryFee" class="font-semibold text-orange-600">0 Ø¬.Ù…</span>
            </div>
            <div class="flex justify-between items-center py-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl px-4">
              <span class="font-bold text-lg">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
              <span id="grandTotal" class="font-bold text-2xl text-blue-600">0 Ø¬.Ù…</span>
            </div>
          </div>

        </div>
      </div>
      
      <div class="bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-100">
        <div class="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-6">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
              ğŸ‘¤
            </div>
            <h3 class="text-xl font-bold">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
          </div>
        </div>
        
        <div class="p-6">

      <div id="customerInfo" class="space-y-2">
        <input id="custName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" class="w-full border p-2 rounded" />
        <input id="custPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="w-full border p-2 rounded" />
        <input id="custAddress" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„" class="w-full border p-2 rounded" />
      </div>
      
      <div class="mt-3 text-center">
        <button id="editInfoBtn" class="hidden bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <button id="saveInfoBtn" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      </div>

        </div>
      </div>
      
      <div class="bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-100">
        <div class="bg-gradient-to-r from-indigo-600 to-blue-600 text-white p-6">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
              ğŸ’³
            </div>
            <h3 class="text-xl font-bold">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h3>
          </div>
        </div>
        
        <div class="p-6">
          <div class="space-y-3">
            <label class="flex items-center gap-3 p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-blue-300 transition-colors payment-option">
              <input type="radio" name="pay" value="cod" checked class="w-5 h-5 text-blue-600" />
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                  ğŸ’µ
                </div>
                <div>
                  <div class="font-semibold">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</div>
                  <div class="text-sm text-gray-500">Ø§Ø¯ÙØ¹ Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨</div>
                </div>
              </div>
            </label>
            
            <label class="flex items-center gap-3 p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-blue-300 transition-colors payment-option">
              <input type="radio" name="pay" value="vodafone" class="w-5 h-5 text-blue-600" />
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center">
                  ğŸ“±
                </div>
                <div>
                  <div class="font-semibold">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</div>
                  <div class="text-sm text-gray-500">Ø§Ø¯ÙØ¹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø­ÙØ¸ØªÙƒ</div>
                </div>
              </div>
            </label>
            
            <label class="flex items-center gap-3 p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-blue-300 transition-colors payment-option">
              <input type="radio" name="pay" value="wallet" class="w-5 h-5 text-blue-600" />
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                  ğŸ’°
                </div>
                <div>
                  <div class="font-semibold">Ø§Ù„Ø¯ÙØ¹ Ù…Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©</div>
                  <div class="text-sm text-gray-500">Ø§Ø³ØªØ®Ø¯Ù… Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ù…ØªØ§Ø­</div>
                </div>
              </div>
            </label>
          </div>
      </div>

      <div id="vodafoneArea" class="mt-3 hidden">
        <label class="small-muted mb-1 block">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´ (Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø³Ù„ Ø£Ùˆ Ø±Ù‚Ù… Ø­ÙˆØ§Ù„Ø©)</label>
        <input id="vodafoneNumber" class="w-full border p-2 rounded" placeholder="Ù…Ø«Ø§Ù„: 01XXXXXXXXX" />
        <label class="small-muted mt-2 block">Ø§Ø±ÙÙ‚ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ â€” Ø³ØªØ­ØªØ§Ø¬ Ù„Ø¥Ø±ÙØ§Ù‚Ù‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹ ÙÙŠ ÙˆØ§ØªØ³Ø§Ø¨)</label>
        <input id="receiptFile" type="file" accept="image/*" />
        <div id="receiptPreview" class="mt-2"></div>
      </div>

      <div id="codNote" class="mt-3 small-muted">
        ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: Ø³Ù†Ø·Ù„Ø¨ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ Ù„Ù„ØªÙˆØ§ØµÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ….
      </div>

        </div>
      </div>
      
      <div class="space-y-3">
        <button id="checkoutBtn" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-4 px-6 rounded-2xl shadow-xl hover:shadow-2xl transform hover:scale-105 transition-all duration-300 text-lg">
          <div class="flex items-center justify-center gap-3">
            <span class="text-2xl">âœ…</span>
            <span>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡</span>
          </div>
        </button>
        
        <button id="clearBtn" class="w-full bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white font-semibold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
          <div class="flex items-center justify-center gap-2">
            <span>ğŸ—‘ï¸</span>
            <span>ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</span>
          </div>
        </button>
      </div>
    </aside>
  </main>
<section>
      <h2 class="text-xl font-bold text-blue-800 mb-3">âœ¨ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ</h2>
      <div id="interestProducts" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
    </section>

  <div id="toast" class="toast"></div>



  <footer class="text-gray-100 mt-16">
    <div class="max-w-7xl mx-auto px-4 py-12 grid grid-cols-1 md:grid-cols-4 gap-10">
      <div>
        <img src="/lv12.ico" class="w-14 h-14 rounded mb-3" alt="LV12 logo">
        <h4 class="font-bold text-lg text-white mb-1">Ù…ØªØ¬Ø± LV12</h4>
        <p class="text-sm text-gray-300">Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø© ØªØ³ÙˆÙ‚ Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª â€” Ø´Ø­Ù† Ø³Ø±ÙŠØ¹ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ù…Ø¶Ù…ÙˆÙ†.</p>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">Ø±ÙˆØ§Ø¨Ø· Ù…ÙÙŠØ¯Ø©</h4>
        <ul class="space-y-2 text-sm text-gray-300">
          <li><a href="about.html" class="hover:text-white">Ù…Ù† Ù†Ø­Ù†</a></li>
          <li><a href="return-policy.html" class="hover:text-white">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a></li>
          <li><a href="shipping-policy.html" class="hover:text-white">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø´Ø­Ù†</a></li>
          <li><a href="support.html" class="hover:text-white">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h4>
        <a href="mailto:shoplv12shop@gmail.com" class="inline-block bg-blue-50 hover:bg-blue-100 text-blue-700 px-4 py-2 rounded-lg text-sm font-medium transition">
          ğŸ“§ shoplv12shop@gmail.com
        </a>
        <a href="tel:01094965067" class="block text-blue-200 text-lg font-bold hover:underline mt-2">
          ğŸ“ 01094965067
        </a>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">ØªØ§Ø¨Ø¹Ù†Ø§</h4>
        <div class="flex gap-3">
<div class="flex items-center justify-center gap-4 mt-4 text-sm font-semibold">
  <a href="https://www.facebook.com/share/1KEzAxHzzS/" target="_blank"
     class="flex items-center gap-1 text-blue-600 hover:text-blue-800 transition-all duration-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
      <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 5.003 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.463h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.891h-2.33v6.987C18.343 21.128 22 17.003 22 12z"/>
    </svg>
    Facebook
  </a>

  <a href="https://www.tiktok.com/@lv12shop1?_r=1&_t=ZS-91JONZZLeZJ" target="_blank"
     class="flex items-center gap-1 text-gray-800 hover:text-black transition-all duration-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
      <path d="M16.5 3a5.5 5.5 0 0 0 5.5 5.5V11a8.5 8.5 0 0 1-8.5-8.5h3zM9 8a5 5 0 1 0 5 5V4h3v9a8 8 0 1 1-8-8h3v3H9z"/>
    </svg>
    TikTok
  </a>

  <a href="https://www.instagram.com/lv12.shop?igsh=MTQxc3lsM24wb2Fmdg==" target="_blank"
     class="flex items-center gap-1 text-pink-600 hover:text-pink-700 transition-all duration-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
      <path d="M7 2C4.243 2 2 4.243 2 7v10c0 2.757 2.243 5 5 5h10c2.757 0 5-2.243 5-5V7c0-2.757-2.243-5-5-5H7zm0 2h10c1.654 0 3 1.346 3 3v10c0 1.654-1.346 3-3 3H7c-1.654 0-3-1.346-3-3V7c0-1.654 1.346-3 3-3zm5 2a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm0 2a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm4.5-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
    </svg>
    Instagram
  </a>
</div>

        
        </div>
      </div>
    </div>
    <div class="border-t border-blue-800 text-center py-4 text-sm text-blue-100">
      Â© <span id="yearFooter"></span> LV12 â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
    </div>
  </footer>
<style>
:root {
  --primary: #4da8ff;       
  --primary-dark: #1f71d8; 
  --secondary: #7b5bff;     
  --accent: #9fd8ff;        

  --bg-light: linear-gradient(180deg, #0e1a33, #111f3f, #13264e); 
  --bg-box: rgba(255,255,255,0.10);

  --text-dark: #f4f7ff;     
  --text-gray: #cdd6ea;

  --radius: 18px;
  --shadow: 0 6px 30px rgba(0,0,0,0.35);
  --transition: .3s ease;
}


header {
  background: linear-gradient(90deg, #122040, #1b2f55, #122040);
  border-bottom: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 6px 20px rgba(0,0,0,0.45);
}


.search-bar input {
  background: rgba(255,255,255,0.14);
  border: 1px solid rgba(255,255,255,0.18);
  color: white;
}
.search-bar input:focus {
  box-shadow: 0 0 0 3px rgba(77,168,255,0.4);
}


.product-card {
  background: rgba(255,255,255,0.10);
  border: 1px solid rgba(255,255,255,0.14);
  backdrop-filter: blur(8px);
}
.product-card h3 {
  color: #eaf1ff;
}
.price-new {
  color: #4da8ff;
}
.price-old {
  color: #b8c3db;
}

#categoriesBar {
  background: #162443;
}
.category-item {
  background: #1c2f57;
  border: 1px solid rgba(255,255,255,0.10);
}
.category-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 26px rgba(0,0,0,0.5);
}


#mainNav {
  background: linear-gradient(90deg, #142544, #203a6d);
  border-top: 1px solid rgba(255,255,255,0.12);
}
.nav-icon {
  color: #aecdff;
}
.nav-link-new span {
  color: #cfd8f7;
}
.nav-link-new:hover .nav-icon {
  color: #4da8ff;
}


#sideMenu {
  background: #172a52;
  border-left: 1px solid rgba(255,255,255,0.14);
}
#sideMenu a {
  color: #dce6ff;
}
#sideMenu a:hover {
  color: var(--primary);
}

#closeMenu {
  color: #ff6b6b !important;
}


footer {
  background: linear-gradient(180deg, #152649, #111e36);
  color: #cbd5ec;
  border-top: 1px solid rgba(255,255,255,0.10);
}
footer a:hover {
  color: var(--primary);
}
</style>
  <script>
const SUPABASE_URL = "https://nszhzfysitppxssplqfb.supabase.co";
const SUPABASE_ANON_KEY =
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zemh6ZnlzaXRwcHhzc3BscWZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMzA4OTcsImV4cCI6MjA3MzgwNjg5N30.5KvK4bhqkZ_GpIfED4qecIMfeubAJYwSFJslULwOp-w";

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const cartList = document.getElementById("cartList");
const emptyEl = document.getElementById("empty");
const subtotalEl = document.getElementById("subtotal");
const deliveryFeeEl = document.getElementById("deliveryFee");
const grandEl = document.getElementById("grandTotal");
const itemCountEl = document.getElementById("itemCount");
const userArea = document.getElementById("userArea");
const vodafoneArea = document.getElementById("vodafoneArea");
const receiptFile = document.getElementById("receiptFile");
const receiptPreview = document.getElementById("receiptPreview");
const checkoutBtn = document.getElementById("checkoutBtn");
const clearBtn = document.getElementById("clearBtn");
const toastEl = document.getElementById("toast");

const custName = document.getElementById("custName");
const custPhone = document.getElementById("custPhone");
const custAddress = document.getElementById("custAddress");
const vodafoneNumber = document.getElementById("vodafoneNumber");
const editInfoBtn = document.getElementById("editInfoBtn");
const saveInfoBtn = document.getElementById("saveInfoBtn");
const customerInfo = document.getElementById("customerInfo");


let cart = JSON.parse(localStorage.getItem("cart") || "[]");
let currentUser = null;
let receiptDataUrl = null;


function showToast(msg, ok = true) {
  toastEl.textContent = msg;
  toastEl.style.background = ok ? "#16a34a" : "#dc2626";
  toastEl.style.display = "block";
  setTimeout(() => (toastEl.style.display = "none"), 3000);
}

function formatEGP(v) {
  return `${Number(v).toFixed(2)} Ø¬.Ù…`;
}

function calcTotals() {
  let subtotal = 0;
  let deliveryFee = 0;
  cart.forEach((item) => {
    const price = Number(item.price || 0);
    const qty = Number(item.quantity || 1);
    subtotal += price * qty;
    deliveryFee += price * qty * 0.1; 
  });
  const grand = subtotal + deliveryFee;
  return { subtotal, deliveryFee, grand };
}

async function renderCart() {
  cartList.innerHTML = "";
  if (!cart.length) {
    emptyEl.classList.remove("hidden");
    subtotalEl.textContent = "0 Ø¬.Ù…";
    deliveryFeeEl.textContent = "0 Ø¬.Ù…";
    grandEl.textContent = "0 Ø¬.Ù…";
    itemCountEl.textContent = "0";
    return;
  }
  emptyEl.classList.add("hidden");

  for (const [idx, it] of cart.entries()) {
    const imgUrl = await fetchProductImage(it.id);

    const price = Number(it.price || 0);
    const qty = Number(it.quantity || 1);
    const subtotalItem = price * qty;

    const div = document.createElement("div");
    div.className = "cart-item animate-slide-in";
    div.innerHTML = `
      <div class="flex items-center gap-4">
        <div class="relative group cursor-pointer" onclick="goToProduct(${it.id})">
          <img src="${imgUrl}" class="w-24 h-24 rounded-2xl object-cover shadow-lg group-hover:scale-105 transition-transform duration-300" />
          <div class="absolute inset-0 bg-black/20 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
            <span class="text-white font-bold text-sm">ğŸ‘ï¸ Ø¹Ø±Ø¶</span>
          </div>
        </div>
        
        <div class="flex-1">
          <h3 class="font-bold text-lg text-gray-800 mb-1 cursor-pointer hover:text-blue-600 transition-colors" onclick="goToProduct(${it.id})">
            ${escapeHtml(it.name)}
          </h3>
          <p class="text-gray-500 text-sm mb-3">${formatEGP(price)} Ù„Ù„ÙˆØ­Ø¯Ø©</p>
          
          <div class="flex items-center justify-between">
            <div class="quantity-controls">
              <button class="quantity-btn" onclick="decrease(${idx}); event.stopPropagation()">âˆ’</button>
              <input type="number" min="1" value="${qty}" 
                     class="w-16 text-center border-0 bg-transparent font-bold text-gray-800" 
                     onchange="setQty(${idx}, this.value)" />
              <button class="quantity-btn" onclick="increase(${idx}); event.stopPropagation()">+</button>
            </div>
            
            <div class="text-right">
              <div class="text-2xl font-bold text-blue-600 mb-1">${formatEGP(subtotalItem)}</div>
              <button onclick="removeItem(${idx}); event.stopPropagation()" 
                      class="text-red-500 hover:text-red-700 font-semibold text-sm hover:bg-red-50 px-3 py-1 rounded-lg transition-all">
                ğŸ—‘ï¸ Ø­Ø°Ù
              </button>
            </div>
          </div>
        </div>
      </div>
    `;
    cartList.appendChild(div);
  }

  const totals = calcTotals();
  subtotalEl.textContent = formatEGP(totals.subtotal);
  deliveryFeeEl.textContent = formatEGP(totals.deliveryFee);
  grandEl.textContent = formatEGP(totals.grand);
  itemCountEl.textContent = cart.length;
}


function goToProduct(id) {
  window.location.href = `product.html?id=${id}`;
}
function setQty(i, v) {
  cart[i].quantity = Math.max(1, parseInt(v) || 1);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}
function increase(i) {
  cart[i].quantity = (cart[i].quantity || 1) + 1;
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}
function decrease(i) {
  cart[i].quantity = Math.max(1, (cart[i].quantity || 1) - 1);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}
function removeItem(i) {
  cart.splice(i, 1);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
  showToast("ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬");
}

clearBtn.onclick = () => {
  if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©ØŸ")) {
    cart = [];
    localStorage.removeItem("cart");
    renderCart();
    showToast("ğŸ§¹ ØªÙ… ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©");
  }
};


receiptFile?.addEventListener?.("change", (e) => {
  const f = e.target.files[0];
  if (!f) {
    receiptPreview.innerHTML = "";
    receiptDataUrl = null;
    return;
  }
  if (!f.type.startsWith("image/")) {
    showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ ØµÙˆØ±Ø© ÙÙ‚Ø·", false);
    receiptFile.value = "";
    return;
  }
  const reader = new FileReader();
  reader.onload = () => {
    receiptDataUrl = reader.result;
    receiptPreview.innerHTML = `<img src="${receiptDataUrl}" class="w-40 rounded border" />`;
  };
  reader.readAsDataURL(f);
});

document.querySelectorAll('input[name="pay"]').forEach((r) => {
  r.addEventListener("change", () => {
    const val = document.querySelector('input[name="pay"]:checked').value;
    vodafoneArea.classList.toggle("hidden", val !== "vodafone");
  });
});

async function fetchProductImage(productId) {
  try {
    const { data, error } = await supabase
      .from("product_images")
      .select("image_url, is_primary, ordering")
      .eq("product_id", productId)
      .order("is_primary", { ascending: false })
      .order("ordering", { ascending: true })
      .limit(1)
      .single();

    if (error) return "https://placehold.co/100x80?text=LV12";
    return data?.image_url || "https://placehold.co/100x80?text=LV12";
  } catch {
    return "https://placehold.co/100x80?text=LV12";
  }
}
(async function checkLoginBeforeCart() {
  const { data } = await supabase.auth.getSession();
  const user = data?.session?.user;

  if (!user) {
    localStorage.setItem("redirectAfterLogin", window.location.pathname);
    window.location.href = "shop-login.html";
    return;
  }
})();
async function loadPaymentProfile() {
  if (!currentUser) return;
  const { data, error } = await supabase
    .from("payment_profiles")
    .select("*")
    .eq("user_id", currentUser.id)
    .single();

  if (!error && data) {
    custName.value = data.full_name;
    custPhone.value = data.phone;
    custAddress.value = data.address;
    
    // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    disableCustomerInfo(true);
    editInfoBtn.classList.remove("hidden");
    saveInfoBtn.classList.add("hidden");

    if (data.pay_method === "vodafone") {
      document.querySelector('input[value="vodafone"]').checked = true;
      vodafoneArea.classList.remove("hidden");
      vodafoneNumber.value = data.pay_ref || "";
    }
  }
}

function disableCustomerInfo(disabled) {
  custName.disabled = disabled;
  custPhone.disabled = disabled;
  custAddress.disabled = disabled;
  if (disabled) {
    customerInfo.classList.add("opacity-75");
  } else {
    customerInfo.classList.remove("opacity-75");
  }
}

async function saveCustomerInfo() {
  if (!currentUser) return;
  
  const name = custName.value.trim();
  const phone = custPhone.value.trim();
  const address = custAddress.value.trim();
  
  if (!name || !phone || !address) {
    showToast("âŒ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„", false);
    return;
  }
  
  const { error } = await supabase
    .from("payment_profiles")
    .upsert({
      user_id: currentUser.id,
      full_name: name,
      phone: phone,
      address: address
    }, { onConflict: "user_id" });
    
  if (error) {
    showToast("âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", false);
    return;
  }
  
  disableCustomerInfo(true);
  editInfoBtn.classList.remove("hidden");
  saveInfoBtn.classList.add("hidden");
  showToast("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
}

editInfoBtn.addEventListener("click", () => {
  disableCustomerInfo(false);
  editInfoBtn.classList.add("hidden");
  saveInfoBtn.classList.remove("hidden");
});

saveInfoBtn.addEventListener("click", saveCustomerInfo);
async function loadWallet() {
  if (!currentUser) return;

  const { data, error } = await supabase
    .from("wallet")
    .select("balance")
    .eq("user_id", currentUser.id)
    .single();

  if (error) {
    console.warn("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø­ÙØ¸Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯");
    return;
  }

  if (data) {
    document.getElementById("walletBalance").textContent =
      `Ø±ØµÙŠØ¯ÙŠ: ${data.balance} Ø¬.Ù…`;
      
  }
}

async function logUserActivity(type) {
  const user = JSON.parse(localStorage.getItem('lv12_user') || '{}');
  await supabase.from('user_activity').insert({
    user_id: user.id || null,
    user_display: user.name || 'Ø²Ø§Ø¦Ø±',
    type
  });
}

logUserActivity('Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±');

async function checkAuth() {
  const { data } = await supabase.auth.getSession();
  const user = data?.session?.user;
  if (user) {
    currentUser = user;
    const name = user.user_metadata?.full_name || user.email.split("@")[0];
    userArea.innerHTML = `ğŸ‘¤ ${escapeHtml(name)}`;
    if (user.user_metadata?.phone) custPhone.value = user.user_metadata.phone;
  } else {
    userArea.innerHTML = `<a href="shop-login.html" class="text-blue-600 underline">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>`;
  }
}
async function loadWallet() {
  if (!currentUser) {
    document.getElementById("walletBalance").textContent = "";
    return;
  }

  try {
    const { data, error } = await supabase
      .from("wallet")
      .select("balance")
      .eq("user_id", currentUser.id)
      .single();

    if (error && error.code === "PGRST116") {
    }

    let balance = 0;
    if (data && typeof data.balance !== "undefined" && data.balance !== null) {
      balance = Number(data.balance);
    } else {
      await supabase.from("wallet").upsert({ user_id: currentUser.id, balance: 0 }, { onConflict: "user_id" });
      balance = 0;
    }

    document.getElementById("walletBalance").textContent = `Ø±ØµÙŠØ¯ÙŠ: ${Number(balance).toFixed(2)} Ø¬.Ù…`;
    return balance;
  } catch (err) {
    console.error("loadWallet error:", err);
    document.getElementById("walletBalance").textContent = "";
    return 0;
  }
}
async function pushWalletHistory(user_id, amount, type, note = "") {
  try {
    await supabase.from("wallet_history").insert({
      user_id,
      amount,
      type,
      note
    });
  } catch (err) {
    console.warn("ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø­ÙØ¸Ø©:", err);
  }
}

checkoutBtn.addEventListener("click", async () => {
  if (!custName.value.trim() || !custPhone.value.trim() || !custAddress.value.trim()) {
    showToast("âŒ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©", false);
    return;
  }

  if (!cart.length) {
    showToast("ğŸ›’ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©", false);
    return;
  }

  if (!currentUser) {
    showToast("ğŸ” ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹", false);
    setTimeout(() => (window.location.href = "shop-login.html"), 800);
    return;
  }

  const selectedPay = document.querySelector('input[name="pay"]:checked')?.value || "cod";
  const payRef = vodafoneNumber.value.trim() || null;

  const deliveryISO = new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString();

  const totals = calcTotals();
  const grand = Number(totals.grand || 0);

  const { data: walletData } = await supabase
    .from("wallet")
    .select("balance")
    .eq("user_id", currentUser.id)
    .single();

  let walletBalance = walletData?.balance ? Number(walletData.balance) : 0;
  let walletDeducted = 0;
  let remainingToPay = grand;

  if (selectedPay === "wallet") {
    if (walletBalance < grand) {
      showToast("âŒ Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ ÙÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨", false);
      return;
    }
    walletDeducted = grand;
    remainingToPay = 0;
  } else {
    walletDeducted = 0;
    remainingToPay = grand;
  }

  const newBalance = +(walletBalance - walletDeducted).toFixed(2);
  if (walletDeducted > 0) {
    await supabase.from("wallet").update({ balance: newBalance }).eq("user_id", currentUser.id);
    await supabase
      .from("wallet_history")
      .insert({
        user_id: currentUser.id,
        amount: -walletDeducted,
        type: "order_payment",
        note: `Ø®ØµÙ… Ù…Ù‚Ø§Ø¨Ù„ Ø´Ø±Ø§Ø¡ Ù…Ù†ØªØ¬Ø§Øª`,
        details: `ØªÙ… Ø®ØµÙ… ${walletDeducted} Ø¬.Ù… Ù„Ø´Ø±Ø§Ø¡ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ù‚ÙŠÙ…Ø© ${grand} Ø¬.Ù…`,
      });
  }

  const finalPaymentMethod = walletDeducted > 0
    ? (remainingToPay > 0 ? "mixed" : "wallet")
    : selectedPay;

  const orders = cart.map(p => ({
    user_id: currentUser.id,
    seller_id: p.seller_id,       

    name: custName.value.trim(),
    phone: custPhone.value.trim(),
    address: custAddress.value.trim(),

    product_id: p.id,
    quantity: p.quantity || 1,
    price: p.price,
    total_price: p.price * (p.quantity || 1),

    status: "pending",
    delivery_status: "pending",

    payment_method: finalPaymentMethod,
    payment_ref: payRef,
    wallet_paid: walletDeducted,
    remaining_to_pay: remainingToPay,

    delivery_date: deliveryISO,
    created_at: new Date().toISOString(),
  }));

  const { data: insertedOrders } = await supabase.from("orders").insert(orders).select();

  if (insertedOrders?.length) {
    for (const order of insertedOrders) {
      await supabase.from("wallet_admin_log").insert({
        user_id: currentUser.id,
        order_id: order.id,
        action: "Ø®ØµÙ… Ù…Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©",
        amount: -walletDeducted,
        note: `Ø®ØµÙ… ${walletDeducted} Ø¬.Ù… Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${currentUser.email}`,
      });
    }
  }

  const phoneWithCode = `20${"01094965067".replace(/^0/, "")}`;
  let msg = `ğŸ›ï¸ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ù…ØªØ¬Ø± LV12%0A`;
  msg += `ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${custName.value}%0AğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${custPhone.value}%0AğŸ  Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${custAddress.value}%0A`;
  msg += `ğŸ’° Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ${
    finalPaymentMethod === "mixed"
      ? `Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© (${formatEGP(walletDeducted)}), ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ ${selectedPay}`
      : selectedPay === "cod"
      ? "ÙƒØ§Ø´ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…"
      : selectedPay === "vodafone"
      ? "ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´"
      : "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"
  }%0A`;
  if (payRef) msg += `ğŸ“„ Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø¯ÙØ¹: ${payRef}%0A`;
  msg += `------------------%0A`;
  cart.forEach((c, i) => {
    msg += `${i + 1}) ${c.name} Ã— ${c.quantity} = ${formatEGP(c.price * c.quantity)}%0A`;
  });
  msg += `------------------%0AØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${formatEGP(grand)}%0A`;

  window.open(`https://wa.me/${phoneWithCode}?text=${msg}`, "_blank");

  localStorage.removeItem("cart");
  cart = [];
  renderCart();
  showToast("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­");
  setTimeout(() => (window.location.href = "my-orders.html"), 1200);
});



(async function init() {
  await checkAuth();
  await loadPaymentProfile();
  await loadWallet(); 
  renderCart();
})();



function escapeHtml(s = "") {
  return String(s || "").replace(/[&<>"']/g, (m) => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#039;" }[m]));
}
</script>
<script>
async function renderUserInterests() {
  const container = document.getElementById("interestProducts");
  if (!container) return;

  try {
    const { data: session } = await supabase.auth.getSession();
    const user = session?.session?.user;

    if (!user) {
      container.innerHTML = `<p class="text-gray-500 text-center py-4">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø¹Ø±Ø¶ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ â¤ï¸</p>`;
      return;
    }

    const { data: interests, error } = await supabase
      .from("user_interests")
      .select("product_id")
      .eq("user_id", user.id)
      .order("created_at", { ascending: false })
      .limit(12);

    if (error) throw error;

    if (!interests?.length) {
      container.innerHTML = `<p class="text-gray-500 text-center py-4">Ù„Ù… ØªÙ‚Ù… Ø¨Ø²ÙŠØ§Ø±Ø© Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯ ğŸ‘€</p>`;
      return;
    }

    const ids = interests.map(i => i.product_id);

    const { data: products, error: pErr } = await supabase
      .from("products")
      .select(`
        id, name, price, discount_price,
        product_images(image_url, is_primary)
      `)
      .in("id", ids);

    if (pErr) throw pErr;

    if (!products?.length) {
      container.innerHTML = `<p class="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¨Ø¹Ø¯</p>`;
      return;
    }

    container.innerHTML = products.map(p => {
      const img =
        (p.product_images?.find(im => im.is_primary)?.image_url) ||
        (p.product_images?.[0]?.image_url) ||
        "/assets/no-image.png";

      const price = p.discount_price ?? p.price;
      return `
        <div class="bg-white rounded-xl shadow hover:shadow-lg transition p-2 cursor-pointer"
             onclick="location.href='product.html?id=${p.id}'">
          <img src="${img}" class="w-full h-40 object-cover rounded-lg mb-2" alt="${p.name}">
          <h3 class="font-semibold text-sm text-gray-800 truncate">${p.name}</h3>
          <p class="text-blue-600 font-bold text-sm">${price} Ø¬.Ù…</p>
        </div>
      `;
    }).join("");

  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª:", err);
    container.innerHTML = `<p class="text-red-500 text-center py-4">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª ğŸ˜</p>`;
  }
}

document.addEventListener("DOMContentLoaded", renderUserInterests);
</script>


<script>
(async () => {
  try {
    const res = await fetch("https://ipwho.is/");
    const data = await res.json();

    const sec = data.security || {};
    const net = data.connection || {};
    const isp = (data.isp || "").toLowerCase();
    const org = (net.org || "").toLowerCase();
    const country = data.country_code || "??";

    const safeCountries = ["EG", "SA", "AE", "KW", "JO", "QA", "OM", "DZ", "MA", "TN", "LY", "BH", "IQ", "SD", "YE", "SY", "PS"];

    const suspicious =
      sec.vpn ||
      sec.proxy ||
      sec.tor ||
      sec.relay ||
      (!isp && !safeCountries.includes(country)) || 
      /vpn|proxy|tor|hosting|cloudflare|aws|azure|google|digitalocean|ovh|linode|hetzner|server/i.test(
        isp + org
      );

    if (suspicious && !safeCountries.includes(country)) {
      document.documentElement.innerHTML = `
        <div style="
          position:fixed;inset:0;background:#0b0f19;
          color:#fff;display:flex;flex-direction:column;
          align-items:center;justify-content:center;
          font-family:'Cairo',sans-serif;text-align:center;
          padding:20px;z-index:999999;
        ">
          <div style="max-width:500px;">
            <h2 style="font-size:26px;margin-bottom:12px;">ğŸš« ØªÙ… Ø­Ø¸Ø± Ø§Ù„ÙˆØµÙˆÙ„</h2>
            <p style="font-size:16px;line-height:1.8;">
              ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø§ØªØµØ§Ù„ ØºÙŠØ± Ù…ÙˆØ«ÙˆÙ‚ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… VPN / Proxy.<br>
              ÙŠØ±Ø¬Ù‰ Ø¥ÙŠÙ‚Ø§ÙÙ‡ Ø«Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.<br><br>
              <b>Ø¹Ù†ÙˆØ§Ù†Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ:</b> ${data.ip || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}<br>
              <b>Ø§Ù„Ø¨Ù„Ø¯:</b> ${data.country || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}
            </p>
            <button onclick="location.reload()" style="
              margin-top:25px;background:#2563eb;color:white;
              border:none;padding:10px 20px;border-radius:8px;
              cursor:pointer;font-size:15px;">
              ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
            </button>
          </div>
        </div>
      `;
      throw new Error("Blocked: Suspicious VPN/Proxy connection");
    }

    console.log(
      `âœ… VPN check passed | IP: ${data.ip} | Country: ${country} | ISP: ${isp || "unknown"}`
    );
  } catch (err) {
    console.warn("âš ï¸ VPN check failed:", err);
  }
})();
</script>

</body>
</html>
