<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ğŸ›ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ§Ø¬Ø± â€” LV12</title>

  <link rel="icon" type="image/png" href="/lv12.png" sizes="32x32">
  <link rel="apple-touch-icon" href="/lv12.png">
  <meta name="theme-color" content="#2563eb">

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>

body {
  font-family: "Cairo", sans-serif;
  background: linear-gradient(180deg, #f9fafb 0%, #f3f4f6 100%);
  min-height: 100vh;
}

h1, h2, h3 {
  font-weight: 700;
  color: #1e40af;
}

.btn {
  background: linear-gradient(90deg, #2563eb, #1d4ed8);
  color: #fff;
  padding: 10px 16px;
  border-radius: 10px;
  font-weight: 600;
  transition: all .2s ease-in-out;
  box-shadow: 0 2px 6px rgba(37, 99, 235, 0.25);
}

.btn:hover {
  transform: scale(1.03);
  box-shadow: 0 4px 10px rgba(37, 99, 235, 0.35);
}

.card {
  background: #fff;
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.05);
  transition: all .2s ease-in-out;
}

.card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.08);
}

.footer {
  text-align: center;
  font-size: 0.85rem;
  color: #6b7280;
  margin-top: 40px;
  padding: 10px 0;
}



#myProductsList {
  display: grid;
  gap: 1rem;
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

@media (min-width: 640px) {
  #myProductsList {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
}

@media (min-width: 1024px) {
  #myProductsList {
    grid-template-columns: repeat(4, minmax(0, 1fr));
  }

  #myProductsList .product-card {
    min-width: 240px !important;
    max-width: 260px !important;
    transform: scale(1.05);
  }
}

@media (min-width: 1280px) {
  #myProductsList {
    grid-template-columns: repeat(5, minmax(0, 1fr));
  }

  #myProductsList .product-card {
    min-width: 260px !important;
    max-width: 280px !important;
  }
}

.product-card {
  transition: 0.2s ease;
}

.product-card:hover {
  transform: scale(1.07);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

#mainHeader {
  transform: none !important;
  left: 0 !important;
  right: 0 !important;
}


:root {
  --primary: #4da8ff;
  --primary-dark: #1f71d8;
  --secondary: #7b5bff;
  --accent: #9fd8ff;

  --bg-light: linear-gradient(180deg, #0e1a33, #111f3f, #13264e);
  --bg-box: rgba(255,255,255,0.10);

  --text-dark: #f4f7ff;
  --text-gray: #cdd6ea;

  --radius: 18px;
  --shadow: 0 6px 30px rgba(0,0,0,0.35);
  --transition: .3s ease;
}

footer {
  background: linear-gradient(180deg, #152649, #111e36);
  color: #cbd5ec;
  border-top: 1px solid rgba(255,255,255,0.10);
}

footer a:hover {
  color: var(--primary);
}

  </style>
</head>

<body class="p-4 sm:p-6">
<main class="max-w-6xl mx-auto">
<header class="flex flex-col sm:flex-row sm:items-center justify-between gap-6 mb-8 
               bg-white/70 backdrop-blur-md rounded-2xl shadow-lg p-6 border border-blue-200">

  <!-- Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£ÙŠØ³Ø±: Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø¬Ø± -->
  <div class="flex items-center gap-4">
    <div class="relative">
      <img src="https://cdn-icons-png.flaticon.com/512/891/891462.png"
           class="w-14 h-14 rounded-full ring-2 ring-blue-400 shadow-md" alt="logo" />
      <span class="absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 border-2 border-white rounded-full"></span>
    </div>

    <div>
      <h1 class="text-3xl font-extrabold text-blue-800 flex items-center gap-2">
        ğŸ›ï¸ <span id="storeName">Ù…ØªØ¬Ø± Ø§Ù„ØªØ§Ø¬Ø±</span>
      </h1>
      <p class="text-sm text-gray-600 mt-1">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ø³Ù‡ÙˆÙ„Ø© ğŸš€</p>
    </div>
  </div>

  <div class="flex flex-wrap items-center justify-end gap-4">

    <div class="flex flex-col text-right">
      <span id="userName" class="font-semibold text-gray-900 text-lg">...</span>
      <span class="text-gray-500 text-xs">ØªØ§Ø¬Ø± Ù…Ø³Ø¬Ù‘Ù„</span>
    </div>

    <div class="hidden sm:block h-8 border-l border-gray-300"></div>

    <div class="bg-blue-50 border border-blue-200 rounded-xl px-5 py-2 text-center shadow-sm hover:shadow-md transition">
      <div class="text-blue-700 font-extrabold text-xl" id="storeProductsCount">0</div>
      <div class="text-xs text-gray-600">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
    </div>

    <a href="seller-delivery.html"
       class="bg-gradient-to-r from-purple-600 to-purple-500 text-white px-5 py-2.5 
              rounded-lg flex items-center gap-2 hover:scale-105 transition font-semibold shadow">
      ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    </a>

    <a href="shop.html" target="_blank"
       class="bg-gradient-to-r from-blue-600 to-blue-500 text-white px-5 py-2.5 rounded-lg 
              flex items-center gap-2 hover:scale-105 transition font-semibold shadow">
      ğŸª Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±
    </a>

  </div>
</header>




<style>
#mainHeader {
  transform: none !important;
  left: 0 !important;
  right: 0 !important;
}


</style>

<nav id="mainNav"
  class="fixed bottom-0 left-0 w-full 
        bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900
        text-white border-t border-blue-900/30
        shadow-[0_-4px_20px_rgba(0,0,0,0.35)]
        z-[99999] transition-all duration-300">

  <div class="max-w-6xl mx-auto flex justify-around items-center px-4 py-2
              text-[11px] sm:text-[14px] font-semibold select-none">

    <a href="shop.html" id="nav-home" class="nav-link-new group">
      <svg class="nav-icon group-hover:scale-110" viewBox="0 0 24 24" fill="currentColor">
        <path d="M3 9.75L12 3l9 6.75V21H4V9.75z"/>
      </svg>
      <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </a>

    <a href="cart.html" id="nav-cart" class="nav-link-new group relative">
      <svg class="nav-icon group-hover:scale-110" viewBox="0 0 24 24" fill="currentColor">
        <path d="M7 4H5L3 8H1v2h3l3.6 7.59L5.24 17A3 3 0 0 0 8 21h11v-2H8l1.1-2h8.45A3 3 0 0 0 20 15l2-9H6.31L5.36 4z"/>
      </svg>
      <span>Ø§Ù„Ø³Ù„Ø©</span>
      <span id="cartBadge"
        class="absolute -top-1 right-2 bg-red-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden">0</span>
    </a>

    <a href="wallet.html" id="nav-wallet" class="nav-link-new group relative">
      <svg id="walletIcon" class="nav-icon group-hover:scale-110 transition"
           fill="currentColor" viewBox="0 0 24 24">
        <path d="M21 7H5V5h16v2zm0 2v10H3V7h2v2h16zM7 15h8v2H7v-2z"/>
      </svg>
      <span>Ø§Ù„Ù…Ø­ÙØ¸Ø©</span>
      <span id="walletBalance"
        class="absolute -top-2 right-2 bg-green-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-lg">0 Ø¬.Ù…</span>
    </a>

    <a href="my-orders.html" id="nav-orders" class="nav-link-new group">
      <svg class="nav-icon group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
        <path d="M3 6v14h14V18H5V6H3zm17-2H8v12h12V4zm-2 8h-8V6h8v6z"/>
      </svg>
      <span>Ø·Ù„Ø¨Ø§ØªÙŠ</span>
    </a>

    <a id="nav-menu" class="nav-link-new group">
      <svg class="nav-icon group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
        <path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/>
      </svg>
      <span>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span>
    </a>

  </div>
</nav>


<div id="menuOverlay"
  class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-[99990]"></div>

<div id="sideMenu"
  class="fixed top-0 right-0 w-72 h-full bg-[#0d0d0f] shadow-2xl z-[99999]
  translate-x-full transition-all duration-300 p-6 border-l border-[#222]">

  <button id="closeMenu" class="text-2xl text-red-500 mb-6 font-bold">âœ–</button>

  <h3 class="text-xl font-bold text-gray-200 mb-4">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3>

  <ul class="space-y-3 text-lg font-semibold text-gray-300">

    <li><a href="shop.html" class="block hover:text-blue-400">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
    <li><a href="about.html" class="block hover:text-blue-400">â„¹ï¸ Ù…Ù† Ù†Ø­Ù†</a></li>
    <li><a href="support.html" class="block hover:text-blue-400">ğŸ“ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a></li>
    <li><a href="shipping-policy.html" class="block hover:text-blue-400">ğŸšš Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø´Ø­Ù†</a></li>
    <li><a href="return-policy.html" class="block hover:text-blue-400">ğŸ”„ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a></li>

    <hr class="border-gray-700">

    <li><a href="profile.html" class="block hover:text-blue-400">ğŸ‘¤ Ù…Ù„ÙÙŠ</a></li>
<ul class="space-y-3 text-lg font-semibold text-gray-300">

  <div id="userAreaMenu"
       class="mb-4 p-3 rounded-lg bg-[#111] border border-gray-700">
  </div>


  </ul>
</div>

<script>
const navMenu     = document.getElementById("nav-menu");
const sideMenu    = document.getElementById("sideMenu");
const closeMenu   = document.getElementById("closeMenu");
const menuOverlay = document.getElementById("menuOverlay");

navMenu.addEventListener("click", () => {
  sideMenu.classList.remove("translate-x-full");
  menuOverlay.classList.remove("hidden");
});

closeMenu.addEventListener("click", () => {
  sideMenu.classList.add("translate-x-full");
  menuOverlay.classList.add("hidden");
});

menuOverlay.addEventListener("click", () => {
  sideMenu.classList.add("translate-x-full");
  menuOverlay.classList.add("hidden");
});
</script>




  <section class="grid lg:grid-cols-3 gap-6">
    
    
    <aside class="bg-white shadow-sm border rounded-xl p-5">
  <div class="flex flex-col items-center text-center mb-4">
    <img src="https://cdn-icons-png.flaticon.com/512/891/891462.png" class="w-16 mb-2" alt="add-icon" />
    <h2 class="text-xl font-bold text-blue-700">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
    <p class="text-gray-500 text-sm">Ø§Ù…Ù„Ø£ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¥Ø±Ø³Ø§Ù„ Ù…Ù†ØªØ¬ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>
  </div>

  <form id="productForm" class="space-y-4" onsubmit="addProduct(event)">
    <input id="productName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" class="w-full border rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500" required />

    <div class="grid grid-cols-2 gap-2">
      <input id="productPrice" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø¬.Ù…)" class="border rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500" required />
      <input id="productQuantity" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" class="border rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500" required />
    </div>

<select id="productCategory" class="w-full border rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500">
  <option>ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª...</option>
</select>

    <textarea id="productDesc" rows="4" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬" class="w-full border rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500"></textarea>

    <div>
      <label class="text-sm font-semibold text-gray-700 mb-1 block">ğŸ“¸ ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬ (Ø­ØªÙ‰ 5 ØµÙˆØ±)</label>
      <input id="productImages" type="file" accept="image/*" multiple class="w-full border-dashed border-2 border-gray-300 rounded-lg p-3 text-sm bg-gray-50 hover:bg-gray-100 transition" />
      <div id="imagesPreview" class="mt-3 flex gap-2 overflow-x-auto"></div>
    </div>

    <div class="grid grid-cols-2 gap-2">
      <input id="productDiscountPercent" type="number" min="0" max="100" placeholder="Ù†Ø³Ø¨Ø© Ø®ØµÙ… (%)" class="border rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500" />
      <input id="productDiscountFixed" type="number" min="0" step="0.01" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…" class="border rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500" />
    </div>

    <div class="grid grid-cols-2 gap-2">
      <label class="block font-medium text-gray-700 mt-2">ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø®ØµÙ…</label>
      <input id="discountStart" type="date" class="border p-2 rounded w-full focus:ring-2 focus:ring-blue-500" />

      <label class="block font-medium text-gray-700 mt-2">ØªØ§Ø±ÙŠØ® Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø®ØµÙ…</label>
      <input id="discountEnd" type="date" class="border p-2 rounded w-full focus:ring-2 focus:ring-blue-500" />
    </div>
<div class="mt-4">
  <label class="block font-semibold text-gray-800 mb-1">ğŸ™ï¸ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¯Ø§Ø®Ù„ Ù…ØµØ±</label>
  <p class="text-sm text-gray-600 mb-2">Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª Ø§Ù„ØªÙŠ ÙŠØªÙˆÙØ± ÙÙŠÙ‡Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ø£Ùˆ Ø§Ø®ØªØ± "<strong class="text-blue-600">ğŸŸ¢ Ø§Ù„Ø¬Ù…ÙŠØ¹</strong>".</p>
  <div id="governorates-list" class="border rounded-lg p-3 bg-gray-50 max-h-56 overflow-y-auto">
    <div class="flex items-center mb-2">
      <input type="checkbox" id="city-all" class="w-4 h-4 accent-blue-600" />
      <label for="city-all" class="ml-2 font-semibold text-blue-700">ğŸŸ¢ Ø§Ù„Ø¬Ù…ÙŠØ¹</label>
    </div>
  </div>
</div>

    <div class="mt-4">
      <label class="block font-semibold text-gray-800 mb-1">ğŸŒ Ù…Ø±Ø¦ÙŠ Ù„Ù„Ø¬Ù…ÙŠØ¹ (Ø®Ø§Ø±Ø¬ Ù…ØµØ±)</label>
      <div class="flex items-center gap-3 border rounded-lg p-2 bg-gray-50">
        <input id="visibleToAll" type="checkbox" checked class="w-5 h-5 accent-green-600" />
        <span class="text-sm text-gray-600">Ø¥Ø°Ø§ ØªÙ… ØªÙØ¹ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø®ÙŠØ§Ø±ØŒ Ø³ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø±Ø¦ÙŠÙ‹Ø§ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø®Ø§Ø±Ø¬ Ù…ØµØ±.</span>
      </div>
    </div>

    <div class="mt-4">
      <label class="block font-semibold text-gray-800 mb-1">ğŸšš Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù„ÙƒÙ„ Ù…Ø¯ÙŠÙ†Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      <textarea id="deliveryByCity" placeholder='{"Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯":10,"Ø§Ù„Ø§Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©":30}' rows="2" class="border p-2 rounded w-full focus:ring-2 focus:ring-blue-500"></textarea>
      <small class="text-gray-500">Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆÙ‚Øª Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ Ù…Ø«Ù„ {"Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©":15} Ø£Ùˆ Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºÙ‹Ø§.</small>
    </div>

    <div class="flex gap-2 mt-4">
      <button id="previewBtn" type="button" class="flex-1 bg-gray-100 text-gray-700 py-2 rounded-lg hover:bg-gray-200">ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø©</button>
      <button id="addProductBtn" type="submit" class="flex-1 bg-gradient-to-r from-blue-600 to-blue-500 text-white py-2 rounded-lg hover:scale-[1.02] transition">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
  </form>
</aside>

<div id="myProductsList"
     class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 px-4">
</div>
<div class="text-center mt-6">
  <button id="loadMoreBtn" class="hidden bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition">
    Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯
  </button>
</div>

<h2 class="font-bold text-orange-600 mt-6 mb-2">ğŸ•“ Ù…Ù†ØªØ¬Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h2>
<div id="pending-grid"
     class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
</div>

<h2 class="font-bold text-red-600 mt-6 mb-2">âŒ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø±ÙÙˆØ¶Ø©</h2>
<div id="rejected-grid"
     class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
</div>

<script>
function getProductImage(p) {
  if (p.primary_image && typeof p.primary_image === "string" && p.primary_image.trim() !== "") {
    return p.primary_image;
  }

  if (p.image_url && typeof p.image_url === "string" && p.image_url.trim() !== "") {
    return p.image_url;
  }

  if (Array.isArray(p.images) && p.images.length > 0) {
    return p.images[0];
  }

  if (p.image && typeof p.image === "string" && p.image.trim() !== "") {
    return p.image;
  }

  return "/placeholder.png";
}
async function getPrimaryImage(productId) {
  const { data } = await supabase
    .from("product_images")
    .select("image_url")
    .eq("product_id", productId)
    .order("is_primary", { ascending: false })
    .limit(1);

  return data?.length ? data[0].image_url : null;
}

async function loadViewsCount(id) {
  const { count } = await supabase
    .from("page_visits")
    .select("id", { count: "exact", head: true })
    .eq("product_id", id);
  return count || 0;
}

async function loadSalesCount(id) {
  const { count } = await supabase
    .from("orders")
    .select("id", { count: "exact", head: true })
    .eq("product_id", id);
  return count || 0;
}
function buildProductCard(p, views, sales, color = "blue") {
  const img = getProductImage(p);
  const quantity = p.stock ?? 0;

  return `
    <div class="bg-white shadow-md rounded-xl p-4 border border-gray-200 hover:shadow-xl transition-all
                flex flex-col w-full min-w-[180px] lg:min-w-[260px] lg:p-5">

      <div class="relative w-full h-40 lg:h-52">
        <img src="${img}" class="w-full h-full object-cover rounded-lg">
        
        ${p.discount > 0 ? `
          <span class="absolute top-2 right-2 bg-red-600 text-white text-xs px-2 py-1 rounded-lg shadow">
            Ø®ØµÙ… ${p.discount}%
          </span>
        ` : ""}
      </div>

      <h3 class="font-bold text-gray-800 text-base mt-3 line-clamp-1 lg:text-lg">${p.name}</h3>

      <div class="text-sm mt-1 text-gray-700 lg:text-base">
        <span>${p.price} Ø¬.Ù…</span>
        ${p.discount > 0 ? `
          <span class="line-through text-gray-400 ml-2">${p.discount_price} Ø¬.Ù…</span>
        ` : ""}
      </div>

      <p class="text-xs text-gray-500 mt-1 lg:text-sm">Ø§Ù„ÙØ¦Ø©: ${p.category || "â€”"}</p>
      <p class="text-xs text-gray-600 font-semibold lg:text-sm">Ø§Ù„ÙƒÙ…ÙŠØ©: ${quantity}</p>

      <div class="flex justify-between text-xs text-gray-500 mt-2 lg:text-sm">
        <span>ğŸ‘ï¸ ${views}</span>
        <span>ğŸ›’ ${sales}</span>
      </div>

      <a href="product.html?id=${p.id}"
         class="mt-4 block text-center bg-blue-600 text-white py-2 rounded-lg text-sm shadow hover:bg-blue-700 transition lg:py-3 lg:text-base">
         Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬
      </a>

    </div>
  `;
}



async function loadMyProducts() {
  const grid = document.getElementById("myProductsList");

  grid.innerHTML = `
    <div class="col-span-5 text-center text-gray-500 p-4">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  `;

  const { data, error } = await supabase
    .from("products")
    .select("*")
    .eq("seller_id", currentUser.id)
    .order("created_at", { ascending: false });

  if (error || !data || data.length === 0) {
    console.warn("Products Load Error:", error);
    grid.innerHTML = `
      <div class="col-span-5 text-center text-gray-500 p-4">
        Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª
      </div>`;
    return;
  }

  console.log("Products from DB:", data);

  const cards = await Promise.all(
    data.map(async p => {
      p.primary_image = await getPrimaryImage(p.id);

      const views = await loadViewsCount(p.id);
      const sales = await loadSalesCount(p.id);

      p._image = getProductImage(p);
      console.log("Product:", p.name, "| Image Used:", p._image);

      return buildProductCard(p, views, sales);
    })
  );

  grid.innerHTML = cards.join("");
}


async function loadPendingProducts() {
  const grid = document.getElementById("pending-grid");

  const { data, error } = await supabase
    .from("pending_products")
    .select("*")
    .eq("seller_id", currentUser.id)
    .order("created_at", { ascending: false });

  if (error || !data?.length) {
    grid.innerHTML = `<p class="text-gray-500 text-sm col-span-3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>`;
    return;
  }

  grid.innerHTML = data.map(p => buildProductCard(p, 0, 0, "orange")).join("");
}
async function loadRejectedProducts() {
  const grid = document.getElementById("rejected-grid");

  const { data, error } = await supabase
    .from("pending_products")
    .select("*")
    .eq("seller_id", currentUser.id)
    .eq("status", "rejected")
    .order("created_at", { ascending: false });

  if (error || !data?.length) {
    grid.innerHTML = `<p class="text-gray-500 text-sm col-span-3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø±ÙÙˆØ¶Ø©</p>`;
    return;
  }

  grid.innerHTML = data.map(p => `
    ${buildProductCard(p, 0, 0, "red")}
    <p class="text-xs text-red-600 mt-1">Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶: ${p.reject_reason || "ØºÙŠØ± Ù…Ø°ÙƒÙˆØ±"}</p>
  `).join("");
}


</script>

</main>
<div id="ordersList" class="mt-4"></div>



  <footer class="text-gray-100 mt-16">
    <div class="max-w-7xl mx-auto px-4 py-12 grid grid-cols-1 md:grid-cols-4 gap-10">
      <div>
        <img src="/lv12.ico" class="w-14 h-14 rounded mb-3" alt="LV12 logo">
        <h4 class="font-bold text-lg text-white mb-1">Ù…ØªØ¬Ø± LV12</h4>
        <p class="text-sm text-gray-300">Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø© ØªØ³ÙˆÙ‚ Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª â€” Ø´Ø­Ù† Ø³Ø±ÙŠØ¹ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ù…Ø¶Ù…ÙˆÙ†.</p>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">Ø±ÙˆØ§Ø¨Ø· Ù…ÙÙŠØ¯Ø©</h4>
        <ul class="space-y-2 text-sm text-gray-300">
          <li><a href="about.html" class="hover:text-white">Ù…Ù† Ù†Ø­Ù†</a></li>
          <li><a href="return-policy.html" class="hover:text-white">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a></li>
          <li><a href="shipping-policy.html" class="hover:text-white">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø´Ø­Ù†</a></li>
          <li><a href="support.html" class="hover:text-white">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h4>
        <a href="mailto:shoplv12shop@gmail.com" class="inline-block bg-blue-50 hover:bg-blue-100 text-blue-700 px-4 py-2 rounded-lg text-sm font-medium transition">
          ğŸ“§ shoplv12shop@gmail.com
        </a>
        <a href="tel:01094965067" class="block text-blue-200 text-lg font-bold hover:underline mt-2">
          ğŸ“ 01094965067
        </a>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">ØªØ§Ø¨Ø¹Ù†Ø§</h4>
        <div class="flex gap-3">
<div class="flex items-center justify-center gap-4 mt-4 text-sm font-semibold">
  <a href="https://www.facebook.com/share/1KEzAxHzzS/" target="_blank"
     class="flex items-center gap-1 text-blue-600 hover:text-blue-800 transition-all duration-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
      <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 5.003 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.463h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.891h-2.33v6.987C18.343 21.128 22 17.003 22 12z"/>
    </svg>
    Facebook
  </a>

  <a href="https://www.tiktok.com/@lv12shop1?_r=1&_t=ZS-91JONZZLeZJ" target="_blank"
     class="flex items-center gap-1 text-gray-800 hover:text-black transition-all duration-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
      <path d="M16.5 3a5.5 5.5 0 0 0 5.5 5.5V11a8.5 8.5 0 0 1-8.5-8.5h3zM9 8a5 5 0 1 0 5 5V4h3v9a8 8 0 1 1-8-8h3v3H9z"/>
    </svg>
    TikTok
  </a>

  <a href="https://www.instagram.com/lv12.shop?igsh=MTQxc3lsM24wb2Fmdg==" target="_blank"
     class="flex items-center gap-1 text-pink-600 hover:text-pink-700 transition-all duration-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
      <path d="M7 2C4.243 2 2 4.243 2 7v10c0 2.757 2.243 5 5 5h10c2.757 0 5-2.243 5-5V7c0-2.757-2.243-5-5-5H7zm0 2h10c1.654 0 3 1.346 3 3v10c0 1.654-1.346 3-3 3H7c-1.654 0-3-1.346-3-3V7c0-1.654 1.346-3 3-3zm5 2a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm0 2a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm4.5-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
    </svg>
    Instagram
  </a>
</div>

        
        </div>
      </div>
    </div>
    <div class="border-t border-blue-800 text-center py-4 text-sm text-blue-100">
      Â© <span id="yearFooter"></span> LV12 â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
    </div>
  </footer>
<style>
:root {
  --primary: #4da8ff;       
  --primary-dark: #1f71d8; 
  --secondary: #7b5bff;     
  --accent: #9fd8ff;        

  --bg-light: linear-gradient(180deg, #0e1a33, #111f3f, #13264e); 
  --bg-box: rgba(255,255,255,0.10);

  --text-dark: #f4f7ff;     
  --text-gray: #cdd6ea;

  --radius: 18px;
  --shadow: 0 6px 30px rgba(0,0,0,0.35);
  --transition: .3s ease;
}


footer {
  background: linear-gradient(180deg, #152649, #111e36);
  color: #cbd5ec;
  border-top: 1px solid rgba(255,255,255,0.10);
}
footer a:hover {
  color: var(--primary);
}
</style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    const SUPABASE_URL = "https://nszhzfysitppxssplqfb.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zemh6ZnlzaXRwcHhzc3BscWZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMzA4OTcsImV4cCI6MjA3MzgwNjg5N30.5KvK4bhqkZ_GpIfED4qecIMfeubAJYwSFJslULwOp-w";
    
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);


async function loadCategories() {
  const sel = document.getElementById("productCategory");
  if (!sel) {
    console.error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ØµØ± productCategory");
    return;
  }

  sel.innerHTML = `<option>ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª.</option>`;

  try {
    console.log('Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„ÙØ¦Ø§Øª.');

    const [{ data: prodCats = [], error: prodError },
           { data: pendingCats = [], error: pendingError }] = await Promise.all([
      supabase.from("products").select("category").not("category", "is", null),
      supabase.from("pending_products").select("category").not("category", "is", null)
    ]);

    if (prodError) console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ÙØ¦Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:", prodError);
    if (pendingError) console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ÙØ¦Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©:", pendingError);

    const combined = [
      ...prodCats.map(r => r.category),
      ...pendingCats.map(r => r.category)
    ].filter(Boolean);

    console.log("Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…Ø¯Ù…Ø¬Ø©:", combined);

    const unique = [...new Set(combined)];

    console.log("Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ÙØ±ÙŠØ¯Ø©:", unique);

    if (!unique.length) {
      sel.innerHTML = `<option value="">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¦Ø§Øª Ù…ØªØ§Ø­Ø©</option>`;
      return;
    }

    sel.innerHTML =
      `<option value="">ğŸ—‚ï¸ Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>` +
      unique.map(c => `<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`).join("");

  } catch (err) {
    console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª:", err);
    sel.innerHTML = `<option value="">âš ï¸ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª</option>`;
  }
}
 
  </script>



<script>



let currentUser = null;

async function uploadImageToStorage(file, targetPath){
  try{
    const { data, error } = await supabase.storage.from("products").upload(targetPath, file, { cacheControl: '3600', upsert: false });
    if(error) throw error;
    const { data: urlData } = supabase.storage.from("products").getPublicUrl(targetPath);
    return urlData?.publicUrl || null;
  }catch(err){
    console.error("Ø®Ø·Ø£ Ø±ÙØ¹ ØµÙˆØ±Ø©:", err);
    return null;
  }
}
function loadGovernorates() {
  const governorates = [
    "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©","Ø§Ù„Ø¬ÙŠØ²Ø©","Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©","Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©","Ø§Ù„Ø´Ø±Ù‚ÙŠØ©","Ø§Ù„ØºØ±Ø¨ÙŠØ©",
    "Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©","Ø§Ù„Ø¨Ø­ÙŠØ±Ø©","ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®","Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©","Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯","Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©",
    "Ø§Ù„Ø³ÙˆÙŠØ³","Ø¯Ù…ÙŠØ§Ø·","Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ","Ø§Ù„ÙÙŠÙˆÙ…","Ø§Ù„Ù…Ù†ÙŠØ§","Ø£Ø³ÙŠÙˆØ·","Ø³ÙˆÙ‡Ø§Ø¬",
    "Ù‚Ù†Ø§","Ø§Ù„Ø£Ù‚ØµØ±","Ø£Ø³ÙˆØ§Ù†","Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±","Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯","Ù…Ø·Ø±ÙˆØ­",
    "Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡","Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡",

    "Ø­Ù„ÙˆØ§Ù†","Ù…Ø¯ÙŠÙ†Ø© 6 Ø£ÙƒØªÙˆØ¨Ø±","Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø´ÙŠØ® Ø²Ø§ÙŠØ¯","Ø§Ù„Ø¹Ø§Ø´Ø± Ù…Ù† Ø±Ù…Ø¶Ø§Ù†",
    "Ø¨Ø¯Ø±","Ø§Ù„Ø´Ø±ÙˆÙ‚","Ø§Ù„ØªØ¬Ù…Ø¹ Ø§Ù„Ø®Ø§Ù…Ø³","Ø§Ù„Ù…Ù‚Ø·Ù…","Ù…Ø¯ÙŠÙ†Ø© Ù†ØµØ±",
    "Ù…ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©","Ø§Ù„Ù…Ø¹Ø§Ø¯ÙŠ","Ø§Ù„Ø¹Ø¨ÙˆØ±","Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©",

    "Ø§Ù„Ø³Ø§Ø¯Ø³ Ù…Ù† Ø£ÙƒØªÙˆØ¨Ø±","Ø§Ù„Ø¨Ø¯Ø±Ø´ÙŠÙ†","Ø§Ù„Ø¹ÙŠØ§Ø·","Ø§Ù„ØµÙ","Ø£Ø¨Ùˆ Ø§Ù„Ù†Ù…Ø±Ø³",
    "Ø¥Ù…Ø¨Ø§Ø¨Ø©","ÙƒØ±Ø¯Ø§Ø³Ø©","Ù…Ù†Ø´Ø£Ø© Ø§Ù„Ù‚Ù†Ø§Ø·Ø±","Ø§Ù„Ø­ÙˆØ§Ù…Ø¯ÙŠØ©",

    "Ø§Ù„Ø¹Ø§Ù…Ø±ÙŠØ©","Ø¨Ø±Ø¬ Ø§Ù„Ø¹Ø±Ø¨","Ø³ÙŠØ¯ÙŠ Ø¨Ø´Ø±","Ø§Ù„Ø¹Ø¬Ù…ÙŠ","Ù…Ø­Ø±Ù… Ø¨Ùƒ",

    "Ø¯Ù…Ù†Ù‡ÙˆØ±","ÙƒÙØ± Ø§Ù„Ø¯ÙˆØ§Ø±","Ø§Ù„Ù†ÙˆØ¨Ø§Ø±ÙŠØ©","ÙƒÙˆÙ… Ø­Ù…Ø§Ø¯Ø©","Ø¥ÙŠØªØ§ÙŠ Ø§Ù„Ø¨Ø§Ø±ÙˆØ¯",
    "Ø£Ø¨Ùˆ Ø­Ù…Øµ","Ø±Ø´ÙŠØ¯","Ø¥Ø¯ÙƒÙˆ","Ø­ÙˆØ´ Ø¹ÙŠØ³Ù‰","Ø§Ù„Ø¯Ù„Ù†Ø¬Ø§Øª",

    "Ø§Ù„Ù…Ù†ØµÙˆØ±Ø©","Ø·Ù„Ø®Ø§","Ù…ÙŠØª ØºÙ…Ø±","Ø¯ÙƒØ±Ù†Ø³","Ø´Ø±Ø¨ÙŠÙ†",
    "Ø¨Ù„Ù‚Ø§Ø³","Ø§Ù„Ø¬Ù…Ø§Ù„ÙŠØ©","Ø§Ù„Ø³Ù†Ø¨Ù„Ø§ÙˆÙŠÙ†","Ù…Ù†ÙŠØ© Ø§Ù„Ù†ØµØ±",

    "Ø·Ù†Ø·Ø§","Ø§Ù„Ù…Ø­Ù„Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰","ÙƒÙØ± Ø§Ù„Ø²ÙŠØ§Øª","Ø²ÙØªÙ‰","Ø§Ù„Ø³Ù†Ø·Ø©",
    "Ù‚Ø·ÙˆØ±","Ø¨Ø³ÙŠÙˆÙ†","Ø³Ù…Ù†ÙˆØ¯",

    "ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®","Ø¯Ø³ÙˆÙ‚","ÙÙˆÙ‡","Ø§Ù„Ø±ÙŠØ§Ø¶","Ø§Ù„Ø­Ø§Ù…ÙˆÙ„",
    "Ø¨Ù„Ø·ÙŠÙ…","Ù…Ø·ÙˆØ¨Ø³","Ø³ÙŠØ¯ÙŠ Ø³Ø§Ù„Ù…","Ø¨ÙŠÙ„Ø§",

    "Ø´Ø¨ÙŠÙ† Ø§Ù„ÙƒÙˆÙ…","Ù…Ù†ÙˆÙ","Ø³Ø±Ø³ Ø§Ù„Ù„ÙŠØ§Ù†","Ù‚ÙˆÙŠØ³Ù†Ø§","Ø§Ù„Ø¨Ø§Ø¬ÙˆØ±",
    "ØªÙ„Ø§","Ø¨Ø±ÙƒØ© Ø§Ù„Ø³Ø¨Ø¹","Ø£Ø´Ù…ÙˆÙ†",

    "Ø§Ù„Ø²Ù‚Ø§Ø²ÙŠÙ‚","Ø§Ù„Ø¹Ø§Ø´Ø± Ù…Ù† Ø±Ù…Ø¶Ø§Ù†","Ø¨Ù„Ø¨ÙŠØ³","Ù…Ù†ÙŠØ§ Ø§Ù„Ù‚Ù…Ø­",
    "Ø£Ø¨Ùˆ ÙƒØ¨ÙŠØ±","Ø£Ø¨Ùˆ Ø­Ù…Ø§Ø¯","Ø¯ÙŠØ±Ø¨ Ù†Ø¬Ù…","ÙØ§Ù‚ÙˆØ³","Ù‡Ù‡ÙŠØ§",

    "Ø¨Ù†Ù‡Ø§","Ø´Ø¨Ø±Ø§ Ø§Ù„Ø®ÙŠÙ…Ø©","Ù‚Ù„ÙŠÙˆØ¨","Ø§Ù„Ø®Ø§Ù†ÙƒØ©","Ø·ÙˆØ®",
    "Ø§Ù„Ø®ØµÙˆØµ","Ù‚Ù‡Ø§","Ø´Ø¨ÙŠÙ† Ø§Ù„Ù‚Ù†Ø§Ø·Ø±","Ø§Ù„Ù‚Ù†Ø§Ø·Ø± Ø§Ù„Ø®ÙŠØ±ÙŠØ©",

    "Ø´Ø±Ù… Ø§Ù„Ø´ÙŠØ®","Ø¯Ù‡Ø¨","Ù†ÙˆÙŠØ¨Ø¹","Ø·Ø§Ø¨Ø§","Ø³Ø§Ù†Øª ÙƒØ§ØªØ±ÙŠÙ†",
    "Ø£Ø¨Ùˆ Ø±Ø¯ÙŠØ³","Ø£Ø¨Ùˆ Ø²Ù†ÙŠÙ…Ø©",

    "Ø§Ù„Ø¹Ø±ÙŠØ´","Ø±ÙØ­","Ø§Ù„Ø´ÙŠØ® Ø²ÙˆÙŠØ¯","Ø¨Ø¦Ø± Ø§Ù„Ø¹Ø¨Ø¯","Ø§Ù„Ø­Ø³Ù†Ø©",

    "Ø§Ù„ØºØ±Ø¯Ù‚Ø©","Ø§Ù„Ù‚ØµÙŠØ±","Ù…Ø±Ø³Ù‰ Ø¹Ù„Ù…","Ø±Ø£Ø³ ØºØ§Ø±Ø¨","Ø³ÙØ§Ø¬Ø§",

    "Ù…Ø±Ø³Ù‰ Ù…Ø·Ø±ÙˆØ­","Ø³ÙŠÙˆØ©","Ø§Ù„Ø¹Ù„Ù…ÙŠÙ†","Ø§Ù„Ø¶Ø¨Ø¹Ø©","Ø§Ù„Ù†Ø¬ÙŠÙ„Ø©",
    "Ø§Ù„Ø­Ù…Ø§Ù…","Ø¨Ø±Ø§Ù†ÙŠ",

    "Ø¯ÙŠØ±ÙˆØ·","Ù…Ù†ÙÙ„ÙˆØ·","Ø£Ø¨Ù†ÙˆØ¨","Ø£Ø¨Ùˆ ØªÙŠØ¬","Ø§Ù„ØºÙ†Ø§ÙŠÙ…",
    "Ø§Ù„ÙØªØ­","Ø³Ø§Ø­Ù„ Ø³Ù„ÙŠÙ…","ØµØ¯ÙØ§",

    "Ø³ÙˆÙ‡Ø§Ø¬","Ø¬Ø±Ø¬Ø§","Ø·Ù‡Ø·Ø§","Ø·Ù…Ø§","Ø£Ø®Ù…ÙŠÙ…",
    "Ø¯Ø§Ø± Ø§Ù„Ø³Ù„Ø§Ù…","Ø§Ù„Ù…Ø±Ø§ØºØ©","Ø§Ù„Ø¨Ù„ÙŠÙ†Ø§",

    "Ù‚Ù†Ø§","Ù†Ø¬Ø¹ Ø­Ù…Ø§Ø¯ÙŠ","Ù‚ÙˆØµ","Ø¯Ø´Ù†Ø§","Ù†Ù‚Ø§Ø¯Ø©","ÙØ±Ø´ÙˆØ·","Ø§Ù„ÙˆÙ‚Ù",

    "Ø§Ù„Ø£Ù‚ØµØ±","Ø§Ù„Ø¨ÙŠØ§Ø¶ÙŠØ©","Ø§Ù„Ø²ÙŠÙ†ÙŠØ©","Ø£Ø±Ù…Ù†Øª","Ø¥Ø³Ù†Ø§",

    "Ø£Ø³ÙˆØ§Ù†","Ø¯Ø±Ø§Ùˆ","ÙƒÙˆÙ… Ø£Ù…Ø¨Ùˆ","Ø¥Ø¯ÙÙˆ","Ù†ØµØ± Ø§Ù„Ù†ÙˆØ¨Ø©",

    "Ø§Ù„ÙÙŠÙˆÙ…","Ø³Ù†ÙˆØ±Ø³","Ø·Ø§Ù…ÙŠØ©","ÙŠÙˆØ³Ù Ø§Ù„ØµØ¯ÙŠÙ‚","Ø¥Ø·Ø³Ø§",

    "Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ","Ù†Ø§ØµØ±","Ø§Ù„ÙˆØ§Ø³Ø·Ù‰","Ø§Ù„ÙØ´Ù†","Ø³Ù…Ø³Ø·Ø§","Ø¥Ù‡Ù†Ø§Ø³ÙŠØ§","Ø¨Ø¨Ø§",

    "Ø§Ù„Ù…Ù†ÙŠØ§","Ù…Ø·Ø§ÙŠ","Ø¨Ù†ÙŠ Ù…Ø²Ø§Ø±","Ø£Ø¨Ùˆ Ù‚Ø±Ù‚Ø§Øµ","Ø³Ù…Ø§Ù„ÙˆØ·",
    "Ù…Ù„ÙˆÙŠ","Ø¯ÙŠØ± Ù…ÙˆØ§Ø³","Ø§Ù„Ø¹Ø¯ÙˆØ©",

    "Ø¯Ù…ÙŠØ§Ø·","Ø¯Ù…ÙŠØ§Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©","Ø±Ø£Ø³ Ø§Ù„Ø¨Ø±","ÙØ§Ø±Ø³ÙƒÙˆØ±","Ø§Ù„Ø²Ø±Ù‚Ø§","ÙƒÙØ± Ø³Ø¹Ø¯",

    "Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©","ÙØ§ÙŠØ¯","Ø§Ù„ØªÙ„ Ø§Ù„ÙƒØ¨ÙŠØ±","Ø§Ù„Ù‚Ù†Ø·Ø±Ø© Ø´Ø±Ù‚","Ø§Ù„Ù‚Ù†Ø·Ø±Ø© ØºØ±Ø¨",

    "Ø­ÙŠ Ø§Ù„Ø²Ù‡ÙˆØ±","Ø­ÙŠ Ø§Ù„Ø¹Ø±Ø¨","Ø­ÙŠ Ø§Ù„Ø¶ÙˆØ§Ø­ÙŠ","Ø¨ÙˆØ±ÙØ¤Ø§Ø¯",

    "Ø­ÙŠ ÙÙŠØµÙ„","Ø­ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø¹ÙŠÙ†","Ø­ÙŠ Ø§Ù„Ø¬Ù†Ø§ÙŠÙ†","Ø­ÙŠ Ø§Ù„Ø³ÙˆÙŠØ³"
  ];

  const list = el("governorates-list");

  governorates.forEach((city) => {
    const div = document.createElement("div");
    div.className = "flex items-center mb-2";

    div.innerHTML = `
      <input type="checkbox" class="city-option w-4 h-4 accent-blue-600" value="${city}">
      <label class="ml-2">${city}</label>
    `;

    list.appendChild(div);
  });

  const allBtn = el("city-all");

  allBtn.addEventListener("change", function () {
    const checked = this.checked;
    document.querySelectorAll(".city-option").forEach((c) => {
      c.checked = checked;
    });
  });

  list.addEventListener("change", (e) => {
    if (!e.target.classList.contains("city-option")) return;

    const allSelected = [...document.querySelectorAll(".city-option")]
      .every((c) => c.checked);

    el("city-all").checked = allSelected;
  });
}


function sanitizeFileName(n) {
  return n.replace(/[^a-z0-9\.\-_]/gi, "_");
}

const el = (id) => document.getElementById(id);


async function addProduct(e) {
  e.preventDefault();

  const currentUser = (await supabase.auth.getUser()).data.user;
  if (!currentUser) {
    toast("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹", false);
    return;
  }

  const name = el("productName").value.trim();
  const desc = el("productDesc").value.trim();
  const price = parseFloat(el("productPrice").value) || 0;
  const quantity = parseInt(el("productQuantity").value) || 0;
  const category = el("productCategory").value;
  
  const discount_price = parseFloat(el("productDiscountFixed").value) || null;
  const discount_percent = parseFloat(el("productDiscountPercent").value) || null;
  
  const imagesInput = el("productImages");

  if (!name || !price || !category) {
    toast("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ÙØ¦Ø©", false);
    return;
  }

  let finalDiscountPrice = discount_price;
  if (discount_percent && discount_percent > 0) {
    finalDiscountPrice = +(price - price * (discount_percent / 100)).toFixed(2);
  }


  const uploadedUrls = [];
  const files = Array.from(imagesInput.files);

  for (const file of files.slice(0, 5)) {
    const safeName = sanitizeFileName(file.name);
    const path = `pending/${currentUser.id}/${Date.now()}-${safeName}`;

    const { error: uploadErr } = await supabase
      .storage
      .from("products")
      .upload(path, file);

    if (uploadErr) {
      console.error(uploadErr);
      toast("âŒ ÙØ´Ù„ Ø±ÙØ¹ Ø¥Ø­Ø¯Ù‰ Ø§Ù„ØµÙˆØ±", false);
      continue;
    }

    const { data: urlData } = await supabase
      .storage
      .from("products")
      .getPublicUrl(path);

    if (urlData?.publicUrl) uploadedUrls.push(urlData.publicUrl);
  }
  const selectedCities = Array.from(
  document.querySelectorAll(".city-option:checked")
).map(el => el.value);
let deliveryByCity = {};

const deliveryRaw = document.getElementById("deliveryByCity")?.value?.trim();

if (deliveryRaw && /^\d+$/.test(deliveryRaw)) {
  const mins = `${deliveryRaw} Ø¯Ù‚ÙŠÙ‚Ø©`;

  if (selectedCities.includes("Ø§Ù„Ø¬Ù…ÙŠØ¹")) {
    governorates.forEach(city => {
      deliveryByCity[city] = mins;
    });
  } 
  else {
    selectedCities.forEach(city => {
      deliveryByCity[city] = mins;
    });
  }
}

else {
  try {
    const parsed = JSON.parse(deliveryRaw);
    if (typeof parsed === "object") {
      deliveryByCity = parsed;
    }
  } catch {
    toast("âš ï¸ ØµÙŠØºØ© Ø§Ù„ÙˆÙ‚Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©", false);
    return;
  }
}

const payload = {
  seller_id: currentUser.id,
  name,
  description: desc,
  price,
  quantity,
  category,
  images: uploadedUrls,

  discount: discount_percent || 0,
  discount_price: finalDiscountPrice || price,

  discount_start: document.getElementById("discountStart")?.value || null,
  discount_end: document.getElementById("discountEnd")?.value || null,

  cities: selectedCities.length ? selectedCities : null,
  delivery_time: document.getElementById("deliveryByCity")?.value || null,
  delivery_by_city: deliveryByCity || null,

  status: "pending",
  created_at: new Date().toISOString()
};


  const { error: insertErr } = await supabase
    .from("pending_products")
    .insert([payload]);

  if (insertErr) {
    console.error(insertErr);
    toast("âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©", false);
    return;
  }

  toast("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨Ù†Ø¬Ø§Ø­");

  el("productForm").reset();
  el("imagesPreview").innerHTML = "";
}

function toast(msg, ok = true) {
  const d = document.createElement("div");
  d.textContent = msg;
  d.style.cssText = `
    position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
    background:${ok ? "#16a34a" : "#dc2626"};
    color:white;padding:10px 14px;border-radius:8px;z-index:9999;
  `;
  document.body.appendChild(d);
  setTimeout(() => d.remove(), 3000);
}






async function checkUser(){
  try{
    const { data } = await supabase.auth.getSession();
    const user = data?.session?.user;
    if(!user){ window.location.href = "shop-login.html"; return; }

    const { data: profile, error } = await supabase.from("profiles").select("*").eq("id", user.id).single();
    if(error){ console.error("ÙØ´Ù„ Ø¬Ù„Ø¨ profile:", error); toast("âŒ ÙØ´Ù„ Ø¬Ù„Ø¨ Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ", false); return; }

    currentUser = profile;
    el("userName").textContent = profile.full_name || profile.email || shortId(profile.id);

    if(!profile.is_seller){
      toast("ğŸš« Ø­Ø³Ø§Ø¨Ùƒ Ù„ÙŠØ³ ØªØ§Ø¬Ø±Ù‹Ø§ Ø¨Ø¹Ø¯ â€” Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª", false);
      el("productForm").classList.add("opacity-50","pointer-events-none");
      return;
    }

  await loadMyProducts();
await loadPendingProducts();
await loadRejectedProducts();


  }catch(err){
    console.error("checkUser error:", err);
  }
}


function escapeHtml(s=''){ return String(s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#039;"}[m])); }
function shortId(u){ return (u||'').toString().slice(0,8); }

document.addEventListener("DOMContentLoaded", () => {
  if(!supabase) return console.error("supabase ØºÙŠØ± Ù…ÙÙ‡ÙŠØ£ â€” Ø¶Ø¹ Ù…ÙØªØ§Ø­ anon Ø§Ù„ØµØ­ÙŠØ­");

  if(!el("productDiscountPercent")){
    const wrapper = el("productForm");
    const discountBlock = document.createElement("div");
    discountBlock.className = "grid grid-cols-2 gap-2";
    discountBlock.innerHTML = `
      <input id="productDiscountPercent" type="number" min="0" max="100" placeholder="Ù†Ø³Ø¨Ø© Ø®ØµÙ… (%)" class="border rounded-xl p-3 text-sm" />
      <input id="productDiscountFixed" type="number" min="0" step="0.01" placeholder="Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ… (Ø¬.Ù…)" class="border rounded-xl p-3 text-sm" />
    `;
    const buttons = el("addProductBtn").parentElement;
    buttons.parentElement.insertBefore(discountBlock, buttons);
  }

  el("productImages").addEventListener("change", () => {
    const preview = el("imagesPreview");
    preview.innerHTML = "";
    Array.from(el("productImages").files).forEach(f => {
      const url = URL.createObjectURL(f);
      preview.innerHTML += `<img src="${escapeHtml(url)}" class="w-20 h-20 object-cover rounded border" />`;
    });
  });

  el("addProductBtn").addEventListener("click", addProduct);
  el("previewBtn").addEventListener("click", (ev) => {
    ev.preventDefault();
    const data = {
      name: el("productName").value,
      price: el("productPrice").value,
      qty: el("productQuantity").value,
      category: el("productCategory").value,
      desc: el("productDesc").value,
      imagesCount: (el("productImages").files || []).length,
      discountPercent: el("productDiscountPercent")?.value,
      discountFixed: el("productDiscountFixed")?.value
    };
    console.table(data);
    toast("ğŸ” Ù…Ø¹Ø§ÙŠÙ†Ø© (Ø§Ù†Ø¸Ø± Ø§Ù„Ù€ Console)");
  });

  checkUser();
});



async function updateOrderStatus(orderId, newStatus) {
  const { error } = await supabase
    .from('orders')
    .update({ delivery_status: newStatus })
    .eq('id', orderId);
  if (error) return alert('ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©');
  document.getElementById(`status-${orderId}`).textContent = newStatus;
  showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨');
}



async function saveTracking(orderId) {
  const comp = document.getElementById(`trackComp-${orderId}`).value;
  const num = document.getElementById(`trackNum-${orderId}`).value;
  const { error } = await supabase
    .from('orders')
    .update({ tracking_company: comp, tracking_number: num })
    .eq('id', orderId);
  if (error) return alert('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„ØªØªØ¨Ø¹');
  showToast('ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØªØ¨Ø¹');
}
</script>
</div> 
<div id="productModal" class="hidden fixed inset-0 z-50 items-center justify-center">
  <div id="modalBackdrop" class="absolute inset-0 bg-black/60"></div>
  <div class="relative max-w-3xl w-full mx-4">
    <div class="bg-white rounded-xl shadow-xl overflow-hidden">
      <div class="p-4 flex justify-between items-center border-b">
        <h3 id="modalTitle" class="text-lg font-bold"></h3>
        <button id="modalClose" class="text-gray-600 px-3 py-1 rounded hover:bg-gray-100">âœ–</button>
      </div>
      <div id="modalBody" class="p-4 max-h-[70vh] overflow-auto"></div>
    </div>
  </div>
</div>



<script>
document.addEventListener("DOMContentLoaded", async () => {
  await checkUser();
  await loadCategories();
  await loadGovernorates();
  await loadMerchantOrders();
});
</script>

</body>
</html>
