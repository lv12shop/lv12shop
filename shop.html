<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>متجر LV12 — تسوق بسهولة وأمان</title>
  <meta name="description" content="متجر LV12 — أحدث المنتجات بأسعار منافسة وتوصيل سريع. تسوق بسهولة وأمان." />
  <meta property="og:image" content="/assets/og-image.jpg" />
  <link rel="icon" href="/lv12.ico" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  :root {
    --lv-blue-500: #2563eb;
    --lv-blue-600: #1d4ed8;
    --lv-blue-700: #1e40af;
    --lv-gray-50: #f9fafb;
    --lv-gray-100: #f1f5f9;
    --lv-gray-800: #1e293b;
  }

  body {
    font-family: 'Cairo', sans-serif;
    scroll-behavior: smooth;
    background: var(--lv-gray-50);
    color: var(--lv-gray-800);
    line-height: 1.7;
    overflow-x: hidden;
  }

  .btn-main {
    background: linear-gradient(90deg, var(--lv-blue-500), var(--lv-blue-600));
    color: white;
    transition: all 0.25s ease;
    box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2);
  }
  .btn-main:hover {
    opacity: 0.95;
    transform: translateY(-2px);
    box-shadow: 0 6px 14px rgba(37, 99, 235, 0.25);
  }

  .btn-outline {
    border: 1.5px solid var(--lv-blue-500);
    color: var(--lv-blue-600);
    background: #fff;
    transition: all 0.25s ease;
  }
  .btn-outline:hover {
    background: var(--lv-blue-500);
    color: white;
  }

  .card-hover {
    transition: all 0.25s ease;
    background: #fff;
    border-radius: 1rem;
    overflow: hidden;
  }
  .card-hover:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.06);
  }

  header {
    backdrop-filter: blur(10px);
    background: rgba(255, 255, 255, 0.85);
  }

  #searchInput {
    transition: all 0.3s ease;
  }
  #searchInput:focus {
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
    border-color: var(--lv-blue-500);
  }

  #categoriesNavWrap button {
    white-space: nowrap;
    font-size: 0.9rem;
    padding: 0.4rem 1rem;
    border-radius: 9999px;
    background: #fff;
    border: 1px solid var(--lv-gray-100);
    transition: all 0.25s ease;
  }
  #categoriesNavWrap button:hover {
    background: var(--lv-blue-500);
    color: #fff;
  }
  #categoriesNavWrap .cat-btn.bg-blue-600 {
    background: var(--lv-blue-600);
    color: #fff;
  }

  section {
    border-radius: 1.5rem;
  }

  footer {
    font-size: 0.9rem;
  }
  footer a:hover {
    text-decoration: underline;
  }

  @media (max-width: 640px) {
    header .max-w-7xl {
      flex-direction: column;
      align-items: stretch;
      gap: 0.8rem;
    }
    header a img {
      width: 2.5rem;
      height: 2.5rem;
    }

    #searchInput {
      width: 100%;
      font-size: 0.9rem;
      padding: 0.5rem 1rem;
    }

    .btn-main, .btn-outline {
      width: 100%;
      text-align: center;
      padding: 0.75rem;
      font-size: 1rem;
      border-radius: 0.75rem;
    }

    h1, h2, h3 {
      font-size: 1.25rem;
      line-height: 1.4;
    }

    section {
      padding: 1.5rem 1rem;
    }

    .grid {
      gap: 1rem;
    }

    .card-hover {
      border-radius: 1rem;
      padding: 0.5rem;
    }

    #categoriesNavWrap {
      padding: 0.5rem 0.25rem;
      overflow-x: auto;
    }

    #categoriesNavWrap button {
      font-size: 0.8rem;
      padding: 0.3rem 0.9rem;
    }

    footer .grid {
      grid-template-columns: 1fr !important;
      gap: 2rem;
      text-align: center;
    }
  }

  @media (min-width: 641px) and (max-width: 1024px) {
    .btn-main, .btn-outline {
      font-size: 0.9rem;
      padding: 0.7rem 1.4rem;
    }
    h1, h2, h3 { font-size: 1.5rem; }
  }
</style>

</head>

<body class="antialiased">

  <header class="bg-white shadow-sm sticky top-0 z-50 border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between flex-wrap gap-3">
      <a href="index.html" class="flex items-center gap-3 group">
        <img src="/lv12.ico" class="w-10 h-10 rounded-md transition-transform group-hover:rotate-6" alt="LV12 logo" />
        <div>
          <h1 class="text-lg font-extrabold text-blue-700">متجر LV12</h1>
          <p class="text-xs text-gray-500">تسوق ذكي وسريع</p>
        </div>
      </a>

      <div class="flex-1 px-4 w-full sm:w-auto">
        <div class="relative">
          <input id="searchInput" type="search" placeholder="🔍 ابحث عن منتج..."
            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
          <button id="clearSearch" class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 hidden">✖</button>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <a href="cart.html" class="relative btn-main px-4 py-2 rounded-md shadow-sm flex items-center gap-2">
          🛍️ السلة
          <span id="cartBadge" class="absolute -left-2 -top-2 bg-red-600 text-white text-xs font-semibold px-2 py-0.5 rounded-full hidden">0</span>
        </a>
        <a href="my-orders.html" class="btn-outline px-4 py-2 rounded-md flex items-center gap-2">📦 طلباتي</a>
        <a href="shop-login.html" class="text-blue-700 font-medium hover:underline hidden sm:inline">تسجيل الدخول</a>
      </div>
    </div>

    <nav class="bg-blue-50 border-t border-gray-200">
      <div class="max-w-7xl mx-auto px-4 py-2 flex overflow-x-auto gap-2" id="categoriesNavWrap">
        <button data-cat="" class="cat-btn px-4 py-1.5 rounded-full bg-blue-600 text-white font-medium">الكل</button>
        <div id="categoriesNav" class="flex gap-2"></div>
      </div>
    </nav>
  </header>

  <section class="bg-gradient-to-l from-blue-100 to-blue-50 py-16">
    <div class="max-w-7xl mx-auto grid md:grid-cols-2 gap-10 items-center px-4">
      <div>
        <h2 class="text-4xl font-extrabold text-blue-900 mb-4 leading-snug">
          اكتشف منتجات <span class="text-blue-600">فريدة</span> بأسعار لا تقاوم
        </h2>
        <p class="text-gray-700 mb-6 text-lg">استمتع بتجربة تسوق آمنة وسريعة، مع خصومات يومية وتوصيل مضمون.</p>
        <div class="flex flex-wrap gap-4">
          <a href="#products" class="btn-main px-5 py-3 rounded-md text-sm font-semibold">ابدأ التسوق الآن</a>
          <a href="about.html" class="btn-outline px-5 py-3 rounded-md text-sm font-semibold">من نحن</a>
        </div>
      </div>
      <div class="hidden md:block">
        <img src="/assets/og-image.jpg" alt="منتجات مميزة" class="rounded-3xl shadow-lg w-full h-80 object-cover">
      </div>
    </div>
  </section>

  <main id="products" class="max-w-7xl mx-auto px-4 py-16">
    <div class="grid lg:grid-cols-4 gap-8">
      
      <aside class="lg:col-span-1 bg-white rounded-2xl p-6 shadow-md space-y-5 h-fit">
        <h3 class="font-bold text-blue-700 text-lg border-b pb-2">🔍 الفلاتر</h3>
        <div>
          <label class="block text-sm font-medium mb-1">الفئة</label>
          <select id="categoryFilter" class="w-full border p-2 rounded">
            <option value="">كل الفئات</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">المخزون</label>
          <select id="stockFilter" class="w-full border p-2 rounded">
            <option value="">الكل</option>
            <option value="in">متوفر</option>
            <option value="out">منفذ</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">نطاق السعر</label>
          <div class="flex gap-2">
            <input id="priceMin" type="number" placeholder="من" class="border p-2 rounded w-1/2" />
            <input id="priceMax" type="number" placeholder="إلى" class="border p-2 rounded w-1/2" />
          </div>
        </div>

        <button id="applyFilters" class="btn-main w-full py-2 rounded mt-3">تطبيق</button>
        <button id="resetFilters" class="bg-gray-200 hover:bg-gray-300 w-full py-2 rounded">إعادة تعيين</button>
      </aside>

      <section class="lg:col-span-3">
        <div id="topInfo" class="text-gray-600 mb-4 text-sm">🛒 تصفح أفضل المنتجات</div>
        <div id="loading" class="text-center text-gray-500 py-16">⏳ جاري تحميل المنتجات...</div>
        <div id="productsGrid" class="hidden grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-6"></div>
        <div id="noResults" class="hidden text-center text-gray-500 py-10">لم يتم العثور على نتائج 🔎</div>
      </section>
    </div>
  </main>

  <footer class="bg-blue-950 text-gray-100 mt-16">
    <div class="max-w-7xl mx-auto px-4 py-12 grid grid-cols-1 md:grid-cols-4 gap-10">
      <div>
        <img src="/lv12.ico" class="w-14 h-14 rounded mb-3" alt="LV12 logo">
        <h4 class="font-bold text-lg text-white mb-1">متجر LV12</h4>
        <p class="text-sm text-gray-300">أفضل تجربة تسوق عبر الإنترنت — شحن سريع واسترجاع مضمون.</p>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">روابط مفيدة</h4>
        <ul class="space-y-2 text-sm text-gray-300">
          <li><a href="about.html" class="hover:text-white">من نحن</a></li>
          <li><a href="return-policy.html" class="hover:text-white">سياسة الاسترجاع</a></li>
          <li><a href="shipping-policy.html" class="hover:text-white">سياسة الشحن</a></li>
          <li><a href="support.html" class="hover:text-white">الدعم الفني</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">تواصل معنا</h4>
        <p class="text-sm">📧 <a href="mailto:info@lv12shop.shop" class="underline hover:text-white">info@lv12shop.shop</a></p>
        <p class="text-sm">📞 +20 100 000 0000</p>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">تابعنا</h4>
        <div class="flex gap-3">
          <a href="#" class="text-blue-400 hover:text-white">Facebook</a>
          <a href="#" class="text-pink-400 hover:text-white">Instagram</a>
        </div>
      </div>
    </div>
    <div class="border-t border-gray-700 text-center py-4 text-sm text-gray-400">
      © <span id="yearFooter"></span> LV12 — جميع الحقوق محفوظة.
    </div>
  </footer>
<script>


const SUPABASE_URL = "https://nszhzfysitppxssplqfb.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zemh6ZnlzaXRwcHhzc3BscWZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMzA4OTcsImV4cCI6MjA3MzgwNjg5N30.5KvK4bhqkZ_GpIfED4qecIMfeubAJYwSFJslULwOp-w";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const productsGrid = document.getElementById("productsGrid");
const loadingEl = document.getElementById("loading");
const noResultsEl = document.getElementById("noResults");
const searchInput = document.getElementById("searchInput");
const clearSearch = document.getElementById("clearSearch");
const categoryFilter = document.getElementById("categoryFilter");
const stockFilter = document.getElementById("stockFilter");
const priceMin = document.getElementById("priceMin");
const priceMax = document.getElementById("priceMax");
const applyFiltersBtn = document.getElementById("applyFilters");
const resetFiltersBtn = document.getElementById("resetFilters");
const categoriesNav = document.getElementById("categoriesNav");
const cartBadge = document.getElementById("cartBadge");

let allProducts = [];
let filteredProducts = [];
let cart = JSON.parse(localStorage.getItem("cart") || "[]");
const CACHE_KEY = "lv12shop_products_v4";

const escapeHtml = s => String(s || "").replace(/[&<>"']/g, m => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#039;" }[m]));
const formatPrice = v => v ? Number(v).toLocaleString('ar-EG', { style: 'currency', currency: 'EGP' }) : "غير متوفر";
const debounce = (fn, ms = 400) => { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), ms); }; };


async function loadProducts() {
  const cache = sessionStorage.getItem(CACHE_KEY);
  if (cache) {
    try {
      const { data, ts } = JSON.parse(cache);
      if (data && (Date.now() - ts < 5 * 60 * 1000)) {
        allProducts = data;
        renderCategories();
        renderFiltered();
        refreshInBackground();
        return;
      }
    } catch {}
  }
  await fetchProducts();
}

async function fetchProducts() {
  showLoading(true);
  try {
    const { data, error } = await supabase.from("products").select(`
      id, name, description, price, stock, category,
      product_images(image_url,is_primary,ordering)
    `).order("created_at", { ascending: false });

    if (error) throw error;

    allProducts = (data || []).map(p => {
      const imgs = (p.product_images || []).sort((a, b) => (a.ordering || 0) - (b.ordering || 0));
      const main = imgs.find(i => i.is_primary) || imgs[0];
      return {
        id: p.id,
        name: p.name,
        description: p.description || "",
        price: Number(p.price),
        stock: Number(p.stock),
        category: p.category || "غير مصنف",
        image: main?.image_url || `${SUPABASE_URL}/storage/v1/object/public/products/no-image.png`
      };
    });

    sessionStorage.setItem(CACHE_KEY, JSON.stringify({ data: allProducts, ts: Date.now() }));
    renderCategories();
    renderFiltered();

  } catch (e) {
    console.error(e);
    showError("حدث خطأ أثناء تحميل المنتجات.");
  } finally {
    showLoading(false);
  }
}

async function refreshInBackground() {
  try {
    const { data } = await supabase.from("products").select("id");
    if (data?.length && data.length !== allProducts.length) {
      fetchProducts();
    }
  } catch {}
}


function renderCategories() {
  const cats = [...new Set(allProducts.map(p => p.category))];
  categoryFilter.innerHTML = `<option value="">كل الفئات</option>` + cats.map(c => `<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`).join("");
  categoriesNav.innerHTML = cats.map(c =>
    `<button class="cat-btn px-3 py-1.5 rounded-full bg-gray-100 hover:bg-blue-100 text-sm" onclick="selectCategory('${escapeHtml(c)}')">${escapeHtml(c)}</button>`
  ).join("");
}

function selectCategory(cat) {
  categoryFilter.value = cat;
  renderFiltered();
  window.scrollTo({ top: document.getElementById("products").offsetTop - 100, behavior: "smooth" });
}

function renderFiltered() {
  const search = searchInput.value.trim().toLowerCase();
  const cat = categoryFilter.value;
  const stock = stockFilter.value;
  const minP = parseFloat(priceMin.value) || 0;
  const maxP = parseFloat(priceMax.value) || Infinity;

  filteredProducts = allProducts.filter(p =>
    (!search || p.name.toLowerCase().includes(search)) &&
    (!cat || p.category === cat) &&
    (!stock || (stock === "in" ? p.stock > 0 : p.stock <= 0)) &&
    (p.price >= minP && p.price <= maxP)
  );

  renderProducts(filteredProducts);
}

function renderProducts(list) {
  productsGrid.innerHTML = "";
  if (!list.length) {
    showLoading(false);
    noResultsEl.classList.remove("hidden");
    productsGrid.classList.add("hidden");
    return;
  }

  noResultsEl.classList.add("hidden");
  productsGrid.classList.remove("hidden");

  productsGrid.innerHTML = list.map(p => `
    <div class="bg-white rounded-xl shadow-sm hover:shadow-md transition-all p-2 cursor-pointer"
         onclick="window.location='product.html?id=${p.id}'">
      <img src="${p.image}" class="w-full h-48 object-cover rounded-lg mb-2" alt="${escapeHtml(p.name)}">
      <h3 class="font-bold text-sm text-blue-700 mb-1">${escapeHtml(p.name)}</h3>
      <p class="text-xs text-gray-500 mb-2">${escapeHtml(p.description.slice(0, 60))}</p>
      <div class="flex justify-between items-center">
        <span class="text-blue-700 font-semibold">${formatPrice(p.price)}</span>
        <button onclick="addToCart(${p.id});event.stopPropagation();" class="bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 py-1 rounded">🛒</button>
      </div>
    </div>
  `).join("");

  showLoading(false);
}


function addToCart(id) {
  const p = allProducts.find(x => x.id === id);
  if (!p) return;
  const exist = cart.find(i => i.id === id);
  if (exist) exist.qty++;
  else cart.push({ id: p.id, name: p.name, price: p.price, qty: 1 });
  localStorage.setItem("cart", JSON.stringify(cart));
  updateCartUI();
}

function updateCartUI() {
  const c = cart.reduce((a, b) => a + b.qty, 0);
  if (c > 0) { cartBadge.textContent = c; cartBadge.classList.remove("hidden"); }
  else cartBadge.classList.add("hidden");
}


function showLoading(on) {
  if (on) { loadingEl.classList.remove("hidden"); productsGrid.classList.add("hidden"); }
  else loadingEl.classList.add("hidden");
}

function showError(msg) {
  loadingEl.textContent = msg;
}


searchInput.addEventListener("input", debounce(() => {
  clearSearch.classList.toggle("hidden", !searchInput.value);
  renderFiltered();
}, 300));

clearSearch.addEventListener("click", () => {
  searchInput.value = "";
  clearSearch.classList.add("hidden");
  renderFiltered();
});

applyFiltersBtn.addEventListener("click", renderFiltered);
resetFiltersBtn.addEventListener("click", () => {
  [searchInput, priceMin, priceMax].forEach(i => i.value = "");
  categoryFilter.value = "";
  stockFilter.value = "";
  clearSearch.classList.add("hidden");
  renderFiltered();
});


(async function init() {
  document.getElementById("yearFooter").textContent = new Date().getFullYear();
  updateCartUI();
  await loadProducts();
})();
</script>

</body>
</html>
