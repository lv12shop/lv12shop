

<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.5/dist/umd/supabase.min.js"></script>
  <title>Ù…ØªØ¬Ø± LV12 â€” Ø§ÙƒØªØ´Ù Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø£Ø³Ø¹Ø§Ø± ØªÙ†Ø§ÙØ³ÙŠØ© ÙˆØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹</title>
  <meta name="description" content="ğŸ›ï¸ Ù…ØªØ¬Ø± LV12 ÙŠÙ‚Ø¯Ù… Ù„Ùƒ ØªØ¬Ø±Ø¨Ø© ØªØ³ÙˆÙ‚ Ø°ÙƒÙŠØ© ÙˆØ³Ù‡Ù„Ø© â€” Ù…Ù†ØªØ¬Ø§Øª Ù…ØªÙ†ÙˆØ¹Ø©ØŒ Ø¹Ø±ÙˆØ¶ Ø­ØµØ±ÙŠØ©ØŒ ÙˆØªÙˆØµÙŠÙ„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª Ø¨Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª. Ø§ÙƒØªØ´Ù Ø§Ù„Ø£ÙØ¶Ù„ Ø§Ù„Ø¢Ù†!">
<meta name="google-adsense-account" content="ca-pub-7770714931220768">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7770714931220768"
     crossorigin="anonymous"></script>
  <meta property="og:title" content="Ù…ØªØ¬Ø± LV12 â€” ØªØ³ÙˆÙ‚ Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù…Ø§Ù†" />
  <meta property="og:description" content="Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…ÙŠØ²Ø© ÙˆØ¹Ø±ÙˆØ¶ Ø­ØµØ±ÙŠØ© ÙƒÙ„ ÙŠÙˆÙ…! Ø¬Ø±Ù‘Ø¨ ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø°ÙƒÙŠØ© Ù…Ù† Ù…ØªØ¬Ø± LV12." />
  <meta property="og:image" content="https://www.lv12shop.shop/lv12.jpg" />
  <meta property="og:url" content="https://www.lv12shop.shop" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="ar_AR" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Ù…ØªØ¬Ø± LV12 â€” ØªØ³ÙˆÙ‚ Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù…Ø§Ù†" />
  <meta name="twitter:description" content="Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…ÙŠØ²Ø© ÙˆØ¹Ø±ÙˆØ¶ Ø­ØµØ±ÙŠØ© ÙƒÙ„ ÙŠÙˆÙ…! ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù† Ù…Ù† LV12." />
  <meta name="twitter:image" content="https://www.lv12shop.shop/lv12.jpg" />
  <link rel="icon" href="/lv12.ico" />
  <link rel="apple-touch-icon" href="/lv12-192.png" />
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#2563eb" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/sw.js")
          .then(() => console.log("âœ… Service Worker Ù…Ø³Ø¬Ù„"))
          .catch(err => console.warn("âš ï¸ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Service Worker:", err));
      });
    }
  </script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "LV12 Shop",
  "url": "https://lv12shop.shop",
  "logo": "https://lv12shop.shop/lv12.png",
  "sameAs": [
    "https://www.facebook.com/",
    "https://www.instagram.com/"
  ]
}
</script>



<style>


:root {
  --primary: #3b82f6;         
  --primary-dark: #1d4ed8;
  --secondary: #8b5cf6;
  --accent: #06b6d4;

  --bg-light: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --bg-box: rgba(255,255,255,0.15);

  --text-dark: #ffffff;
  --text-gray: #e2e8f0;

  --radius: 18px;
  --shadow: 0 8px 32px rgba(0,0,0,0.25);
  --transition: all .35s ease;
}


body {
  font-family: 'Cairo', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
  background-attachment: fixed;
  color: var(--text-dark);
  margin: 0;
  padding: 0;
  overflow-x: hidden;
  line-height: 1.7;
  scroll-behavior: smooth;
  min-height: 100vh;
}



header {
  background: linear-gradient(90deg, rgba(59,130,246,0.9), rgba(139,92,246,0.9));
  color: #fff;
  position: sticky;
  top: 0;
  z-index: 50;
  backdrop-filter: blur(20px);
  border-bottom: 1px solid rgba(255,255,255,0.2);
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  padding: 14px 22px;
}
header .container {
  max-width: 1280px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  flex-wrap: wrap;
}
header img {
  width: 48px;
  height: 48px;
  border-radius: 14px;
  background: white;
  padding: 5px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.2);
  transition: var(--transition);
}
header img:hover {
  transform: rotate(-4deg) scale(1.08);
}
header h1 {
  font-size: 20px;
  font-weight: 800;
  color: #fff;
  letter-spacing: 0.5px;
}



.search-bar {
  flex: 1;
  position: relative;
  max-width: 420px;
}
.search-bar input {
  width: 100%;
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 14px;
  padding: 10px 42px 10px 14px;
  font-size: 15px;
  background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
  color: #fff;
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  transition: var(--transition);
  backdrop-filter: blur(15px);
}
.search-bar input::placeholder {
  color: #cbd5e1;
}
.search-bar input:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(16,185,129,0.5), 0 8px 25px rgba(0,0,0,0.3);
  background: linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.2));
  transform: translateY(-2px);
}
.search-bar .icon {
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--accent);
  font-size: 18px;
}



#categoriesBar {
  display: flex;
  overflow-x: auto;
  gap: 14px;
  padding: 18px;
  scroll-snap-type: x mandatory;
  background: linear-gradient(90deg, rgba(59,130,246,0.8), rgba(139,92,246,0.8));
  border-bottom: 1px solid rgba(255,255,255,0.2);
  backdrop-filter: blur(10px);
}
#categoriesBar::-webkit-scrollbar {
  height: 6px;
}
#categoriesBar::-webkit-scrollbar-thumb {
  background: var(--primary);
  border-radius: 8px;
}

.category-item {
  min-width: 120px;
  background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 16px;
  box-shadow: var(--shadow);
  padding: 10px;
  text-align: center;
  cursor: pointer;
  scroll-snap-align: center;
  transition: var(--transition);
  backdrop-filter: blur(10px);
}
.category-item:hover {
  transform: translateY(-6px);
  box-shadow: 0 10px 26px rgba(0,0,0,0.45);
}
.category-item img {
  width: 100%;
  height: 100px;
  object-fit: cover;
  border-radius: 12px;
}
.category-item p {
  font-size: 14px;
  color: #fff;
  margin-top: 6px;
  font-weight: 600;
}



#productsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 22px;
  padding: 28px;
  max-width: 1300px;
  margin: 0 auto;
}

.product-card {
  background: linear-gradient(135deg, rgba(255,255,255,0.25), rgba(255,255,255,0.15));
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: var(--radius);
  overflow: hidden;
  position: relative;
  box-shadow: 0 8px 32px rgba(0,0,0,0.2);
  cursor: pointer;
  transition: var(--transition);
  backdrop-filter: blur(15px);
}
.product-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 20px 40px rgba(0,0,0,0.3);
  background: linear-gradient(135deg, rgba(255,255,255,0.35), rgba(255,255,255,0.25));
}
.product-card img {
  width: 100%;
  height: 190px;
  object-fit: cover;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  transition: transform .4s ease;
}
.product-card:hover img {
  transform: scale(1.05);
}
.product-card h3 {
  font-size: 15px;
  font-weight: 700;
  margin: 10px 8px 4px;
  color: #ffffff;
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}
.product-card .price {
  display: flex;
  align-items: center;
  gap: 6px;
  margin: 0 8px 12px;
}
.price-new {
  color: #10b981;
  font-weight: 800;
  font-size: 16px;
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}
.price-old {
  text-decoration: line-through;
  color: #9ca3af;
  font-size: 13px;
}
.discount-badge {
  position: absolute;
  top: 10px;
  right: 10px;
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: #fff;
  padding: 4px 8px;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 700;
  box-shadow: 0 4px 12px rgba(245,158,11,0.4);
  animation: pulse 2s infinite;
}



.category-section {
  margin-bottom: 40px;
}
.category-section h2 {
  font-size: 18px;
  font-weight: 800;
  color: #ffffff;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  text-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
.view-all {
  color: #10b981;
  cursor: pointer;
  transition: var(--transition);
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}
.view-all:hover {
  color: #34d399;
  text-decoration: underline;
  transform: translateX(-3px);
}


footer {
  background: linear-gradient(135deg, rgba(59,130,246,0.9), rgba(139,92,246,0.9));
  color: #ffffff;
  padding: 50px 20px;
  box-shadow: 0 -8px 32px rgba(0,0,0,0.3);
  border-top: 1px solid rgba(255,255,255,0.2);
  backdrop-filter: blur(20px);
}

footer .container {
  max-width: 1200px;
  margin: 0 auto;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 30px;
}

footer h4 {
  color: white;
}
footer a {
  color: #cbd5e1;
  text-decoration: none;
  transition: .25s;
}
footer a:hover {
  color: var(--secondary);
}


@media (max-width: 120px) {
  header .container { flex-direction: column; }
  .search-bar { width: 100%; }
  #productsGrid {
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    padding: 16px;
  }
  .category-scroll .product-card {
    min-width: 140px;
  }
}

@media (max-width: 300px) {
  header img { width: 42px; height: 42px; }
  .product-card img { height: 140px; }
  .product-card h3 { font-size: 14px; }
  .price-new { font-size: 14px; }
}



@keyframes fade {
  0% { opacity: 0; transform: translateY(-5px); }
  100% { opacity: 1; transform: translateY(0); }
}
.animate-fade {
  animation: fade 0.8s ease-out forwards;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
}

.category-item:hover {
  transform: translateY(-6px) scale(1.05);
  box-shadow: 0 15px 35px rgba(0,0,0,0.3);
  background: linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.2));
}

.product-card img {
  width: 100%;
  height: 190px;
  object-fit: cover;
  border-bottom: 1px solid rgba(255,255,255,0.2);
  transition: transform .4s ease;
  filter: brightness(1.1) contrast(1.1);
}

.product-card:hover img {
  transform: scale(1.08);
  filter: brightness(1.2) contrast(1.2);
}

#productsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 22px;
  padding: 28px;
  max-width: 1300px;
  margin: 0 auto;
  animation: float 6s ease-in-out infinite;
}

</style>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<body class="antialiased">
<header id="mainHeader"
  class="fixed top-0 left-0 w-full z-[99999]
  bg-white/10 backdrop-blur-xl shadow-lg
  px-3 py-2 flex items-center gap-3 justify-start
  border-b border-white/20">

  <a href="shop.html" class="flex items-center gap-2">
    <img src="/lv12.png" 
         class="w-8 h-8 rounded-lg bg-white/80 p-1 shadow-md" 
         alt="LV12">
    <span class="text-base font-semibold text-white drop-shadow-sm tracking-wide">
      Ù…ØªØ¬Ø± LV12
    </span>
  </a>

</header>


<div id="pwaInstallBanner" class="hidden px-4 py-3 bg-gradient-to-r from-yellow-400 to-amber-500 text-black flex items-center justify-between gap-4 shadow-lg z-50" role="dialog" aria-live="polite">
  <div class="flex items-center gap-3">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L15 8H9L12 2Z" fill="currentColor" opacity="0.9"/><path d="M4 10H20V20H4V10Z" fill="currentColor" opacity="0.95"/></svg>
    <div>
      <div class="font-bold">ØªØ«Ø¨ÙŠØª ØªØ·Ø¨ÙŠÙ‚ LV12</div>
      <div class="text-sm opacity-80">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ ØªØ¬Ø±Ø¨Ø© Ø£Ø³Ø±Ø¹ ÙˆØ¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</div>
    </div>
  </div>

  <div class="flex items-center gap-3">
    <button id="pwaInstallBtn" class="bg-black/90 text-white px-4 py-2 rounded-lg font-semibold">ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¢Ù†</button>
    <button id="pwaDismissBtn" class="text-black/70 px-3 py-2">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>




<style>
#mainHeader {
  transform: none !important;
  left: 0 !important;
  right: 0 !important;
}
</style>



<button id="floatingSearchBtn"
  class="fixed bottom-20 right-5 sm:right-8 bg-gradient-to-r from-blue-600 to-indigo-600 text-white 
         font-bold px-5 py-3 rounded-full shadow-xl hover:scale-105 transition-all duration-300 
         z-[9999] flex items-center gap-2 text-sm sm:text-base">
  ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬
</button>
<div id="searchOverlay"
  class="hidden fixed inset-0 bg-black/60 backdrop-blur-md flex items-start justify-center z-[20000] pt-16 transition-all">

  <div class="bg-white w-[92%] sm:w-[460px] rounded-3xl p-6 shadow-2xl border border-blue-200 
              animate-[fadeIn_0.35s_ease] relative">

    <button id="closeSearchOverlay"
      class="absolute top-3 left-3 text-red-500 text-xl hover:scale-125 transition">âœ–</button>

    <h3 class="text-center text-blue-700 font-extrabold text-xl mb-4">Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ ğŸ”</h3>

    <div class="flex gap-2">
      <input type="text" id="popupSearchInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ù‡Ù†Ø§..."
        class="w-full border border-blue-300 rounded-full px-4 py-3 text-gray-700 text-sm 
               focus:ring-4 focus:ring-blue-300/40 focus:outline-none shadow-inner">
      <button id="startSearchBtn"
        class="bg-blue-600 text-white px-4 py-2 rounded-full shadow hover:scale-105 transition">
        Ø¨Ø­Ø«
      </button>
    </div>

    <div id="popupSuggestions"
      class="hidden mt-3 bg-white border border-blue-100 rounded-2xl shadow-xl max-h-72 overflow-y-auto p-1">
    </div>

  </div>
</div>



<style>
@keyframes fadeIn { from { opacity: 0; transform: scale(.95); } to { opacity: 1; transform: scale(1); } }
@keyframes fadeOut { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(.95); } }
.animate-fade-out { animation: fadeOut .3s ease forwards; }

.suggestion-item {
  padding: 10px 14px;
  display: flex;
  gap: 10px;
  align-items: center;
  border-bottom: 1px solid #e5e7eb;
  cursor: pointer;
  transition: .25s;
}
.suggestion-item:hover {
  background: #eff6ff;
}
</style>


<script>
const floatingBtn = document.getElementById("floatingSearchBtn");
const overlay = document.getElementById("searchOverlay");
const closeBtn = document.getElementById("closeSearchOverlay");
const searchInput = document.getElementById("popupSearchInput");
const suggestionsBox = document.getElementById("popupSuggestions");
const searchBtn = document.getElementById("startSearchBtn");

floatingBtn?.addEventListener("click", () => {
  overlay.classList.remove("hidden", "animate-fade-out");
  overlay.classList.add("flex");
  setTimeout(() => searchInput.focus(), 150);
});

closeBtn?.addEventListener("click", closeSearch);
overlay?.addEventListener("click", (e) => { if (e.target === overlay) closeSearch(); });

function closeSearch() {
  overlay.classList.add("animate-fade-out");
  setTimeout(() => overlay.classList.add("hidden"), 280);
  suggestionsBox.classList.add("hidden");
}

function levenshtein(a, b) {
  const m = a.length, n = b.length;
  const dp = Array.from({ length: m + 1 }, () => Array(n + 1).fill(0));

  for (let i = 0; i <= m; i++) dp[i][0] = i;
  for (let j = 0; j <= n; j++) dp[0][j] = j;

  for (let i = 1; i <= m; i++) {
    for (let j = 1; j <= n; j++) {
      dp[i][j] = Math.min(
        dp[i-1][j] + 1,
        dp[i][j-1] + 1,
        dp[i-1][j-1] + (a[i-1] === b[j-1] ? 0 : 1)
      );
    }
  }
  return dp[m][n];
}
searchBtn?.addEventListener("click", () => {
  const q = searchInput.value.trim();
  if (q.length > 0) openSearchResultsPage(q);
});
searchInput?.addEventListener("input", async () => {
  const query = searchInput.value.trim().toLowerCase();
  if (!query) return suggestionsBox.classList.add("hidden");
  const { data: products, error } = await supabase
    .from("products")
    .select(`
      id,
      name,
      price,
      product_images(image_url, is_primary)
    `);

  if (error || !products) return;

  let results = products.filter(p =>
    p.name?.toLowerCase().includes(query) ||
    levenshtein(p.name?.toLowerCase(), query) <= 2
  );

  results = results.map(p => ({
    ...p,
    img:
      p.product_images?.find(i => i.is_primary)?.image_url ||
      p.product_images?.[0]?.image_url ||
      "/placeholder.png"
  }));

  if (!results.length) {
    suggestionsBox.innerHTML = `
      <div class="p-3 text-center text-red-600">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>
    `;
    return suggestionsBox.classList.remove("hidden");
  }

  suggestionsBox.innerHTML = results
    .map(
      p => `
      <div class="suggestion-item flex items-center gap-3 cursor-pointer"
           onclick="goToProduct(${p.id})">

        <img src="${p.img}" 
             class="w-12 h-12 object-cover rounded border">

        <div>
          <div class="font-bold text-blue-900 text-sm">${p.name}</div>
          <div class="text-blue-600 text-xs">${p.price} Ø¬.Ù…</div>
        </div>
      </div>
    `
    )
    .join("");

  suggestionsBox.classList.remove("hidden");
});
function openSearchResultsPage(query) {
  window.location.href = `search.html?q=${encodeURIComponent(query)}`;
}


function goToProduct(id) {
  window.location.href = `product.html?id=${id}`;
}
</script>


<nav id="mainNav"
  class="fixed bottom-0 left-0 w-full 
        bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900
        text-white border-t border-blue-900/30
        shadow-[0_-4px_20px_rgba(0,0,0,0.35)]
        z-[99999] transition-all duration-300">

  <div class="max-w-6xl mx-auto flex justify-around items-center px-4 py-2
              text-[11px] sm:text-[14px] font-semibold select-none">

    <a href="shop.html" id="nav-home" class="nav-link-new group">
      <svg class="nav-icon group-hover:scale-110" viewBox="0 0 24 24" fill="currentColor">
        <path d="M3 9.75L12 3l9 6.75V21H4V9.75z"/>
      </svg>
      <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </a>

    <a href="cart.html" id="nav-cart" class="nav-link-new group relative">
      <svg class="nav-icon group-hover:scale-110" viewBox="0 0 24 24" fill="currentColor">
        <path d="M7 4H5L3 8H1v2h3l3.6 7.59L5.24 17A3 3 0 0 0 8 21h11v-2H8l1.1-2h8.45A3 3 0 0 0 20 15l2-9H6.31L5.36 4z"/>
      </svg>
      <span>Ø§Ù„Ø³Ù„Ø©</span>
      <span id="cartBadge"
        class="absolute -top-1 right-2 bg-red-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden">0</span>
    </a>

    <a href="wallet.html" id="nav-wallet" class="nav-link-new group relative">
      <svg id="walletIcon" class="nav-icon group-hover:scale-110 transition"
           fill="currentColor" viewBox="0 0 24 24">
        <path d="M21 7H5V5h16v2zm0 2v10H3V7h2v2h16zM7 15h8v2H7v-2z"/>
      </svg>
      <span>Ø§Ù„Ù…Ø­ÙØ¸Ø©</span>
      <span id="walletBalance"
        class="absolute -top-2 right-2 bg-green-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-lg">0 Ø¬.Ù…</span>
    </a>

    <a href="my-orders.html" id="nav-orders" class="nav-link-new group">
      <svg class="nav-icon group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
        <path d="M3 6v14h14V18H5V6H3zm17-2H8v12h12V4zm-2 8h-8V6h8v6z"/>
      </svg>
      <span>Ø·Ù„Ø¨Ø§ØªÙŠ</span>
    </a>

    <a id="nav-menu" class="nav-link-new group">
      <svg class="nav-icon group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
        <path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/>
      </svg>
      <span>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span>
    </a>

  </div>
</nav>


<div id="menuOverlay"
  class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-[99990]"></div>

<div id="sideMenu"
  class="fixed top-0 right-0 w-72 h-full bg-[#0d0d0f] shadow-2xl z-[99999]
  translate-x-full transition-all duration-300 p-6 border-l border-[#222]">

  <button id="closeMenu" class="text-2xl text-red-500 mb-6 font-bold">âœ–</button>

  <h3 class="text-xl font-bold text-gray-200 mb-4">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3>

  <ul class="space-y-3 text-lg font-semibold text-gray-300">

    <li><a href="shop.html" class="block hover:text-blue-400">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
    <li><a href="about.html" class="block hover:text-blue-400">â„¹ï¸ Ù…Ù† Ù†Ø­Ù†</a></li>
    <li><a href="support.html" class="block hover:text-blue-400">ğŸ“ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a></li>
    <li><a href="shipping-policy.html" class="block hover:text-blue-400">ğŸšš Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø´Ø­Ù†</a></li>
    <li><a href="return-policy.html" class="block hover:text-blue-400">ğŸ”„ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a></li>

    <hr class="border-gray-700">

    <li><a href="profile.html" class="block hover:text-blue-400">ğŸ‘¤ Ù…Ù„ÙÙŠ</a></li>
<ul class="space-y-3 text-lg font-semibold text-gray-300">

  <div id="userAreaMenu"
       class="mb-4 p-3 rounded-lg bg-[#111] border border-gray-700">
  </div>


  </ul>
</div>

<script>
const navMenu     = document.getElementById("nav-menu");
const sideMenu    = document.getElementById("sideMenu");
const closeMenu   = document.getElementById("closeMenu");
const menuOverlay = document.getElementById("menuOverlay");

navMenu.addEventListener("click", () => {
  sideMenu.classList.remove("translate-x-full");
  menuOverlay.classList.remove("hidden");
});

closeMenu.addEventListener("click", () => {
  sideMenu.classList.add("translate-x-full");
  menuOverlay.classList.add("hidden");
});

menuOverlay.addEventListener("click", () => {
  sideMenu.classList.add("translate-x-full");
  menuOverlay.classList.add("hidden");
});
</script>



<style>
  body { padding-bottom: 85px; }

  @media (min-width: 640px) {
    body { padding-bottom: 110px; }
  }

  .nav-link-new {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    color: white;
    opacity: 0.9;
    transition: 0.25s;
  }
  .nav-link-new:hover {
    opacity: 1;
    transform: translateY(-3px);
  }

  .nav-icon {
    width: 26px;
    height: 26px;
    transition: 0.25s;
    filter: drop-shadow(0 0 4px rgba(255,255,255,0.2));
  }

  .nav-link-new.active {
    color: #ffe680;
    text-shadow: 0 0 12px rgba(255,255,255,0.7);
  }
</style>


<script>
const toggleBtn = document.getElementById("toggleHeaderBtn");

let minimized = false;
let lastScrollTop = 0;
let isHiddenByScroll = false;

function hideHeader(auto = false) {
  header.style.transform = "translate(-50%, -130%) scale(0.95)";
  header.style.opacity = "0";
  header.style.filter = "blur(10px)";
  header.style.pointerEvents = "none";
  if (auto) isHiddenByScroll = true;
}

function showHeader(auto = false) {
  header.style.transform = "translate(-50%, 0) scale(1)";
  header.style.opacity = "1";
  header.style.filter = "blur(0)";
  header.style.pointerEvents = "auto";
  if (auto) isHiddenByScroll = false;
}

toggleBtn.addEventListener("click", () => {
  minimized = !minimized;
  if (minimized) {
    hideHeader();
    toggleBtn.innerHTML = "â¬‡ï¸";
  } else {
    showHeader();
    toggleBtn.innerHTML = "â¬†ï¸";
  }
});

window.addEventListener("scroll", () => {
  const currentScroll = window.pageYOffset || document.documentElement.scrollTop;

  if (currentScroll > lastScrollTop && currentScroll > 100 && !isHiddenByScroll && !minimized) {
    hideHeader(true);
  } else if ((currentScroll < lastScrollTop || currentScroll <= 50) && isHiddenByScroll && !minimized) {
    showHeader(true);
  }

  lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
});

let isDragging = false, offsetX, offsetY;

toggleBtn.addEventListener("mousedown", e => {
  isDragging = true;
  offsetX = e.clientX - toggleBtn.offsetLeft;
  offsetY = e.clientY - toggleBtn.offsetTop;
  toggleBtn.style.transition = "none";
});

window.addEventListener("mouseup", () => {
  isDragging = false;
  toggleBtn.style.transition = "all 0.3s ease";
});

window.addEventListener("mousemove", e => {
  if (isDragging) {
    const x = e.clientX - offsetX;
    const y = e.clientY - offsetY;
    toggleBtn.style.left = `${x}px`;
    toggleBtn.style.top = `${y}px`;
  }
});
</script>

<section class="w-full py-4 sm:py-8 bg-gradient-to-b from-[#0a0a0c] via-[#0f0f12] to-[#0a0a0c] relative overflow-hidden">
  <div class="absolute inset-0 opacity-30">
    <div class="absolute top-20 left-10 w-96 h-96 bg-blue-500/20 rounded-full blur-[120px] animate-pulse"></div>
    <div class="absolute bottom-20 right-10 w-96 h-96 bg-purple-500/20 rounded-full blur-[120px] animate-pulse" style="animation-delay: 1s"></div>
  </div>

  <div class="swiper adSwiper w-[95%] sm:w-full max-w-2xl mx-auto rounded-2xl sm:rounded-[32px] overflow-hidden
              shadow-[0_20px_80px_rgba(0,0,0,0.8)] bg-gradient-to-br from-[#1a1a1f] to-[#0f0f14]
              border border-white/10 backdrop-blur-2xl relative z-10
              hover:shadow-[0_25px_100px_rgba(59,130,246,0.3)] transition-all duration-500">

    <div class="swiper-wrapper">

      <div class="swiper-slide">
        <div class="w-full h-[280px] sm:h-[380px] relative overflow-hidden rounded-2xl sm:rounded-[32px] bg-gradient-to-br from-indigo-900/40 via-purple-900/40 to-pink-900/40">
          
          <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="0.03"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-20"></div>

          <div class="absolute top-0 left-0 w-full p-6 bg-gradient-to-b from-black/80 via-black/40 to-transparent z-20">
            <div class="flex items-center gap-3 mb-2">
              <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-yellow-400 to-orange-500 flex items-center justify-center shadow-lg shadow-yellow-500/50 animate-bounce">
                <span class="text-2xl">ğŸ”¥</span>
              </div>
              <div>
                <h2 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 via-orange-400 to-red-500 drop-shadow-2xl tracking-tight">
                  Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø´Ø§Ù‡Ø¯Ø©
                </h2>
                <p class="text-yellow-100/90 text-sm font-semibold drop-shadow-lg flex items-center gap-2">
                  <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                  Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª
                </p>
              </div>
            </div>
          </div>

          <div id="featuredProducts" class="absolute inset-0 pt-16 sm:pt-24"></div>

          <div class="absolute bottom-0 left-0 right-0 h-20 bg-gradient-to-t from-black/60 to-transparent z-10"></div>
        </div>
      </div>

      <div class="swiper-slide group">
        <a href="wallet.html" class="block relative overflow-hidden rounded-[32px]">
          <div class="absolute inset-0 bg-gradient-to-br from-blue-600/20 to-purple-600/20 opacity-0 group-hover:opacity-100 transition-opacity duration-500 z-10"></div>
          <img src="1.png" class="w-full h-[280px] sm:h-[380px] object-cover rounded-2xl sm:rounded-[32px] transform group-hover:scale-105 transition-transform duration-700" />
          <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
        </a>
      </div>

      <div class="swiper-slide group">
        <a href="wallet.html" class="block relative overflow-hidden rounded-[32px]">
          <div class="absolute inset-0 bg-gradient-to-br from-purple-600/20 to-pink-600/20 opacity-0 group-hover:opacity-100 transition-opacity duration-500 z-10"></div>
          <img src="2.png" class="w-full h-[280px] sm:h-[380px] object-cover rounded-2xl sm:rounded-[32px] transform group-hover:scale-105 transition-transform duration-700" />
          <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
        </a>
      </div>

      <div class="swiper-slide group">
        <a href="discount-day.html" class="block relative overflow-hidden rounded-[32px]">
          <div class="absolute inset-0 bg-gradient-to-br from-orange-600/20 to-red-600/20 opacity-0 group-hover:opacity-100 transition-opacity duration-500 z-10"></div>
          <img src="3.png" class="w-full h-[280px] sm:h-[380px] object-cover rounded-2xl sm:rounded-[32px] transform group-hover:scale-105 transition-transform duration-700" />
          <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
        </a>
      </div>

    </div>

    <div class="swiper-pagination !bottom-4"></div>

  </div>

</section>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
new Swiper(".adSwiper", {
  loop: true,
  autoplay: { delay: 5000 },
  pagination: { el: ".swiper-pagination", clickable: true },
});
</script>

<style>
  .slide-banner {
    width: 100%;
    height: 190px;
    object-fit: cover;
    border-radius: 20px;
    display: block;
  }

  .swiper-slide {
    background: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .swiper-pagination-bullet {
    background: rgba(255,255,255,0.4) !important;
    width: 10px !important;
    height: 10px !important;
    transition: all 0.3s ease !important;
  }

  .swiper-pagination-bullet-active {
    background: linear-gradient(135deg, #fbbf24, #f59e0b) !important;
    width: 32px !important;
    border-radius: 6px !important;
    box-shadow: 0 0 20px rgba(251,191,36,0.6) !important;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }

  .swiper-slide:hover {
    transform: scale(1.01);
  }
</style>

<script>
  (function(){
    const SUPABASE_URL = "https://nszhzfysitppxssplqfb.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zemh6ZnlzaXRwcHhzc3BscWZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMzA4OTcsImV4cCI6MjA3MzgwNjg5N30.5KvK4bhqkZ_GpIfED4qecIMfeubAJYwSFJslULwOp-w";
    const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function renderFeatured() {
      try {
        const el = document.getElementById('featuredProducts');
        if (!el) return;
        el.innerHTML = `<div class="w-full h-full flex items-center justify-center"><div class="loader" style="width:48px;height:48px;border-width:5px;border-top-color:#f59e0b"></div></div>`;

        const { data: products, error } = await client
          .from('products')
          .select(`id,name,price,product_images(image_url,is_primary),short_desc,visits`)
          .order('visits', { ascending: false })
          .limit(6);

        if (error) {
          console.error('featured fetch error', error);
          el.innerHTML = `<div class="text-gray-400 p-4 text-center">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙØ¶Ù„Ø§Øª Ø§Ù„Ø¢Ù†</div>`;
          return;
        }

        if (!products || !products.length) {
          el.innerHTML = `<div class="text-gray-400 p-4 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…ÙŠØ²Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>`;
          return;
        }

        el.innerHTML = `
          <div class="w-full h-full p-3">
            <div class="grid grid-cols-2 gap-3 h-full">
              ${products.slice(0,4).map(p => `
                <a href="product.html?id=${p.id}" class="group relative bg-gradient-to-br from-blue-900/80 to-purple-900/80 backdrop-blur-sm rounded-2xl overflow-hidden border border-white/20 hover:scale-105 hover:border-yellow-400/50 transition-all duration-300 shadow-2xl">
                  <div class="absolute inset-0">
                    <img src="${(p.product_images?.[0]?.image_url) || '/placeholder.png'}" class="w-full h-full object-cover opacity-60 group-hover:opacity-80 transition-opacity" alt="${escapeHtml(p.name)}" />
                  </div>
                  <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/30 to-transparent"></div>
                  <div class="relative z-10 p-3 h-full flex flex-col justify-end">
                    <div class="text-white font-bold text-sm leading-tight mb-1 drop-shadow-lg">${escapeHtml(p.name)}</div>
                    <div class="text-yellow-400 font-black text-lg drop-shadow-lg">${Number(p.price||0).toFixed(0)} Ø¬.Ù…</div>
                  </div>
                </a>
              `).join('')}
            </div>
          </div>`;

      } catch (e) {
        console.error('renderFeatured', e);
      }
    }

    function escapeHtml(s=''){
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
    }

    async function updateWalletBadge(){
      try{
        const { data } = await client.auth.getSession();
        const user = data?.session?.user;
        const badge = document.getElementById('walletBalance');
        if (!user) {
          if (badge) badge.textContent = '';
          return;
        }
        const { data: w, error } = await client.from('wallet').select('balance').eq('user_id', user.id).maybeSingle();
        if (error) { console.error('wallet badge error', error); return; }
        const bal = w?.balance || 0;
        if (badge) badge.textContent = `Ø±ØµÙŠØ¯ÙŠ: ${Number(bal).toFixed(2)} Ø¬.Ù…`;
      }catch(e){console.error('updateWalletBadge', e)}
    }

    async function initRealtimeNotifications(){
      try{
        if ('Notification' in window) {
          const perm = await Notification.requestPermission();
          if (perm !== 'granted') console.warn('Notification permission:', perm);
        }

        let swReg = null;
        if ('serviceWorker' in navigator) {
          try{ swReg = await navigator.serviceWorker.register('/sw.js'); console.log('sw registered'); } catch(e){console.warn('sw register failed', e); }
        }

        const channel = client.channel('public:products').on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'products' }, payload => {
          const p = payload.new;
          console.log('new product realtime', p?.id, p?.name);
          const title = `ğŸ†• Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯: ${p.name}`;
          const body = (p.short_desc || '').slice(0,80) || `Ø³Ø¹Ø±: ${Number(p.price||0).toFixed(2)} Ø¬.Ù…`;
          const icon = (p.product_images?.[0]?.image_url) || '/lv12.png';
          const url = `product.html?id=${p.id}`;
          if (swReg && swReg.showNotification) {
            swReg.showNotification(title, { body, icon, data:{url} });
          } else if (Notification.permission === 'granted') {
            const n = new Notification(title, { body, icon });
            n.onclick = () => { window.open(url, '_blank'); };
          }

          try{
            const el = document.getElementById('featuredProducts');
            if (el) {
              const node = document.createElement('a');
              node.href = `product.html?id=${p.id}`;
              node.className = 'group block w-44 bg-[#0b1220] p-3 rounded-2xl border border-white/6 hover:scale-105 transition shadow';
              node.innerHTML = `<div class="w-full h-36 bg-gray-900 rounded-lg overflow-hidden mb-2"><img src="${(p.product_images?.[0]?.image_url)||'/placeholder.png'}" class="w-full h-full object-cover"/></div><div class="text-sm text-white font-semibold truncate">${escapeHtml(p.name)}</div><div class="text-xs text-gray-300">${Number(p.price||0).toFixed(2)} Ø¬.Ù…</div>`;
              const gallery = el.querySelector('.flex');
              if (gallery) gallery.prepend(node);
            }
          }catch(e){console.warn('add realtime product UI', e)}
        }).subscribe();

      }catch(e){console.error('initRealtimeNotifications', e)}
    }

    document.addEventListener('DOMContentLoaded', async ()=>{
      await renderFeatured();
      await updateWalletBadge();
      await initRealtimeNotifications();
    });

  })();
</script>







</script>

<main id="products" class="w-full px-2 sm:px-4 py-4 sm:py-8 space-y-6 sm:space-y-10 pb-20">

  <!-- ÙØ¦Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
  <section class="relative px-2">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg sm:text-2xl font-black flex items-center gap-2">
        <span class="text-xl sm:text-2xl">ğŸ·ï¸</span>
        <span class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent">Ø§Ù„ÙØ¦Ø§Øª</span>
      </h2>
    </div>
    <div id="categoriesBar" class="flex gap-2 sm:gap-3 overflow-x-auto pb-3 snap-x snap-mandatory hide-scrollbar"></div>
  </section>

  <!-- Ø¹Ø±ÙˆØ¶ Ø§Ù„ÙŠÙˆÙ… -->
  <section id="todayDeals" class="relative bg-gradient-to-br from-amber-500 via-orange-500 to-red-500 rounded-2xl sm:rounded-3xl p-4 sm:p-6 shadow-xl overflow-hidden mx-2">
    <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23ffffff" fill-opacity="0.1"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-20"></div>
    <div class="absolute top-0 left-0 w-32 h-32 bg-yellow-300/30 rounded-full blur-3xl animate-pulse"></div>
    <div class="relative z-10">
      <div class="flex items-center justify-between mb-4">
        <div>
          <h2 class="text-xl sm:text-2xl font-black text-white flex items-center gap-2 drop-shadow-lg">
            <span class="text-xl sm:text-2xl animate-bounce">ğŸ”¥</span>
            Ø¹Ø±ÙˆØ¶ Ø§Ù„ÙŠÙˆÙ…
          </h2>
          <p class="text-white/90 text-xs sm:text-sm mt-1 font-semibold">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„ÙŠÙˆÙ…</p>
        </div>
        <a href="discount-day.html" class="bg-white text-orange-600 px-3 py-1.5 rounded-lg text-xs sm:text-sm font-bold hover:scale-105 transition shadow-lg">
          Ø§Ù„ÙƒÙ„ â†
        </a>
      </div>
      <div id="todayDealsCarousel" class="flex gap-3 overflow-x-auto snap-x pb-2 hide-scrollbar"></div>
    </div>
  </section>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª -->
  <section id="discountsSection" class="relative bg-gradient-to-br from-rose-500 via-pink-500 to-fuchsia-600 rounded-2xl sm:rounded-3xl p-4 sm:p-6 shadow-xl overflow-hidden mx-2">
    <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="%23ffffff" fill-opacity="0.08" fill-rule="evenodd"%3E%3Cpath d="M0 40L40 0H20L0 20M40 40V20L20 40"%3E%3C/path%3E%3C/g%3E%3C/svg%3E')] opacity-30"></div>
    <div class="absolute bottom-0 right-0 w-32 h-32 bg-purple-300/30 rounded-full blur-3xl animate-pulse" style="animation-delay: 0.5s"></div>
    <div class="relative z-10">
      <div class="flex items-center justify-between mb-4">
        <div>
          <h2 class="text-xl sm:text-2xl font-black text-white flex items-center gap-2 drop-shadow-lg">
            <span class="text-xl sm:text-2xl">ğŸ</span>
            Ø®ØµÙˆÙ…Ø§Øª Ø­ØµØ±ÙŠØ©
          </h2>
          <p class="text-white/90 text-xs sm:text-sm mt-1 font-semibold">ÙˆÙÙ‘Ø± Ø§Ù„Ø¢Ù† Ù…Ø¹ Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶</p>
        </div>
      </div>
      <div id="discountsGrid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3"></div>
    </div>
  </section>

  <!-- Ø§Ù„ÙØ¦Ø§Øª -->
  <section id="categorySections" class="space-y-6 px-2"></section>

  <!-- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
  <section class="relative px-2">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg sm:text-2xl font-black flex items-center gap-2">
        <span class="text-xl sm:text-2xl">ğŸ›ï¸</span>
        <span class="bg-gradient-to-r from-blue-600 via-cyan-600 to-teal-600 bg-clip-text text-transparent">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
      </h2>
    </div>
    <div id="allProductsGrid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3"></div>
  </section>

  <!-- Ù…Ù†ØªØ¬Ø§Øª Ø£Ù‚Ù„ Ù…Ù† 100 -->
  <section id="under100Wrapper" class="relative bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-4 sm:p-6 shadow-lg mx-2">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg sm:text-xl font-black text-emerald-700 flex items-center gap-2">
        <span class="text-lg sm:text-xl">ğŸ’°</span>
        Ø£Ù‚Ù„ Ù…Ù† 100 Ø¬.Ù…
      </h2>
    </div>
    <div id="under100" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3"></div>
  </section>

  <!-- Ù…Ù†ØªØ¬Ø§Øª Ø£Ù‚Ù„ Ù…Ù† 200 -->
  <section id="under200Wrapper" class="relative bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-4 sm:p-6 shadow-lg mx-2">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg sm:text-xl font-black text-blue-700 flex items-center gap-2">
        <span class="text-lg sm:text-xl">ğŸ’</span>
        Ø£Ù‚Ù„ Ù…Ù† 200 Ø¬.Ù…
      </h2>
    </div>
    <div id="under200" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3"></div>
  </section>

  <!-- Ù‚Ø¯ ÙŠØ¹Ø¬Ø¨Ùƒ -->
  <section id="interestWrapper" class="relative bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-4 sm:p-6 shadow-lg mx-2">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg sm:text-xl font-black text-purple-700 flex items-center gap-2">
        <span class="text-lg sm:text-xl">âœ¨</span>
        Ù‚Ø¯ ÙŠØ¹Ø¬Ø¨Ùƒ
      </h2>
    </div>
    <div id="interestProducts" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3"></div>
  </section>
</main>

<style>
  .hide-scrollbar::-webkit-scrollbar { display: none; }
  .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

  #categoriesBar .category-item {
    min-width: 100px;
    padding: 8px 12px;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
    border-radius: 16px;
    color: white;
    font-weight: 700;
    font-size: 13px;
    text-align: center;
    box-shadow: 0 4px 15px rgba(99,102,241,0.3);
    scroll-snap-align: start;
    transition: all .3s ease;
    cursor: pointer;
    border: 1px solid rgba(255,255,255,0.2);
    white-space: nowrap;
    -webkit-tap-highlight-color: transparent;
  }
  
  @media (min-width: 640px) {
    #categoriesBar .category-item {
      min-width: 120px;
      padding: 10px 16px;
      font-size: 14px;
      border-radius: 18px;
    }
  }
  
  #categoriesBar .category-item:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 25px rgba(139,92,246,0.4);
    border-color: rgba(255,255,255,0.4);
  }
  
  #categoriesBar .category-item:active {
    transform: scale(0.95);
  }

  .product-card-modern {
    background: white;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    transition: all .3s ease;
    cursor: pointer;
    border: 1px solid rgba(0,0,0,0.04);
    position: relative;
    -webkit-tap-highlight-color: transparent;
  }
  
  @media (min-width: 640px) {
    .product-card-modern {
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
  }
  
  .product-card-modern:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    border-color: rgba(99,102,241,0.2);
  }
  
  @media (min-width: 640px) {
    .product-card-modern:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 35px rgba(0,0,0,0.15);
    }
  }
  
  .product-card-modern:active {
    transform: scale(0.98);
  }
  
  .product-card-modern img {
    width: 100%;
    height: 140px;
    object-fit: cover;
    transition: transform .3s ease;
  }
  
  @media (min-width: 640px) {
    .product-card-modern img {
      height: 180px;
    }
  }
  
  .product-card-modern:hover img {
    transform: scale(1.08);
  }
  
  @media (min-width: 640px) {
    .product-card-modern:hover img {
      transform: scale(1.12);
    }
  }
  .product-card-modern .discount-badge {
    position: absolute;
    top: 6px;
    right: 6px;
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
    padding: 4px 8px;
    border-radius: 8px;
    font-size: 11px;
    font-weight: 700;
    box-shadow: 0 2px 8px rgba(239,68,68,0.3);
    z-index: 10;
  }
  
  @media (min-width: 640px) {
    .product-card-modern .discount-badge {
      top: 8px;
      right: 8px;
      padding: 6px 10px;
      font-size: 12px;
      border-radius: 10px;
    }
  }
  
  .product-card-modern .new-badge {
    position: absolute;
    top: 6px;
    left: 6px;
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    padding: 4px 8px;
    border-radius: 8px;
    font-size: 10px;
    font-weight: 700;
    box-shadow: 0 2px 8px rgba(16,185,129,0.3);
    z-index: 10;
  }
  
  @media (min-width: 640px) {
    .product-card-modern .new-badge {
      top: 8px;
      left: 8px;
      padding: 6px 10px;
      font-size: 11px;
      border-radius: 10px;
    }
  }
</style>


  <footer class="text-gray-100 mt-16">
    <div class="max-w-7xl mx-auto px-4 py-12 grid grid-cols-1 md:grid-cols-4 gap-10">
      <div>
        <img src="/lv12.ico" class="w-14 h-14 rounded mb-3" alt="LV12 logo">
        <h4 class="font-bold text-lg text-white mb-1">Ù…ØªØ¬Ø± LV12</h4>
        <p class="text-sm text-gray-300">Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø© ØªØ³ÙˆÙ‚ Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª â€” Ø´Ø­Ù† Ø³Ø±ÙŠØ¹ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ù…Ø¶Ù…ÙˆÙ†.</p>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">Ø±ÙˆØ§Ø¨Ø· Ù…ÙÙŠØ¯Ø©</h4>
        <ul class="space-y-2 text-sm text-gray-300">
          <li><a href="about.html" class="hover:text-white">Ù…Ù† Ù†Ø­Ù†</a></li>
          <li><a href="return-policy.html" class="hover:text-white">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a></li>
          <li><a href="shipping-policy.html" class="hover:text-white">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø´Ø­Ù†</a></li>
          <li><a href="support.html" class="hover:text-white">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h4>
        <a href="mailto:shoplv12shop@gmail.com" class="inline-block bg-blue-50 hover:bg-blue-100 text-blue-700 px-4 py-2 rounded-lg text-sm font-medium transition">
          ğŸ“§ shoplv12shop@gmail.com
        </a>
        <a href="tel:01094965067" class="block text-blue-200 text-lg font-bold hover:underline mt-2">
          ğŸ“ 01094965067
        </a>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">ØªØ§Ø¨Ø¹Ù†Ø§</h4>
        <div class="flex gap-3">
<div class="flex items-center justify-center gap-4 mt-4 text-sm font-semibold">
  <a href="https://www.facebook.com/share/1KEzAxHzzS/" target="_blank"
     class="flex items-center gap-1 text-blue-600 hover:text-blue-800 transition-all duration-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
      <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 5.003 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.463h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.891h-2.33v6.987C18.343 21.128 22 17.003 22 12z"/>
    </svg>
    Facebook
  </a>

  <a href="https://www.tiktok.com/@lv12shop1?_r=1&_t=ZS-91JONZZLeZJ" target="_blank"
     class="flex items-center gap-1 text-gray-800 hover:text-black transition-all duration-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
      <path d="M16.5 3a5.5 5.5 0 0 0 5.5 5.5V11a8.5 8.5 0 0 1-8.5-8.5h3zM9 8a5 5 0 1 0 5 5V4h3v9a8 8 0 1 1-8-8h3v3H9z"/>
    </svg>
    TikTok
  </a>

  <a href="https://www.instagram.com/lv12.shop?igsh=MTQxc3lsM24wb2Fmdg==" target="_blank"
     class="flex items-center gap-1 text-pink-600 hover:text-pink-700 transition-all duration-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
      <path d="M7 2C4.243 2 2 4.243 2 7v10c0 2.757 2.243 5 5 5h10c2.757 0 5-2.243 5-5V7c0-2.757-2.243-5-5-5H7zm0 2h10c1.654 0 3 1.346 3 3v10c0 1.654-1.346 3-3 3H7c-1.654 0-3-1.346-3-3V7c0-1.654 1.346-3 3-3zm5 2a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm0 2a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm4.5-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
    </svg>
    Instagram
  </a>
</div>

        
        </div>
      </div>
    </div>
    <div class="border-t border-blue-800 text-center py-4 text-sm text-blue-100">
      Â© <span id="yearFooter"></span> LV12 â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
    </div>
  </footer>

  <script>
    document.getElementById("yearFooter").textContent = new Date().getFullYear();
  </script>
<style>
.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: linear-gradient(135deg, #2563eb, #1e40af);
  color: #fff;
  padding: 14px 18px;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
  font-size: 15px;
  font-weight: 600;
  z-index: 9999;
  animation: slideIn 0.4s ease, fadeOut 0.4s ease 4.6s forwards;
  max-width: 300px;
  text-align: right;
  line-height: 1.4;
}
@keyframes slideIn {
  from { transform: translateX(120%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}
@keyframes fadeOut {
  to { transform: translateX(120%); opacity: 0; }
}
@media (max-width: 640px) {
  .toast {
    right: 10px;
    left: 10px;
    bottom: 15px;
    font-size: 14px;
    max-width: unset;
  }
}
</style>

<script>
function showToast(message) {
  const toast = document.createElement("div");
  toast.className = "toast";
  toast.textContent = message;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 5000);
}

(async () => {
  try {
    if (!supabase?.realtime || typeof supabase.realtime.channel !== "function") {
      console.warn("âš ï¸ Realtime ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù†Ø³Ø®Ø© Supabase Ø§Ù„Ø­Ø§Ù„ÙŠØ©");
      return;
    }

    const channel = supabase.realtime.channel("products-realtime");

    channel
      .on("postgres_changes", { event: "INSERT", schema: "public", table: "products" }, async (payload) => {
        const p = payload.new;
        if (!p?.name || !p?.price) return;

        const msg = `ğŸ†• ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯: ${p.name} Ø¨Ø³Ø¹Ø± ${p.price} Ø¬.Ù… ğŸ’¸`;
        showToast(msg);

        if ("serviceWorker" in navigator && navigator.serviceWorker.controller) {
          navigator.serviceWorker.controller.postMessage({
            type: "SHOW_NOTIFICATION",
            title: "ğŸ†• Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ù…ØªØ¬Ø± LV12",
            body: `${p.name} Ù…ØªØ§Ø­ Ø§Ù„Ø¢Ù† Ø¨Ø³Ø¹Ø± ${p.price} Ø¬.Ù… ğŸ’¸`,
            url: `/product.html?id=${p.id}`
          });
        } else {
          console.log("â„¹ï¸ Service Worker ØºÙŠØ± Ù…ØªØµÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹");
        }
      })
      .subscribe();

    console.log("âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¹Ø¨Ø± Realtime");
  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙØ¹ÙŠÙ„ Realtime:", err);
  }
})();
</script>


<style>
  .toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #1d4ed8;
    color: #fff;
    padding: 0.8rem 1.2rem;
    border-radius: 0.75rem;
    font-size: 0.95rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    opacity: 0;
    transform: translateY(-10px);
    animation: toastIn 0.4s forwards;
    z-index: 9999;
  }
  @keyframes toastIn {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
<script>
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;

  const installBanner = document.createElement('div');
  installBanner.id = 'installBanner';
  installBanner.className = 'fixed bottom-5 right-5 left-5 bg-blue-600 text-white rounded-xl shadow-lg flex justify-between items-center px-4 py-3 z-50';
  installBanner.innerHTML = `
    <div class="flex items-center gap-2">
      ğŸ“± <span>ØªØµÙØ­ Ù…ØªØ¬Ø± LV12 Ø¨Ø´ÙƒÙ„ Ø£Ø³Ø±Ø¹ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</span>
    </div>
    <div class="flex gap-2">
      <button id="installBtn" class="bg-white text-blue-700 px-3 py-1 rounded font-semibold">ØªØ«Ø¨ÙŠØª</button>
      <button id="closeInstall" class="text-white/80 hover:text-white font-medium">âœ–</button>
    </div>
  `;
  document.body.appendChild(installBanner);

  document.getElementById('closeInstall').onclick = () => installBanner.remove();

  document.getElementById('installBtn').onclick = async () => {
    installBanner.remove();
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    if (outcome === 'accepted') {
      console.log('âœ… ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚');
      showToast("ØªÙ… ØªØ«Ø¨ÙŠØª Ù…ØªØ¬Ø± LV12 Ø¨Ù†Ø¬Ø§Ø­ âœ…");
    } else {
      console.log('âŒ ØªÙ… ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªØ«Ø¨ÙŠØª');
    }
    deferredPrompt = null;
  };
});

window.addEventListener('appinstalled', () => {
  console.log('ğŸ‰ ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­!');
  showToast('ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­ âœ…');
});
</script>


<script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 const SUPABASE_URL = "https://nszhzfysitppxssplqfb.supabase.co";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zemh6ZnlzaXRwcHhzc3BscWZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMzA4OTcsImV4cCI6MjA3MzgwNjg5N30.5KvK4bhqkZ_GpIfED4qecIMfeubAJYwSFJslULwOp-w";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const productsGrid = document.getElementById("productsGrid");
const loadingEl = document.getElementById("loading");
const noResultsEl = document.getElementById("noResults");

const categoryFilter = document.getElementById("categoryFilter");
const stockFilter = document.getElementById("stockFilter");
const priceMin = document.getElementById("priceMin");
const priceMax = document.getElementById("priceMax");
const applyFiltersBtn = document.getElementById("applyFilters");
const resetFiltersBtn = document.getElementById("resetFilters");
const categoriesNav = document.getElementById("categoriesNav");
const cartBadge = document.getElementById("cartBadge");

let filteredProducts = [];
let cart = JSON.parse(localStorage.getItem("cart") || "[]");
const CACHE_KEY = "lv12shop_products_v4";

let userArea = document.getElementById("userArea");
if (!userArea) {
  const headerBtns = document.querySelector("header .flex.items-center.gap-3");
  userArea = document.createElement("div");
  userArea.id = "userArea";
  headerBtns.appendChild(userArea);
}

const formatPrice = v => v ? Number(v).toLocaleString('ar-EG', { style: 'currency', currency: 'EGP' }) : "ØºÙŠØ± Ù…ØªÙˆÙØ±";
const debounce = (fn, ms = 400) => { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), ms); }; };
document.querySelectorAll(".loc-tab").forEach(btn => {
  btn.addEventListener("click", e => {
    document.querySelectorAll(".loc-tab").forEach(b => b.classList.remove("bg-blue-600", "text-white"));
    btn.classList.add("bg-blue-600", "text-white");

    const type = btn.dataset.filter;
    const list = filterByLocation(type);
    renderProducts(list);
  });
});
function normalizeCityName(city) {
  const map = {
    "Cairo": "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©",
    "Giza": "Ø§Ù„Ø¬ÙŠØ²Ø©",
    "Alexandria": "Ø§Ù„Ø§Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©",
    "Suez": "Ø§Ù„Ø³ÙˆÙŠØ³",
    "Port Said": "Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯",
    "Damietta": "Ø¯Ù…ÙŠØ§Ø·",
    "Ismailia": "Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©",
    "Faiyum": "Ø§Ù„ÙÙŠÙˆÙ…",
    "Beni Suef": "Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ",
    "Minya": "Ø§Ù„Ù…Ù†ÙŠØ§",
    "Assiut": "Ø§Ø³ÙŠÙˆØ·",
    "Sohag": "Ø³ÙˆÙ‡Ø§Ø¬",
    "Qena": "Ù‚Ù†Ø§",
    "Aswan": "Ø§Ø³ÙˆØ§Ù†",
    "Luxor": "Ø§Ù„Ø£Ù‚ØµØ±",
    "Red Sea": "Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±",
    "Beheira": "Ø§Ù„Ø¨Ø­ÙŠØ±Ø©",
    "Dakahlia": "Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©",
    "Sharqia": "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©",
    "Kafr el-Sheikh": "ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®",
    "Menoufia": "Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©",
    "Gharbia": "Ø§Ù„ØºØ±Ø¨ÙŠØ©",
    "Qalyubia": "Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©",
    "Matrouh": "Ù…Ø·Ø±ÙˆØ­",
    "North Sinai": "Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡",
    "South Sinai": "Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡",
    "New Valley": "Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯"
  };
  return map[city] || city;
}

let userCity = null;
let userCountry = null;
async function detectUserLocation() {
  try {
    const res = await fetch("https://ipwho.is/");
    const data = await res.json();
    if (data && data.city) {
      userCity = normalizeCityName(data.city); 
      userCountry = data.country || "Egypt";
      console.log("ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹:", userCity, "-", userCountry);
      return;
    }
  } catch (err) {
    console.warn("âš ï¸ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹:", err);
  }

  userCity = prompt("Ø£Ø¯Ø®Ù„ Ù…Ø­Ø§ÙØ¸ØªÙƒ:", "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©") || "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©";
  userCountry = "Egypt";
  console.log("ğŸ“ ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠÙ‹Ø§:", userCity, "-", userCountry);
}


function filterByLocation(type) {
  if (!userCity) return allProducts;

  return allProducts.filter(p => {
    const inMyCity = Array.isArray(p.available_cities) && p.available_cities.includes(userCity);
    if (type === "local") return inMyCity;
    if (type === "other") return !inMyCity;
    return true;
  });
}

function isProductAvailable(p) {
  if (p.visible_to_all) return true;
  if (userCountry && userCountry !== "Egypt") return false;
  if (Array.isArray(p.available_cities) && p.available_cities.length > 0)
    return p.available_cities.includes(userCity);
  return true;
}


function sortByLocation(products) {
  if (!userCity) return products;
  return products.sort((a, b) => {
    const aLocal = a.available_cities?.includes(userCity);
    const bLocal = b.available_cities?.includes(userCity);
    if (aLocal && !bLocal) return -1;
    if (!aLocal && bLocal) return 1;
    return 0;
  });
}
async function setupPushNotifications() {
  if (!("Notification" in window) || !("serviceWorker" in navigator)) return;

  const permission = await Notification.requestPermission();
  if (permission !== "granted") {
    console.log("âŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±ÙØ¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª");
    return;
  }

  const reg = await navigator.serviceWorker.ready;
  console.log("ğŸ”” Service Worker Ø¬Ø§Ù‡Ø²:", reg);

  const subscription = await reg.pushManager.subscribe({
    userVisibleOnly: true,
    applicationServerKey: "<VAPID_PUBLIC_KEY>"
  });

  console.log("âœ… ØªÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:", subscription);
  await supabase.from("push_subscriptions").insert([
    { endpoint: subscription.endpoint, data: subscription.toJSON() }
  ]);
}

setupPushNotifications();

function injectProductSchema(p) {
  const schema = {
    "@context": "https://schema.org/",
    "@type": "Product",
    "name": p.name,
    "image": p.image,
    "description": p.description || "Ù…Ù†ØªØ¬ Ù…ØªÙˆÙØ± ÙÙŠ Ù…ØªØ¬Ø± LV12.",
    "sku": p.id,
    "brand": { "@type": "Brand", "name": "LV12" },
    "offers": {
      "@type": "Offer",
      "priceCurrency": "EGP",
      "price": p.discount_price && p.discount_price < p.price ? p.discount_price : p.price,
      "availability": p.stock > 0 ? "https://schema.org/InStock" : "https://schema.org/OutOfStock",
      "url": window.location.href
    }
  };

  const script = document.createElement("script");
  script.type = "application/ld+json";
  script.innerHTML = JSON.stringify(schema, null, 2);
  document.head.appendChild(script);
}
function injectShopSchema(products) {
  const schema = {
    "@context": "https://schema.org",
    "@type": "ItemList",
    "name": "LV12 Shop Products",
    "url": "https://lv12shop.shop/shop.html",
    "itemListElement": products.map((p, index) => ({
      "@type": "ListItem",
      "position": index + 1,
      "url": `https://lv12shop.shop/product.html?id=${p.id}`
    }))
  };

  const script = document.createElement("script");
  script.type = "application/ld+json";
  script.innerHTML = JSON.stringify(schema, null, 2);
  document.head.appendChild(script);
}


async function logVisit(pageType, productId = null) {
  try {
    const loc = await fetch("https://ipwho.is/").then((r) => r.json());
    const ip = loc.ip || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
    const city = loc.city || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
    const country = loc.country || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";

    const { data } = await supabase.auth.getSession();
    const user = data?.session?.user;
    const user_id = user ? user.id : null;
    const user_email = user ? user.email : "Ø²Ø§Ø¦Ø±";

    const { error } = await supabase.from("page_visits").insert([
      {
        page_type: pageType,
        product_id: productId,
        ip_address: ip,
        city,
        country,
        user_id,
        user_email,
        user_agent: navigator.userAgent,
        created_at: new Date().toISOString(),
      },
    ]);

    if (error) console.warn("âš ï¸ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø©:", error);
    else console.log(`âœ… Ø²ÙŠØ§Ø±Ø© (${pageType}) Ù…Ù† ${city} - ${country}`);
  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø©:", err);
  }
}

const currentPath = window.location.pathname;

if (currentPath.includes("product.html")) {
  logVisit("product", productId);
} else if (currentPath.includes("shop.html")) {
  logVisit("shop");
} else if (currentPath.includes("cart.html")) {
  logVisit("cart");
} else if (currentPath.includes("my-orders.html")) {
  logVisit("my_orders");
} else {
  logVisit(currentPath);
}
function showToast(msg, ok = true, time = 2500) {
  const toast = document.createElement("div");
  toast.textContent = msg;
  toast.className = `fixed bottom-5 right-5 px-4 py-2 rounded-lg shadow text-white z-50 ${
    ok ? "bg-green-600" : "bg-red-600"
  }`;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), time);
}

let currentUser = null;



function getPriceHTML(product) {
  if (product.discount_price && product.discount_price < product.price) {
    return `
      <div class="text-red-600 font-bold text-lg">${product.discount_price} Ø¬.Ù…</div>
      <div class="text-gray-400 line-through text-sm">${product.price} Ø¬.Ù…</div>
      <span class="bg-red-500 text-white text-xs px-2 py-1 rounded ml-1">Ø®ØµÙ… ğŸ”¥</span>
    `;
  }
  return `<div class="text-blue-700 font-bold text-lg">${product.price} Ø¬.Ù…</div>`;
}
async function renderFeatured(products) {
  const box = document.getElementById("featuredProducts");
  box.innerHTML = "";

  for (const p of products) {

    const { data: imgData } = await supabase
      .from("product_images")
      .select("image_url, is_primary")
      .eq("product_id", p.id)
      .order("is_primary", { ascending: false })
      .limit(1);

    const img = imgData?.[0]?.image_url || "/assets/no-image.png";

    box.innerHTML += `
      <div onclick="location.href='product.html?id=${p.id}'"
           class="w-full h-[340px] relative cursor-pointer">
        <img src="${img}"
             class="absolute inset-0 w-full h-full object-cover" />

        <div class="absolute bottom-0 left-0 p-4 bg-black/40 w-full backdrop-blur-sm">
          <h3 class="text-white font-bold">${p.name}</h3>
          <p class="text-yellow-300">${p.price} Ø¬.Ù…</p>
        </div>
      </div>
    `;
  }
}



async function loadTopViewedProducts() {
  try {
    const { data, error } = await supabase
      .from('page_visits')
      .select('product_id')
      .not('product_id', 'is', null);

    if (error) throw error;

    const viewsCount = {};
    data.forEach(v => {
      viewsCount[v.product_id] = (viewsCount[v.product_id] || 0) + 1;
    });

    const sorted = Object.entries(viewsCount)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 4)
      .map(([id]) => parseInt(id));

    if (sorted.length === 0) {
      document.getElementById("featuredProducts").innerHTML = `
        <p class="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…ÙŠØ²Ø© Ø¨Ø¹Ø¯.</p>`;
      return;
    }

    const { data: products, error: pErr } = await supabase
      .from('products')
      .select(`
        id, name, price,
        product_images!product_images_product_id_fkey(image_url, is_primary)
      `)
      .in('id', sorted);

    if (pErr) throw pErr;

    const html = products.map(p => {
      const img = p.product_images?.find(i => i.is_primary)?.image_url || "https://placehold.co/300x200";
      return `
        <div onclick="location.href='product.html?id=${p.id}'"
             class="cursor-pointer bg-white rounded-xl shadow hover:shadow-lg transition p-2 text-center">
          <img src="${img}" class="w-full h-32 object-cover rounded-md mb-2">
          <h4 class="font-semibold text-blue-700 text-sm">${p.name}</h4>
          <p class="text-green-700 text-sm font-bold">${p.price} Ø¬.Ù…</p>
        </div>`;
    }).join('');

    document.getElementById("featuredProducts").innerHTML = html;

  } catch (err) {
    console.error("âš ï¸ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©:", err);
  }
}

document.addEventListener("DOMContentLoaded", loadTopViewedProducts);
async function getSalesCount(productId) {
  const { count, error } = await supabase
    .from('cart_events')
    .select('id', { count: 'exact', head: true })
    .eq('product_id', productId);

  if (error) {
    console.error("âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:", error);
    return 0;
  }
  return count || 0;
}const PAGE_SIZE = 100; 
let currentPage = 0;
let isLoadingMore = false;
let allLoaded = false;


async function loadWallet() {
  if (!currentUser) return;

  const { data } = await supabase
    .from("wallet")
    .select("balance")
    .eq("user_id", currentUser.id)
    .single();

  const walletBtn = document.getElementById("walletBtn");
  const walletAmount = document.getElementById("walletAmount");

  if (!data) {
    await supabase.from("wallet").insert({ user_id: currentUser.id, balance: 0 });
    walletBtn.classList.remove("hidden");
    walletAmount.textContent = "0 Ø¬.Ù…";
    return;
  }

  walletBtn.classList.remove("hidden");
  walletAmount.textContent = `${data.balance} Ø¬.Ù…`;
}

async function refreshInBackground() {
  try {
    const { data } = await supabase.from("products").select("id");
    if (data?.length && data.length !== allProducts.length) fetchProducts();
  } catch {}
}

function renderDiscountDaysBar() {
  const bar = document.getElementById("discountDaysBar");
  if (!bar) return;

  const days = ["Ø§Ù„Ø³Ø¨Øª","Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©"];
  const withDiscount = {};

  allProducts.forEach(p => {
    if (p.discountActive && p.discount_start) {
      const d = new Date(p.discount_start).getDay();
      const name = days[d];
      if (!withDiscount[name]) withDiscount[name] = 0;
      withDiscount[name]++;
    }
  });

  bar.innerHTML = Object.keys(withDiscount).map(d => `
    <button onclick="openDiscountDay('${d}')">${d} (${withDiscount[d]})</button>
  `).join("");
}

function openDiscountDayFromShop(day) {
  localStorage.setItem("selectedDiscountDay", day);
  location.href = "discount-day.html";
}

  function renderSearchResults(filtered) {
    if (!filtered.length) {
      productsGrid.innerHTML = `<p class="text-center text-gray-500 col-span-full">ğŸ˜” Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©</p>`;
      return;
    }
    renderAllSections(filtered); 
  }

  searchInput.addEventListener("input", e => {
    const query = e.target.value;
    const filtered = filterProducts(query);
    renderSearchResults(filtered);
  });
async function fetchProductsFromSupabase(limit = 60, background = false) {
  try {
    const { data, error } = await supabase
      .from("products")
      .select(`
        id, name, price, discount_price, discount_start, discount_end,
        category, stock, views,
        product_images(image_url, is_primary, ordering)
      `)
      .limit(limit);

    if (error) throw error;

    const now = new Date();

    const processed = data.map(p => {
      const imgs = (p.product_images || []).sort((a, b) => (a.ordering || 0) - (b.ordering || 0));
      const mainImg =
        imgs.find(i => i.is_primary)?.image_url ||
        imgs[0]?.image_url ||
        "/lv12.png";

      const discountActive =
        p.discount_price &&
        p.discount_start &&
        p.discount_end &&
        new Date(p.discount_start) <= now &&
        new Date(p.discount_end) >= now;

      return {
        ...p,
        mainImg,
        discountActive
      };
    });

    window.allProducts = processed;
    localStorage.setItem("LV12_PRODUCTS_CACHE", JSON.stringify({ data: processed, ts: Date.now() }));

    if (!background) {
      renderAllSections(processed);
      hideLoadingSkeleton();
    }

  } catch (err) {
    console.error("âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:", err.message);
  }
}
function renderDealsOfDay(products) {
  const container = document.getElementById("dealsCarousel");
  if (!container) return;

  const today = new Date();
  const deals = products.filter(
    p => p.discountActive && new Date(p.discount_end) >= today
  );

  if (!deals.length) {
    container.innerHTML = `<p class="text-gray-500 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ø§Ù„ÙŠÙˆÙ…</p>`;
    return;
  }

  container.innerHTML = deals
    .map(
      p => `
      <div class="min-w-[150px] bg-white p-2 rounded-lg shadow hover:scale-105 transition cursor-pointer"
           onclick="openProduct('${p.id}')">
        <img src="${p.mainImg}" class="rounded-lg w-full h-32 object-cover">
        <p class="mt-1 text-sm font-medium truncate">${p.name}</p>
        <p class="text-red-500 font-bold">${p.discount_price} Ø¬.Ù…</p>
      </div>`
    )
    .join("");
}
function renderRecommended(products) {
  const container = document.getElementById("recommendedGrid");
  if (!container) return;

  const topViewed = [...products]
    .filter(p => p.views > 0)
    .sort((a, b) => b.views - a.views)
    .slice(0, 8);

  if (!topViewed.length) {
    container.innerHTML = "";
    return;
  }

  container.innerHTML = topViewed
    .map(
      p => `
      <div class="border rounded-xl p-2 bg-white shadow-sm hover:shadow-md cursor-pointer"
           onclick="openProduct('${p.id}')">
        <img src="${p.mainImg}" class="rounded-lg w-full h-32 object-cover">
        <p class="font-semibold text-sm mt-1 truncate">${p.name}</p>
      </div>`
    )
    .join("");
}


async function renderRecommended() {
  try {
    const { data, error } = await supabase
      .from("products")
      .select("*")
      .order("views", { ascending: false })
      .limit(8);

    if (error) throw error;

    const container = document.getElementById("recommendedGrid");
    container.innerHTML = data
      .map(
        (p) => `
        <div class="border rounded-xl p-2 bg-white shadow-sm hover:shadow-md cursor-pointer"
             onclick="openProduct('${p.id}')">
          <img src="${p.image}" class="rounded-lg w-full h-32 object-cover"/>
          <p class="font-semibold text-sm mt-1 truncate">${p.name}</p>
        </div>
      `
      )
      .join("");
  } catch (err) {
    console.error("âš ï¸ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©:", err.message);
  }
}


function openProduct(id) {
  window.location.href = `product.html?id=${id}`;
}
function showLoadingSkeleton() {
  const grid = document.getElementById("productGrid");
  grid.innerHTML = `<div class="text-center text-gray-400 w-full py-6">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</div>`;
}

function hideLoadingSkeleton() {
  const grid = document.getElementById("productGrid");
  if (grid && grid.innerText.includes("Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„")) {
    grid.innerHTML = ""; 
  }
}

window.addEventListener("scroll", () => {
  if (isLoadingMore || allLoaded) return;
  const nearBottom = window.innerHeight + window.scrollY >= document.body.offsetHeight - 300;
  if (nearBottom) fetchProducts(false);
});

function renderTodayOffers() {
  try {
    const wrap = document.getElementById("todayOffers") || document.getElementById("dealsCarousel");
    if (!wrap) {
      console.warn("âš ï¸ Ø¹Ù†ØµØ± Ø¹Ø±ÙˆØ¶ Ø§Ù„ÙŠÙˆÙ… (todayOffers) ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„ØµÙØ­Ø©");
      return;
    }

    if (!window.allProducts || !Array.isArray(allProducts)) {
      wrap.innerHTML = `<p class="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†ØªØ¬Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>`;
      return;
    }

    const now = new Date();
    const today = allProducts.filter(p =>
      p.discount_price &&
      p.discount_start &&
      p.discount_end &&
      new Date(p.discount_start) <= now &&
      new Date(p.discount_end) >= now
    );

    if (!today.length) {
      wrap.innerHTML = `
        <div class="text-center py-6 text-gray-500">
          ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ù…ØªØ§Ø­Ø© Ø§Ù„ÙŠÙˆÙ…ØŒ ØªØ±Ù‚Ø¨ Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©!
        </div>
      `;
      return;
    }

    wrap.innerHTML = today.map(renderSmallCardHorizontal).join("");

  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¹Ø±Ø¶ Ø¹Ø±ÙˆØ¶ Ø§Ù„ÙŠÙˆÙ…:", err);
  }
}

function renderUnder100() {
  const list = allProducts.filter(p =>
    (p.discount_price ?? p.price) <= 100
  );

  const wrap = document.getElementById("under100");
  if (!list.length) return wrap.innerHTML = "";

  wrap.innerHTML = list.map(renderSmallCardHorizontal).join("");
}


function renderUnder100() {
  const list = allProducts.filter(p =>
    (p.discount_price ?? p.price) <= 100
  );

  const wrap = document.getElementById("under100");
  if (!list.length) return wrap.innerHTML = "";

  wrap.innerHTML = list.map(renderSmallCardHorizontal).join("");
}


function renderSmallCardHorizontal(product) {
  return `
    <div class="flex bg-white rounded-xl shadow-sm hover:shadow-md p-3 gap-3 cursor-pointer transition-all duration-300 hover:-translate-y-1"
         onclick="window.location.href='product.html?id=${product.id}'">
   <img src="${product.mainImg || product.image || '/lv12.png'}"

           alt="${product.name}" 
           class="w-24 h-24 rounded-lg object-cover flex-shrink-0 border border-gray-100" />

      <div class="flex-1 flex flex-col justify-between">
        <div>
          <h4 class="font-semibold text-gray-800 text-sm mb-1">${product.name}</h4>
          <p class="text-gray-500 text-xs line-clamp-2">${product.description || ''}</p>
        </div>
        <div class="flex items-center gap-2 mt-2">
          <span class="text-blue-600 font-bold text-sm">${product.discount_price || product.price} Ø¬.Ù…</span>
          ${product.discount_price
            ? `<span class="line-through text-gray-400 text-xs">${product.price} Ø¬.Ù…</span>`
            : ""}
        </div>
      </div>

      ${product.discount_price
        ? `<div class="absolute top-2 right-2 bg-red-600 text-white text-xs font-semibold px-2 py-1 rounded-lg shadow-md">Ø®ØµÙ…</div>`
        : ""}
    </div>
  `;
}
function normalizeText(text) {
  return text
    .toLowerCase()
    .replace(/[Ø£Ø¥Ø¢]/g, "Ø§")
    .replace(/Ø©/g, "Ù‡")
    .replace(/Ù‰/g, "ÙŠ")
    .trim();
}

function normalizeText(text) {
  return text
    .toLowerCase()
    .replace(/[Ø£Ø¥Ø¢]/g, "Ø§")
    .replace(/Ø©/g, "Ù‡")
    .replace(/Ù‰/g, "ÙŠ")
    .trim();
}


const clearSearch = document.getElementById("clearSearch");
const allSections = Array.from(document.querySelectorAll("main > section"));

const suggestionBox = document.createElement("div");
suggestionBox.id = "suggestionBox";
suggestionBox.className = "absolute bg-white border border-gray-200 shadow-lg rounded-lg w-full mt-1 z-50 hidden";
document.querySelector(".relative").appendChild(suggestionBox);

searchInput.addEventListener("input", () => {
  const query = normalizeText(searchInput.value);
  suggestionBox.innerHTML = "";
  if (!query) {
    suggestionBox.classList.add("hidden");
    return;
  }

  const suggestions = allProducts
    .filter(p => {
      const name = normalizeText(p.name);
      const dist = levenshtein(name, query);
      return name.includes(query) || dist <= 2;
    })
    .slice(0, 6); 

  if (suggestions.length === 0) {
    suggestionBox.classList.add("hidden");
    return;
  }

  suggestionBox.classList.remove("hidden");
  suggestionBox.innerHTML = suggestions.map(p => `
    <div class="px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm flex items-center gap-2" data-id="${p.id}">
      <img src="${p.mainImg}" class="w-8 h-8 rounded object-cover border">
      <span>${p.name}</span>
    </div>
  `).join("");

  suggestionBox.querySelectorAll("div").forEach(div => {
    div.addEventListener("click", () => {
      const pid = div.dataset.id;
      suggestionBox.classList.add("hidden");
      window.location.href = `product.html?id=${pid}`;
    });
  });
});

searchInput.addEventListener("keydown", e => {
  if (e.key === "Enter") {
    e.preventDefault();
    suggestionBox.classList.add("hidden");
    const query = normalizeText(searchInput.value);
    const results = allProducts.filter(p => normalizeText(p.name).includes(query));
    allSections.forEach(sec => sec.classList.add("hidden"));
    productsGrid.parentElement.classList.remove("hidden");
    productsGrid.innerHTML = results.map(renderProductCard).join("");
  }
});

clearSearch.addEventListener("click", () => {
  searchInput.value = "";
  suggestionBox.classList.add("hidden");
  allSections.forEach(sec => sec.classList.remove("hidden"));
  loadProducts();
});
function renderUnder200() {
  const list = allProducts.filter(p =>
    (p.discount_price ?? p.price) > 100 &&
    (p.discount_price ?? p.price) <= 200
  );

  const wrap = document.getElementById("under200");
  if (!list.length) return wrap.innerHTML = "";

  wrap.innerHTML = list.map(renderSmallCardHorizontal).join("");
}

function renderDiscountDaysBar() {
  const days = {
    0: "Ø§Ù„Ø£Ø­Ø¯",
    1: "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†",
    2: "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡",
    3: "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡",
    4: "Ø§Ù„Ø®Ù…ÙŠØ³",
    5: "Ø§Ù„Ø¬Ù…Ø¹Ø©",
    6: "Ø§Ù„Ø³Ø¨Øª"
  };

  const groups = {};

  allProducts.forEach(p => {
    if (!p.discount_start) return;
    const d = new Date(p.discount_start).getDay();
    const dayName = days[d];
    groups[dayName] = groups[dayName] || [];
    groups[dayName].push(p);
  });

  const bar = document.getElementById("discountDaysSection");
  if (!bar) return;

  bar.innerHTML = Object.keys(groups).map(day => `
    <button class="discount-day-btn bg-red-600 text-white px-3 py-1 rounded-full text-sm"
            onclick="openDiscountDay('${day}')">
      ${day} (${groups[day].length})
    </button>
  `).join("");

  window.openDiscountDay = function(day) {
    const list = groups[day];
    document.getElementById("discountDayProducts").innerHTML = list.map(renderSmallCardHorizontal).join("");
  };

  const firstDay = Object.keys(groups)[0];
  if (firstDay) openDiscountDay(firstDay);
}

function renderSmallCard(p) {
  return `
  <div class="product-card" onclick="location.href='product.html?id=${p.id}'">
    <img src="${p.mainImg}">
    <h3>${p.name}</h3>
    <div>
      ${p.discount_price ? `<span class="price-new">${p.discount_price} Ø¬.Ù…</span><span class="price-old">${p.price} Ø¬.Ù…</span>` : `<span class="price-new">${p.price} Ø¬.Ù…</span>`}
    </div>
  </div>`;
}

function selectCategory(cat, btn = null) {
  document.querySelectorAll("#categoriesNav .cat-btn").forEach(b => {
    b.classList.remove("bg-blue-600", "text-white");
    b.classList.add("bg-gray-100", "text-gray-800");
  });
  if (btn) {
    btn.classList.remove("bg-gray-100", "text-gray-800");
    btn.classList.add("bg-blue-600", "text-white");
  }

  categoryFilter.value = cat;
  renderFiltered();

  window.scrollTo({
    top: document.getElementById("products").offsetTop - 80,
    behavior: "smooth"
  });


  function renderFiltered() {
  const q = searchInput.value.trim().toLowerCase();

  const list = q ? smartSearch(q, allProducts) : allProducts;

  renderProducts(list);
}

  const script = document.createElement("script");
  script.type = "application/ld+json";
  script.innerHTML = JSON.stringify(schema, null, 2);
  document.head.appendChild(script);
}

function renderGroupedByDay(list) {
  const groups = groupByDiscountDay(list);
  productsGrid.innerHTML = ""; 

  const dayNames = Object.keys(groups);

  if (!dayNames.length) {
    productsGrid.innerHTML = `<p style="text-align:center;margin-top:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>`;
    return;
  }

  let html = "";

  dayNames.forEach(day => {
    html += `
      <div style="margin-bottom:25px;">
        <h2 style="font-size:18px;font-weight:bold;margin-bottom:10px;color:#c30000;cursor:pointer"
            onclick="this.nextElementSibling.classList.toggle('hidden')">
          Ø¹Ø±ÙˆØ¶ ÙŠÙˆÙ… ${day} ğŸ”½
        </h2>

        <div class="products-day-container">
          ${groups[day].map(p => `
            <div class="product-card" onclick="location.href='product.html?id=${p.id}'">
              ${p.discount_price && p.discount_price < p.price ? `<span class="discount-badge">Ø®ØµÙ… ğŸ”¥</span>` : ""}
              <img src="${p.image}">
              <h3>${escapeHtml(p.name)}</h3>
              <span class="price-new">${p.discount_price ?? p.price} Ø¬.Ù…</span>
              ${p.discount_price ? `<span class="price-old">${p.price} Ø¬.Ù…</span>` : ""}
            </div>
          `).join("")}
        </div>
      </div>
    `;
  });

  productsGrid.innerHTML = html;
}

document.getElementById("discountBtn").onclick = () => {
  filtered = allProducts.filter(p => p.discount_price && p.discount_price < p.price);
  renderFiltered();
};

function safeParseJSON(raw) {
  if (!raw) return {};
  try {
    if (typeof raw === "object") return raw;
    let parsed = JSON.parse(raw);
    if (typeof parsed === "string") parsed = JSON.parse(parsed);
    return parsed;
  } catch {
    return {};
  }
}


async function loadInterestProducts() {
  const { data: sessionData } = await supabase.auth.getSession();
  const user = sessionData?.session?.user;
  if (!user) return;

  const { data: visits, error } = await supabase
    .from("page_visits")
    .select("product_id")
    .eq("user_id", user.id)
    .order("visited_at", { ascending: false })
    .limit(8);

  if (error || !visits?.length) {
    console.warn("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª Ø¨Ø¹Ø¯:", error);
    document.getElementById("interestProducts").innerHTML = `<p class="text-gray-500 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª Ø¨Ø¹Ø¯.</p>`;
    return;
  }

  const productIds = visits.map(v => v.product_id);
  const { data: products } = await supabase
    .from("products")
    .select("id, name, price, image")
    .in("id", productIds);

  const container = document.getElementById("interestProducts");
  container.innerHTML = products.map(p => `
    <a href="product.html?id=${p.id}" class="bg-white rounded-xl shadow hover:shadow-lg transition p-2 flex flex-col">
      <img src="${p.image || 'lv12.png'}" class="w-full h-40 object-cover rounded-lg mb-2">
      <h3 class="font-semibold text-sm text-gray-800 truncate">${p.name}</h3>
      <p class="text-blue-600 font-bold text-sm">${p.price} Ø¬.Ù…</p>
    </a>
  `).join("");
}

document.addEventListener("DOMContentLoaded", loadInterestProducts);

function getDiscountDays(products) {
  const days = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];
  const result = {};

  products.forEach(p => {
    if (!p.discount_start) return;
    const d = new Date(p.discount_start).getDay();
    const dayName = days[d];
    if (!result[dayName]) result[dayName] = [];
    result[dayName].push(p);
  });

  return result;
}



window.showCategoryProducts = function(cat) {
  const list = allProducts.filter(p => p.category === cat);

  productsGrid.classList.add("hidden");
  noResultsEl.classList.add("hidden");

  document.getElementById("discountDayProducts").innerHTML = "";
  
  document.getElementById("products").scrollIntoView({ behavior: "smooth" });

  document.getElementById("productsGrid").outerHTML = `
    <div id="productsGrid" class="flex gap-3 overflow-x-auto pb-4 snap-x">
      ${list.map(p => `
        <div class="product-card min-w-[170px] snap-center" onclick="location.href='product.html?id=${p.id}'">
          <img src="${p.mainImg}">
          <h3>${p.name}</h3>
          <span class="price-new">${p.discount_price ?? p.price} Ø¬.Ù…</span>
        </div>
      `).join("")}
    </div>
  `;
};



function openDiscountDay(day) {
  const groups = getDiscountDays(allProducts);
  renderProducts(groups[day] || []);
  window.scrollTo({ top: productsGrid.offsetTop - 50, behavior: "smooth" });
}
window.openCategoryHorizontal = function(cat) {
  const list = allProducts.filter(p => p.category === cat);

  document.getElementById("productsGrid").classList.add("hidden");
  document.getElementById("noResults").classList.add("hidden");

  document.getElementById("products").scrollIntoView({ behavior: "smooth" });

  document.getElementById("discountDayProducts").innerHTML = "";

  document.getElementById("productsGrid").outerHTML = `
    <div id="productsGrid" class="flex gap-3 overflow-x-auto pb-4 snap-x scroll-smooth">
      ${list.map(p => `
        <div class="min-w-[160px] bg-white rounded-lg shadow p-2 snap-center cursor-pointer"
             onclick="location.href='product.html?id=${p.id}'">

          <img src="${p.mainImg}" class="w-full h-32 object-cover rounded-md mb-1">

          <h3 class="text-sm font-semibold text-blue-800 truncate">${p.name}</h3>

          <div class="text-sm font-bold text-red-600">${p.discount_price ?? p.price} Ø¬.Ù…</div>
        </div>
      `).join("")}
    </div>
  `;
};


function addToCart(id) {
  const p = allProducts.find(x => x.id === id);
  if (!p) return;

  const seller = p.seller_id || p.owner_id || null;

  const exist = cart.find(i => i.id === id);
  if (exist) {
    exist.qty++;
  } else {
    cart.push({
      id: p.id,
      name: p.name,
      price: p.price,
      qty: 1,
      seller_id: seller   
    });
  }

  localStorage.setItem("cart", JSON.stringify(cart));
  updateCartUI();
}


function updateCartUI() {
  const c = cart.reduce((a, b) => a + b.qty, 0);
  if (c > 0) { cartBadge.textContent = c; cartBadge.classList.remove("hidden"); }
  else cartBadge.classList.add("hidden");
}

function showLoading(on) {
  if (on) { loadingEl.classList.remove("hidden"); productsGrid.classList.add("hidden"); }
  else loadingEl.classList.add("hidden");
}

function showError(msg) {
  loadingEl.textContent = msg;
}

function levenshtein(a, b) {
  const m = a.length, n = b.length;
  const dp = Array.from({ length: m + 1 }, () => Array(n + 1).fill(0));
  for (let i = 0; i <= m; i++) dp[i][0] = i;
  for (let j = 0; j <= n; j++) dp[0][j] = j;
  for (let i = 1; i <= m; i++) {
    for (let j = 1; j <= n; j++) {
      const cost = a[i - 1] === b[j - 1] ? 0 : 1;
      dp[i][j] = Math.min(
        dp[i - 1][j] + 1,
        dp[i][j - 1] + 1,
        dp[i - 1][j - 1] + cost
      );
    }
  }
  return dp[m][n];
}



(async function init() {
  document.getElementById("yearFooter").textContent = new Date().getFullYear();
  updateCartUI();
  await checkAuth();
  await detectUserLocation();
  await loadProducts(); 
  hideLoadingSkeleton();
})();


</script>














<script>
document.addEventListener("DOMContentLoaded", () => {
  const taskId = localStorage.getItem("activeTaskId");
  const duration = Number(localStorage.getItem("taskDuration"));
  let remaining = Number(localStorage.getItem("taskRemaining")) || duration;
  let lastUpdate = Number(localStorage.getItem("taskLastUpdate")) || Date.now();
  if (!taskId || !duration) return;

  const bar = document.createElement("div");
  Object.assign(bar.style, {
    position: "fixed",
    top: "0",
    left: "0",
    right: "0",
    zIndex: "9999",
    background: "#2563eb",
    color: "#fff",
    textAlign: "center",
    padding: "10px",
    fontWeight: "bold",
    fontSize: "15px",
    transition: "opacity 0.5s ease"
  });
  document.body.prepend(bar);

  let finishedShown = false;

  function saveState() {
    localStorage.setItem("taskRemaining", remaining);
    localStorage.setItem("taskLastUpdate", Date.now());
  }

  function finishTask() {
    if (finishedShown) return;
    finishedShown = true;
    clearInterval(window.__taskTimer);
    bar.textContent = "âœ… ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø­ÙØ¸Ø©.";
    localStorage.removeItem("activeTaskId");
    localStorage.removeItem("taskDuration");
    localStorage.removeItem("taskRemaining");
    localStorage.removeItem("taskLastUpdate");
    localStorage.setItem(`task_${taskId}_completed_at`, new Date().toISOString());
    setTimeout(() => (bar.style.opacity = "0"), 2000);
    setTimeout(() => bar.remove(), 3000);
  }

  function tick() {
    const now = Date.now();
    const diff = Math.floor((now - lastUpdate) / 1000);
    lastUpdate = now;
    remaining -= diff;

    if (remaining <= 0) return finishTask();

    const m = Math.floor(remaining / 60);
    const s = remaining % 60;
    bar.textContent = `â³ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¬Ø§Ø±ÙŠØ© â€” ${m}:${String(s).padStart(2, "0")} Ø¯Ù‚ÙŠÙ‚Ø©`;
    saveState();
  }

  tick();
  window.__taskTimer = setInterval(tick, 1000);

  document.addEventListener("visibilitychange", () => {
    if (document.hidden) {
      saveState();
      clearInterval(window.__taskTimer);
    } else {
      const now = Date.now();
      const diff = Math.floor((now - lastUpdate) / 1000);
      remaining -= diff;
      lastUpdate = now;
      tick();
      clearInterval(window.__taskTimer);
      window.__taskTimer = setInterval(tick, 1000);
    }
  });
});

</script>






<script>
const userAreaMenu = document.getElementById("userAreaMenu");

async function renderUserMenuUI(user, profile) {
  const name =
    profile?.full_name ||
    user.user_metadata?.full_name ||
    user.email.split("@")[0];

  const avatar =
    profile?.avatar_url ||
    user.user_metadata?.avatar_url ||
    `https://ui-avatars.com/api/?background=2563eb&color=fff&name=${encodeURIComponent(
      name
    )}`;

  const html = `
    <div class="flex items-center gap-3 bg-white px-3 py-2 rounded-xl shadow-sm border border-blue-200">
      <img src="${avatar}" alt="avatar" class="w-10 h-10 rounded-full border border-blue-300 object-cover ring-2 ring-blue-100">

      <div class="flex flex-col">
        <span class="text-gray-800 text-sm font-semibold">${name}</span>
        
        <button id="logoutBtnMenu" class="text-red-600 hover:text-red-800 text-xs font-semibold mt-1">
          ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
        </button>
      </div>
    </div>
  `;

  userAreaMenu.innerHTML = html;

  if (profile?.is_seller) {
    const sellerLink = document.createElement("a");
    sellerLink.href = "merchant-dashboard.html";
    sellerLink.textContent = "ğŸ›ï¸ Ù…ØªØ¬Ø±ÙŠ";
    sellerLink.className =
      "bg-indigo-600 hover:bg-indigo-700 text-white text-xs px-2 py-1 rounded mt-2 inline-block";
    userAreaMenu.appendChild(sellerLink);
  }

  document.getElementById("logoutBtnMenu")?.addEventListener(
    "click",
    async () => {
      await supabase.auth.signOut();
      showToast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­");
      location.reload();
    }
  );
}


function renderLoggedOutMenu() {
  userAreaMenu.innerHTML = `
    <a href="shop-login.html"
       class="text-blue-400 text-sm font-semibold hover:text-blue-300">
       ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    </a>
  `;
}


async function checkAuth() {
  try {
    const { data } = await supabase.auth.getSession();
    const user = data?.session?.user;

    if (!user) {
      renderLoggedOutMenu();
      return;
    }

    const { data: profile } = await supabase
      .from("profiles")
      .select("full_name, avatar_url, is_seller, seller_verified")
      .eq("id", user.id)
      .maybeSingle();

    await renderUserMenuUI(user, profile);
  } catch (err) {
    console.error("Auth Error:", err);
  }
}

async function updateWallet() {
  const { data } = await supabase.auth.getSession();
  const user = data?.session?.user;

  if (!user) return;

  const walletAmount = document.getElementById("walletAmount");

  try {
    const { data: wallet } = await supabase
      .from("wallet")
      .select("balance")
      .eq("user_id", user.id)
      .maybeSingle();

    const bal = wallet?.balance ?? 0;
    if (walletAmount) walletAmount.textContent = `${Number(bal).toFixed(2)} Ø¬.Ù…`;

  } catch (e) {
    console.warn("Wallet load error", e);
  }
}

function updateCartBadge() {
  const cart = JSON.parse(localStorage.getItem("cart") || "[]");
  const cartBadge = document.getElementById("cartBadge");

  if (!cartBadge) return;

  if (cart.length > 0) {
    cartBadge.textContent = cart.length;
    cartBadge.classList.remove("hidden");
  } else {
    cartBadge.classList.add("hidden");
  }
}


window.addEventListener("DOMContentLoaded", async () => {
  await checkAuth();
  await updateWallet();
  updateCartBadge();
});
</script>


<script>
async function renderUnderPriceSections() {
  try {
    if (!window.allProducts || !allProducts.length) {
      console.warn("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø© Ø¨Ø¹Ø¯ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…");
      return;
    }
    const under100 = allProducts.filter(p => p.price <= 100);
    const under200 = allProducts.filter(p => p.price > 100 && p.price <= 200);
    const under100Container = document.getElementById("under100");
    const under200Container = document.getElementById("under200");
    if (under100Container) {
      under100Container.innerHTML = under100.map(renderProductCard).join("");
    }

    if (under200Container) {
      under200Container.innerHTML = under200.map(renderProductCard).join("");
    }
    document.getElementById("under100Wrapper").classList.remove("hidden");
    document.getElementById("under200Wrapper").classList.remove("hidden");
  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:", err);
  }
}

</script>
<script>
async function renderUserInterests() {
  const container = document.getElementById("interestProducts");
  if (!container) return;

  try {
    const { data: session } = await supabase.auth.getSession();
    const user = session?.session?.user;

    if (!user) {
      container.innerHTML = `<p class="text-gray-500 text-center py-4">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø¹Ø±Ø¶ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ â¤ï¸</p>`;
      return;
    }

    const { data: interests, error } = await supabase
      .from("user_interests")
      .select("product_id")
      .eq("user_id", user.id)
      .order("created_at", { ascending: false })
      .limit(12);

    if (error) throw error;

    if (!interests?.length) {
      container.innerHTML = `<p class="text-gray-500 text-center py-4">Ù„Ù… ØªÙ‚Ù… Ø¨Ø²ÙŠØ§Ø±Ø© Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯ ğŸ‘€</p>`;
      return;
    }

    const ids = interests.map(i => i.product_id);

    const { data: products, error: pErr } = await supabase
      .from("products")
      .select(`
        id, name, price, discount_price,
        product_images(image_url, is_primary)
      `)
      .in("id", ids);

    if (pErr) throw pErr;

    if (!products?.length) {
      container.innerHTML = `<p class="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¨Ø¹Ø¯</p>`;
      return;
    }

    container.innerHTML = products.map(p => {
      const img =
        (p.product_images?.find(im => im.is_primary)?.image_url) ||
        (p.product_images?.[0]?.image_url) ||
        "/assets/no-image.png";

      const price = p.discount_price ?? p.price;
      return `
        <div class="bg-white rounded-xl shadow hover:shadow-lg transition p-2 cursor-pointer"
             onclick="location.href='product.html?id=${p.id}'">
          <img src="${img}" class="w-full h-40 object-cover rounded-lg mb-2" alt="${p.name}">
          <h3 class="font-semibold text-sm text-gray-800 truncate">${p.name}</h3>
          <p class="text-blue-600 font-bold text-sm">${price} Ø¬.Ù…</p>
        </div>
      `;
    }).join("");

  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª:", err);
    container.innerHTML = `<p class="text-red-500 text-center py-4">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª ğŸ˜</p>`;
  }
}
window.addEventListener("DOMContentLoaded", async () => {
  const taskId = localStorage.getItem("activeTaskId");
  if (!taskId) return;

  const startTime = parseInt(localStorage.getItem("taskStartTime"));
  const duration = parseInt(localStorage.getItem("taskDuration"));
  const taskTitle = localStorage.getItem("taskTitle");
  const reward = parseFloat(localStorage.getItem("taskReward"));

  const timerEl = document.createElement("div");
  timerEl.style.position = "fixed";
  timerEl.style.bottom = "20px";
  timerEl.style.left = "50%";
  timerEl.style.transform = "translateX(-50%)";
  timerEl.style.padding = "10px 20px";
  timerEl.style.background = "rgba(0,0,0,0.6)";
  timerEl.style.color = "#fff";
  timerEl.style.borderRadius = "10px";
  timerEl.style.fontSize = "1.2rem";
  document.body.appendChild(timerEl);

  const interval = setInterval(async () => {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    const remaining = duration - elapsed;

    if (remaining > 0) {
      const m = Math.floor(remaining / 60);
      const s = remaining % 60;
      timerEl.textContent = `â±ï¸ Ø¬Ø§Ø±ÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‡Ù…Ø© (${m}:${String(s).padStart(2,"0")})`;
    } else {
      clearInterval(interval);
      timerEl.textContent = "âœ… ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‡Ù…Ø©ØŒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©...";
      localStorage.removeItem("activeTaskId");

      try {
        const userIP = await fetch("https://api.ipify.org?format=json").then(r=>r.json()).then(d=>d.ip).catch(()=> "unknown");
        await supabase.from("user_daily_tasks").insert([
          {
            user_id: currentUser.id,
            task_id: taskId,
            status: "pending",
            ip_address: userIP,
            username: currentUser.user_metadata?.full_name || "Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
            wallet_id: currentUser.id,
          }
        ]);
        toast(`ğŸ¯ ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© "${taskTitle}" Ø¨Ù†Ø¬Ø§Ø­!`);
      } catch (err) {
        console.error("insert error", err);
        toast("âš ï¸ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©", false);
      }
    }
  }, 1000);
});

document.addEventListener("DOMContentLoaded", renderUserInterests);
</script>








<script>
document.addEventListener("DOMContentLoaded", async () => {
  try {
    const taskId = localStorage.getItem("activeTaskId");
    if (!taskId) return; 

    const { data: session } = await supabase.auth.getSession();
    const user = session?.session?.user;
    if (!user) return;

    const { data: activeTask, error } = await supabase
      .from("user_daily_tasks")
      .select("id, status, expected_end_at")
      .eq("user_id", user.id)
      .eq("task_id", taskId)
      .in("status", ["in_progress", "pending"])
      .order("created_at", { ascending: false })
      .limit(1)
      .maybeSingle();

    if (error || !activeTask) {
      console.warn("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ù…Ø© Ù†Ø´Ø·Ø© ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±");
      localStorage.removeItem("activeTaskId");
      return;
    }

    if (activeTask.status === "pending") {
      showStatusBar("â³ Ø§Ù„Ù…Ù‡Ù…Ø© Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù† Ø§Ù„Ø£Ø¯Ø§Ø±Ø©...");
      return;
    }

    const endTime = new Date(activeTask.expected_end_at).getTime();
    let remaining = Math.floor((endTime - Date.now()) / 1000);

    const bar = showStatusBar("");

    const timer = setInterval(async () => {
      if (remaining <= 0) {
        clearInterval(timer);
        bar.textContent = "âœ… ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© â€” Ø¬Ø§Ø±Ù Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©...";

        try {
          await supabase
            .from("user_daily_tasks")
            .update({
              status: "pending",
              completed_at: new Date().toISOString(),
            })
            .eq("id", activeTask.id);

          localStorage.removeItem("activeTaskId");
          setTimeout(() => (bar.textContent = "ğŸ“© ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"), 1500);
          setTimeout(() => bar.remove(), 4000);
        } catch (err) {
          console.error("âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©:", err);
          bar.textContent = "âš ï¸ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
        }

        return;
      }

      const m = Math.floor(remaining / 60);
      const s = remaining % 60;
      bar.textContent = `â³ Ø¬Ø§Ø±ÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‡Ù…Ø© â€” ${m}:${String(s).padStart(2, "0")}`;
      remaining--;
    }, 1000);

  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ù…Ù‡Ù…Ø©:", err);
  }

  function showStatusBar(text) {
    let bar = document.getElementById("taskTimerBar");
    if (!bar) {
      bar = document.createElement("div");
      bar.id = "taskTimerBar";
      Object.assign(bar.style, {
        position: "fixed",
        top: "0",
        left: "0",
        right: "0",
        zIndex: "9999",
        background: "#2563eb",
        color: "#fff",
        fontWeight: "bold",
        textAlign: "center",
        padding: "10px",
        fontSize: "16px",
        transition: "opacity 0.5s ease",
      });
      document.body.prepend(bar);
    }
    bar.textContent = text;
    return bar;
  }
});
function restoreActiveTask() {
  const activeId = localStorage.getItem('activeTaskId');
  const startTime = localStorage.getItem('taskStartTime');
  const duration = localStorage.getItem('taskDuration');
  const title = localStorage.getItem('activeTaskTitle');
  const reward = localStorage.getItem('activeTaskReward');

  if (!activeId || !startTime || !duration) return;

  const elapsed = Math.floor((Date.now() - Number(startTime)) / 1000);
  const remaining = Number(duration) - elapsed;

  if (remaining > 0) {
    startCountdown(activeId, remaining, Number(startTime), title, reward);
  } else {
    clearActiveTask();
  }
}

function startCountdown(taskId, totalSeconds, startTime, title, reward) {
  const countdownEl = document.getElementById("countdownDisplay");
  if (countdownEl) countdownEl.textContent = `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${fmtTimeLeft(totalSeconds)}`;

  const interval = setInterval(async () => {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    const remaining = totalSeconds - elapsed;

    if (remaining <= 0) {
      clearInterval(interval);
      clearActiveTask();

      if (countdownEl) countdownEl.textContent = "âœ… ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©!";

      try {
        await supabase.from("user_daily_tasks").update({
          status: "pending",
          completed_at: new Date().toISOString()
        }).eq("id", localStorage.getItem('activeUserTaskRowId'));
      } catch (err) {
        console.error("sendToAdmin error:", err);
      }

      toast("âœ… ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­ â€” Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©");
      return;
    }

    if (countdownEl) countdownEl.textContent = `â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${fmtTimeLeft(remaining)}`;
  }, 1000);
}

function clearActiveTask() {
  localStorage.removeItem('activeTaskId');
  localStorage.removeItem('activeUserTaskRowId');
  localStorage.removeItem('taskStartTime');
  localStorage.removeItem('taskDuration');
  localStorage.removeItem('activeTaskTitle');
  localStorage.removeItem('activeTaskReward');
}

function fmtTimeLeft(sec) {
  const m = Math.floor(sec / 60);
  const s = sec % 60;
  return `${m}:${s.toString().padStart(2, '0')}`;
}

document.addEventListener("DOMContentLoaded", restoreActiveTask);

</script>














<script>
async function loadNotifications() {
  const { data, error } = await supabase
    .from('notifications')
    .select('*')
    .order('created_at', { ascending: false })
    .limit(5);

  if (error) return console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:", error);

  const list = document.getElementById("notificationsList");
  list.innerHTML = data.map(n => `
    <div class="p-2 border-b border-gray-700">
      <p class="text-white">${n.title}</p>
      <small class="text-gray-400">${new Date(n.created_at).toLocaleString()}</small>
    </div>
  `).join('');
}
loadNotifications();


const seenAds = JSON.parse(localStorage.getItem("seen_ads") || "{}");

async function showShopAd() {
  try {

    if (typeof supabase === "undefined") {
      console.error("âŒ Supabase ØºÙŠØ± Ù…Ø¹Ø±Ù‘Ù. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ¶Ù…ÙŠÙ† Ù…ÙƒØªØ¨Ø© supabase Ù‚Ø¨Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±Ø¨Øª.");
      return;
    }

    const { data, error } = await supabase
      .from("shop_ads")
      .select("*")
      .order("created_at", { ascending: false })
      .limit(1);

    if (error) {
      console.error("âŒ Ø®Ø·Ø£ Ù…Ù† Supabase:", error);
      return;
    }

    if (!data || !data.length) {
      console.log("â„¹ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© ÙÙŠ shop_ads");
      return;
    }

    const ad = data[0];
    const now = new Date();

    if (ad.start_date && new Date(ad.start_date) > now) return;
    if (ad.end_date && new Date(ad.end_date) < now) return;

    if (seenAds[ad.id]) return;

    let banner = document.getElementById("shopAdBanner");
    let text = document.getElementById("shopAdText");
    let closeBtn = document.getElementById("closeShopAd");

   
    if (!banner || !text || !closeBtn) {
      banner = document.createElement("div");
      banner.id = "shopAdBanner";

      banner.className = "mx-auto max-w-3xl w-full bg-white text-gray-900 rounded-2xl shadow-lg p-4 flex items-center justify-between gap-4";

      banner.style.opacity = "0";
      banner.style.transform = "translateY(-10px)";
      banner.style.transition = "opacity 300ms ease, transform 300ms ease";

      banner.innerHTML = `
        <div class="flex items-center gap-3">
          <div id="shopAdIcon" aria-hidden="true" style="font-size:22px;line-height:1;width:44px;height:44px;border-radius:10px;display:inline-flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#f97316,#ef4444);color:white;box-shadow:0 6px 18px rgba(239,68,68,0.12)">ğŸ”¥</div>
          <div>
            <div id="shopAdText" style="font-weight:800;font-size:1.15rem;line-height:1.1;letter-spacing:0.2px;background:linear-gradient(90deg,#4f46e5,#ec4899);-webkit-background-clip:text;background-clip:text;color:transparent;">Ø¥Ø¹Ù„Ø§Ù† Ù…Ù…ÙŠØ²</div>
            <div id="shopAdSub" style="margin-top:3px;color:#475569;font-size:0.9rem;">Ù†Øµ ØªÙˆØ¶ÙŠØ­ÙŠ Ù‚ØµÙŠØ± Ù„Ù„Ø§Ø¹Ù„Ø§Ù†</div>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <a id="shopAdAction" href="#" class="hidden" style="background:linear-gradient(90deg,#4f46e5,#ec4899);color:#fff;padding:8px 12px;border-radius:10px;font-weight:600;text-decoration:none;box-shadow:0 6px 16px rgba(79,70,229,0.12);">Ø¹Ø±Ø¶</a>
          <button id="closeShopAd" aria-label="Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†" style="background:transparent;border:none;color:#94a3b8;font-size:0.95rem;padding:6px 8px;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      `;

      const productsEl = document.getElementById("products");
      if (productsEl && productsEl.parentNode) {
        productsEl.parentNode.insertBefore(banner, productsEl);
      } else {
        const mainEl = document.querySelector("main") || document.body;
        mainEl.insertBefore(banner, mainEl.firstChild);
      }

      text = document.getElementById("shopAdText");
      closeBtn = document.getElementById("closeShopAd");
    }

    if (ad.bg) banner.style.background = ad.bg;
    if (ad.text) text.textContent = ad.text;
    if (ad.subtext) document.getElementById("shopAdSub").textContent = ad.subtext;

    const actionBtn = document.getElementById("shopAdAction");
    if (ad.link) {
      actionBtn.href = ad.link;
      actionBtn.classList.remove("hidden");
    } else {
      actionBtn.classList.add("hidden");
    }

    requestAnimationFrame(() => {
      banner.style.opacity = "1";
      banner.style.transform = "translateY(0)";
    });

    closeBtn.addEventListener("click", () => {
      banner.style.opacity = "0";
      banner.style.transform = "translateY(-10px)";
      setTimeout(() => banner.remove(), 300);
      seenAds[ad.id] = true;
      localStorage.setItem("seen_ads", JSON.stringify(seenAds));
    });

  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†:", err);
  }
}

document.addEventListener("DOMContentLoaded", showShopAd);


async function logUserActivity(type) {
  try {
    const user = JSON.parse(localStorage.getItem('lv12_user') || '{}');

    if (typeof supabase === "undefined") {
      console.error("âŒ Supabase ØºÙŠØ± Ù…Ø¹Ø±Ù‘Ù. Ù„Ù† ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·.");
      return;
    }

    await supabase.from('user_activity').insert({
      user_id: user.id || null,
      user_display: user.name || 'Ø²Ø§Ø¦Ø±',
      type
    });

  } catch (e) {
    console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·:", e);
  }
}

logUserActivity('Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±');
</script>











<script>
function goToCategory(cat) {
  window.location.href = "category.html?name=" + encodeURIComponent(cat);
}

function scrollToCategory(cat) {
  const id = "cat_" + cat.replace(/\s+/g, '_');
  const section = document.getElementById(id);
  if (section) {
    section.scrollIntoView({ behavior: "smooth", block: "start" });
  }
}

function renderCategorySections(products) {
  const bar = document.getElementById("categoriesBar");
  const container = document.getElementById("categorySections");

  if (!bar || !container) return;

  const groups = {};

  products.forEach(p => {
    const cat = p.category?.trim() || "ØºÙŠØ± Ù…ØµÙ†Ù";
    if (!groups[cat]) groups[cat] = [];
    groups[cat].push(p);
  });

  const categories = Object.keys(groups);

  bar.innerHTML = categories.map(cat => `
    <div class="category-item cursor-pointer"
         onclick="goToCategory('${encodeURIComponent(cat)}')">
      ${cat}
    </div>
  `).join("");

  container.innerHTML = categories.map(cat => {
    const id = "cat_" + cat.replace(/\s+/g, "_");
    const items = groups[cat].slice(0, 10);

    return `
      <section id="${id}" class="bg-white p-4 rounded-3xl shadow-md border border-blue-100 mb-8">

        <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† + Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ -->
        <div class="flex justify-between items-center mb-3">
          <h2 class="font-bold text-xl text-blue-900">${cat}</h2>

          <button class="text-blue-600 text-sm font-semibold hover:underline"
                  onclick="goToCategory('${encodeURIComponent(cat)}')">
            Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ â†’
          </button>
        </div>

        <!-- Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± -->
        <div class="flex gap-4 overflow-x-auto snap-x pb-2 scrollbar-thin scrollbar-thumb-blue-300">
          ${items.map(p => `
            <div class="min-w-[150px] bg-white rounded-xl border border-gray-200 p-2 shadow-sm hover:shadow-md transition cursor-pointer snap-center"
                 onclick="location.href='product.html?id=${p.id}'">

              <img src="${p.mainImg}" class="w-full h-32 object-cover rounded-lg mb-1">

              <p class="text-sm font-semibold text-gray-800 truncate">${p.name}</p>

              <p class="text-xs text-blue-600 font-bold mt-1">
                ${p.discount_price && p.discount_price < p.price ? p.discount_price : p.price} Ø¬.Ù…
              </p>

            </div>
          `).join("")}
        </div>

      </section>
    `;
  }).join("");
}

document.addEventListener("DOMContentLoaded", () => {
  fetchProducts();
});
async function fetchProducts() {
  try {
    const { data, error } = await supabase
      .from("products")
      .select(`
        id, name, price, discount_price, category,
        product_images(image_url, is_primary)
      `);

    if (error) {
      console.error("âŒ Supabase Error:", error);
      return;
    }

    if (!data || !data.length) {
      console.log("ğŸ“¦ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
      return;
    }

    const products = data.map(p => {
      let mainImg =
        p.product_images?.find(im => im.is_primary)?.image_url ||
        p.product_images?.[0]?.image_url ||
        "/assets/no-image.png";

      return {
        ...p,
        mainImg
      };
    });

    console.log("ğŸ“¦ Products Loaded:", products);  
    renderCategorySections(products);  
  } catch (err) {
    console.error("âŒ Fetch Error:", err);
  }
}
function renderCategorySections(products) {
  const bar = document.getElementById("categoriesBar");
  const container = document.getElementById("categorySections");

  if (!bar || !container) {
    console.error("âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ù„Ø¹Ù†ØµØ± bar Ø£Ùˆ container ÙÙŠ HTML");
    return;
  }

  const groups = {};

  products.forEach(p => {
    const cat = p.category?.trim() || "ØºÙŠØ± Ù…ØµÙ†Ù";
    if (!groups[cat]) groups[cat] = [];
    groups[cat].push(p);
  });

  const categories = Object.keys(groups);

  if (!categories.length) {
    console.error("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¦Ø§Øª Ù…Ù…ÙŠØ²Ø© ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª");
  }

  bar.innerHTML = categories.map(cat => `
    <div class="category-item cursor-pointer"
         onclick="goToCategory('${encodeURIComponent(cat)}')">
      ${cat}
    </div>
  `).join("");

  container.innerHTML = categories.map(cat => {
    const id = "cat_" + cat.replace(/\s+/g, "_");
    const items = groups[cat].slice(0, 10);

    return `
      <section id="${id}" class="bg-white p-4 rounded-3xl shadow-md border border-blue-100 mb-8">

        <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† + Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ -->
        <div class="flex justify-between items-center mb-3">
          <h2 class="font-bold text-xl text-blue-900">${cat}</h2>

          <button class="text-blue-600 text-sm font-semibold hover:underline"
                  onclick="goToCategory('${encodeURIComponent(cat)}')">
            Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ â†’
          </button>
        </div>

        <!-- Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± -->
        <div class="flex gap-4 overflow-x-auto snap-x pb-2 scrollbar-thin scrollbar-thumb-blue-300">
          ${items.map(p => `
            <div class="min-w-[150px] bg-white rounded-xl border border-gray-200 p-2 shadow-sm hover:shadow-md transition cursor-pointer snap-center"
                 onclick="location.href='product.html?id=${p.id}'">

              <img src="${p.mainImg}" class="w-full h-32 object-cover rounded-lg mb-1">

              <p class="text-sm font-semibold text-gray-800 truncate">${p.name}</p>

              <p class="text-xs text-blue-600 font-bold mt-1">
                ${p.discount_price && p.discount_price < p.price ? p.discount_price : p.price} Ø¬.Ù…
              </p>

            </div>
          `).join("")}
        </div>

      </section>
    `;
  }).join("");
}
async function loadCategories() {
  const bar = document.getElementById("categoriesBar");
  const container = document.getElementById("categorySections");

  if (!bar || !container) return;

  try {
    const { data, error } = await supabase
      .from("products")
      .select("id, name, category, price, discount_price, product_images(image_url, is_primary)");

    if (error) {
      console.error("âŒ Error loading products:", error);
      return;
    }
    if (!data || !data.length) {
      bar.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¦Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</p>";
      return;
    }

    const categories = Array.from(new Set(data.map(p => p.category))).filter(Boolean);

    if (!categories.length) {
      bar.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¦Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</p>";
      return;
    }

    bar.innerHTML = categories.map(cat => `
      <div class="category-item cursor-pointer" onclick="scrollToCategory('${cat}')">
        ${cat}
      </div>
    `).join("");

    container.innerHTML = categories.map(cat => {
      const items = data.filter(p => p.category === cat).slice(0, 10); 
      return `
        <section id="cat_${cat.replace(/\s+/g, '_')}" class="category-section">
          <h2>${cat}</h2>
          <div class="flex gap-4 overflow-x-auto snap-x pb-2 scrollbar-thin scrollbar-thumb-blue-300">
            ${items.map(p => {
              const displayPrice = p.discount_price && p.discount_price < p.price
                ? p.discount_price
                : p.price;
              return `
                <div class="min-w-[150px] bg-white rounded-xl border border-gray-200 p-2 shadow-sm hover:shadow-md transition cursor-pointer snap-center"
                     onclick="location.href='product.html?id=${p.id}'">
                  <img src="${p.product_images?.find(im => im.is_primary)?.image_url || '/assets/no-image.png'}" class="w-full h-32 object-cover rounded-lg mb-1">
                  <p class="text-sm font-semibold text-gray-800 truncate">${p.name}</p>
                  <p class="text-xs text-blue-600 font-bold mt-1">
                    ${displayPrice} Ø¬.Ù…
                  </p>
                </div>
              `;
            }).join("")}
          </div>
        </section>
      `;
    }).join("");

  } catch (err) {
    console.error("âŒ Error:", err);
  }
}

document.addEventListener("DOMContentLoaded", loadCategories);

</script>




<script>
document.addEventListener("DOMContentLoaded", async () => {
  const featuredBox = document.getElementById("featuredProducts");
  if (!featuredBox) {
    console.warn("âš ï¸ Ø¹Ù†ØµØ± featuredProducts ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„ØµÙØ­Ø©.");
    return;
  }

  featuredBox.innerHTML = `
    <div class="text-center text-gray-400 py-6 animate-pulse">
      â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©...
    </div>
  `;

  try {
    const { data, error } = await supabase
      .from("products")
      .select(`
        id, name, price, discount_price, views, 
        product_images(image_url, is_primary, ordering)
      `)
      .order("views", { ascending: false })
      .limit(4);

    if (error) throw error;

    if (!data?.length) {
      featuredBox.innerHTML = `<p class="text-center text-gray-500 py-6">ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…ÙŠØ²Ø© Ø¨Ø¹Ø¯</p>`;
      return;
    }

    const processed = data.map(p => {
      const imgs = (p.product_images || []).sort((a,b)=>(a.ordering||0)-(b.ordering||0));
      const img = imgs.find(i => i.is_primary)?.image_url || imgs[0]?.image_url || "/lv12.png";
      return { ...p, img };
    });

    featuredBox.innerHTML = `
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 sm:gap-6">
        ${processed.map(p => `
          <div 
            onclick="location.href='product.html?id=${p.id}'"
            class="group relative overflow-hidden bg-gradient-to-br from-blue-800/60 to-blue-900/80 border border-blue-600/20 rounded-2xl shadow-md hover:shadow-xl hover:-translate-y-1 transition-all duration-500 cursor-pointer backdrop-blur-lg"
          >
            <img 
              src="${p.img}" 
              alt="${p.name}" 
              class="w-full h-44 object-cover rounded-t-2xl transition-transform duration-700 group-hover:scale-110"
            >
            
            <div class="p-3 text-white">
              <h3 class="font-semibold text-sm sm:text-base mb-1 truncate">${p.name}</h3>

              <div class="flex justify-between items-center">
                <p class="text-yellow-300 font-bold text-sm sm:text-base">
                  ${p.discount_price || p.price} Ø¬.Ù…
                </p>

                ${p.discount_price 
                  ? `<span class="bg-red-600/80 text-xs px-2 py-0.5 rounded-lg shadow-md animate-pulse">Ø®ØµÙ… ğŸ”¥</span>` 
                  : ""}
              </div>
            </div>

            <div class="absolute inset-0 bg-blue-600/0 group-hover:bg-blue-600/10 transition-all duration-500"></div>
          </div>
        `).join("")}
      </div>
    `;

  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:", err);
    featuredBox.innerHTML = `
      <p class="text-center text-red-500 py-6">âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ù‹Ø§.</p>
    `;
  }
});
</script>



<script>
document.addEventListener("DOMContentLoaded", async () => {
  const grid = document.getElementById("allProductsGrid");
  if (!grid) {
    console.warn("âš ï¸ Ø¹Ù†ØµØ± allProductsGrid ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„ØµÙØ­Ø©");
    return;
  }

  grid.innerHTML = `
    <div class="col-span-full text-center text-gray-400 py-6 animate-pulse">
      â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...
    </div>
  `;

  try {
    const { data, error } = await supabase
      .from("products")
      .select(`
        id, name, price, discount_price, category, 
        product_images(image_url, is_primary, ordering)
      `)
      .order("id", { ascending: false })
      .limit(100);

    if (error) throw error;

    if (!data?.length) {
      grid.innerHTML = `
        <p class="col-span-full text-center text-gray-500 py-8">
          ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§
        </p>`;
      return;
    }

    const products = data.map(p => {
      const imgs = (p.product_images || []).sort((a,b)=>(a.ordering||0)-(b.ordering||0));
      const img = imgs.find(i => i.is_primary)?.image_url || imgs[0]?.image_url || "/lv12.png";
      return { ...p, img };
    });

    grid.innerHTML = products.map(p => `
      <div class="bg-white rounded-2xl shadow hover:shadow-lg transition-all duration-300 overflow-hidden cursor-pointer group"
           onclick="location.href='product.html?id=${p.id}'">
        <div class="relative">
          <img src="${p.img}" alt="${p.name}" class="w-full h-44 object-cover group-hover:scale-105 transition-transform duration-500">
          ${p.discount_price ? `
            <div class="absolute top-2 right-2 bg-red-600 text-white text-xs font-semibold px-2 py-1 rounded-md shadow">
              Ø®ØµÙ… ${Math.round(((p.price - p.discount_price) / p.price) * 100)}%
            </div>
          ` : ""}
        </div>
        <div class="p-3">
          <h3 class="font-bold text-blue-900 text-sm mb-1 truncate">${p.name}</h3>
          <div class="flex items-center gap-2">
            <span class="text-blue-700 font-semibold text-sm">${p.discount_price || p.price} Ø¬.Ù…</span>
            ${p.discount_price ? `<span class="line-through text-gray-400 text-xs">${p.price}</span>` : ""}
          </div>
          <p class="text-gray-500 text-xs mt-1">${p.category || "Ù…Ù†ØªØ¬ Ø¹Ø§Ù…"}</p>
        </div>
      </div>
    `).join("");

  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:", err);
    grid.innerHTML = `
      <p class="col-span-full text-center text-red-500 py-8">
        âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ù‹Ø§.
      </p>`;
  }
});
</script>



<script>
let isLoading = false;

async function fetchProducts(page = 0, useCache = true) {
  const CACHE_KEY = "LV12_PRODUCTS_CACHE_V7";
  const CACHE_TTL = 10 * 60 * 1000;

  if (allLoaded || isLoading) return;

  isLoading = true;
  showLoadingSpinner(true);

  try {
    if (page === 0 && useCache) {
      const cached = JSON.parse(localStorage.getItem(CACHE_KEY) || "{}");
      if (cached.ts && Date.now() - cached.ts < CACHE_TTL && cached.data?.length) {
        console.log("âš¡ ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„ÙŠ");
        window.allProducts = cached.data;
        renderCategorySections(cached.data);
        isLoading = false;
        showLoadingSpinner(false);
        return;
      }
    }

    const from = page * PAGE_SIZE;
    const to = from + PAGE_SIZE - 1;

    const { data, error } = await supabase
      .from("products")
      .select(`
        id, name, price, discount_price, discount_start, discount_end,
        category, stock, views,
        product_images(image_url, is_primary, ordering)
      `)
      .order("id", { ascending: false })
      .range(from, to);

    if (error) throw error;

    const now = new Date();
    const processed = (data || []).map(p => {
      const imgs = (p.product_images || []).sort((a,b)=>(a.ordering||0)-(b.ordering||0));
      const mainImg = imgs.find(i=>i.is_primary)?.image_url || imgs[0]?.image_url || "/lv12.png";
      const discountActive = p.discount_price && new Date(p.discount_start) <= now && new Date(p.discount_end) >= now;
      return { ...p, mainImg, discountActive, category: (p.category || "ØºÙŠØ± Ù…ØµÙ†Ù").trim() };
    });

    window.allProducts = (window.allProducts || []).concat(processed);
    renderCategorySections(window.allProducts);

    if (page === 0)
      localStorage.setItem(CACHE_KEY, JSON.stringify({ data: window.allProducts, ts: Date.now() }));

    if (!processed.length || processed.length < PAGE_SIZE) {
      allLoaded = true;
      console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª.");
    }

  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:", err);
  } finally {
    isLoading = false;
    showLoadingSpinner(false);
  }
}

window.addEventListener("scroll", () => {
  if (isLoading || allLoaded) return;
  const nearBottom = window.innerHeight + window.scrollY >= document.body.offsetHeight - 400;
  if (nearBottom) {
    currentPage++;
    fetchProducts(currentPage, false);
  }
});

function showLoadingSpinner(show) {
  let spinner = document.getElementById("scrollLoader");
  if (!spinner) {
    spinner = document.createElement("div");
    spinner.id = "scrollLoader";
    spinner.className = "text-center py-5 text-blue-600 font-semibold";
    spinner.textContent = "â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯...";
    document.body.appendChild(spinner);
  }
  spinner.style.display = show ? "block" : "none";
}
</script>









<script>
document.addEventListener("DOMContentLoaded", async () => {
  try {
    const { data, error } = await supabase
      .from("products")
      .select(`
        id, name, price, discount_price, discount_start, discount_end,
        product_images(image_url, is_primary, ordering)
      `);

    if (error) throw error;
    if (!data?.length) {
      console.warn("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø©");
      return;
    }

    const now = new Date();
    const products = data.map(p => {
      const imgs = (p.product_images || []).sort((a,b)=>(a.ordering||0)-(b.ordering||0));
      const img = imgs.find(i => i.is_primary)?.image_url || imgs[0]?.image_url || "/lv12.png";

      const discountActive =
        p.discount_price &&
        p.discount_start &&
        p.discount_end &&
        new Date(p.discount_start) <= now &&
        new Date(p.discount_end) >= now;

      return { ...p, img, discountActive };
    });

    const under100 = products.filter(p => (p.discount_price ?? p.price) <= 100);
    renderProductSection("under100", under100);

    const under200 = products.filter(p => {
      const price = p.discount_price ?? p.price;
      return price > 100 && price <= 200;
    });
    renderProductSection("under200", under200);

    const discountDays = groupByDiscountDay(products.filter(p => p.discountActive));
    renderDiscountDays(discountDays);

  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…:", err);
  }
});


function renderProductSection(id, list) {
  const container = document.getElementById(id);
  if (!container) return;

  if (!list.length) {
    container.innerHTML = `<p class="col-span-full text-center text-gray-400 py-6">ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø©</p>`;
    return;
  }

  container.innerHTML = list.map(p => `
    <div class="bg-white rounded-2xl shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 overflow-hidden cursor-pointer"
         onclick="location.href='product.html?id=${p.id}'">
      <div class="relative">
        <img src="${p.img}" alt="${p.name}" class="w-full h-40 object-cover">
        ${p.discount_price ? `
          <span class="absolute top-2 right-2 bg-red-600 text-white text-xs font-semibold px-2 py-1 rounded-md shadow">
            Ø®ØµÙ… ğŸ”¥
          </span>` : ""}
      </div>
      <div class="p-3">
        <h3 class="font-semibold text-gray-800 text-sm truncate">${p.name}</h3>
        <div class="flex items-center gap-2 mt-1">
          <span class="text-blue-700 font-bold text-sm">${p.discount_price ?? p.price} Ø¬.Ù…</span>
          ${p.discount_price ? `<span class="line-through text-gray-400 text-xs">${p.price}</span>` : ""}
        </div>
      </div>
    </div>
  `).join("");
}


function groupByDiscountDay(products) {
  const days = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];
  const groups = {};
  products.forEach(p => {
    if (!p.discount_start) return;
    const day = days[new Date(p.discount_start).getDay()];
    if (!groups[day]) groups[day] = [];
    groups[day].push(p);
  });
  return groups;
}


function renderDiscountDays(groups) {
  const bar = document.getElementById("discountDaysBar");
  const grid = document.getElementById("discountDayProducts");
  const wrap = document.getElementById("discountDaysWrapper");

  if (!wrap || !bar || !grid) return;
  if (!Object.keys(groups).length) {
    wrap.classList.add("hidden");
    return;
  }

  wrap.classList.remove("hidden");
  bar.innerHTML = "";
  grid.innerHTML = "";

  Object.keys(groups).forEach((day, i) => {
    const btn = document.createElement("button");
    btn.className = `px-3 py-1 rounded-full text-sm font-semibold transition ${
      i === 0 ? "bg-red-600 text-white" : "bg-white border border-red-300 text-red-600 hover:bg-red-50"
    }`;
    btn.textContent = `${day} (${groups[day].length})`;

    btn.addEventListener("click", () => {
      document.querySelectorAll("#discountDaysBar button").forEach(b => b.className = 
        "px-3 py-1 rounded-full text-sm font-semibold bg-white border border-red-300 text-red-600 hover:bg-red-50"
      );
      btn.className = "px-3 py-1 rounded-full text-sm font-semibold bg-red-600 text-white";
      grid.innerHTML = groups[day].map(p => `
        <div class="bg-white rounded-xl shadow hover:shadow-lg p-2 cursor-pointer transition hover:-translate-y-1"
             onclick="location.href='product.html?id=${p.id}'">
          <img src="${p.img}" class="w-full h-36 object-cover rounded-lg mb-2">
          <h3 class="text-sm font-semibold text-gray-800 truncate">${p.name}</h3>
          <p class="text-red-600 font-bold text-sm">${p.discount_price ?? p.price} Ø¬.Ù…</p>
        </div>
      `).join("");
    });

    bar.appendChild(btn);
  });

  const firstDay = Object.keys(groups)[0];
  grid.innerHTML = groups[firstDay].map(p => `
    <div class="bg-white rounded-xl shadow hover:shadow-lg p-2 cursor-pointer transition hover:-translate-y-1"
         onclick="location.href='product.html?id=${p.id}'">
      <img src="${p.img}" class="w-full h-36 object-cover rounded-lg mb-2">
      <h3 class="text-sm font-semibold text-gray-800 truncate">${p.name}</h3>
      <p class="text-red-600 font-bold text-sm">${p.discount_price ?? p.price} Ø¬.Ù…</p>
    </div>
  `).join("");
}
</script>

<script>
(async () => {
  try {
    const res = await fetch("https://ipwho.is/");
    const data = await res.json();

    const sec = data.security || {};
    const net = data.connection || {};
    const isp = (data.isp || "").toLowerCase();
    const org = (net.org || "").toLowerCase();
    const country = data.country_code || "??";

    const safeCountries = ["EG", "SA", "AE", "KW", "JO", "QA", "OM", "DZ", "MA", "TN", "LY", "BH", "IQ", "SD", "YE", "SY", "PS"];

    const suspicious =
      sec.vpn ||
      sec.proxy ||
      sec.tor ||
      sec.relay ||
      (!isp && !safeCountries.includes(country)) || 
      /vpn|proxy|tor|hosting|cloudflare|aws|azure|google|digitalocean|ovh|linode|hetzner|server/i.test(
        isp + org
      );

    if (suspicious && !safeCountries.includes(country)) {
      document.documentElement.innerHTML = `
        <div style="
          position:fixed;inset:0;background:#0b0f19;
          color:#fff;display:flex;flex-direction:column;
          align-items:center;justify-content:center;
          font-family:'Cairo',sans-serif;text-align:center;
          padding:20px;z-index:999999;
        ">
          <div style="max-width:500px;">
            <h2 style="font-size:26px;margin-bottom:12px;">ğŸš« ØªÙ… Ø­Ø¸Ø± Ø§Ù„ÙˆØµÙˆÙ„</h2>
            <p style="font-size:16px;line-height:1.8;">
              ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø§ØªØµØ§Ù„ ØºÙŠØ± Ù…ÙˆØ«ÙˆÙ‚ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… VPN / Proxy.<br>
              ÙŠØ±Ø¬Ù‰ Ø¥ÙŠÙ‚Ø§ÙÙ‡ Ø«Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.<br><br>
              <b>Ø¹Ù†ÙˆØ§Ù†Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ:</b> ${data.ip || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}<br>
              <b>Ø§Ù„Ø¨Ù„Ø¯:</b> ${data.country || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}
            </p>
            <button onclick="location.reload()" style="
              margin-top:25px;background:#2563eb;color:white;
              border:none;padding:10px 20px;border-radius:8px;
              cursor:pointer;font-size:15px;">
              ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
            </button>
          </div>
        </div>
      `;
      throw new Error("Blocked: Suspicious VPN/Proxy connection");
    }

    console.log(
      `âœ… VPN check passed | IP: ${data.ip} | Country: ${country} | ISP: ${isp || "unknown"}`
    );
  } catch (err) {
    console.warn("âš ï¸ VPN check failed:", err);
  }
})();
</script>


<script>
const _timers = {};

function formatLocalTime(dateMs) {
  return new Date(dateMs).toLocaleString("ar-EG", {
    timeZone: userTimeZone,
    hour12: true
  });
}
let serverOffset = 0; 
let userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;

function getNow() {
  try {
    return Date.now() + (serverOffset || 0);
  } catch {
    return Date.now();
  }
}
async function syncServerTime() {
  try {
    const { data, error } = await supabase.rpc("server_now");
    if (error || !data) throw error;

    const serverUtc = new Date(data);
    const deviceNow = new Date();

    serverOffset = serverUtc.getTime() - deviceNow.getTime();

    userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;

    const localTimeStr = serverUtc.toLocaleString("ar-EG", {
      timeZone: userTimeZone,
      hour12: true,
    });

    console.log(`ğŸ•“ ØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© ÙˆÙ‚Øª Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¨Ø¯Ù‚Ø©: ${localTimeStr}`);
    console.log("ğŸŒ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…:", userTimeZone);
    console.log(
      `ğŸ“ ÙØ±Ù‚ Ø§Ù„ÙˆÙ‚Øª Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ§Ù„Ø³ÙŠØ±ÙØ±: ${(serverOffset / 1000).toFixed(1)} Ø«Ø§Ù†ÙŠØ©`
    );

    const offsetDiff = Math.abs(serverOffset);
    if (offsetDiff > 2 * 60 * 1000) {
      toast("âš ï¸ ÙŠØ¨Ø¯Ùˆ Ø£Ù† ÙˆÙ‚Øª Ø¬Ù‡Ø§Ø²Ùƒ Ù…Ø®ØªÙ„Ù Ø¹Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±ØŒ ÙŠØ±Ø¬Ù‰ Ø¶Ø¨Ø· Ø§Ù„Ø³Ø§Ø¹Ø©.", false);
    }
  } catch (err) {
    console.warn("âš ï¸ ÙØ´Ù„ Ù…Ø²Ø§Ù…Ù†Ø© ÙˆÙ‚Øª Ø§Ù„Ø³ÙŠØ±ÙØ±ØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆÙ‚Øª Ø§Ù„Ø¬Ù‡Ø§Ø².", err);
    serverOffset = 0;
  }
}

async function loadDailyTasks() {
  try {
    const container = document.getElementById("tasksList");
    container.innerHTML = `<div class="loader"></div>`;

    const { data: tasks, error: tErr } = await supabase
      .from("daily_tasks")
      .select("*")
      .eq("active", true)
      .order("id");
    if (tErr) throw tErr;

    const { data: userTasks } = await supabase
      .from("user_daily_tasks")
      .select("*")
      .eq("user_id", currentUser.id)
      .order("started_at", { ascending: false });

    const map = {};
    (userTasks || []).forEach(t => {
      map[t.task_id] = map[t.task_id] || [];
      map[t.task_id].push(t);
    });

    const now = getNow();

    container.innerHTML = tasks.map(task => {
      const attempts = map[task.id] || [];
      const maxRepeat = task.repeat_per_day || 1;
      const used = attempts.filter(a => ["running", "pending"].includes(a.status)).length;
      const remaining = Math.max(0, maxRepeat - used);
      const disabled = remaining <= 0 ? "disabled" : "";

      return `
        <div class="task-card ${disabled ? "opacity-50" : ""}">
          <div class="task-info">
            <div class="task-title">${escapeHtml(task.title)}</div>
            <div class="task-desc">${escapeHtml(task.description || "")}</div>
            <div class="task-reward">ğŸ’° Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©: ${task.reward} Ø¬.Ù…</div>
            <div class="text-xs text-gray-400">â±ï¸ Ø§Ù„Ù…Ø¯Ø©: ${task.duration_minutes} Ø¯Ù‚ÙŠÙ‚Ø©</div>
            <div class="text-xs text-gray-300">â™»ï¸ Ø§Ù„Ø¨Ø§Ù‚ÙŠ: ${remaining}</div>
          </div>
          <div class="flex flex-col items-center gap-2">
            <button id="taskBtn-${task.id}" class="task-btn" ${disabled}>â–¶ï¸ Ø§Ø¨Ø¯Ø£</button>
            <div id="taskCountdown-${task.id}" class="text-xs text-yellow-400 mt-1"></div>
          </div>
        </div>`;
    }).join("");

    bindTasksUI(tasks);
  } catch (err) {
    toast("âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…", false);
  }
}


async function handleTaskStart(task) {
  try {
    if (!currentUser?.id) 
      return toast("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ù‹Ø§", false);

    const ipRes = await fetch("https://api.ipify.org?format=json");
    const ipData = await ipRes.json();
    const userIP = ipData?.ip || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";

    const todayStart = new Date();
    todayStart.setHours(0, 0, 0, 0);
    const todayIso = todayStart.toISOString();

    const { data: attempts, error: attemptsErr } = await supabase
      .from("user_daily_tasks")
      .select("id, started_at, status")
      .eq("user_id", currentUser.id)
      .eq("task_id", task.id)
      .gte("started_at", todayIso);

    if (attemptsErr) throw attemptsErr;

    const maxRepeat = task.repeat_per_day || 1;
    const activeAttempts = attempts?.filter(a => ["running", "pending"].includes(a.status)) || [];

    if (activeAttempts.length >= maxRepeat) {
      return toast("ğŸš« ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„ØªÙƒØ±Ø§Ø± Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„ÙŠÙˆÙ…", false);
    }

    const { data: running } = await supabase
      .from("user_daily_tasks")
      .select("id")
      .eq("user_id", currentUser.id)
      .eq("status", "running");

    if (running?.length)
      return toast("ğŸš« Ù„Ø¯ÙŠÙƒ Ù…Ù‡Ù…Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° Ø­Ø§Ù„ÙŠÙ‹Ø§", false);

    const startUtcMs = getNow();
    const startIso = new Date(startUtcMs).toISOString();
    const durationMs = (task.duration_minutes || 1) * 60 * 1000;
    const endUtcMs = startUtcMs + durationMs;
    const endIso = new Date(endUtcMs).toISOString();

    const { data, error } = await supabase
      .from("user_daily_tasks")
      .insert([{
        user_id: currentUser.id,
        task_id: task.id,
        status: "running",
        started_at: startIso,
        expected_end_at: endIso,
        ip_address: userIP
      }])
      .select()
      .single();

    if (error) throw error;

    const startLocal = new Date(startUtcMs).toLocaleString("ar-EG", {
      timeZone: userTimeZone,
      hour12: true
    });
    const endLocal = new Date(endUtcMs).toLocaleString("ar-EG", {
      timeZone: userTimeZone,
      hour12: true
    });

    console.log(`â±ï¸ Ù…Ù‡Ù…Ø© "${task.title}" Ø¨Ø¯Ø£Øª: ${startLocal} â€” ØªÙ†ØªÙ‡ÙŠ: ${endLocal}`);
    console.log("ğŸŒ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…:", userTimeZone);
    console.log("ğŸŒ Ø¹Ù†ÙˆØ§Ù† IP:", userIP);

    localStorage.setItem("activeAttempt", JSON.stringify({
      attemptId: data.id,
      taskId: task.id,
      startUtc: startUtcMs,
      endUtc: endUtcMs
    }));

    if (task.link && task.link.trim()) window.open(task.link, "_blank");

    disableTaskButton(task.id, true);
    startCountdown(task.id, data.id, startUtcMs, endUtcMs);

    toast(`ğŸš€ Ø¨Ø¯Ø£Øª Ø§Ù„Ù…Ù‡Ù…Ø© "${task.title}" â€” Ø§Ù„Ù…Ø¯Ø© ${task.duration_minutes} Ø¯Ù‚ÙŠÙ‚Ø©`, true);

  } catch (err) {
    console.error("âŒ handleTaskStart error:", err);
    toast("âš ï¸ ÙØ´Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©", false);
  }
}



function startCountdown(taskId, attemptId, startUtc, endUtc) {
  if (_timers[attemptId]) clearInterval(_timers[attemptId]);

  const tick = async () => {
    const now = getNow();
    const secLeft = Math.ceil((endUtc - now) / 1000);

    if (secLeft > 0) {
      renderCountdownForTask(taskId, secLeft);
      return;
    }

    clearInterval(_timers[attemptId]);
    localStorage.removeItem("activeAttempt");
    renderCountdownForTask(taskId, 0);

    try {
      await supabase
        .from("user_daily_tasks")
        .update({ 
          status: "pending",
          completed_at: new Date().toISOString()
        })
        .eq("id", attemptId);
      toast("âœ… Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ù‡Ù…Ø© â€” Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø¯Ø§Ø±Ø©", true);
      loadDailyTasks();
    } catch (e) {
      console.error("âŒ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø© ÙØ´Ù„:", e);
    }
  };

  tick();
  _timers[attemptId] = setInterval(tick, 1000);
}

function disableTaskButton(id, disabled = true) {
  const btn = document.getElementById(`taskBtn-${id}`);
  if (!btn) return;
  btn.disabled = disabled;
  btn.classList.toggle("opacity-50", disabled);
}

function renderCountdownForTask(id, sec) {
  const el = document.getElementById(`taskCountdown-${id}`);
  if (!el) return;
  el.textContent = sec <= 0
    ? "â³ Ø§Ù†ØªÙ‡Øª â€” Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø¯Ø§Ø±Ø©"
    : `â³ Ù…ØªØ¨Ù‚ÙŠ: ${fmtTimeLeft(sec)}`;
}

async function bindTasksUI(tasks) {
  for (const task of tasks) {
    const btn = document.getElementById(`taskBtn-${task.id}`);
    if (btn) btn.onclick = () => handleTaskStart(task);
  }

  const saved = localStorage.getItem("activeAttempt");
  if (saved) {
    const { taskId, attemptId, startUtc, endUtc } = JSON.parse(saved);
    const now = getNow();
    if (now < endUtc) {
      disableTaskButton(taskId, true);
      startCountdown(taskId, attemptId, startUtc, endUtc);
    } else {
      localStorage.removeItem("activeAttempt");
    }
  }
}
window.addEventListener("DOMContentLoaded", async () => {
  await syncServerTime();
  await loadDailyTasks();

  const saved = localStorage.getItem("activeAttempt");
  if (saved) {
    const { taskId, attemptId, startUtc, endUtc } = JSON.parse(saved);
    const now = getNow();
    if (now < endUtc) {
      disableTaskButton(taskId, true);
      startCountdown(taskId, attemptId, startUtc, endUtc);
    } else {
      localStorage.removeItem("activeAttempt");
    }
  }

  const diff = Math.abs(serverOffset);
  if (diff > 60_000) {
    toast("âš ï¸ ÙŠØ¨Ø¯Ùˆ Ø£Ù† ÙˆÙ‚Øª Ø¬Ù‡Ø§Ø²Ùƒ ØºÙŠØ± Ø¯Ù‚ÙŠÙ‚ØŒ ÙŠØ±Ø¬Ù‰ Ø¶Ø¨Ø· Ø§Ù„Ø³Ø§Ø¹Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ø§Ù„ØµØ­ÙŠØ­.", false);
  }
});

</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const searchInput = document.getElementById("searchInput");
  const productsGrid = document.getElementById("productsGrid");

  const suggestionsBox = document.createElement("div");
  suggestionsBox.id = "suggestionsBox";
  suggestionsBox.className = `
    absolute bg-white border border-gray-200 rounded-xl shadow-lg 
    mt-1 max-h-72 overflow-auto w-full z-50 hidden
  `;
  searchInput.parentElement.appendChild(suggestionsBox);

  function filterProducts(query) {
    const all = window.allProducts || [];
    if (!query) return [];
    query = query.trim().toLowerCase();
    return all
      .filter(p => p.name && p.name.toLowerCase().includes(query))
      .slice(0, 8); 
  }

  function showSuggestions(list) {
    if (!list.length) {
      suggestionsBox.innerHTML = `<p class="text-gray-400 text-sm px-4 py-2">ğŸ˜• Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>`;
      suggestionsBox.classList.remove("hidden");
      return;
    }

    suggestionsBox.innerHTML = list
      .map(
        p => `
        <div class="flex items-center gap-3 p-2 hover:bg-blue-50 cursor-pointer rounded-lg transition"
             data-id="${p.id}">
          <img src="${p.images?.[0] || '/lv12.jpg'}" class="w-10 h-10 rounded-md object-cover" />
          <div>
            <p class="text-sm font-semibold text-gray-800">${p.name}</p>
            <p class="text-xs text-blue-600 font-medium">${p.price} Ø¬.Ù…</p>
          </div>
        </div>
      `
      )
      .join("");
    suggestionsBox.classList.remove("hidden");
  }

  searchInput.addEventListener("blur", () => {
    setTimeout(() => suggestionsBox.classList.add("hidden"), 200);
  });

  suggestionsBox.addEventListener("click", (e) => {
    const item = e.target.closest("[data-id]");
    if (!item) return;
    const id = item.getAttribute("data-id");
    window.location.href = `product.html?id=${id}`;
  });

  searchInput.addEventListener("input", (e) => {
    const query = e.target.value.trim();
    if (!query) {
      suggestionsBox.classList.add("hidden");
      renderAllSections(window.allProducts || []);
      return;
    }
    const filtered = filterProducts(query);
    showSuggestions(filtered);

    const gridFiltered = (window.allProducts || []).filter(p =>
      p.name?.toLowerCase().includes(query)
    );
    renderAllSections(gridFiltered);
  });
});
</script>
<script>


async function loadUserProfile() {
  try {
    const { data: session } = await supabase.auth.getSession();
    const user = session?.session?.user;
    if (!user) return;

    const { data: profile, error } = await supabase
      .from('profiles')
      .select('full_name, avatar_url')
      .eq('id', user.id)
      .maybeSingle();

    if (error) throw error;

    const avatar = document.getElementById("userAvatar");
    const nameEl = document.getElementById("userName");

    if (profile) {
      nameEl.textContent = profile.full_name || "Ù…Ø³ØªØ®Ø¯Ù…";
      if (profile.avatar_url) {
        avatar.src = profile.avatar_url.startsWith("http")
          ? profile.avatar_url
          : `${supabaseUrl}/storage/v1/object/public/avatars/${profile.avatar_url}`;
      }
    }
  } catch (err) {
    console.error("âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:", err.message);
  }
}

document.addEventListener("DOMContentLoaded", loadUserProfile);
</script>

</body>
</html>


<script src="shop-products.js"></script>
