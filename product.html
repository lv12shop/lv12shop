<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ | Ù…ØªØ¬Ø± LV12</title>
  <meta name="description" content="ğŸ“¦ ØªØµÙØ­ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ù…ØªØ¬Ø± LV12 â€” ØµÙˆØ± Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø©ØŒ Ø§Ù„Ø³Ø¹Ø±ØŒ Ø§Ù„Ù…ÙˆØ§ØµÙØ§ØªØŒ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ù…Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡. ØªØ³ÙˆÙ‚ Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù…Ø§Ù†.">
<link rel="icon" href="/lv12.png" />
<link rel="image_src" href="https://www.lv12shop.shop/lv12.png" />

<meta property="og:title" content="Ù…ØªØ¬Ø± LV12 - ØªØ³ÙˆÙ‚ Ø°ÙƒÙŠ ÙˆØ³Ø±ÙŠØ¹" />
<meta property="og:description" content="Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø© ØªØ³ÙˆÙ‚ Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª - Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…ÙŠØ²Ø© ÙˆØ´Ø­Ù† Ø³Ø±ÙŠØ¹ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª." />
<meta property="og:image" content="https://www.lv12shop.shop/lv12.png" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://www.lv12shop.shop" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Ù…ØªØ¬Ø± LV12 - ØªØ³ÙˆÙ‚ Ø°ÙƒÙŠ ÙˆØ³Ø±ÙŠØ¹" />
<meta name="twitter:description" content="Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø© ØªØ³ÙˆÙ‚ Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª - Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…ÙŠØ²Ø© ÙˆØ´Ø­Ù† Ø³Ø±ÙŠØ¹ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª." />
<meta name="twitter:image" content="https://www.lv12shop.shop/lv12.png" />

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "LV12 Shop",
  "url": "https://www.lv12shop.shop",
  "logo": "https://www.lv12shop.shop/lv12.png"
}
</script>

  <meta property="og:title" content="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ | Ù…ØªØ¬Ø± LV12" />
  <meta property="og:description" content="ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù…Ù…ÙŠØ²Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø±Ø§Ø¦Ø¹ Ù…Ù† Ù…ØªØ¬Ø± LV12 â€” Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© ÙˆØ³Ø¹Ø± Ù…Ù†Ø§Ø³Ø¨!" />
  <meta property="og:image" content="https://www.lv12shop.shop/lv12.jpg" />
  <meta property="og:type" content="product" />
  <meta property="og:site_name" content="Ù…ØªØ¬Ø± LV12" />
  <meta property="og:locale" content="ar_AR" />
  
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ | Ù…ØªØ¬Ø± LV12" />
  <meta name="twitter:description" content="Ø§ÙƒØªØ´Ù ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ù…ØªØ¬Ø± LV12 â€” Ø¬ÙˆØ¯Ø© ÙˆØ£Ù…Ø§Ù† ÙˆØ³Ø±Ø¹Ø© ÙÙŠ Ø§Ù„ØªÙˆØµÙŠÙ„." />
  <meta name="twitter:image" content="https://www.lv12shop.shop/lv12.jpg" />

  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" href="/lv12.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/lv12-192.png" />
  <meta name="theme-color" content="#0ea5a4" />

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <meta name="robots" content="index, follow" />
  <meta name="author" content="LV12 Shop" />
  <meta name="keywords" content="Ù…ØªØ¬Ø±, LV12, Ù…Ù†ØªØ¬Ø§Øª, ØªØ³ÙˆÙ‚, Ø´Ø±Ø§Ø¡, Ø¹Ø±ÙˆØ¶, Ù…ØµØ±, Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª, Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª, Ø§Ø²ÙŠØ§Ø¡, ØªØ³ÙˆÙ‚ Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†" />

  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/sw.js")
          .then(() => console.log("âœ… Service Worker Ù…Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­"))
          .catch(err => console.warn("âš ï¸ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Service Worker:", err));
      });
    }
  </script>
</head>
<style>
:root {
  --primary: #0ea5a4; /* teal */
  --primary-dark: #087f7c;
  --primary-soft: #99f6e4;
  --secondary: #f97316; /* orange */
  --accent: #06b6d4;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  
  --dark: #000000;      
  --light: #ffffff;    
  --glass: rgba(0, 0, 0, 0.05);

  --shadow-soft: 0 10px 25px -5px rgba(0, 0, 0, 0.1),
                 0 10px 10px -5px rgba(0, 0, 0, 0.04);

  --shadow-glow: 0 0 18px rgba(14,165,164,0.14);

  --bg-light: #f8fafc;        
  --bg-box: #ffffff; 
  --bg-muted: #eef2f6;
  --text-dark: #0f172a;        
  --text-gray: #475569;
  --muted: #9aa4b2;
  --success-dark: #059669;

  --radius: 14px;
  --transition: .22s ease;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'IBM Plex Sans Arabic', sans-serif;
  background-color: var(--bg-light);
  color: var(--text-dark);
  line-height: 1.6;
}

a { text-decoration: none; color: inherit; }
ul { list-style: none; }

.welcome-container {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  text-align: center;
}

.welcome-title {
  font-size: 2.5rem;
  margin-bottom: 20px;
  color: var(--text-dark);
  font-weight: bold;
}

.welcome-buttons .btn-login,
.welcome-buttons .btn-register {
  width: 260px;
  padding: 14px;
  font-size: 1.2rem;
  border-radius: 35px;
  border: none;
  cursor: pointer;
  margin: 10px 0;
  transition: var(--transition);
}

.btn-login {
  background: linear-gradient(90deg, var(--primary), var(--primary-dark));
  color: var(--light);
}

.btn-register {
  background: transparent;
  border: 2px solid var(--primary-dark);
  color: var(--primary-dark);
}

.navbar {
  width: 100%;
  padding: 15px 30px;
  background-color: var(--bg-box);
  box-shadow: var(--shadow-soft);
  display: flex;
  justify-content: space-between;
  position: fixed;
  top: 0; left: 0;
  z-index: 1000;
}

.logo {
  font-size: 1.8rem;
  font-weight: bold;
  color: var(--primary-dark);
}

.search-box {
  display: flex;
  justify-content: center;
  margin-top: 90px;
}

.search-input {
  width: 90%;
  max-width: 600px;
  padding: 15px 20px;
  border-radius: 30px;
  border: 2px solid var(--border);
  background: var(--bg-box);
  color: var(--text-dark);
  font-size: 1.2rem;
}

.suggestions-container {
  width: 100%;
  display: flex;
  justify-content: center;
  margin-top: 15px;
}

.suggestions {
  width: 90%;
  max-width: 600px;
  background: var(--bg-muted);
  padding: 10px 0;
  border-radius: 15px;
}

.suggest-item {
  padding: 12px 20px;
  cursor: pointer;
  transition: var(--transition);
  color: var(--text-dark);
}

.suggest-item:hover {
  background: var(--primary-dark);
  color: var(--light);
}

@media (max-width: 768px) {
  .welcome-title { font-size: 2rem; }
  .btn-login, .btn-register { width: 220px; font-size: 1rem; }
  .search-input { font-size: 1rem; padding: 12px 18px; }
  .navbar { padding: 10px 20px; }
  .logo { font-size: 1.4rem; }
}

@media (max-width: 480px) {
  .welcome-title { font-size: 1.8rem; }
  .btn-login, .btn-register { width: 200px; padding: 12px; }
  .search-input { width: 92%; font-size: 0.95rem; }
  .suggest-item { padding: 10px 15px; font-size: 0.9rem; }
}
footer {
  background-color: var(--dark); 
  color: var(--light); 
  margin-top: 4rem;
  padding: 3rem 1rem;
  font-family: 'IBM Plex Sans Arabic', sans-serif;
}

footer h4 {
  color: var(--light);
  font-weight: 600;
  margin-bottom: 1rem;
}

footer p, 
footer a, 
footer li {
  color: var(--muted);
  font-size: 0.9rem;
  transition: color 0.3s ease;
}

footer a:hover, 
footer li:hover {
  color: var(--light);
}

footer .border-t {
  border-color: var(--border);
}

footer .social-icons a {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--muted);
  transition: color 0.3s ease;
}

footer .social-icons a:hover {
  color: var(--primary);
}

footer img {
  border-radius: 0.25rem;
  margin-bottom: 0.5rem;
}

/* Ù…Ø­Ø³Ù‘Ù†Ø§Øª Ø¯ÙŠØ²Ø§ÙŠÙ† Ø§Ø­ØªØ±Ø§ÙÙŠ */
.product-card {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  border-radius: var(--radius);
  overflow: hidden;
  background: var(--bg-box);
  position: relative;
}

.product-card:hover {
  transform: translateY(-12px) scale(1.02);
  box-shadow: 0 20px 40px rgba(14, 165, 164, 0.15);
}

.product-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(14, 165, 164, 0.1), rgba(249, 115, 22, 0.1));
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 1;
}

.product-card:hover::before {
  opacity: 1;
}

.btn-modern {
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  border: none;
  cursor: pointer;
  font-weight: 600;
  letter-spacing: 0.5px;
  position: relative;
  overflow: hidden;
  text-transform: none;
}

.btn-modern::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
  z-index: 0;
}

.btn-modern:hover::before {
  width: 300px;
  height: 300px;
}

.btn-modern:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.25) !important;
  letter-spacing: 1px;
}

.btn-modern:active {
  transform: translateY(-1px);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2) !important;
}

.size-btn, .shoe-size-btn {
  transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
  cursor: pointer;
  position: relative;
  overflow: hidden;
  font-weight: 600;
}

.size-btn::after, .shoe-size-btn::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.3);
  transition: left 0.3s ease;
  z-index: -1;
}

.size-btn:hover, .shoe-size-btn:hover {
  transform: scale(1.08) translateY(-2px);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
}

.size-btn:hover::after, .shoe-size-btn:hover::after {
  left: 100%;
}

.size-btn:active, .shoe-size-btn:active {
  transform: scale(0.95);
}

.glass-card {
  backdrop-filter: blur(10px);
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.7));
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: var(--radius);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ù…Ø¹Ø±Ø¶ */
.product-image-section {
  position: relative;
  border-radius: var(--radius);
  overflow: hidden;
  background: linear-gradient(135deg, var(--bg-muted), var(--bg-light));
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
}

.main-image {
  transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  object-fit: cover;
  width: 100%;
  display: block;
}

.product-image-section:hover .main-image {
  transform: scale(1.05);
}

.image-thumbnails {
  display: flex;
  gap: 12px;
  margin-top: 15px;
  overflow-x: auto;
  padding-bottom: 8px;
}

.thumbnail {
  width: 80px;
  height: 80px;
  border-radius: 10px;
  overflow: hidden;
  cursor: pointer;
  border: 2px solid transparent;
  transition: all 0.2s ease;
  opacity: 0.7;
}

.thumbnail:hover,
.thumbnail.active {
  border-color: var(--primary);
  opacity: 1;
  transform: scale(1.1);
  box-shadow: 0 4px 12px rgba(14, 165, 164, 0.3);
}

.thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
.product-info-card {
  padding: 20px;
  background: linear-gradient(to bottom, var(--bg-box), var(--bg-muted));
}

.product-info-box {
  background: linear-gradient(135deg, rgba(14, 165, 164, 0.05), rgba(249, 115, 22, 0.05));
  border-left: 4px solid var(--primary);
  padding: 16px;
  border-radius: 8px;
  margin: 12px 0;
  transition: all 0.3s ease;
}

.product-info-box:hover {
  background: linear-gradient(135deg, rgba(14, 165, 164, 0.1), rgba(249, 115, 22, 0.1));
  border-left-color: var(--secondary);
  transform: translateX(4px);
}

#addToCartBtn {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  position: relative;
}

#addToCartBtn:hover {
  background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
}

#buyNowBtn {
  background: linear-gradient(135deg, var(--secondary) 0%, #ea580c 100%);
  color: white;
  position: relative;
}

#buyNowBtn:hover {
  background: linear-gradient(135deg, #ea580c 0%, var(--secondary) 100%);
}

.product-title {
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--text-dark);
  line-height: 1.4;
  margin: 16px 0;
  letter-spacing: -0.5px;
}

.product-title::after {
  content: '';
  display: block;
  width: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  border-radius: 2px;
  margin-top: 8px;
  transition: width 0.4s ease;
}

.product-info-box:hover .product-title::after {
  width: 40px;
}

.price-section {
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 20px 0;
  padding: 16px;
  background: linear-gradient(135deg, rgba(14, 165, 164, 0.1), rgba(249, 115, 22, 0.1));
  border-radius: 12px;
  border: 1px solid rgba(14, 165, 164, 0.2);
}

.price-current {
  font-size: 2rem;
  font-weight: 700;
  color: var(--primary);
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.price-old {
  font-size: 1.2rem;
  color: var(--text-gray);
  text-decoration: line-through;
  opacity: 0.7;
}

.discount-badge {
  background: linear-gradient(135deg, var(--danger), #d32f2f);
  color: white;
  padding: 6px 12px;
  border-radius: 20px;
  font-weight: 700;
  font-size: 0.9rem;
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

#productOptions {
  background: linear-gradient(to bottom, var(--bg-light), var(--bg-box));
  padding: 24px;
  border-radius: var(--radius);
  border: 1px solid rgba(14, 165, 164, 0.1);
  margin: 20px 0;
}

#sizeOptions, #shoeSizeOptions {
  display: grid;
  gap: 12px;
  animation: slideUp 0.4s ease;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.size-btn, .shoe-size-btn {
  padding: 12px 16px;
  border: 2px solid var(--bg-muted);
  background: var(--bg-box);
  border-radius: 8px;
  color: var(--text-dark);
  font-weight: 600;
  letter-spacing: 0.5px;
}

.size-btn[style*="background-color: rgb(37, 99, 235)"],
.shoe-size-btn[style*="background-color: rgb(147, 51, 234)"] {
  box-shadow: 0 0 0 3px rgba(14, 165, 164, 0.2);
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù‚Ø³Ù… Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª */
.reviews-section {
  margin-top: 40px;
  padding: 24px;
  background: linear-gradient(135deg, var(--bg-light), var(--bg-muted));
  border-radius: var(--radius);
  border: 1px solid rgba(14, 165, 164, 0.1);
}

.review-item {
  background: var(--bg-box);
  padding: 16px;
  margin-bottom: 16px;
  border-radius: 12px;
  border-left: 4px solid var(--primary);
  transition: all 0.3s ease;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.review-item:hover {
  box-shadow: 0 8px 16px rgba(14, 165, 164, 0.1);
  transform: translateX(4px);
  border-left-color: var(--secondary);
}

.review-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.review-avatar {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 700;
  font-size: 1.2rem;
  object-fit: cover;
  box-shadow: 0 2px 8px rgba(14, 165, 164, 0.2);
}

.review-stars {
  margin-right: auto;
  color: var(--warning);
  font-size: 1.1rem;
  letter-spacing: 2px;
}

.review-content {
  color: var(--text-gray);
  line-height: 1.6;
  margin: 12px 0;
  padding: 12px;
  background: var(--bg-light);
  border-radius: 8px;
  border-right: 3px solid var(--primary-soft);
}

.reply-btn {
  background: linear-gradient(135deg, var(--primary-soft), var(--primary));
  color: var(--dark);
  padding: 8px 16px;
  border-radius: 20px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s ease;
  font-size: 0.9rem;
}

.reply-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(14, 165, 164, 0.3);
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù€ Toast */
#toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  padding: 16px 24px;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(14, 165, 164, 0.4);
  z-index: 9999;
  animation: slideInRight 0.3s ease;
  font-weight: 600;
  letter-spacing: 0.5px;
}

@keyframes slideInRight {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

#toast.hidden {
  animation: slideOutRight 0.3s ease forwards;
}

@keyframes slideOutRight {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(400px);
    opacity: 0;
  }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
.product-section {
  background: var(--bg-box);
  padding: 24px;
  border-radius: var(--radius);
  margin-bottom: 20px;
  border: 1px solid rgba(14, 165, 164, 0.1);
  transition: all 0.3s ease;
}

.product-section:hover {
  border-color: var(--primary);
  box-shadow: 0 8px 24px rgba(14, 165, 164, 0.12);
}

.section-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text-dark);
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
  letter-spacing: -0.5px;
}

.section-title::before {
  content: '';
  width: 4px;
  height: 28px;
  background: linear-gradient(180deg, var(--primary), var(--secondary));
  border-radius: 2px;
}

/* Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù€ Navigation */
.navbar {
  backdrop-filter: blur(10px);
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.95));
  border-bottom: 1px solid rgba(14, 165, 164, 0.1);
}

.navbar:hover {
  box-shadow: 0 10px 30px rgba(14, 165, 164, 0.1);
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ© Ø¹Ø§Ù…Ø© */
button {
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

input, textarea, select {
  transition: all 0.3s ease;
  border: 2px solid var(--bg-muted);
}

input:focus, textarea:focus, select:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(14, 165, 164, 0.1);
  outline: none;
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù€ Loading ÙˆØ§Ù„Ù€ Skeleton */
@keyframes shimmer {
  0% {
    background-position: -1000px 0;
  }
  100% {
    background-position: 1000px 0;
  }
}

.skeleton {
  background: linear-gradient(90deg, var(--bg-muted) 25%, var(--bg-light) 50%, var(--bg-muted) 75%);
  background-size: 1000px 100%;
  animation: shimmer 2s infinite;
  border-radius: 8px;
}

@media (max-width: 768px) {
    footer {
        padding: 2rem 1rem;
    }
    
    .product-title {
        font-size: 1.4rem;
    }
    
    .price-current {
        font-size: 1.6rem;
    }
    
    #productOptions {
        padding: 16px;
    }
}

@media (max-width: 480px) {
    footer p,
    footer a,
    footer li {
        font-size: 0.8rem;
    }
    
    .product-title {
        font-size: 1.2rem;
    }
    
    .price-current {
        font-size: 1.4rem;
    }
    
    .btn-modern {
        width: 100%;
        padding: 12px !important;
    }
}

</style>

  <script>
    function setupBuyNowButton() {
      const buyNowBtn = document.getElementById('buyNowBtn');
      const addToCartBtn = document.getElementById('addToCartBtn');
      
      if (buyNowBtn) {
        buyNowBtn.addEventListener('click', async function() {
          if (addToCartBtn) {
            addToCartBtn.click();
          }
          
          setTimeout(() => {
            window.location.href = 'cart.html';
          }, 500);
        });
      }
    }

    async function checkUserLoginForReviews() {
      try {
        const { data: { user } } = await supabase.auth.getUser();
        const reviewLoginNotice = document.getElementById('reviewLoginNotice');
        const reviewFormContainer = document.getElementById('reviewFormContainer');
        
        if (user) {
          reviewLoginNotice.classList.add('hidden');
          reviewFormContainer.classList.remove('hidden');
        } else {
          reviewLoginNotice.classList.remove('hidden');
          reviewFormContainer.classList.add('hidden');
        }
      } catch (error) {
        console.error('Error checking auth:', error);
        document.getElementById('reviewLoginNotice').classList.remove('hidden');
        document.getElementById('reviewFormContainer').classList.add('hidden');
      }
    }

    function displayReviews(reviews) {
      const reviewsList = document.getElementById('reviewsList');
      if (!reviews || reviews.length === 0) {
        reviewsList.innerHTML = '<p class="text-gray-500 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø¨Ø¹Ø¯</p>';
        return;
      }

      reviewsList.innerHTML = reviews.map(review => {
        const userInitial = review.user_name ? review.user_name.charAt(0).toUpperCase() : 'Ù…';
        const stars = 'â˜…'.repeat(review.rating) + 'â˜†'.repeat(5 - review.rating);
        const reviewDate = new Date(review.created_at).toLocaleDateString('ar-EG');
        
        return `
          <div class="review-item">
            <div class="review-header">
              ${review.user_avatar ? 
                `<img src="${review.user_avatar}" alt="${review.user_name}" class="review-avatar">` : 
                `<div class="review-avatar">${userInitial}</div>`
              }
              <div class="review-user-info">
                <div class="review-author">${review.user_name || 'Ù…Ø³ØªØ®Ø¯Ù…'}</div>
                <div class="review-date">${reviewDate}</div>
              </div>
              <div class="review-stars">${stars}</div>
            </div>
            <div class="review-content">${review.comment}</div>
            <div class="review-actions">
              <button class="reply-btn" onclick="addReplyToReview(${review.id})">
                ğŸ’¬ Ø±Ø¯
              </button>
            </div>
            <div class="reply-section" id="replies-${review.id}"></div>
          </div>
        `;
      }).join('');
    }

    async function addReplyToReview(reviewId) {
      try {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) {
          alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª');
          return;
        }

        const replyText = prompt('Ø§ÙƒØªØ¨ Ø±Ø¯Ùƒ:');
        if (!replyText || replyText.trim() === '') return;

        const { data: profile } = await supabase
          .from('profiles')
          .select('full_name, avatar_url')
          .eq('id', user.id)
          .single();

        const { error } = await supabase
          .from('review_replies')
          .insert({
            review_id: reviewId,
            user_id: user.id,
            user_name: profile?.full_name || user.email,
            reply_text: replyText.trim()
          });

        if (error) {
          console.error('Error adding reply:', error);
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø¯');
          return;
        }

        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø¯ Ø¨Ù†Ø¬Ø§Ø­!');
        
        loadProductReviews();
        
      } catch (error) {
        console.error('Error:', error);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹');
      }
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.remove('hidden');
      setTimeout(() => {
        toast.classList.add('hidden');
      }, 3000);
    }

    function createOptimizedProductCard(product) {
      const img = product.product_images?.find(i => i.is_primary)?.image_url || 
                  product.product_images?.[0]?.image_url || 
                  '/placeholder.png';
      
      const discount = product.old_price && product.old_price > product.price ? 
                      Math.round(((product.old_price - product.price) / product.old_price) * 100) : 0;
      
      const isNew = new Date(product.created_at).toDateString() === new Date().toDateString();
      
      return `
        <div class="product-card" onclick="window.location.href='product.html?id=${product.id}'">
          ${discount > 0 ? `<div class="product-badge-card">-${discount}%</div>` : ''}
          ${isNew ? `<div class="product-badge-card">Ø¬Ø¯ÙŠØ¯</div>` : ''}
          
          <div class="product-image-container-card">
            <img src="${img}" alt="${product.name}" class="product-image-card" loading="lazy">
          </div>
          
          <div class="product-info-card">
            <h4 class="product-title-card">${product.name}</h4>
            
            <div class="product-price-card">
              ${Number(product.price || 0).toFixed(0)} Ø¬.Ù…
              ${product.old_price && product.old_price > product.price ? 
                `<span class="old-price">${Number(product.old_price).toFixed(0)} Ø¬.Ù…</span>` : ''}
            </div>
            
            <div class="product-rating-card">
              <span class="stars">â˜…â˜…â˜…â˜…â˜†</span>
              <span>(${Math.floor(Math.random() * 50) + 10})</span>
            </div>
            
            <div class="product-actions-card">
              <button class="btn-add-cart-card" onclick="event.stopPropagation(); addToCartFromCard(${product.id})">
                ğŸ›’ Ø£Ø¶Ù
              </button>
              <button class="btn-quick-view-card" onclick="event.stopPropagation(); window.location.href='product.html?id=${product.id}'">
                ğŸ‘ï¸
              </button>
            </div>
          </div>
        </div>
      `;
    }

    async function addToCartFromCard(productId) {
      try {
        const { data: product, error } = await supabase
          .from('products')
          .select('*')
          .eq('id', productId)
          .single();

        if (error || !product) {
          showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø©');
          return;
        }

        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const existingItem = cart.find(item => item.id === productId);
        
        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          cart.push({
            id: product.id,
            name: product.name,
            price: product.price,
            image: product.product_images?.[0]?.image_url || '/placeholder.png',
            quantity: 1
          });
        }
        
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartBadge();
        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
      } catch (error) {
        console.error('Error adding to cart:', error);
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø©');
      }
    }

    function updateCartBadge() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      const badge = document.getElementById('cartBadge');
      
      if (badge) {
        if (totalItems > 0) {
          badge.textContent = totalItems;
          badge.classList.remove('hidden');
        } else {
          badge.classList.add('hidden');
        }
      }
    }

    async function loadRelatedProducts() {
      try {
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        
        if (!productId) return;

        const { data: currentProduct } = await supabase
          .from('products')
          .select('category_id')
          .eq('id', productId)
          .single();

        const { data: products, error } = await supabase
          .from('products')
          .select(`
            id,
            name,
            price,
            old_price,
            created_at,
            product_images(image_url, is_primary)
          `)
          .eq('category_id', currentProduct?.category_id)
          .neq('id', productId)
          .limit(10);

        if (error || !products || products.length === 0) {
          const { data: randomProducts } = await supabase
            .from('products')
            .select(`
              id,
              name,
              price,
              old_price,
              created_at,
              product_images(image_url, is_primary)
            `)
            .neq('id', productId)
            .limit(10);
          
          if (randomProducts && randomProducts.length > 0) {
            document.getElementById('relatedProducts').innerHTML = 
              randomProducts.map(createOptimizedProductCard).join('');
          }
          return;
        }

        document.getElementById('relatedProducts').innerHTML = 
          products.map(createOptimizedProductCard).join('');
      } catch (error) {
        console.error('Error loading related products:', error);
      }
    }

    async function loadInterestProducts() {
      try {
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        
        const { data: products, error } = await supabase
          .from('products')
          .select(`
            id,
            name,
            price,
            old_price,
            created_at,
            visits,
            product_images(image_url, is_primary)
          `)
          .neq('id', productId || 0)
          .order('visits', { ascending: false })
          .limit(10);

        if (error || !products || products.length === 0) {
          const { data: recentProducts } = await supabase
            .from('products')
            .select(`
              id,
              name,
              price,
              old_price,
              created_at,
              product_images(image_url, is_primary)
            `)
            .neq('id', productId || 0)
            .order('created_at', { ascending: false })
            .limit(10);
          
          if (recentProducts && recentProducts.length > 0) {
            document.getElementById('interestProducts').innerHTML = 
              recentProducts.map(createOptimizedProductCard).join('');
          }
          return;
        }

        document.getElementById('interestProducts').innerHTML = 
          products.map(createOptimizedProductCard).join('');
      } catch (error) {
        console.error('Error loading interest products:', error);
      }
    }

    let selectedOptions = {
      size: null,
      shoeSize: null,
      weight: null
    };
    let currentProduct = null;

    function setupProductOptions(product) {
      currentProduct = product;
      selectedOptions = { size: null, shoeSize: null, weight: null };
      const category = product.category?.toLowerCase() || '';
      
      renderProductOptions(product);
      
      if ((category.includes('Ù…Ù„Ø§Ø¨Ø³') || category.includes('Ø£Ø²ÙŠØ§Ø¡') || category.includes('Ù‚Ù…ØµØ§Ù†') || category.includes('Ø¨Ù†Ø§Ø·ÙŠÙ„')) && product.sizes && product.sizes.length > 0) {
        setupClothingSizes(product.sizes);
      } else if ((category.includes('Ø£Ø­Ø°ÙŠØ©') || category.includes('Ø­Ø°Ø§Ø¡')) && product.shoe_sizes && product.shoe_sizes.length > 0) {
        setupShoeSizes(product.shoe_sizes);
      } else if (product.weight_unit && product.weight) {
        setupWeightSelection(product.weight, product.weight_unit, product.price);
      }
    }

    function setupClothingSizes(sizes) {
      if (!sizes || sizes.length === 0) return;
      
      const sizeSelection = document.getElementById('sizeSelection');
      const sizeOptions = document.getElementById('sizeOptions');
      
      sizeSelection.classList.remove('hidden');
      
      const sizeButtons = sizes.map(size => `
        <button class="size-option" data-size="${size}" onclick="selectSize('${size}', event)">
          ${size}
        </button>
      `).join('');
      
      sizeOptions.innerHTML = sizeButtons;
    }

    function setupShoeSizes(shoeSizes) {
      if (!shoeSizes || shoeSizes.length === 0) return;
      
      const shoeSizeSelection = document.getElementById('shoeSizeSelection');
      const shoeSizeOptions = document.getElementById('shoeSizeOptions');
      
      shoeSizeSelection.classList.remove('hidden');
      
      const sizeButtons = shoeSizes.map(size => `
        <button class="size-option" data-shoe-size="${size}" onclick="selectShoeSize('${size}', event)">
          ${size}
        </button>
      `).join('');
      
      shoeSizeOptions.innerHTML = sizeButtons;
    }

    function setupWeightSelection(defaultWeight, weightUnit, basePrice) {
      const weightSelection = document.getElementById('weightSelection');
      const weightInput = document.getElementById('weightInput');
      const weightUnitSpan = document.getElementById('weightUnit');
      const weightPrice = document.getElementById('weightPrice');
      
      weightSelection.classList.remove('hidden');
      
      if (defaultWeight) {
        weightInput.value = defaultWeight;
        selectedOptions.weight = defaultWeight;
        const totalPrice = (basePrice * defaultWeight).toFixed(2);
        weightPrice.textContent = `Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalPrice} Ø¬.Ù…`;
      }
      
      if (weightUnit) {
        weightUnitSpan.textContent = weightUnit;
      }
      
      weightInput.addEventListener('input', function() {
        const weight = parseFloat(this.value) || 0;
        if (weight > 0 && basePrice) {
          const totalPrice = (basePrice * weight).toFixed(2);
          weightPrice.textContent = `Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalPrice} Ø¬.Ù…`;
          selectedOptions.weight = weight;
        } else {
          weightPrice.textContent = '';
          selectedOptions.weight = null;
        }
      });
    }

    function selectSize(size, evt) {
      evt.preventDefault();
      // Remove selected state from all size buttons
      document.querySelectorAll('#sizeOptions button').forEach(btn => {
        btn.classList.remove('ring-2', 'ring-blue-500', 'bg-blue-600', 'text-white', 'border-blue-600', 'scale-105');
        btn.classList.add('border-gray-300', 'text-gray-700', 'hover:border-blue-500');
      });
      
      // Add selected state to clicked button
      evt.target.classList.remove('border-gray-300', 'text-gray-700', 'hover:border-blue-500');
      evt.target.classList.add('ring-2', 'ring-blue-500', 'bg-blue-600', 'text-white', 'border-blue-600', 'scale-105');
      
      // Store selection
      selectedOptions.size = size;
      
      // Update confirmation text if it exists
      const selectedSizeText = document.getElementById('selectedSizeText');
      if (selectedSizeText) {
        selectedSizeText.textContent = `âœ“ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‚Ø§Ø³: ${size}`;
        selectedSizeText.classList.remove('hidden');
      }
    }

    function selectShoeSize(size, evt) {
      evt.preventDefault();
      // Remove selected state from all shoe size buttons
      document.querySelectorAll('#shoeSizeOptions button').forEach(btn => {
        btn.classList.remove('ring-2', 'ring-purple-500', 'bg-purple-600', 'text-white', 'border-purple-600', 'scale-105');
        btn.classList.add('border-gray-300', 'text-gray-700', 'hover:border-purple-500');
      });
      
      // Add selected state to clicked button
      evt.target.classList.remove('border-gray-300', 'text-gray-700', 'hover:border-purple-500');
      evt.target.classList.add('ring-2', 'ring-purple-500', 'bg-purple-600', 'text-white', 'border-purple-600', 'scale-105');
      
      // Store selection
      selectedOptions.shoeSize = size;
      
      // Update confirmation text if it exists
      const selectedShoeSizeText = document.getElementById('selectedShoeSizeText');
      if (selectedShoeSizeText) {
        selectedShoeSizeText.textContent = `âœ“ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‚Ø§Ø³ Ø§Ù„Ø­Ø°Ø§Ø¡: ${size}`;
        selectedShoeSizeText.classList.remove('hidden');
      }
    }

    function updateWeightPrice(basePrice, unitText) {
      const weightInput = document.getElementById('weightInput');
      const weightPriceText = document.getElementById('weightPriceText');
      
      if (!weightInput) return;
      
      const weight = parseFloat(weightInput.value) || 0;
      
      if (weight > 0 && basePrice > 0) {
        const totalPrice = (basePrice * weight).toFixed(2);
        selectedOptions.weight = weight;
        selectedOptions.weightUnit = unitText;
        
        if (weightPriceText) {
          weightPriceText.textContent = `ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalPrice} Ø¬.Ù… (${weight} ${unitText})`;
          weightPriceText.classList.remove('hidden');
        }
      } else {
        selectedOptions.weight = null;
        if (weightPriceText) {
          weightPriceText.textContent = '';
          weightPriceText.classList.add('hidden');
        }
      }
    }

    function validateProductOptions(product) {
      const hasSizes = product.sizes && product.sizes.length > 0;
      const hasShoeSizes = product.shoe_sizes && product.shoe_sizes.length > 0;
      const hasWeight = product.weight_unit;
      
      if (hasSizes && !selectedOptions.size) {
        showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‚Ø§Ø³ Ø£ÙˆÙ„Ø§Ù‹');
        return false;
      }
      
      if (hasShoeSizes && !selectedOptions.shoeSize) {
        showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‚Ø§Ø³ Ø§Ù„Ø­Ø°Ø§Ø¡ Ø£ÙˆÙ„Ø§Ù‹');
        return false;
      }
      
      if (hasWeight && !hasSizes && !hasShoeSizes && !selectedOptions.weight) {
        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨');
        return false;
      }
      
      return true;
    }

    function validateAndAddToCart(product) {
      return validateProductOptions(product);
    }

    function addToCartWithOptions(product) {
      if (!validateProductOptions(product)) {
        return;
      }
      
      let cart = JSON.parse(localStorage.getItem('cart') || '[]');
      
      const itemKey = `${product.id}_${selectedOptions.size || ''}_${selectedOptions.shoeSize || ''}_${selectedOptions.weight || ''}`;
      
      const existingItem = cart.find(item => item.key === itemKey);
      
      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        const cartItem = {
          key: itemKey,
          id: product.id,
          name: product.name,
          price: selectedOptions.weight ? (product.price * selectedOptions.weight) : product.price,
          image: product.product_images?.[0]?.image_url || '/placeholder.png',
          quantity: 1,
          seller_id: product.seller_id,
          options: {
            size: selectedOptions.size,
            shoeSize: selectedOptions.shoeSize,
            weight: selectedOptions.weight,
            weightUnit: product.weight_unit
          }
        };
        cart.push(cartItem);
      }
      
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartBadge();
      
      let optionsText = '';
      if (selectedOptions.size) optionsText += ` - Ø§Ù„Ù…Ù‚Ø§Ø³: ${selectedOptions.size}`;
      if (selectedOptions.shoeSize) optionsText += ` - Ù…Ù‚Ø§Ø³ Ø§Ù„Ø­Ø°Ø§Ø¡: ${selectedOptions.shoeSize}`;
      if (selectedOptions.weight) optionsText += ` - Ø§Ù„ÙˆØ²Ù†: ${selectedOptions.weight} ${product.weight_unit || 'ÙƒØ¬Ù…'}`;
      
      showToast(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!${optionsText}`);
    }

    document.addEventListener('DOMContentLoaded', function() {
      setupBuyNowButton();
      checkUserLoginForReviews();
      updateCartBadge();
      loadRelatedProducts();
      loadInterestProducts();
      
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get('id');
      if (productId) {
        setTimeout(() => {
          const productContent = document.getElementById('productContent');
          if (!productContent.classList.contains('hidden')) {
            if (currentProduct) {
              renderProductOptions(currentProduct);
            }
          }
        }, 500);
      }
    });

    document.addEventListener('visibilitychange', function() {
      if (!document.hidden) {
        checkUserLoginForReviews();
      }
    });

    window.selectSize = selectSize;
    window.selectShoeSize = selectShoeSize;
    window.validateProductOptions = validateProductOptions;
    window.addToCartWithOptions = addToCartWithOptions;
    window.setupProductOptions = setupProductOptions;
    window.selectedOptions = selectedOptions;
  </script>
</head>
<script>
function injectProductSchema(p) {
  const schema = {
    "@context": "https://schema.org/",
    "@type": "Product",
    "name": p.name,
    "image": p.image,
    "description": p.description || "Ù…Ù†ØªØ¬ Ù…ØªÙˆÙØ± ÙÙŠ Ù…ØªØ¬Ø± LV12",
    "sku": p.id,
    "brand": { "@type": "Brand", "name": "LV12" },
    "offers": {
      "@type": "Offer",
      "priceCurrency": "EGP",
      "price": p.discount_price && p.discount_price < p.price ? p.discount_price : p.price,
      "availability": p.stock > 0 ? "https://schema.org/InStock" : "https://schema.org/OutOfStock",
      "url": window.location.href
    }
  };

  const script = document.createElement("script");
  script.type = "application/ld+json";
  script.innerHTML = JSON.stringify(schema, null, 2);
  document.head.appendChild(script);
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "LV12 Shop",
  "url": "https://lv12shop.shop",
  "logo": "https://lv12shop.shop/lv12.png",
  "sameAs": [
    "https://www.facebook.com/",
    "https://www.instagram.com/"
  ]
}
</script>

<body class="antialiased">
  
  <header class="bg-white shadow sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3 cursor-pointer" onclick="location.href='index.html'">
        <img src="lv12.ico" alt="LV12" class="w-10 h-10 rounded-md" />
        <div>
          <div class="text-lg font-extrabold text-blue-700">Ù…ØªØ¬Ø± LV12</div>
          <div class="text-xs text-gray-500">ØªØ³ÙˆÙ‚ Ø°ÙƒÙŠ ÙˆØ³Ø±ÙŠØ¹</div>
        </div>
      </div>

      <div class="flex items-center gap-3">
    
        <a href="cart.html" class="relative btn-main px-3 py-2">
          ğŸ›’ Ø§Ù„Ø³Ù„Ø©
          <span id="cartBadge" class="absolute -left-2 -top-2 bg-red-600 text-xs text-white rounded-full px-2 hidden">0</span>
        </a>
      </div>
    </div>
  </header>








<button id="floatingSearchBtn"
  class="fixed bottom-20 right-5 sm:right-8 bg-gradient-to-r from-blue-600 to-indigo-600 text-white 
         font-bold px-5 py-3 rounded-full shadow-xl hover:scale-105 transition-all duration-300 
         z-[9999] flex items-center gap-2 text-sm sm:text-base">
  ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬
</button>
<div id="searchOverlay"
  class="hidden fixed inset-0 bg-black/60 backdrop-blur-md flex items-start justify-center z-[20000] pt-16 transition-all">

  <div class="bg-white w-[92%] sm:w-[460px] rounded-3xl p-6 shadow-2xl border border-blue-200 
              animate-[fadeIn_0.35s_ease] relative">

    <button id="closeSearchOverlay"
      class="absolute top-3 left-3 text-red-500 text-xl hover:scale-125 transition">âœ–</button>

    <h3 class="text-center text-blue-700 font-extrabold text-xl mb-4">Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ ğŸ”</h3>

    <div class="flex gap-2">
      <input type="text" id="popupSearchInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ù‡Ù†Ø§..."
        class="w-full border border-blue-300 rounded-full px-4 py-3 text-gray-700 text-sm 
               focus:ring-4 focus:ring-blue-300/40 focus:outline-none shadow-inner">
      <button id="startSearchBtn"
        class="bg-blue-600 text-white px-4 py-2 rounded-full shadow hover:scale-105 transition">
        Ø¨Ø­Ø«
      </button>
    </div>

    <div id="popupSuggestions"
      class="hidden mt-3 bg-white border border-blue-100 rounded-2xl shadow-xl max-h-72 overflow-y-auto p-1">
    </div>

  </div>
</div>






<script>
const floatingBtn = document.getElementById("floatingSearchBtn");
const overlay = document.getElementById("searchOverlay");
const closeBtn = document.getElementById("closeSearchOverlay");
const searchInput = document.getElementById("popupSearchInput");
const suggestionsBox = document.getElementById("popupSuggestions");
const searchBtn = document.getElementById("startSearchBtn");

floatingBtn?.addEventListener("click", () => {
  overlay.classList.remove("hidden", "animate-fade-out");
  overlay.classList.add("flex");
  setTimeout(() => searchInput.focus(), 150);
});

closeBtn?.addEventListener("click", closeSearch);
overlay?.addEventListener("click", (e) => { if (e.target === overlay) closeSearch(); });

function closeSearch() {
  overlay.classList.add("animate-fade-out");
  setTimeout(() => overlay.classList.add("hidden"), 280);
  suggestionsBox.classList.add("hidden");
}

function levenshtein(a, b) {
  const m = a.length, n = b.length;
  const dp = Array.from({ length: m + 1 }, () => Array(n + 1).fill(0));

  for (let i = 0; i <= m; i++) dp[i][0] = i;
  for (let j = 0; j <= n; j++) dp[0][j] = j;

  for (let i = 1; i <= m; i++) {
    for (let j = 1; j <= n; j++) {
      dp[i][j] = Math.min(
        dp[i-1][j] + 1,
        dp[i][j-1] + 1,
        dp[i-1][j-1] + (a[i-1] === b[j-1] ? 0 : 1)
      );
    }
  }
  return dp[m][n];
}
searchBtn?.addEventListener("click", () => {
  const q = searchInput.value.trim();
  if (q.length > 0) openSearchResultsPage(q);
});
searchInput?.addEventListener("input", async () => {
  const query = searchInput.value.trim().toLowerCase();
  if (!query) return suggestionsBox.classList.add("hidden");
  const { data: products, error } = await supabase
    .from("products")
    .select(`
      id,
      name,
      price,
      product_images(image_url, is_primary)
    `);

  if (error || !products) return;

  let results = products.filter(p =>
    p.name?.toLowerCase().includes(query) ||
    levenshtein(p.name?.toLowerCase(), query) <= 2
  );

  results = results.map(p => ({
    ...p,
    img:
      p.product_images?.find(i => i.is_primary)?.image_url ||
      p.product_images?.[0]?.image_url ||
      "/placeholder.png"
  }));

  if (!results.length) {
    suggestionsBox.innerHTML = `
      <div class="p-3 text-center text-red-600">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>
    `;
    return suggestionsBox.classList.remove("hidden");
  }

  suggestionsBox.innerHTML = results
    .map(
      p => `
      <div class="suggestion-item flex items-center gap-3 cursor-pointer"
           onclick="goToProduct(${p.id})">

        <img src="${p.img}" 
             class="w-12 h-12 object-cover rounded border">

        <div>
          <div class="font-bold text-blue-900 text-sm">${p.name}</div>
          <div class="text-blue-600 text-xs">${p.price} Ø¬.Ù…</div>
        </div>
      </div>
    `
    )
    .join("");

  suggestionsBox.classList.remove("hidden");
});
function openSearchResultsPage(query) {
  window.location.href = `search.html?q=${encodeURIComponent(query)}`;
}


function goToProduct(id) {
  window.location.href = `product.html?id=${id}`;
}
</script>


<nav id="mainNav"
  class="fixed bottom-0 left-0 w-full 
        bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900
        text-white border-t border-blue-900/30
        shadow-[0_-4px_20px_rgba(0,0,0,0.35)]
        z-[99999] transition-all duration-300">

  <div class="max-w-6xl mx-auto flex justify-around items-center px-4 py-2
              text-[11px] sm:text-[14px] font-semibold select-none">

    <a href="shop.html" id="nav-home" class="nav-link-new group">
      <svg class="nav-icon group-hover:scale-110" viewBox="0 0 24 24" fill="currentColor">
        <path d="M3 9.75L12 3l9 6.75V21H4V9.75z"/>
      </svg>
      <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
    </a>

    <a href="cart.html" id="nav-cart" class="nav-link-new group relative">
      <svg class="nav-icon group-hover:scale-110" viewBox="0 0 24 24" fill="currentColor">
        <path d="M7 4H5L3 8H1v2h3l3.6 7.59L5.24 17A3 3 0 0 0 8 21h11v-2H8l1.1-2h8.45A3 3 0 0 0 20 15l2-9H6.31L5.36 4z"/>
      </svg>
      <span>Ø§Ù„Ø³Ù„Ø©</span>
      <span id="cartBadge"
        class="absolute -top-1 right-2 bg-red-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden">0</span>
    </a>

    <a href="wallet.html" id="nav-wallet" class="nav-link-new group relative">
      <svg id="walletIcon" class="nav-icon group-hover:scale-110 transition"
           fill="currentColor" viewBox="0 0 24 24">
        <path d="M21 7H5V5h16v2zm0 2v10H3V7h2v2h16zM7 15h8v2H7v-2z"/>
      </svg>
      <span>Ø§Ù„Ù…Ø­ÙØ¸Ø©</span>
      <span id="walletBalance"
        class="absolute -top-2 right-2 bg-green-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-lg">0 Ø¬.Ù…</span>
    </a>

    <a href="my-orders.html" id="nav-orders" class="nav-link-new group">
      <svg class="nav-icon group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
        <path d="M3 6v14h14V18H5V6H3zm17-2H8v12h12V4zm-2 8h-8V6h8v6z"/>
      </svg>
      <span>Ø·Ù„Ø¨Ø§ØªÙŠ</span>
    </a>

    <a id="nav-menu" class="nav-link-new group">
      <svg class="nav-icon group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
        <path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/>
      </svg>
      <span>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span>
    </a>

  </div>
</nav>


<div id="menuOverlay"
  class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-[99990]"></div>

<div id="sideMenu"
  class="fixed top-0 right-0 w-72 h-full bg-[#0d0d0f] shadow-2xl z-[99999]
  translate-x-full transition-all duration-300 p-6 border-l border-[#222]">

  <button id="closeMenu" class="text-2xl text-red-500 mb-6 font-bold">âœ–</button>

  <h3 class="text-xl font-bold text-gray-200 mb-4">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3>

  <ul class="space-y-3 text-lg font-semibold text-gray-300">

    <li><a href="shop.html" class="block hover:text-blue-400">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
    <li><a href="about.html" class="block hover:text-blue-400">â„¹ï¸ Ù…Ù† Ù†Ø­Ù†</a></li>
    <li><a href="support.html" class="block hover:text-blue-400">ğŸ“ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a></li>
    <li><a href="shipping-policy.html" class="block hover:text-blue-400">ğŸšš Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø´Ø­Ù†</a></li>
    <li><a href="return-policy.html" class="block hover:text-blue-400">ğŸ”„ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a></li>

    <hr class="border-gray-700">

    <li><a href="profile.html" class="block hover:text-blue-400">ğŸ‘¤ Ù…Ù„ÙÙŠ</a></li>
<ul class="space-y-3 text-lg font-semibold text-gray-300">

  <div id="userAreaMenu"
       class="mb-4 p-3 rounded-lg bg-[#111] border border-gray-700">
  </div>


  </ul>
</div>

<script>
const navMenu     = document.getElementById("nav-menu");
const sideMenu    = document.getElementById("sideMenu");
const closeMenu   = document.getElementById("closeMenu");
const menuOverlay = document.getElementById("menuOverlay");

navMenu.addEventListener("click", () => {
  sideMenu.classList.remove("translate-x-full");
  menuOverlay.classList.remove("hidden");
});

closeMenu.addEventListener("click", () => {
  sideMenu.classList.add("translate-x-full");
  menuOverlay.classList.add("hidden");
});

menuOverlay.addEventListener("click", () => {
  sideMenu.classList.add("translate-x-full");
  menuOverlay.classList.add("hidden");
});
</script>

  <main class="max-w-7xl mx-auto px-6 py-12">
    <section id="productBlock" class="product-section overflow-hidden">
      <div id="productSkeleton" class="skeleton animate-pulse text-center py-20 text-gray-500">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600 mb-4"></div>
        <p class="text-lg font-medium">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬...</p>
      </div>

      <div id="productContent" class="hidden">
        <div class="grid lg:grid-cols-2 gap-12">
          <div class="image-gallery p-8 product-image-section">
            <div id="discountBadge" class="discount-badge hidden absolute top-6 right-6 z-10">Ø®ØµÙ… Ø®Ø§Øµ!</div>
            <img id="mainImage" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬" class="main-image" />
            <div id="thumbs" class="image-thumbnails mt-6"></div>
          </div>
          <div class="product-info py-8">
            <h1 id="pName" class="product-title"></h1>
            <p id="pDesc" class="product-description text-gray-600 leading-relaxed"></p>
            <button id="toggleDescBtn" class="hidden text-blue-600 hover:text-blue-800 font-semibold text-sm mt-2 transition">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯</button>

            <div class="price-section mt-6">
              <div class="flex items-center gap-3">
                <span id="pPrice" class="price-current"></span>
                <span id="oldPrice" class="price-old hidden"></span>
              </div>
              <div id="discountTimer" class="text-red-500 font-bold text-sm mt-2 hidden flex items-center gap-2">
                <span>â° Ø§Ù„Ø¹Ø±Ø¶ ÙŠÙ†ØªÙ‡ÙŠ Ø®Ù„Ø§Ù„:</span>
                <span id="timerText" class="bg-red-100 px-2 py-1 rounded"></span>
              </div>
            </div>

            <div class="stats-grid grid grid-cols-3 gap-4 mt-8 p-4 bg-gradient-to-r from-blue-50 to-teal-50 rounded-xl border border-blue-100">
              <div class="stat-item text-center">
                <div id="viewsNum" class="stat-number text-2xl font-bold text-blue-600">0</div>
                <div class="stat-label text-xs text-gray-600 mt-1">ğŸ‘ï¸ Ù…Ø´Ø§Ù‡Ø¯Ø©</div>
              </div>
              <div class="stat-item text-center border-r border-l border-gray-200">
                <div id="salesCount" class="stat-number text-2xl font-bold text-teal-600">0</div>
                <div class="stat-label text-xs text-gray-600 mt-1">ğŸ›ï¸ Ù…Ø¨ÙŠØ¹Ø§Øª</div>
              </div>
              <div class="stat-item text-center">
                <div class="stat-number text-2xl font-bold text-orange-600">ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø±</div>
                <div id="pStock" class="stat-label text-xs text-gray-600 mt-1"></div>
              </div>
            </div>

            <div id="productOptions" class="mb-6 space-y-4"></div>

            <div class="action-buttons grid grid-cols-2 gap-4 mt-8">
              <button id="addToCartBtn" class="btn-modern bg-gradient-to-br from-teal-500 via-teal-600 to-teal-700 text-white font-bold py-4 px-8 rounded-xl shadow-lg hover:shadow-xl text-lg relative z-10">
                ğŸ›’ Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©
              </button>
              <button id="buyNowBtn" class="btn-modern bg-gradient-to-br from-orange-500 via-orange-600 to-orange-700 text-white font-bold py-4 px-8 rounded-xl shadow-lg hover:shadow-xl text-lg relative z-10">
                âš¡ Ø§Ø´ØªØ±ÙŠ Ø§Ù„Ø¢Ù†
              </button>
            </div>

            <div class="mt-8 p-6 bg-gradient-to-br from-blue-50 to-teal-50 rounded-2xl border border-blue-100">
              <h3 class="section-title mb-4">ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬</h3>
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div class="product-info-box">
                  <span class="font-semibold text-gray-700">Ø§Ù„ÙØ¦Ø©:</span>
                  <div id="pCategory" class="text-teal-600 font-medium mt-1"></div>
                </div>
                <div class="product-info-box">
                  <span class="font-semibold text-gray-700">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</span>
                  <div id="pDate" class="text-gray-600 mt-1"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="product-section mt-8">
      <div class="flex items-center justify-between flex-wrap gap-6">
        <div>
          <h3 class="section-title mb-0">ğŸª Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø§Ø¦Ø¹</h3>
          <p class="text-lg font-semibold text-gray-700 mt-4">
            <span id="sellerName" class="text-teal-600 font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
          </p>
        </div>
        <button id="sellerProductsBtn" class="btn-modern bg-gradient-to-r from-teal-500 to-teal-600 text-white px-8 py-3 rounded-lg font-bold relative z-10">
          ğŸ” Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¨Ø§Ø¦Ø¹
        </button>
      </div>
    </section>

    <section id="reviews" class="product-section mt-8">
      <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
        <h2 class="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">â­ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
        <div id="avgBadge" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-4 py-2 rounded-full font-bold shadow-lg"></div>
      </div>

      <div id="ratingSummary" class="mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl border border-blue-100"></div>
      
      <div id="reviewsList" class="space-y-4 mb-6"></div>

      <div class="border-t border-gray-200 pt-6 mt-6">
        <div id="reviewLoginNotice" class="hidden">
          <div class="bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-2xl p-6 text-center">
            <div class="text-4xl mb-3">ğŸ”</div>
            <h3 class="text-lg font-bold text-amber-800 mb-2">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„ÙƒØªØ§Ø¨Ø© ØªÙ‚ÙŠÙŠÙ…</h3>
            <p class="text-amber-700 mb-4">Ø´Ø§Ø±Ùƒ Ø±Ø£ÙŠÙƒ Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† ÙˆØ³Ø§Ø¹Ø¯Ù‡Ù… ÙÙŠ Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­</p>
            <a href="shop-login.html" class="btn-modern bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600">
              ğŸš€ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†
            </a>
          </div>
        </div>

        <div id="reviewFormContainer" class="hidden">
          <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-2xl p-6">
            <h3 class="text-lg font-bold text-blue-800 mb-4 flex items-center gap-2">
              âœï¸ Ø§ÙƒØªØ¨ ØªÙ‚ÙŠÙŠÙ…Ùƒ
            </h3>
            
            <form id="reviewForm" class="space-y-4">
              <div class="text-center">
                <p class="text-sm text-gray-600 mb-2">Ù‚ÙŠÙ… Ø§Ù„Ù…Ù†ØªØ¬:</p>
                <div id="starInput" class="flex justify-center gap-1 mb-4"></div>
              </div>
              
              <textarea id="reviewComment" rows="4" placeholder="Ø´Ø§Ø±ÙƒÙ†Ø§ ØªØ¬Ø±Ø¨ØªÙƒ Ù…Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬... Ù…Ø§ Ø±Ø£ÙŠÙƒ ÙÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ø³Ø¹Ø±ØŸ" 
                class="w-full border-2 border-gray-200 rounded-xl p-4 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 focus:outline-none transition-all resize-none text-black font-medium"></textarea>
              
              <div class="flex gap-3">
                <button type="submit" class="btn-modern flex-1">
                  ğŸ“¤ Ù†Ø´Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
                </button>
                <button type="button" id="clearReview" class="px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-medium transition-all">
                  Ø¥Ù„ØºØ§Ø¡
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>

    <section class="glass-card p-4 sm:p-6 lg:p-8 mt-8 overflow-hidden relative">
      <div class="absolute inset-0 bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 opacity-60"></div>
      <div class="absolute top-0 right-0 w-20 h-20 sm:w-32 sm:h-32 bg-gradient-to-br from-blue-200 to-purple-200 rounded-full opacity-20 transform translate-x-10 sm:translate-x-16 -translate-y-10 sm:-translate-y-16"></div>
      <div class="absolute bottom-0 left-0 w-16 h-16 sm:w-24 sm:h-24 bg-gradient-to-tr from-pink-200 to-indigo-200 rounded-full opacity-20 transform -translate-x-8 sm:-translate-x-12 translate-y-8 sm:translate-y-12"></div>
      
      <div class="relative z-10">
        <div class="text-center mb-6 sm:mb-8 lg:mb-10">
          <div class="inline-flex items-center justify-center w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full mb-3 sm:mb-4 shadow-lg">
            <span class="text-lg sm:text-2xl">ğŸ›ï¸</span>
          </div>
          <h3 class="text-xl sm:text-2xl lg:text-3xl font-bold bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent mb-2 sm:mb-4 leading-tight">
            Ù…Ù†ØªØ¬Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©
          </h3>
          <p class="text-gray-600 text-sm sm:text-base max-w-md mx-auto leading-relaxed px-4">
            Ø§ÙƒØªØ´Ù Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ø®ØªØ§Ø±Ø© Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø§Ù„ØªÙŠ Ù‚Ø¯ ØªÙ†Ø§Ù„ Ø¥Ø¹Ø¬Ø§Ø¨Ùƒ
          </p>
          <div class="w-16 sm:w-20 h-1 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full mx-auto mt-3 sm:mt-4"></div>
        </div>
        
        <div id="relatedProducts" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 sm:gap-4 lg:gap-6"></div>
        
        <div class="text-center mt-6 sm:mt-8">
          <button onclick="window.location.href='shop.html'" class="btn-modern bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 px-6 sm:px-8 py-2.5 sm:py-3 text-sm sm:text-base text-white font-semibold rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
            ğŸ” ØªØµÙØ­ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
          </button>
        </div>
      </div>
    </section>

    <section class="glass-card p-4 sm:p-6 lg:p-8 mt-8 overflow-hidden relative">
      <div class="absolute inset-0 bg-gradient-to-br from-pink-50 via-purple-50 to-indigo-50 opacity-60"></div>
      <div class="absolute top-0 left-0 w-18 h-18 sm:w-28 sm:h-28 bg-gradient-to-br from-pink-200 to-purple-200 rounded-full opacity-20 transform -translate-x-9 sm:-translate-x-14 -translate-y-9 sm:-translate-y-14"></div>
      <div class="absolute bottom-0 right-0 w-24 h-24 sm:w-36 sm:h-36 bg-gradient-to-tr from-indigo-200 to-pink-200 rounded-full opacity-20 transform translate-x-12 sm:translate-x-18 translate-y-12 sm:translate-y-18"></div>
      
      <div class="relative z-10">
        <div class="text-center mb-6 sm:mb-8 lg:mb-10">
          <div class="inline-flex items-center justify-center w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-r from-pink-500 to-indigo-600 rounded-full mb-3 sm:mb-4 shadow-lg">
            <span class="text-lg sm:text-2xl">âœ¨</span>
          </div>
          <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold bg-gradient-to-r from-pink-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent mb-2 sm:mb-4 leading-tight">
            Ù‚Ø¯ ÙŠØ¹Ø¬Ø¨Ùƒ Ø£ÙŠØ¶Ø§Ù‹
          </h2>
          <p class="text-gray-600 text-sm sm:text-base max-w-md mx-auto leading-relaxed px-4">
            Ù…Ù†ØªØ¬Ø§Øª Ù…Ø®ØªØ§Ø±Ø© Ø¨Ø¹Ù†Ø§ÙŠØ© Ø®ØµÙŠØµØ§Ù‹ Ù„Ùƒ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ ÙˆØªÙØ¶ÙŠÙ„Ø§ØªÙƒ
          </p>
          <div class="w-16 sm:w-20 h-1 bg-gradient-to-r from-pink-500 to-indigo-500 rounded-full mx-auto mt-3 sm:mt-4"></div>
        </div>
        
        <div id="interestProducts" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 sm:gap-4 lg:gap-6"></div>
        
        <div class="text-center mt-6 sm:mt-8">
          <button onclick="window.location.href='shop.html'" class="btn-modern bg-gradient-to-r from-pink-500 to-indigo-600 hover:from-pink-600 hover:to-indigo-700 px-6 sm:px-8 py-2.5 sm:py-3 text-sm sm:text-base text-white font-semibold rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
            ğŸ¯ Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙˆØµÙŠØ§Øª
          </button>
        </div>
      </div>
    </section>

  </main>

  <div id="toast" class="toast hidden"></div>
  
  <footer class="text-gray-100 mt-16">
    <div class="max-w-7xl mx-auto px-4 py-12 grid grid-cols-1 md:grid-cols-4 gap-10">
      <div>
        <img src="/lv12.ico" class="w-14 h-14 rounded mb-3" alt="LV12 logo">
        <h4 class="font-bold text-lg text-white mb-1">Ù…ØªØ¬Ø± LV12</h4>
        <p class="text-sm text-gray-300">Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø© ØªØ³ÙˆÙ‚ Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª â€” Ø´Ø­Ù† Ø³Ø±ÙŠØ¹ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ù…Ø¶Ù…ÙˆÙ†.</p>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">Ø±ÙˆØ§Ø¨Ø· Ù…ÙÙŠØ¯Ø©</h4>
        <ul class="space-y-2 text-sm text-gray-300">
          <li><a href="about.html" class="hover:text-white">Ù…Ù† Ù†Ø­Ù†</a></li>
          <li><a href="return-policy.html" class="hover:text-white">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a></li>
          <li><a href="shipping-policy.html" class="hover:text-white">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø´Ø­Ù†</a></li>
          <li><a href="support.html" class="hover:text-white">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h4>
        <a href="mailto:shoplv12shop@gmail.com" class="inline-block bg-blue-50 hover:bg-blue-100 text-blue-700 px-4 py-2 rounded-lg text-sm font-medium transition">
          ğŸ“§ shoplv12shop@gmail.com
        </a>
        <a href="tel:01094965067" class="block text-blue-200 text-lg font-bold hover:underline mt-2">
          ğŸ“ 01094965067
        </a>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">ØªØ§Ø¨Ø¹Ù†Ø§</h4>
        <div class="flex gap-3">
<div class="flex items-center justify-center gap-4 mt-4 text-sm font-semibold">
  <a href="https://www.facebook.com/share/1KEzAxHzzS/" target="_blank"
     class="flex items-center gap-1 text-blue-600 hover:text-blue-800 transition-all duration-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
      <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 5.003 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.463h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.891h-2.33v6.987C18.343 21.128 22 17.003 22 12z"/>
    </svg>
    Facebook
  </a>

  <a href="https://www.tiktok.com/@lv12shop1?_r=1&_t=ZS-91JONZZLeZJ" target="_blank"
     class="flex items-center gap-1 text-gray-800 hover:text-black transition-all duration-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
      <path d="M16.5 3a5.5 5.5 0 0 0 5.5 5.5V11a8.5 8.5 0 0 1-8.5-8.5h3zM9 8a5 5 0 1 0 5 5V4h3v9a8 8 0 1 1-8-8h3v3H9z"/>
    </svg>
    TikTok
  </a>

  <a href="https://www.instagram.com/lv12.shop?igsh=MTQxc3lsM24wb2Fmdg==" target="_blank"
     class="flex items-center gap-1 text-pink-600 hover:text-pink-700 transition-all duration-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
      <path d="M7 2C4.243 2 2 4.243 2 7v10c0 2.757 2.243 5 5 5h10c2.757 0 5-2.243 5-5V7c0-2.757-2.243-5-5-5H7zm0 2h10c1.654 0 3 1.346 3 3v10c0 1.654-1.346 3-3 3H7c-1.654 0-3-1.346-3-3V7c0-1.654 1.346-3 3-3zm5 2a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm0 2a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm4.5-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
    </svg>
    Instagram
  </a>
</div>

        
        </div>
      </div>
    </div>
    <div class="border-t border-blue-800 text-center py-4 text-sm text-blue-100">
      Â© <span id="yearFooter"></span> LV12 â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
    </div>
  </footer>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase-config.js"></script>

<script>

const productSkeleton = document.getElementById('productSkeleton');
const productContent = document.getElementById('productContent');
const mainImage = document.getElementById('mainImage');
const thumbsEl = document.getElementById('thumbs');
const pName = document.getElementById('pName');
const pDesc = document.getElementById('pDesc');
const pPrice = document.getElementById('pPrice');
const pStock = document.getElementById('pStock');
const pCategory = document.getElementById('pCategory');
const pDate = document.getElementById('pDate');
const addToCartBtn = document.getElementById('addToCartBtn');
const buyNowBtn = document.getElementById('buyNowBtn');

const reviewsList = document.getElementById('reviewsList');
const avgBadge = document.getElementById('avgBadge');
const ratingSummary = document.getElementById('ratingSummary');
const reviewForm = document.getElementById('reviewForm');
const reviewLoginNotice = document.getElementById('reviewLoginNotice');
const starInput = document.getElementById('starInput');
const reviewComment = document.getElementById('reviewComment');
const clearReviewBtn = document.getElementById('clearReview');

const relatedProductsEl = document.getElementById('relatedProducts');
const userArea = document.getElementById('userArea');
const cartBadge = document.getElementById('cartBadge');
const toast = document.getElementById('toast');

const params = new URLSearchParams(window.location.search);
const productId = Number(params.get('id') || 0);

let currentUser = null;
let selectedRating = 0;
let reviewSub = null;
let reviewsData = [];
let reviewsShown = 0;
const REVIEWS_PER_PAGE = 3;

let userCity = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
let userCountry = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";

function showToast(msg, ok = true, t = 3000) {
  if (!toast) return;
  toast.innerHTML = `<div class="px-4 py-2 rounded-lg shadow text-white ${ok ? 'bg-green-600' : 'bg-red-600'}">${msg}</div>`;
  toast.classList.remove('hidden');
  clearTimeout(toast._t);
  toast._t = setTimeout(() => toast.classList.add('hidden'), t);
}
function escapeHtml(s = '') {
  return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'" : '&#39;'}[m]));
}
function formatDate(d) { try { return new Date(d).toLocaleDateString('ar-EG'); } catch { return ''; } }

async function logVisit(type, prodId = null) {
  try {
    let ip = null;
    try {
      const r = await fetch("https://api.ipify.org?format=json");
      if (r.ok) {
        const j = await r.json();
        ip = j.ip || null;
      }
    } catch (e) {
      console.warn("âš ï¸ Ù„Ù… ÙŠØªÙ…ÙƒÙ† Ù…Ù† Ø¬Ù„Ø¨ IP (ØªØ¬Ø§Ù‡Ù„):", e);
    }

    if (!supabase) return console.warn("âš ï¸ Supabase ØºÙŠØ± Ù…Ø¹Ø±Ù â€” ØªØ®Ø·Ù‰ Ø­ÙØ¸ Ø§Ù„Ø²ÙŠØ§Ø±Ø©");

    const payload = {
      page_type: type,
      product_id: prodId,
      ip_address: ip,
      country: userCountry || null,
      city: userCity || null,
      user_agent: navigator.userAgent,
      created_at: new Date().toISOString()
    };

    const { error } = await supabase.from("page_visits").insert([payload]);
    if (error) console.warn("âš ï¸ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø© ÙÙŠ Supabase:", error);
    else console.log("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø©");
  } catch (err) {
    console.warn("âš ï¸ Ø®Ø·Ø£ ÙÙŠ logVisit:", err);
  }
}
async function detectUserLocation() {
  userCity = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
  userCountry = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";

  try {
    console.log("ğŸ” Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù€ IP ...");

    const ipRes = await fetch("https://api.ipify.org?format=json");
    const ipData = await ipRes.json();
    const userIP = ipData.ip;

    console.log("ğŸ“¡ Ø¹Ù†ÙˆØ§Ù† IP Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:", userIP);

   const geoRes = await fetch(`https://api.ipflare.io/${userIP}`, {
  headers: {
        "X-API-Key": "01f4450c058bd11e.aa59666daec3e37a34bc5741013d438592908a4655ee62c9632a46018f557f6f"
      }
    });

    console.log("ğŸ“¡ HTTP Status:", geoRes.status);

    if (!geoRes.ok) {
      const text = await geoRes.text();
      console.log("ğŸ“© Ø±Ø¯ Ø§Ù„Ù€ API:", text);
      throw new Error("IPFlare failed");
    }

    const data = await geoRes.json();
    console.log("ğŸ“¦ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹:", data);

    userCountry = data.country_name || data.country || "Egypt";

    userCity =
      data.region ||
      data.region_name ||
      data.subdivision_1_name ||
      data.admin1_name ||
      data.state ||
      data.province ||
      data.city ||
      "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";

    userCity = normalizeCityName(userCity);

    console.log("ğŸŒ Ø§Ù„Ø¯ÙˆÙ„Ø©:", userCountry);
    console.log("ğŸ™ï¸ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:", userCity);

  } catch (err) {
    console.warn("âš ï¸ Ø®Ø·Ø£:", err);
    userCountry = "Egypt";
    userCity = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
  }
}





function normalizeCityName(city) {
  if (!city) return city;
  const map = {
    "Cairo": "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©", "Giza": "Ø§Ù„Ø¬ÙŠØ²Ø©", "Alexandria": "Ø§Ù„Ø§Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©",
    "Suez": "Ø§Ù„Ø³ÙˆÙŠØ³", "Port Said": "Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯", "Damietta": "Ø¯Ù…ÙŠØ§Ø·",
    "Ismailia": "Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©", "Faiyum": "Ø§Ù„ÙÙŠÙˆÙ…", "Beni Suef": "Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ",
    "Minya": "Ø§Ù„Ø§Ù„Ù…Ù†ÙŠØ§", "Assiut": "Ø§Ø³ÙŠÙˆØ·", "Sohag": "Ø³ÙˆÙ‡Ø§Ø¬", "Qena": "Ù‚Ù†Ø§",
    "Aswan": "Ø§Ø³ÙˆØ§Ù†", "Luxor": "Ø§Ù„Ø£Ù‚ØµØ±", "Red Sea": "Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±",
    "Beheira": "Ø§Ù„Ø¨Ø­ÙŠØ±Ø©", "Dakahlia": "Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©", "Sharqia": "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©",
    "Kafr el-Sheikh": "ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®", "Menoufia": "Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©", "Gharbia": "Ø§Ù„ØºØ±Ø¨ÙŠØ©",
    "Qalyubia": "Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©", "Matrouh": "Ù…Ø·Ø±ÙˆØ­",
    "North Sinai": "Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡", "South Sinai": "Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡",
    "New Valley": "Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯"
  };
  return map[city] || city;
}
const oldPrice = document.getElementById('oldPrice');
const discountBadge = document.getElementById('discountBadge');
const discountTimer = document.getElementById('discountTimer');
const timerText = document.getElementById('timerText');



async function loadProduct() {
  if (!productId) {
    productSkeleton.innerHTML = `<div class="text-center text-red-600">Ø±Ù‚Ù… Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± ØµØ§Ù„Ø­</div>`;
    return;
  }

  try {
    productSkeleton.classList.remove('hidden');
    productContent.classList.add('hidden');

    const { data, error } = await supabase.from('products')
      .select(`
        id, name, description, price, discount_price, discount_start, discount_end,
        stock, category, created_at, available_cities, delivery_by_city, seller_id,
        sizes, shoe_sizes, weight, weight_unit,
        product_images!product_images_product_id_fkey(image_url, is_primary, ordering)
      `)
      .eq('id', productId)
      .maybeSingle();

    if (error || !data) {
      productSkeleton.innerHTML = `<div class="text-center text-gray-600">Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</div>`;
      console.error("âŒ loadProduct error:", error);
      return;
    }


    if (data.seller_id) {
      try {
        const { data: seller } = await supabase
          .from("profiles")
          .select("full_name, store_name")
          .eq("id", data.seller_id)
          .maybeSingle();

        let sellerName = seller?.store_name || seller?.full_name;
        
        if (!sellerName) {
          const { data: user } = await supabase
            .from("users")
            .select("full_name")
            .eq("id", data.seller_id)
            .maybeSingle();
          sellerName = user?.full_name || `ID: ${data.seller_id}`;
        }
        
        document.getElementById("sellerName").textContent = sellerName;
      } catch (e) {
        document.getElementById("sellerName").textContent = `ID: ${data.seller_id}`;
      }
    } else {
      document.getElementById("sellerName").textContent = "Ø¨Ø§Ø¦Ø¹ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
    }


    const imgs = (data.product_images || []).slice().sort((a,b) => (a.ordering||0) - (b.ordering||0));
    const main = imgs.find(i => i.is_primary) || imgs[0];
    mainImage.src = main?.image_url || '/assets/no-image.png';
    thumbsEl.innerHTML = imgs.map(im => `
      <img src="${im.image_url}"
           class="w-20 h-20 rounded object-cover border cursor-pointer hover:scale-105 transition"
           onclick="mainImage.src='${im.image_url}'" />
    `).join('');

    pName.textContent = data.name ?? '';
    
    const fullDesc = data.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ';
    const toggleBtn = document.getElementById('toggleDescBtn');
    let isExpanded = false;
    
    if (fullDesc.length > 60) {
      pDesc.textContent = fullDesc.substring(0, 60) + '...';
      toggleBtn.classList.remove('hidden');
      
      toggleBtn.onclick = () => {
        isExpanded = !isExpanded;
        pDesc.textContent = isExpanded ? fullDesc : fullDesc.substring(0, 60) + '...';
        toggleBtn.textContent = isExpanded ? 'Ø¹Ø±Ø¶ Ø£Ù‚Ù„' : 'Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯';
      };
    } else {
      pDesc.textContent = fullDesc;
    }
    
    pStock.textContent = data.stock > 0 ? `Ø§Ù„Ù…ØªÙˆÙØ±: ${data.stock}` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
    pCategory.textContent = data.category || 'ØºÙŠØ± Ù…ØµÙ†Ù';
    pDate.textContent = formatDate(data.created_at);

    const price = Number(data.price || 0);
    const discount = data.discount_price ? Number(data.discount_price) : null;
    const dStart = data.discount_start ? new Date(data.discount_start) : null;
    const dEnd = data.discount_end ? new Date(data.discount_end) : null;
    const now = new Date();

    oldPrice.classList.add("hidden");
    discountBadge.classList.add("hidden");
    discountTimer.classList.add("hidden");

    const discountActive = discount && dEnd && now <= dEnd && (!dStart || now >= dStart);

    if (discountActive) {
      pPrice.innerHTML = `<span class="text-red-600 font-bold text-2xl">${discount.toLocaleString('ar-EG')} Ø¬.Ù…</span>`;

      oldPrice.textContent = `${price.toLocaleString('ar-EG')} Ø¬.Ù…`;
      oldPrice.classList.remove("hidden");

      discountBadge.textContent = "Ø®ØµÙ…";
      discountBadge.classList.remove("hidden");
      discountTimer.classList.remove("hidden");

      let timer = setInterval(() => {
        const diff = dEnd - new Date();
        if (diff <= 0) {
          clearInterval(timer);
          location.reload();
        }

        const h = Math.floor(diff / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        const s = Math.floor((diff % 60000) / 1000);

        timerText.textContent = `${h} Ø³ ${m} Ø¯ ${s} Ø«`;
      }, 1000);
    } else {
      pPrice.innerHTML = `<span class="text-blue-700 font-bold text-2xl">${price.toLocaleString('ar-EG')} Ø¬.Ù…</span>`;
    }

    let availableCities = Array.isArray(data.available_cities)
      ? data.available_cities.join(", ")
      : (data.available_cities || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©");

    const cityEl = document.createElement('p');
    cityEl.className = "text-gray-600 text-sm mt-2 lv12-city-info";
    cityEl.innerHTML = `ğŸ™ï¸ Ù…ØªØ§Ø­ ÙÙŠ: <span class="font-medium">${escapeHtml(availableCities)}</span>`;
    pDate.insertAdjacentElement('afterend', cityEl);

    let deliveryText = "Ø®Ù„Ø§Ù„ 1â€“3 Ø£ÙŠØ§Ù…";
    try {
      const deliveryData = data.delivery_by_city && typeof data.delivery_by_city === "object"
        ? data.delivery_by_city
        : JSON.parse(data.delivery_by_city || "{}");

      if (userCountry?.toLowerCase().includes("egypt")) {
        deliveryText = deliveryData[userCity] 
          ? `Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ù…Ø­Ø§ÙØ¸ØªÙƒ (${userCity}): ${deliveryData[userCity]}`
          : `Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ù…Ø­Ø§ÙØ¸ØªÙƒ (${userCity || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'}): Ø®Ù„Ø§Ù„ 1â€“3 Ø£ÙŠØ§Ù…`;
      } else {
        deliveryText = "âŒ ØºÙŠØ± Ù…ØªÙˆÙØ± Ø®Ø§Ø±Ø¬ Ù…ØµØ±";
      }

      const deliveryEl = document.createElement('p');
      deliveryEl.className = "text-green-700 text-sm mt-1 lv12-delivery-info";
      deliveryEl.innerHTML = `ğŸšš <span class="font-medium">${escapeHtml(deliveryText)}</span>`;
      cityEl.insertAdjacentElement('afterend', deliveryEl);
    } catch {}

    const insideEgypt = userCountry?.toLowerCase().includes("egypt");

    if (!insideEgypt) {
      addToCartBtn.classList.add("hidden");
      buyNowBtn.classList.add("hidden");
    } else {
      addToCartBtn.onclick = async () => {
        if (!validateAndAddToCart(data)) return;
        addToCartWithOptions(data);
        try {
          await supabase.from('cart_events').insert([{ 
            product_id: data.id,
            user_id: data.seller_id || null
          }]);
        } catch (e) {}
      };

      buyNowBtn.onclick = async () => {
        if (!validateAndAddToCart(data)) return;
        addToCartWithOptions(data);
        try {
          await supabase.from('cart_events').insert([{ 
            product_id: data.id,
            user_id: data.seller_id || null
          }]);
        } catch (e) {}
        showToast('âœ… Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ù„Ø©...');
        setTimeout(() => {
          window.location.href = 'cart.html';
        }, 600);
      };
    }

    productSkeleton.classList.add('hidden');
    productContent.classList.remove('hidden');
document.getElementById("sellerProductsBtn").onclick = () => {
  window.location.href = `seller-products.html?seller=${data.seller_id}`;
};

    setupProductOptions(data);

    await logVisit("product", data.id);
    loadProductViews(data.id);
    loadSalesCount(data.id);
    loadRelatedProducts(data.category, data.id);
    subscribeReviewsRealtime();

    try {
      const { data: sessionData } = await supabase.auth.getSession();
      const user = sessionData?.session?.user;
      if (user && data?.id) {
        await supabase
          .from("user_interests")
          .upsert({
            user_id: user.id,
            product_id: data.id
          }, { onConflict: ['user_id', 'product_id'] });
        console.log("ğŸ’¾ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù‡ØªÙ…Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬:", data.name);
      }
    } catch (err) {
      console.warn("âš ï¸ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…:", err.message);
    }

  } catch (err) {
    console.error("âš ï¸ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ loadProduct:", err);
    productSkeleton.innerHTML = `<div class="text-red-600 text-center">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</div>`;
  }
}
async function loadSalesCount(productId) {
  const { data, error } = await supabase
    .from("orders")
    .select("quantity")
    .eq("product_id", productId);

  if (error) return console.error(error);

  const total = (data || []).reduce((t, x) => t + (x.quantity || 0), 0);
  document.getElementById("salesCount").textContent = total;
}

async function saveUserInterest(productId) {
  try {
    const { data: session } = await supabase.auth.getSession();
    const user = session?.session?.user;
    if (!user) return;

    await supabase
      .from("user_interests")
      .upsert([{ user_id: user.id, product_id: productId }], { onConflict: "user_id,product_id" });

  } catch (err) {
    console.warn("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…:", err.message);
  }
}


async function loadProductViews(prodId) {
  if (!supabase || !prodId) return;
  try {
    const { data, error } = await supabase.from('page_visits').select('id').eq('product_id', prodId);
    if (error) return console.warn("âš ï¸ Ø®Ø·Ø£ ÙÙŠ loadProductViews:", error);
    document.getElementById('viewsNum').textContent = (data || []).length;
  } catch (err) {
    console.error("âš ï¸ loadProductViews exception:", err);
  }
}
async function loadRelatedProducts(category, currentId) {
  try {
    if (!category) {
      if (relatedProductsEl) relatedProductsEl.innerHTML = `<p class="text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØµÙ†ÙŠÙ Ù„Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø­Ø§Ù„ÙŠ.</p>`;
      return;
    }

    const { data, error } = await supabase.from("products")
      .select(`
        id, name, price, discount_price, discount_start, discount_end,
        product_images!product_images_product_id_fkey(image_url, is_primary)
      `)
      .eq("category", category)
      .neq("id", currentId)
      .limit(4);

    if (error) throw error;

    if (!data || data.length === 0) {
      relatedProductsEl.innerHTML = `<p class="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø© ÙÙŠ Ù†ÙØ³ Ø§Ù„ØªØµÙ†ÙŠÙ.</p>`;
      return;
    }

    relatedProductsEl.innerHTML = data.map(p => {
      const img = p.product_images?.find(i => i.is_primary)?.image_url || "/assets/no-image.png";

      const hasDiscount = p.discount_price && p.discount_price < p.price;
      const discountPercent = hasDiscount ? Math.round((1 - (p.discount_price / p.price)) * 100) : 0;

      return `
        <div onclick="location.href='product.html?id=${p.id}'"
          class="cursor-pointer bg-white rounded-xl shadow-md hover:shadow-lg transition p-3">

          <div class="relative">
            <img src="${img}" class="w-full h-40 object-cover rounded-lg">

            ${hasDiscount ? `
              <span class="absolute top-2 right-2 bg-red-600 text-white text-xs px-2 py-1 rounded">
                Ø®ØµÙ… ${discountPercent}%
              </span>
            ` : ""}
          </div>

          <h4 class="font-semibold text-blue-700 truncate mt-2">${escapeHtml(p.name)}</h4>

          <div class="mt-1">
            <span class="text-red-600 font-bold text-lg">${hasDiscount ? p.discount_price : p.price} Ø¬.Ù…</span>
            ${hasDiscount ? `<span class="text-gray-400 line-through text-xs ml-1">${p.price} Ø¬.Ù…</span>` : ""}
          </div>

          ${p.discount_end ? `<div class="text-xs text-red-600 mt-1" id="cd-related-${p.id}">â³ </div>` : ""}
        </div>
      `;
    }).join("");

    data.forEach(p => {
      if (!p.discount_end) return;
      const element = document.getElementById(`cd-related-${p.id}`);
      const endTime = new Date(p.discount_end).getTime();

      setInterval(() => {
        const diff = endTime - Date.now();
        if (diff <= 0) {
          element.innerHTML = "â›” Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¹Ø±Ø¶";
          return;
        }
        const h = Math.floor(diff / (1000 * 60 * 60));
        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        element.innerHTML = `â³ ${h} Ø³ ${m} Ø¯`;
      }, 1000);
    });

  } catch (err) {
    console.error("âš ï¸ loadRelatedProducts error:", err);
  }
}




async function loadReviews(initial = true) {
  try {
    if (initial) {
      const { data, error } = await supabase.from('product_reviews')
        .select('*').eq('product_id', productId).order('created_at', { ascending: false });
      if (error) return reviewsList && (reviewsList.innerHTML = `<div class="text-red-500">âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</div>`);
      reviewsData = data || [];
      reviewsShown = 0;
    }

    if (!reviewsData.length) {
      if (reviewsList) reviewsList.innerHTML = `<div class="text-gray-500 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø¨Ø¹Ø¯</div>`;
      avgBadge.textContent = ''; ratingSummary.textContent = '';
      return;
    }

    const avg = (reviewsData.reduce((a,b)=>a+Number(b.rating),0) / reviewsData.length).toFixed(1);
    avgBadge.textContent = `${avg} / 5`;
    ratingSummary.innerHTML = `<span class="text-sm text-gray-700">â­ ${avg} Ù…Ù† ${reviewsData.length} ØªÙ‚ÙŠÙŠÙ…</span>`;

    reviewsList.innerHTML = reviewsData.map(r=>`
      <div class="border rounded-lg p-3 mb-3 bg-gray-50 shadow-sm hover:shadow-md transition">
        <div class="flex justify-between mb-2">
          <span class="font-semibold">${escapeHtml(r.user_name || 'Ù…Ø³ØªØ®Ø¯Ù…')}</span>
          <span class="text-yellow-400">${'â˜…'.repeat(r.rating)}${'â˜†'.repeat(5-r.rating)}</span>
        </div>
        <p class="text-gray-700 mb-1">${escapeHtml(r.comment || '')}</p>
        <small class="text-gray-400">${new Date(r.created_at).toLocaleString()}</small>
      </div>
    `).join('');
  } catch (err) {
    console.error("âš ï¸ loadReviews error:", err);
  }
}

reviewForm?.addEventListener('submit', async (e) => {
  e.preventDefault();
  if (!currentUser) { showToast('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', false); return; }
  const comment = reviewComment.value.trim();
  if (!comment || !selectedRating) { showToast('Ø§Ø®ØªØ± ØªÙ‚ÙŠÙŠÙ… ÙˆØ§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ', false); return; }
  const name = currentUser.user_metadata?.full_name || currentUser.email.split('@')[0];

  try {
    const { data: existing } = await supabase.from('product_reviews')
      .select('id').eq('product_id', productId).eq('user_id', currentUser.id).maybeSingle();
    if (existing) { showToast('Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ØªÙ‚ÙŠÙŠÙ… Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ù‚Ø¨Ù„', false); return; }

    const { error } = await supabase.from('product_reviews').insert([{
      product_id: productId, user_id: currentUser.id, user_name: name,
      rating: selectedRating, comment, created_at: new Date().toISOString()
    }]);
    if (error) { showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…', false); return; }

    reviewComment.value = ''; selectedRating = 0; renderStarUI(0);
    showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© ØªÙ‚ÙŠÙŠÙ…Ùƒ Ø¨Ù†Ø¬Ø§Ø­ âœ…');
    await loadReviews();
  } catch (err) {
    console.error("âš ï¸ add review failed:", err);
    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£', false);
  }
});

function buildStarInput() {
  if (!starInput) return;
  starInput.innerHTML = '';
  for (let i=1;i<=5;i++){
    const s = document.createElement('span');
    s.textContent = 'â˜†';
    s.className = 'cursor-pointer text-2xl sm:text-3xl transition-transform hover:scale-125';
    s.onclick = () => { selectedRating = i; renderStarUI(i); };
    starInput.appendChild(s);
  }
  renderStarUI(0);
}
function renderStarUI(n) {
  if (!starInput) return;
  [...starInput.children].forEach((s, idx) => {
    s.textContent = idx < n ? 'â˜…' : 'â˜†';
    s.classList.toggle('text-yellow-400', idx < n);
  });
}
clearReviewBtn?.addEventListener('click', ()=> { reviewComment.value=''; selectedRating=0; renderStarUI(0); });

function addToCartLocal(id, name, price, seller_id) {
  const cart = JSON.parse(localStorage.getItem('cart') || '[]');
  const found = cart.find(i => i.id === id);

  if (found) {
    found.quantity = (found.quantity || 0) + 1;
  } else {
    cart.push({
      id,
      name,
      price,
      seller_id,  
      quantity: 1
    });
  }

  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartBadgeUI();
  showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©');
}

function getSelectedOptions() {
  const options = {};
  const sizeSelect = document.getElementById('sizeSelect');
  if (sizeSelect && sizeSelect.value) options.size = sizeSelect.value;
  const shoeSizeSelect = document.getElementById('shoeSizeSelect');
  if (shoeSizeSelect && shoeSizeSelect.value) options.shoeSize = shoeSizeSelect.value;
  const weightSelect = document.getElementById('weightSelect');
  if (weightSelect && weightSelect.value) {
    const [weight, unit] = weightSelect.value.split('|');
    options.weight = weight;
    options.weightUnit = unit;
  }
  return options;
}

function validateRequiredOptions(options) {
  if (productData.sizes && productData.sizes.length > 0 && !options.size) {
    showToast('âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‚Ø§Ø³', false);
    return false;
  }
  if (productData.shoe_sizes && productData.shoe_sizes.length > 0 && !options.shoeSize) {
    showToast('âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‚Ø§Ø³ Ø§Ù„Ø­Ø°Ø§Ø¡', false);
    return false;
  }
  if (productData.weight && !options.weight) {
    showToast('âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆØ²Ù†', false);
    return false;
  }
  return true;
}

function renderProductOptions(product) {
  const optionsContainer = document.getElementById('productOptions');
  if (!optionsContainer) return;
  
  const category = (product.category || '').toLowerCase();
  let optionsHtml = '';
  
  // ÙØ­Øµ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
  if (product.sizes && Array.isArray(product.sizes) && product.sizes.length > 0) {
    optionsHtml += `
      <div class="mb-6">
        <label class="block text-sm font-bold text-gray-700 mb-3">ğŸ“ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³:</label>
        <div id="sizeOptions" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2">
          ${product.sizes.map(size => `
            <button type="button" 
                    class="size-btn px-4 py-3 border-2 border-gray-300 rounded-lg font-semibold text-gray-700 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-600 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    data-size="${size}"
                    onclick="selectSize('${size}', event)">
              ${size}
            </button>
          `).join('')}
        </div>
        <div id="selectedSizeText" class="mt-2 text-sm text-green-600 font-medium hidden"></div>
      </div>
    `;
  }
  
  // ÙØ­Øµ Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ø£Ø­Ø°ÙŠØ©
  if (product.shoe_sizes && Array.isArray(product.shoe_sizes) && product.shoe_sizes.length > 0) {
    optionsHtml += `
      <div class="mb-6">
        <label class="block text-sm font-bold text-gray-700 mb-3">ğŸ‘Ÿ Ø§Ø®ØªØ± Ù…Ù‚Ø§Ø³ Ø§Ù„Ø­Ø°Ø§Ø¡:</label>
        <div id="shoeSizeOptions" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2">
          ${product.shoe_sizes.map(size => `
            <button type="button"
                    class="shoe-size-btn px-3 py-3 border-2 border-gray-300 rounded-lg font-semibold text-gray-700 hover:border-purple-500 hover:bg-purple-50 hover:text-purple-600 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-purple-500"
                    data-shoe-size="${size}"
                    onclick="selectShoeSize('${size}', event)">
              ${size}
            </button>
          `).join('')}
        </div>
        <div id="selectedShoeSizeText" class="mt-2 text-sm text-green-600 font-medium hidden"></div>
      </div>
    `;
  }
  
  // ÙØ­Øµ Ø§Ù„ÙˆØ²Ù†
  if (product.weight && product.weight_unit) {
    const unitText = product.weight_unit === 'kg' ? 'ÙƒÙŠÙ„Ùˆ' : product.weight_unit === 'g' ? 'Ø¬Ø±Ø§Ù…' : product.weight_unit;
    optionsHtml += `
      <div class="mb-6">
        <label class="block text-sm font-bold text-gray-700 mb-3">âš–ï¸ Ø­Ø¯Ø¯ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</label>
        <div class="flex items-center gap-3">
          <input type="number" 
                 id="weightInput" 
                 min="0.1" 
                 step="0.1" 
                 value="${product.weight}"
                 class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg font-semibold focus:border-green-500 focus:ring-2 focus:ring-green-500 focus:outline-none"
                 onchange="updateWeightPrice(${product.price}, '${unitText}')">
          <span class="px-4 py-3 bg-gray-100 border-2 border-gray-300 rounded-lg font-semibold text-gray-700">${unitText}</span>
        </div>
        <div id="weightPriceText" class="mt-2 text-sm text-blue-600 font-bold"></div>
      </div>
    `;
  }
  
  optionsContainer.innerHTML = optionsHtml;
  
  if (product.weight && product.weight_unit) {
    const unitText = product.weight_unit === 'kg' ? 'ÙƒÙŠÙ„Ùˆ' : product.weight_unit === 'g' ? 'Ø¬Ø±Ø§Ù…' : product.weight_unit;
    updateWeightPrice(product.price, unitText);
  }
}

function updateCartBadgeUI(){
  const cart = JSON.parse(localStorage.getItem('cart') || '[]');
  const count = cart.reduce((a,b)=>a+(b.quantity||0),0);
  if (count>0) { cartBadge.textContent = count; cartBadge.classList.remove('hidden'); }
  else cartBadge.classList.add('hidden');
}

function subscribeReviewsRealtime(){
  if (!supabase || reviewSub) return;
  try {
    reviewSub = supabase.channel('public:product_reviews')
      .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'product_reviews', filter: `product_id=eq.${productId}` },
        () => loadReviews())
      .subscribe();
  } catch (e) { console.warn("âš ï¸ subscribeReviewsRealtime failed:", e); }
}

async function checkAuth() {
  if (!supabase) return;
  try {
    const { data } = await supabase.auth.getSession();
    currentUser = data?.session?.user || null;
    renderAuthUI();
  } catch (err) {
    console.warn("âš ï¸ checkAuth error:", err);
  }
}
function renderAuthUI() {
  if (!userArea) return;
  if (currentUser) {
    const name = currentUser.user_metadata?.full_name || currentUser.email.split("@")[0];
    const avatar = currentUser.user_metadata?.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0D8ABC&color=fff`;
    userArea.innerHTML = `<div class="flex items-center gap-2">
      <img src="${avatar}" class="w-8 h-8 rounded-full border border-gray-300" alt="user">
      <span class="text-sm text-gray-700 font-medium">ğŸ‘¤ ${escapeHtml(name)}</span>
      <button id="logoutBtn" class="text-sm text-red-500 ml-2 hover:underline">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>`;
    reviewForm?.classList.remove('hidden');
    reviewLoginNotice?.classList.add('hidden');
    document.getElementById('logoutBtn').onclick = async () => { await supabase.auth.signOut(); currentUser=null; renderAuthUI(); showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬'); };
  } else {
    userArea.innerHTML = `<a href="shop-login.html" class="text-blue-600 underline text-sm">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>`;
    reviewForm?.classList.add('hidden');
    reviewLoginNotice?.classList.remove('hidden');
  }
}
(async function init(){
  try {
    updateCartBadgeUI();
    buildStarInput();
    await detectUserLocation();
    await loadProduct();     
    await loadReviews();
    await checkAuth();

  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙØ­Ø©:", err);
    showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©", false);
  }

})();

</script>
<script>
async function renderUserInterests() {
  const container = document.getElementById("interestProducts");
  if (!container) return;

  try {
    const { data: session } = await supabase.auth.getSession();
    const user = session?.session?.user;

    if (!user) {
      container.innerHTML = `<p class="text-gray-500 text-center py-4">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø¹Ø±Ø¶ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ â¤ï¸</p>`;
      return;
    }

    const { data: interests, error } = await supabase
      .from("user_interests")
      .select("product_id")
      .eq("user_id", user.id)
      .order("created_at", { ascending: false })
      .limit(12);

    if (error) throw error;

    if (!interests?.length) {
      container.innerHTML = `<p class="text-gray-500 text-center py-4">Ù„Ù… ØªÙ‚Ù… Ø¨Ø²ÙŠØ§Ø±Ø© Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯ ğŸ‘€</p>`;
      return;
    }

    const ids = interests.map(i => i.product_id);

    const { data: products, error: pErr } = await supabase
      .from("products")
      .select(`
        id, name, price, discount_price,
        product_images(image_url, is_primary)
      `)
      .in("id", ids);

    if (pErr) throw pErr;

    if (!products?.length) {
      container.innerHTML = `<p class="text-gray-500 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¨Ø¹Ø¯</p>`;
      return;
    }

    container.innerHTML = products.map(p => {
      const img =
        (p.product_images?.find(im => im.is_primary)?.image_url) ||
        (p.product_images?.[0]?.image_url) ||
        "/assets/no-image.png";

      const price = p.discount_price ?? p.price;
      return `
        <div class="bg-white rounded-xl shadow hover:shadow-lg transition p-2 cursor-pointer"
             onclick="location.href='product.html?id=${p.id}'">
          <img src="${img}" class="w-full h-40 object-cover rounded-lg mb-2" alt="${p.name}">
          <h3 class="font-semibold text-sm text-gray-800 truncate">${p.name}</h3>
          <p class="text-blue-600 font-bold text-sm">${price} Ø¬.Ù…</p>
        </div>
      `;
    }).join("");

  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª:", err);
    container.innerHTML = `<p class="text-red-500 text-center py-4">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª ğŸ˜</p>`;
  }
}

document.addEventListener("DOMContentLoaded", renderUserInterests);
async function logUserActivity(type) {
  const user = JSON.parse(localStorage.getItem('lv12_user') || '{}');
  await supabase.from('user_activity').insert({
    user_id: user.id || null,
    user_display: user.name || 'Ø²Ø§Ø¦Ø±',
    type
  });
}

logUserActivity('Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±');

</script>
<script>
(async () => {
  try {
    const res = await fetch("https://ipwho.is/");
    const data = await res.json();

    const sec = data.security || {};
    const net = data.connection || {};
    const isp = (data.isp || "").toLowerCase();
    const org = (net.org || "").toLowerCase();
    const country = data.country_code || "??";

    const safeCountries = ["EG", "SA", "AE", "KW", "JO", "QA", "OM", "DZ", "MA", "TN", "LY", "BH", "IQ", "SD", "YE", "SY", "PS"];

    const suspicious =
      sec.vpn ||
      sec.proxy ||
      sec.tor ||
      sec.relay ||
      (!isp && !safeCountries.includes(country)) || 
      /vpn|proxy|tor|hosting|cloudflare|aws|azure|google|digitalocean|ovh|linode|hetzner|server/i.test(
        isp + org
      );

    if (suspicious && !safeCountries.includes(country)) {
      document.documentElement.innerHTML = `
        <div style="
          position:fixed;inset:0;background:#0b0f19;
          color:#fff;display:flex;flex-direction:column;
          align-items:center;justify-content:center;
          font-family:'Cairo',sans-serif;text-align:center;
          padding:20px;z-index:999999;
        ">
          <div style="max-width:500px;">
            <h2 style="font-size:26px;margin-bottom:12px;">ğŸš« ØªÙ… Ø­Ø¸Ø± Ø§Ù„ÙˆØµÙˆÙ„</h2>
            <p style="font-size:16px;line-height:1.8;">
              ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø§ØªØµØ§Ù„ ØºÙŠØ± Ù…ÙˆØ«ÙˆÙ‚ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… VPN / Proxy.<br>
              ÙŠØ±Ø¬Ù‰ Ø¥ÙŠÙ‚Ø§ÙÙ‡ Ø«Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.<br><br>
              <b>Ø¹Ù†ÙˆØ§Ù†Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ:</b> ${data.ip || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}<br>
              <b>Ø§Ù„Ø¨Ù„Ø¯:</b> ${data.country || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}
            </p>
            <button onclick="location.reload()" style="
              margin-top:25px;background:#2563eb;color:white;
              border:none;padding:10px 20px;border-radius:8px;
              cursor:pointer;font-size:15px;">
              ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
            </button>
          </div>
        </div>
      `;
      throw new Error("Blocked: Suspicious VPN/Proxy connection");
    }

    console.log(
      `âœ… VPN check passed | IP: ${data.ip} | Country: ${country} | ISP: ${isp || "unknown"}`
    );
  } catch (err) {
    console.warn("âš ï¸ VPN check failed:", err);
  }
})();
</script>

</body>
</html>