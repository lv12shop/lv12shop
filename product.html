
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ | ŸÖÿ™ÿ¨ÿ± LV12</title>
  <meta name="description" content="üì¶ ÿ™ÿµŸÅÿ≠ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÅŸä ŸÖÿ™ÿ¨ÿ± LV12 ‚Äî ÿµŸàÿ± ÿπÿßŸÑŸäÿ© ÿßŸÑÿ¨ŸàÿØÿ©ÿå ÿßŸÑÿ≥ÿπÿ±ÿå ÿßŸÑŸÖŸàÿßÿµŸÅÿßÿ™ÿå ŸàÿßŸÑŸÖÿ±ÿßÿ¨ÿπÿßÿ™ ŸÖŸÜ ÿßŸÑÿπŸÖŸÑÿßÿ°. ÿ™ÿ≥ŸàŸÇ ÿ®ÿ≥ŸáŸàŸÑÿ© Ÿàÿ£ŸÖÿßŸÜ.">
<link rel="icon" href="/lv12.png" />
<link rel="image_src" href="https://www.lv12shop.shop/lv12.png" />

<meta property="og:title" content="ŸÖÿ™ÿ¨ÿ± LV12 - ÿ™ÿ≥ŸàŸÇ ÿ∞ŸÉŸä Ÿàÿ≥ÿ±Ÿäÿπ" />
<meta property="og:description" content="ÿ£ŸÅÿ∂ŸÑ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿ™ÿ≥ŸàŸÇ ÿπÿ®ÿ± ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™ - ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖŸÖŸäÿ≤ÿ© Ÿàÿ¥ÿ≠ŸÜ ÿ≥ÿ±Ÿäÿπ ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿßÿ™." />
<meta property="og:image" content="https://www.lv12shop.shop/lv12.png" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://www.lv12shop.shop" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="ŸÖÿ™ÿ¨ÿ± LV12 - ÿ™ÿ≥ŸàŸÇ ÿ∞ŸÉŸä Ÿàÿ≥ÿ±Ÿäÿπ" />
<meta name="twitter:description" content="ÿ£ŸÅÿ∂ŸÑ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿ™ÿ≥ŸàŸÇ ÿπÿ®ÿ± ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™ - ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖŸÖŸäÿ≤ÿ© Ÿàÿ¥ÿ≠ŸÜ ÿ≥ÿ±Ÿäÿπ ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿßÿ™." />
<meta name="twitter:image" content="https://www.lv12shop.shop/lv12.png" />

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "LV12 Shop",
  "url": "https://www.lv12shop.shop",
  "logo": "https://www.lv12shop.shop/lv12.png"
}
</script>

  <meta property="og:title" content="ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ | ŸÖÿ™ÿ¨ÿ± LV12" />
  <meta property="og:description" content="ÿ™ÿπÿ±ŸÅ ÿπŸÑŸâ ŸÖŸÖŸäÿ≤ÿßÿ™ Ÿáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿßŸÑÿ±ÿßÿ¶ÿπ ŸÖŸÜ ŸÖÿ™ÿ¨ÿ± LV12 ‚Äî ÿ¨ŸàÿØÿ© ÿπÿßŸÑŸäÿ© Ÿàÿ≥ÿπÿ± ŸÖŸÜÿßÿ≥ÿ®!" />
  <meta property="og:image" content="https://www.lv12shop.shop/lv12.jpg" />
  <meta property="og:type" content="product" />
  <meta property="og:site_name" content="ŸÖÿ™ÿ¨ÿ± LV12" />
  <meta property="og:locale" content="ar_AR" />
  
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ | ŸÖÿ™ÿ¨ÿ± LV12" />
  <meta name="twitter:description" content="ÿßŸÉÿ™ÿ¥ŸÅ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÖŸÜ ŸÖÿ™ÿ¨ÿ± LV12 ‚Äî ÿ¨ŸàÿØÿ© Ÿàÿ£ŸÖÿßŸÜ Ÿàÿ≥ÿ±ÿπÿ© ŸÅŸä ÿßŸÑÿ™ŸàÿµŸäŸÑ." />
  <meta name="twitter:image" content="https://www.lv12shop.shop/lv12.jpg" />

  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" href="/lv12.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/lv12-192.png" />
  <meta name="theme-color" content="#2563eb" />

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <meta name="robots" content="index, follow" />
  <meta name="author" content="LV12 Shop" />
  <meta name="keywords" content="ŸÖÿ™ÿ¨ÿ±, LV12, ŸÖŸÜÿ™ÿ¨ÿßÿ™, ÿ™ÿ≥ŸàŸÇ, ÿ¥ÿ±ÿßÿ°, ÿπÿ±Ÿàÿ∂, ŸÖÿµÿ±, ÿßŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿßÿ™, ÿßŸÉÿ≥ÿ≥Ÿàÿßÿ±ÿßÿ™, ÿßÿ≤Ÿäÿßÿ°, ÿ™ÿ≥ŸàŸÇ ÿßŸàŸÜŸÑÿßŸäŸÜ" />

  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/sw.js")
          .then(() => console.log("‚úÖ Service Worker ŸÖÿ≥ÿ¨ŸÑ ÿ®ŸÜÿ¨ÿßÿ≠"))
          .catch(err => console.warn("‚ö†Ô∏è ŸÅÿ¥ŸÑ ÿ™ÿ≥ÿ¨ŸäŸÑ Service Worker:", err));
      });
    }
  </script>
</head>

  <style>
    :root {
      --lv-blue-500: #2563eb;
      --lv-blue-600: #1d4ed8;
      --lv-blue-700: #1e40af;
      --lv-gray-50: #f9fafb;
      --lv-gray-100: #f3f4f6;
      --lv-gray-200: #e5e7eb;
      --lv-gray-700: #374151;
      --lv-gray-900: #111827;
      --lv-yellow: #fbbf24;
    }


    .btn-main {
      display: inline-block;
      background: linear-gradient(90deg, var(--lv-blue-500), var(--lv-blue-600));
      color: #fff;
      transition: all 0.3s ease;
      border-radius: 0.75rem;
      font-weight: 600;
      box-shadow: 0 3px 8px rgba(37, 99, 235, 0.25);
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      text-align: center;
    }
    .btn-main:hover {
      transform: translateY(-2px);
      opacity: 0.9;
    }
    .btn-main:active {
      transform: scale(0.98);
    }

    .card {
      background: #fff;
      border-radius: 1rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      padding: 1rem 1.25rem;
      margin-bottom: 1.25rem;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
    }

    #reviewsList > div {
      background: #fff;
      border: 1px solid var(--lv-gray-200);
      border-radius: 1rem;
      padding: 1rem 1.25rem;
      transition: all 0.3s ease;
      margin-bottom: 1rem;
    }
    #reviewsList > div:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transform: translateY(-3px);
    }

    #starInput span {
      cursor: pointer;
      font-size: 1.8rem;
      color: #d1d5db;
      transition: color 0.2s ease, transform 0.2s ease;
    }
    #starInput span:hover {
      transform: scale(1.2);
      color: var(--lv-yellow);
    }

    .review-stars {
      color: var(--lv-yellow);
      font-size: 1.2rem;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--lv-blue-600);
      color: #fff;
      padding: 0.75rem 1rem;
      border-radius: 0.75rem;
      font-size: 0.9rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      opacity: 0;
      transform: translateY(10px);
      animation: fadeIn 0.4s forwards;
      z-index: 1000;
    }
    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    #thumbs {
      display: flex;
      gap: 0.5rem;
      overflow-x: auto;
      scroll-behavior: smooth;
      padding-bottom: 0.5rem;
    }
    #thumbs img {
      flex-shrink: 0;
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 0.5rem;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }
    #thumbs img:hover {
      border-color: var(--lv-blue-500);
      transform: scale(1.05);
    }

    #mainImage {
      max-width: 100%;
      height: auto;
      border-radius: 1rem;
    }

    #relatedProducts {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 1rem;
    }
    #relatedProducts .card {
      text-align: center;
      padding: 1rem;
    }
    #relatedProducts img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 0.75rem;
      margin-bottom: 0.5rem;
      transition: transform 0.3s ease;
    }
    #relatedProducts img:hover {
      transform: scale(1.03);
    }

    p, h1, h2, h3, span, div {
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    @media (max-width: 768px) {
      body {
        line-height: 1.6;
        font-size: 15px;
      }

      .btn-main {
        width: 100%;
        padding: 0.9rem 1rem;
        font-size: 1rem;
        border-radius: 0.6rem;
      }

      .card {
        padding: 1rem;
        margin-bottom: 1rem;
      }

      #reviewsList > div {
        padding: 0.9rem 1rem;
      }

      #starInput span {
        font-size: 1.5rem;
      }

      .toast {
        bottom: 15px;
        right: 15px;
        width: calc(100% - 30px);
        text-align: center;
        border-radius: 0.6rem;
      }

      main {
        padding: 1rem;
      }

      #thumbs img {
        width: 70px;
        height: 70px;
      }

      #relatedProducts {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      }

      .grid.md\:grid-cols-2 {
        grid-template-columns: 1fr !important; 
      }

      #mainImage {
        height: auto;
        margin-bottom: 1rem;
      }
    }

    @media (max-width: 480px) {
      body {
        font-size: 14px;
      }

      .btn-main {
        font-size: 0.95rem;
      }

      .card {
        border-radius: 0.75rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      #starInput span {
        font-size: 1.4rem;
      }

      .review-stars {
        font-size: 1rem;
      }
    }
  </style>
</head>
<script>
function injectProductSchema(p) {
  const schema = {
    "@context": "https://schema.org/",
    "@type": "Product",
    "name": p.name,
    "image": p.image,
    "description": p.description || "ŸÖŸÜÿ™ÿ¨ ŸÖÿ™ŸàŸÅÿ± ŸÅŸä ŸÖÿ™ÿ¨ÿ± LV12",
    "sku": p.id,
    "brand": { "@type": "Brand", "name": "LV12" },
    "offers": {
      "@type": "Offer",
      "priceCurrency": "EGP",
      "price": p.discount_price && p.discount_price < p.price ? p.discount_price : p.price,
      "availability": p.stock > 0 ? "https://schema.org/InStock" : "https://schema.org/OutOfStock",
      "url": window.location.href
    }
  };

  const script = document.createElement("script");
  script.type = "application/ld+json";
  script.innerHTML = JSON.stringify(schema, null, 2);
  document.head.appendChild(script);
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "LV12 Shop",
  "url": "https://lv12shop.shop",
  "logo": "https://lv12shop.shop/lv12.png",
  "sameAs": [
    "https://www.facebook.com/",
    "https://www.instagram.com/"
  ]
}
</script>

<body class="antialiased">
  
  <header class="bg-white shadow sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3 cursor-pointer" onclick="location.href='index.html'">
        <img src="lv12.ico" alt="LV12" class="w-10 h-10 rounded-md" />
        <div>
          <div class="text-lg font-extrabold text-blue-700">ŸÖÿ™ÿ¨ÿ± LV12</div>
          <div class="text-xs text-gray-500">ÿ™ÿ≥ŸàŸÇ ÿ∞ŸÉŸä Ÿàÿ≥ÿ±Ÿäÿπ</div>
        </div>
      </div>

      <div class="flex items-center gap-3">
    
        <a href="cart.html" class="relative btn-main px-3 py-2">
          üõí ÿßŸÑÿ≥ŸÑÿ©
          <span id="cartBadge" class="absolute -left-2 -top-2 bg-red-600 text-xs text-white rounded-full px-2 hidden">0</span>
        </a>
      </div>
    </div>
  </header>




<style>
#mainHeader {
  transform: none !important;
  left: 0 !important;
  right: 0 !important;
}
</style>



<button id="floatingSearchBtn"
  class="fixed bottom-20 right-5 sm:right-8 bg-gradient-to-r from-blue-600 to-indigo-600 text-white 
         font-bold px-5 py-3 rounded-full shadow-xl hover:scale-105 transition-all duration-300 
         z-[9999] flex items-center gap-2 text-sm sm:text-base">
  üîç ÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸÜÿ™ÿ¨
</button>
<div id="searchOverlay"
  class="hidden fixed inset-0 bg-black/60 backdrop-blur-md flex items-start justify-center z-[20000] pt-16 transition-all">

  <div class="bg-white w-[92%] sm:w-[460px] rounded-3xl p-6 shadow-2xl border border-blue-200 
              animate-[fadeIn_0.35s_ease] relative">

    <button id="closeSearchOverlay"
      class="absolute top-3 left-3 text-red-500 text-xl hover:scale-125 transition">‚úñ</button>

    <h3 class="text-center text-blue-700 font-extrabold text-xl mb-4">ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸÜÿ™ÿ¨ üîç</h3>

    <div class="flex gap-2">
      <input type="text" id="popupSearchInput" placeholder="ÿßŸÉÿ™ÿ® ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸáŸÜÿß..."
        class="w-full border border-blue-300 rounded-full px-4 py-3 text-gray-700 text-sm 
               focus:ring-4 focus:ring-blue-300/40 focus:outline-none shadow-inner">
      <button id="startSearchBtn"
        class="bg-blue-600 text-white px-4 py-2 rounded-full shadow hover:scale-105 transition">
        ÿ®ÿ≠ÿ´
      </button>
    </div>

    <div id="popupSuggestions"
      class="hidden mt-3 bg-white border border-blue-100 rounded-2xl shadow-xl max-h-72 overflow-y-auto p-1">
    </div>

  </div>
</div>



<style>
@keyframes fadeIn { from { opacity: 0; transform: scale(.95); } to { opacity: 1; transform: scale(1); } }
@keyframes fadeOut { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(.95); } }
.animate-fade-out { animation: fadeOut .3s ease forwards; }

.suggestion-item {
  padding: 10px 14px;
  display: flex;
  gap: 10px;
  align-items: center;
  border-bottom: 1px solid #e5e7eb;
  cursor: pointer;
  transition: .25s;
}
.suggestion-item:hover {
  background: #eff6ff;
}
</style>


<script>
const floatingBtn = document.getElementById("floatingSearchBtn");
const overlay = document.getElementById("searchOverlay");
const closeBtn = document.getElementById("closeSearchOverlay");
const searchInput = document.getElementById("popupSearchInput");
const suggestionsBox = document.getElementById("popupSuggestions");
const searchBtn = document.getElementById("startSearchBtn");

floatingBtn?.addEventListener("click", () => {
  overlay.classList.remove("hidden", "animate-fade-out");
  overlay.classList.add("flex");
  setTimeout(() => searchInput.focus(), 150);
});

closeBtn?.addEventListener("click", closeSearch);
overlay?.addEventListener("click", (e) => { if (e.target === overlay) closeSearch(); });

function closeSearch() {
  overlay.classList.add("animate-fade-out");
  setTimeout(() => overlay.classList.add("hidden"), 280);
  suggestionsBox.classList.add("hidden");
}

function levenshtein(a, b) {
  const m = a.length, n = b.length;
  const dp = Array.from({ length: m + 1 }, () => Array(n + 1).fill(0));

  for (let i = 0; i <= m; i++) dp[i][0] = i;
  for (let j = 0; j <= n; j++) dp[0][j] = j;

  for (let i = 1; i <= m; i++) {
    for (let j = 1; j <= n; j++) {
      dp[i][j] = Math.min(
        dp[i-1][j] + 1,
        dp[i][j-1] + 1,
        dp[i-1][j-1] + (a[i-1] === b[j-1] ? 0 : 1)
      );
    }
  }
  return dp[m][n];
}
searchBtn?.addEventListener("click", () => {
  const q = searchInput.value.trim();
  if (q.length > 0) openSearchResultsPage(q);
});
searchInput?.addEventListener("input", async () => {
  const query = searchInput.value.trim().toLowerCase();
  if (!query) return suggestionsBox.classList.add("hidden");
  const { data: products, error } = await supabase
    .from("products")
    .select(`
      id,
      name,
      price,
      product_images(image_url, is_primary)
    `);

  if (error || !products) return;

  let results = products.filter(p =>
    p.name?.toLowerCase().includes(query) ||
    levenshtein(p.name?.toLowerCase(), query) <= 2
  );

  results = results.map(p => ({
    ...p,
    img:
      p.product_images?.find(i => i.is_primary)?.image_url ||
      p.product_images?.[0]?.image_url ||
      "/placeholder.png"
  }));

  if (!results.length) {
    suggestionsBox.innerHTML = `
      <div class="p-3 text-center text-red-600">ŸÑÿß ŸäŸàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨</div>
    `;
    return suggestionsBox.classList.remove("hidden");
  }

  suggestionsBox.innerHTML = results
    .map(
      p => `
      <div class="suggestion-item flex items-center gap-3 cursor-pointer"
           onclick="goToProduct(${p.id})">

        <img src="${p.img}" 
             class="w-12 h-12 object-cover rounded border">

        <div>
          <div class="font-bold text-blue-900 text-sm">${p.name}</div>
          <div class="text-blue-600 text-xs">${p.price} ÿ¨.ŸÖ</div>
        </div>
      </div>
    `
    )
    .join("");

  suggestionsBox.classList.remove("hidden");
});
function openSearchResultsPage(query) {
  window.location.href = `search.html?q=${encodeURIComponent(query)}`;
}


function goToProduct(id) {
  window.location.href = `product.html?id=${id}`;
}
</script>


<nav id="mainNav"
  class="fixed bottom-0 left-0 w-full 
        bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900
        text-white border-t border-blue-900/30
        shadow-[0_-4px_20px_rgba(0,0,0,0.35)]
        z-[99999] transition-all duration-300">

  <div class="max-w-6xl mx-auto flex justify-around items-center px-4 py-2
              text-[11px] sm:text-[14px] font-semibold select-none">

    <a href="shop.html" id="nav-home" class="nav-link-new group">
      <svg class="nav-icon group-hover:scale-110" viewBox="0 0 24 24" fill="currentColor">
        <path d="M3 9.75L12 3l9 6.75V21H4V9.75z"/>
      </svg>
      <span>ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</span>
    </a>

    <a href="cart.html" id="nav-cart" class="nav-link-new group relative">
      <svg class="nav-icon group-hover:scale-110" viewBox="0 0 24 24" fill="currentColor">
        <path d="M7 4H5L3 8H1v2h3l3.6 7.59L5.24 17A3 3 0 0 0 8 21h11v-2H8l1.1-2h8.45A3 3 0 0 0 20 15l2-9H6.31L5.36 4z"/>
      </svg>
      <span>ÿßŸÑÿ≥ŸÑÿ©</span>
      <span id="cartBadge"
        class="absolute -top-1 right-2 bg-red-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden">0</span>
    </a>

    <a href="wallet.html" id="nav-wallet" class="nav-link-new group relative">
      <svg id="walletIcon" class="nav-icon group-hover:scale-110 transition"
           fill="currentColor" viewBox="0 0 24 24">
        <path d="M21 7H5V5h16v2zm0 2v10H3V7h2v2h16zM7 15h8v2H7v-2z"/>
      </svg>
      <span>ÿßŸÑŸÖÿ≠ŸÅÿ∏ÿ©</span>
      <span id="walletBalance"
        class="absolute -top-2 right-2 bg-green-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-lg">0 ÿ¨.ŸÖ</span>
    </a>

    <a href="my-orders.html" id="nav-orders" class="nav-link-new group">
      <svg class="nav-icon group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
        <path d="M3 6v14h14V18H5V6H3zm17-2H8v12h12V4zm-2 8h-8V6h8v6z"/>
      </svg>
      <span>ÿ∑ŸÑÿ®ÿßÿ™Ÿä</span>
    </a>

    <a id="nav-menu" class="nav-link-new group">
      <svg class="nav-icon group-hover:scale-110" fill="currentColor" viewBox="0 0 24 24">
        <path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/>
      </svg>
      <span>ÿßŸÑŸÇÿßÿ¶ŸÖÿ©</span>
    </a>

  </div>
</nav>


<div id="menuOverlay"
  class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-[99990]"></div>

<div id="sideMenu"
  class="fixed top-0 right-0 w-72 h-full bg-[#0d0d0f] shadow-2xl z-[99999]
  translate-x-full transition-all duration-300 p-6 border-l border-[#222]">

  <button id="closeMenu" class="text-2xl text-red-500 mb-6 font-bold">‚úñ</button>

  <h3 class="text-xl font-bold text-gray-200 mb-4">ÿßŸÑŸÇÿßÿ¶ŸÖÿ©</h3>

  <ul class="space-y-3 text-lg font-semibold text-gray-300">

    <li><a href="shop.html" class="block hover:text-blue-400">üè† ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</a></li>
    <li><a href="about.html" class="block hover:text-blue-400">‚ÑπÔ∏è ŸÖŸÜ ŸÜÿ≠ŸÜ</a></li>
    <li><a href="support.html" class="block hover:text-blue-400">üìû ÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÜÿß</a></li>
    <li><a href="shipping-policy.html" class="block hover:text-blue-400">üöö ÿ≥Ÿäÿßÿ≥ÿ© ÿßŸÑÿ¥ÿ≠ŸÜ</a></li>
    <li><a href="return-policy.html" class="block hover:text-blue-400">üîÑ ÿ≥Ÿäÿßÿ≥ÿ© ÿßŸÑÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ</a></li>

    <hr class="border-gray-700">

    <li><a href="profile.html" class="block hover:text-blue-400">üë§ ŸÖŸÑŸÅŸä</a></li>
<ul class="space-y-3 text-lg font-semibold text-gray-300">

  <div id="userAreaMenu"
       class="mb-4 p-3 rounded-lg bg-[#111] border border-gray-700">
  </div>


  </ul>
</div>

<script>
const navMenu     = document.getElementById("nav-menu");
const sideMenu    = document.getElementById("sideMenu");
const closeMenu   = document.getElementById("closeMenu");
const menuOverlay = document.getElementById("menuOverlay");

navMenu.addEventListener("click", () => {
  sideMenu.classList.remove("translate-x-full");
  menuOverlay.classList.remove("hidden");
});

closeMenu.addEventListener("click", () => {
  sideMenu.classList.add("translate-x-full");
  menuOverlay.classList.add("hidden");
});

menuOverlay.addEventListener("click", () => {
  sideMenu.classList.add("translate-x-full");
  menuOverlay.classList.add("hidden");
});
</script>

  <main class="max-w-6xl mx-auto px-4 py-8 space-y-6">
    <section id="productBlock" class="card p-6">
      <div id="productSkeleton" class="animate-pulse text-center py-10 text-gray-500">
        ‚è≥ ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨...
      </div>

      <div id="productContent" class="hidden">
        <div class="grid md:grid-cols-2 gap-8 items-start">
          <div>
            <img id="mainImage" class="w-full h-96 object-cover rounded-xl shadow-md" />
            <div id="thumbs" class="flex gap-2 mt-3 overflow-x-auto"></div>
          </div>

          <div>
            <h1 id="pName" class="text-3xl font-bold text-blue-700 mb-2"></h1>
            <p id="pDesc" class="text-gray-600 mb-4 leading-relaxed"></p>
<div class="flex items-center gap-3 mb-2">
  <span id="pPrice" class="text-2xl font-bold text-blue-700"></span>
  <span id="oldPrice" class="line-through text-gray-500 text-lg hidden"></span>
  <span id="discountBadge" class="bg-red-600 text-white px-2 py-1 rounded text-sm hidden"></span>
</div>

<span id="discountTimer" class="text-sm text-red-500 hidden">
 ‚è≥ ŸäŸÜÿ™ŸáŸä ÿÆŸÑÿßŸÑ: <span id="timerText"></span>
</span>

            <div id="pStock" class="text-sm text-gray-500 mb-4"></div>


            <div class="flex flex-wrap gap-3 mb-4 items-center">
              <button id="addToCartBtn" class="btn-main px-4 py-2">üõí ÿ£ÿ∂ŸÅ ŸÑŸÑÿ≥ŸÑÿ©</button>
              <button id="buyNowBtn" class="border border-blue-600 text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-50 transition">
                üí≥ ÿßÿ¥ÿ™ÿ±Ÿä ÿßŸÑÿ¢ŸÜ
              </button>

              <p id="viewsCounter" class="text-sm text-gray-600 mt-2">üëÅÔ∏è ÿßŸÑŸÖÿ¥ÿßŸáÿØÿßÿ™: <span id="viewsNum">0</span></p>
              <p class="text-sm text-gray-600 mt-1">üõçÔ∏è ÿßŸÑŸÖÿ®Ÿäÿπÿßÿ™: <span id="salesCount">0</span></p>
            </div>


            <div class="text-sm text-gray-500">
              <span class="font-semibold">ÿßŸÑŸÅÿ¶ÿ©:</span> <span id="pCategory"></span> ‚Ä¢
              <span class="font-semibold">ÿ£ÿ∂ŸäŸÅ ŸÅŸä:</span> <span id="pDate"></span>
            </div>
          </div>
        </div>
      </div>
    </section>
    <p class="text-sm text-gray-600 mt-2">
  üõí ÿßŸÑÿ®ÿßÿ¶ÿπ: <span id="sellerName" class="font-semibold text-blue-700">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</span>
</p>

<button id="sellerProductsBtn"
  class="mt-3 bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition">
  üîç ÿπÿ±ÿ∂ ŸÉŸÑ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑÿ®ÿßÿ¶ÿπ
</button>
    <section id="reviews" class="card p-6">
      <div class="flex justify-between mb-4 items-center">
        <h2 class="text-xl font-bold text-blue-700">‚≠ê ÿ™ŸÇŸäŸäŸÖÿßÿ™ ÿßŸÑÿπŸÖŸÑÿßÿ°</h2>
        <div id="avgBadge" class="text-sm bg-blue-50 px-3 py-1 rounded-full text-blue-700 font-medium"></div>
      </div>

      <div id="ratingSummary" class="mb-4 text-gray-600 text-sm"></div>
      <div id="reviewsList" class="space-y-4 mb-5"></div>

      <div class="border-t pt-4 mt-4">
        <div id="reviewLoginNotice" class="text-sm text-gray-600 hidden">
          ŸÑÿ™ÿ™ŸÖŸÉŸÜ ŸÖŸÜ ŸÉÿ™ÿßÿ®ÿ© ÿ™ŸÇŸäŸäŸÖÿå Ÿäÿ±ÿ¨Ÿâ <a href="shop-login.html" class="text-blue-600 underline">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</a>.
        </div>

        <form id="reviewForm" class="hidden space-y-3">
          <div id="starInput" class="flex gap-1"></div>
          <textarea id="reviewComment" rows="3" placeholder="ÿßŸÉÿ™ÿ® ÿ±ÿ£ŸäŸÉ ÿ≠ŸàŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨..." class="w-full border rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"></textarea>
          <div class="flex gap-2">
            <button type="submit" class="btn-main px-4 py-2">üì§ ÿ£ÿ±ÿ≥ŸÑ ÿßŸÑÿ™ŸÇŸäŸäŸÖ</button>
            <button type="button" id="clearReview" class="px-3 py-2 bg-gray-200 rounded-lg">ÿ•ŸÑÿ∫ÿßÿ°</button>
          </div>
        </form>
      </div>
    </section>

    <section class="mt-10">
      <h3 class="text-xl font-bold text-blue-800 mb-4">üõçÔ∏è ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖÿ¥ÿßÿ®Ÿáÿ©</h3>
      <div id="relatedProducts" class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </section>
    <section>
      <h2 class="text-xl font-bold text-blue-800 mb-3">‚ú® ÿßŸáÿ™ŸÖÿßŸÖÿßÿ™ŸÉ</h2>
      <div id="interestProducts" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
    </section>

  </main>

  <div id="toast" class="toast hidden"></div>
  
  <footer class="text-gray-100 mt-16">
    <div class="max-w-7xl mx-auto px-4 py-12 grid grid-cols-1 md:grid-cols-4 gap-10">
      <div>
        <img src="/lv12.ico" class="w-14 h-14 rounded mb-3" alt="LV12 logo">
        <h4 class="font-bold text-lg text-white mb-1">ŸÖÿ™ÿ¨ÿ± LV12</h4>
        <p class="text-sm text-gray-300">ÿ£ŸÅÿ∂ŸÑ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿ™ÿ≥ŸàŸÇ ÿπÿ®ÿ± ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™ ‚Äî ÿ¥ÿ≠ŸÜ ÿ≥ÿ±Ÿäÿπ Ÿàÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ŸÖÿ∂ŸÖŸàŸÜ.</p>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">ÿ±Ÿàÿßÿ®ÿ∑ ŸÖŸÅŸäÿØÿ©</h4>
        <ul class="space-y-2 text-sm text-gray-300">
          <li><a href="about.html" class="hover:text-white">ŸÖŸÜ ŸÜÿ≠ŸÜ</a></li>
          <li><a href="return-policy.html" class="hover:text-white">ÿ≥Ÿäÿßÿ≥ÿ© ÿßŸÑÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ</a></li>
          <li><a href="shipping-policy.html" class="hover:text-white">ÿ≥Ÿäÿßÿ≥ÿ© ÿßŸÑÿ¥ÿ≠ŸÜ</a></li>
          <li><a href="support.html" class="hover:text-white">ÿßŸÑÿØÿπŸÖ ÿßŸÑŸÅŸÜŸä</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">ÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÜÿß</h4>
        <a href="mailto:shoplv12shop@gmail.com" class="inline-block bg-blue-50 hover:bg-blue-100 text-blue-700 px-4 py-2 rounded-lg text-sm font-medium transition">
          üìß shoplv12shop@gmail.com
        </a>
        <a href="tel:01094965067" class="block text-blue-200 text-lg font-bold hover:underline mt-2">
          üìû 01094965067
        </a>
      </div>
      <div>
        <h4 class="font-semibold mb-3 text-white">ÿ™ÿßÿ®ÿπŸÜÿß</h4>
        <div class="flex gap-3">
<div class="flex items-center justify-center gap-4 mt-4 text-sm font-semibold">
  <a href="https://www.facebook.com/share/1KEzAxHzzS/" target="_blank"
     class="flex items-center gap-1 text-blue-600 hover:text-blue-800 transition-all duration-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
      <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 5.003 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.463h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.891h-2.33v6.987C18.343 21.128 22 17.003 22 12z"/>
    </svg>
    Facebook
  </a>

  <a href="https://www.tiktok.com/@lv12shop1?_r=1&_t=ZS-91JONZZLeZJ" target="_blank"
     class="flex items-center gap-1 text-gray-800 hover:text-black transition-all duration-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
      <path d="M16.5 3a5.5 5.5 0 0 0 5.5 5.5V11a8.5 8.5 0 0 1-8.5-8.5h3zM9 8a5 5 0 1 0 5 5V4h3v9a8 8 0 1 1-8-8h3v3H9z"/>
    </svg>
    TikTok
  </a>

  <a href="https://www.instagram.com/lv12.shop?igsh=MTQxc3lsM24wb2Fmdg==" target="_blank"
     class="flex items-center gap-1 text-pink-600 hover:text-pink-700 transition-all duration-300">
    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="w-5 h-5">
      <path d="M7 2C4.243 2 2 4.243 2 7v10c0 2.757 2.243 5 5 5h10c2.757 0 5-2.243 5-5V7c0-2.757-2.243-5-5-5H7zm0 2h10c1.654 0 3 1.346 3 3v10c0 1.654-1.346 3-3 3H7c-1.654 0-3-1.346-3-3V7c0-1.654 1.346-3 3-3zm5 2a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm0 2a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm4.5-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
    </svg>
    Instagram
  </a>
</div>

        
        </div>
      </div>
    </div>
    <div class="border-t border-blue-800 text-center py-4 text-sm text-blue-100">
      ¬© <span id="yearFooter"></span> LV12 ‚Äî ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©.
    </div>
  </footer>
<style>
:root {
  --primary: #4da8ff;       
  --primary-dark: #1f71d8; 
  --secondary: #7b5bff;     
  --accent: #9fd8ff;        

  --bg-light: linear-gradient(180deg, #0e1a33, #111f3f, #13264e); 
  --bg-box: rgba(255,255,255,0.10);

  --text-dark: #f4f7ff;     
  --text-gray: #cdd6ea;

  --radius: 18px;
  --shadow: 0 6px 30px rgba(0,0,0,0.35);
  --transition: .3s ease;
}

body {
  font-family: 'Cairo', sans-serif;
  background: var(--bg-light);
  color: var(--text-dark);
  margin: 0;
  overflow-x: hidden;
}


header {
  background: linear-gradient(90deg, #122040, #1b2f55, #122040);
  border-bottom: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 6px 20px rgba(0,0,0,0.45);
}


.search-bar input {
  background: rgba(255,255,255,0.14);
  border: 1px solid rgba(255,255,255,0.18);
  color: white;
}
.search-bar input:focus {
  box-shadow: 0 0 0 3px rgba(77,168,255,0.4);
}


.product-card {
  background: rgba(255,255,255,0.10);
  border: 1px solid rgba(255,255,255,0.14);
  backdrop-filter: blur(8px);
}
.product-card h3 {
  color: #eaf1ff;
}
.price-new {
  color: #4da8ff;
}
.price-old {
  color: #b8c3db;
}

#categoriesBar {
  background: #162443;
}
.category-item {
  background: #1c2f57;
  border: 1px solid rgba(255,255,255,0.10);
}
.category-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 26px rgba(0,0,0,0.5);
}


#mainNav {
  background: linear-gradient(90deg, #142544, #203a6d);
  border-top: 1px solid rgba(255,255,255,0.12);
}
.nav-icon {
  color: #aecdff;
}
.nav-link-new span {
  color: #cfd8f7;
}
.nav-link-new:hover .nav-icon {
  color: #4da8ff;
}


#sideMenu {
  background: #172a52;
  border-left: 1px solid rgba(255,255,255,0.14);
}
#sideMenu a {
  color: #dce6ff;
}
#sideMenu a:hover {
  color: var(--primary);
}

#closeMenu {
  color: #ff6b6b !important;
}


footer {
  background: linear-gradient(180deg, #152649, #111e36);
  color: #cbd5ec;
  border-top: 1px solid rgba(255,255,255,0.10);
}
footer a:hover {
  color: var(--primary);
}
</style>
<script>
const SUPABASE_URL = "https://nszhzfysitppxssplqfb.supabase.co";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zemh6ZnlzaXRwcHhzc3BscWZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMzA4OTcsImV4cCI6MjA3MzgwNjg5N30.5KvK4bhqkZ_GpIfED4qecIMfeubAJYwSFJslULwOp-w";
const supabase = window.supabase?.createClient(SUPABASE_URL, SUPABASE_KEY);

const productSkeleton = document.getElementById('productSkeleton');
const productContent = document.getElementById('productContent');
const mainImage = document.getElementById('mainImage');
const thumbsEl = document.getElementById('thumbs');
const pName = document.getElementById('pName');
const pDesc = document.getElementById('pDesc');
const pPrice = document.getElementById('pPrice');
const pStock = document.getElementById('pStock');
const pCategory = document.getElementById('pCategory');
const pDate = document.getElementById('pDate');
const addToCartBtn = document.getElementById('addToCartBtn');
const buyNowBtn = document.getElementById('buyNowBtn');

const reviewsList = document.getElementById('reviewsList');
const avgBadge = document.getElementById('avgBadge');
const ratingSummary = document.getElementById('ratingSummary');
const reviewForm = document.getElementById('reviewForm');
const reviewLoginNotice = document.getElementById('reviewLoginNotice');
const starInput = document.getElementById('starInput');
const reviewComment = document.getElementById('reviewComment');
const clearReviewBtn = document.getElementById('clearReview');

const relatedProductsEl = document.getElementById('relatedProducts');
const userArea = document.getElementById('userArea');
const cartBadge = document.getElementById('cartBadge');
const toast = document.getElementById('toast');

const params = new URLSearchParams(window.location.search);
const productId = Number(params.get('id') || 0);

let currentUser = null;
let selectedRating = 0;
let reviewSub = null;
let reviewsData = [];
let reviewsShown = 0;
const REVIEWS_PER_PAGE = 3;

let userCity = "ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ";
let userCountry = "ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ";

function showToast(msg, ok = true, t = 3000) {
  if (!toast) return;
  toast.innerHTML = `<div class="px-4 py-2 rounded-lg shadow text-white ${ok ? 'bg-green-600' : 'bg-red-600'}">${msg}</div>`;
  toast.classList.remove('hidden');
  clearTimeout(toast._t);
  toast._t = setTimeout(() => toast.classList.add('hidden'), t);
}
function escapeHtml(s = '') {
  return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'" : '&#39;'}[m]));
}
function formatDate(d) { try { return new Date(d).toLocaleDateString('ar-EG'); } catch { return ''; } }

async function logVisit(type, prodId = null) {
  try {
    let ip = null;
    try {
      const r = await fetch("https://api.ipify.org?format=json");
      if (r.ok) {
        const j = await r.json();
        ip = j.ip || null;
      }
    } catch (e) {
      console.warn("‚ö†Ô∏è ŸÑŸÖ Ÿäÿ™ŸÖŸÉŸÜ ŸÖŸÜ ÿ¨ŸÑÿ® IP (ÿ™ÿ¨ÿßŸáŸÑ):", e);
    }

    if (!supabase) return console.warn("‚ö†Ô∏è Supabase ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸÅ ‚Äî ÿ™ÿÆÿ∑Ÿâ ÿ≠ŸÅÿ∏ ÿßŸÑÿ≤Ÿäÿßÿ±ÿ©");

    const payload = {
      page_type: type,
      product_id: prodId,
      ip_address: ip,
      country: userCountry || null,
      city: userCity || null,
      user_agent: navigator.userAgent,
      created_at: new Date().toISOString()
    };

    const { error } = await supabase.from("page_visits").insert([payload]);
    if (error) console.warn("‚ö†Ô∏è ŸÅÿ¥ŸÑ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≤Ÿäÿßÿ±ÿ© ŸÅŸä Supabase:", error);
    else console.log("‚úÖ ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≤Ÿäÿßÿ±ÿ©");
  } catch (err) {
    console.warn("‚ö†Ô∏è ÿÆÿ∑ÿ£ ŸÅŸä logVisit:", err);
  }
}
async function detectUserLocation() {
  userCity = "ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ";
  userCountry = "ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ";

  try {
    console.log("üîç ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÄ IP ...");

    const ipRes = await fetch("https://api.ipify.org?format=json");
    const ipData = await ipRes.json();
    const userIP = ipData.ip;

    console.log("üì° ÿπŸÜŸàÿßŸÜ IP ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ:", userIP);

   const geoRes = await fetch(`https://api.ipflare.io/${userIP}`, {
  headers: {
        "X-API-Key": "01f4450c058bd11e.aa59666daec3e37a34bc5741013d438592908a4655ee62c9632a46018f557f6f"
      }
    });

    console.log("üì° HTTP Status:", geoRes.status);

    if (!geoRes.ok) {
      const text = await geoRes.text();
      console.log("üì© ÿ±ÿØ ÿßŸÑŸÄ API:", text);
      throw new Error("IPFlare failed");
    }

    const data = await geoRes.json();
    console.log("üì¶ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸàŸÇÿπ:", data);

    userCountry = data.country_name || data.country || "Egypt";

    userCity =
      data.region ||
      data.region_name ||
      data.subdivision_1_name ||
      data.admin1_name ||
      data.state ||
      data.province ||
      data.city ||
      "ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ";

    userCity = normalizeCityName(userCity);

    console.log("üåç ÿßŸÑÿØŸàŸÑÿ©:", userCountry);
    console.log("üèôÔ∏è ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©:", userCity);

  } catch (err) {
    console.warn("‚ö†Ô∏è ÿÆÿ∑ÿ£:", err);
    userCountry = "Egypt";
    userCity = "ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ";
  }
}





function normalizeCityName(city) {
  if (!city) return city;
  const map = {
    "Cairo": "ÿßŸÑŸÇÿßŸáÿ±ÿ©", "Giza": "ÿßŸÑÿ¨Ÿäÿ≤ÿ©", "Alexandria": "ÿßŸÑÿßÿ≥ŸÉŸÜÿØÿ±Ÿäÿ©",
    "Suez": "ÿßŸÑÿ≥ŸàŸäÿ≥", "Port Said": "ÿ®Ÿàÿ±ÿ≥ÿπŸäÿØ", "Damietta": "ÿØŸÖŸäÿßÿ∑",
    "Ismailia": "ÿßŸÑÿ•ÿ≥ŸÖÿßÿπŸäŸÑŸäÿ©", "Faiyum": "ÿßŸÑŸÅŸäŸàŸÖ", "Beni Suef": "ÿ®ŸÜŸä ÿ≥ŸàŸäŸÅ",
    "Minya": "ÿßŸÑÿßŸÑŸÖŸÜŸäÿß", "Assiut": "ÿßÿ≥ŸäŸàÿ∑", "Sohag": "ÿ≥ŸàŸáÿßÿ¨", "Qena": "ŸÇŸÜÿß",
    "Aswan": "ÿßÿ≥ŸàÿßŸÜ", "Luxor": "ÿßŸÑÿ£ŸÇÿµÿ±", "Red Sea": "ÿßŸÑÿ®ÿ≠ÿ± ÿßŸÑÿ£ÿ≠ŸÖÿ±",
    "Beheira": "ÿßŸÑÿ®ÿ≠Ÿäÿ±ÿ©", "Dakahlia": "ÿßŸÑÿØŸÇŸáŸÑŸäÿ©", "Sharqia": "ÿßŸÑÿ¥ÿ±ŸÇŸäÿ©",
    "Kafr el-Sheikh": "ŸÉŸÅÿ± ÿßŸÑÿ¥ŸäÿÆ", "Menoufia": "ÿßŸÑŸÖŸÜŸàŸÅŸäÿ©", "Gharbia": "ÿßŸÑÿ∫ÿ±ÿ®Ÿäÿ©",
    "Qalyubia": "ÿßŸÑŸÇŸÑŸäŸàÿ®Ÿäÿ©", "Matrouh": "ŸÖÿ∑ÿ±Ÿàÿ≠",
    "North Sinai": "ÿ¥ŸÖÿßŸÑ ÿ≥ŸäŸÜÿßÿ°", "South Sinai": "ÿ¨ŸÜŸàÿ® ÿ≥ŸäŸÜÿßÿ°",
    "New Valley": "ÿßŸÑŸàÿßÿØŸä ÿßŸÑÿ¨ÿØŸäÿØ"
  };
  return map[city] || city;
}
const oldPrice = document.getElementById('oldPrice');
const discountBadge = document.getElementById('discountBadge');
const discountTimer = document.getElementById('discountTimer');
const timerText = document.getElementById('timerText');



async function loadProduct() {
  if (!productId) {
    productSkeleton.innerHTML = `<div class="text-center text-red-600">ÿ±ŸÇŸÖ ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠</div>`;
    return;
  }

  try {
    productSkeleton.classList.remove('hidden');
    productContent.classList.add('hidden');

    const { data, error } = await supabase.from('products')
      .select(`
        id, name, description, price, discount_price, discount_start, discount_end,
        stock, category, created_at, available_cities, delivery_by_city,    seller_id
,
        product_images!product_images_product_id_fkey(image_url, is_primary, ordering)
      `)
      .eq('id', productId)
      .maybeSingle();

    if (error || !data) {
      productSkeleton.innerHTML = `<div class="text-center text-gray-600">ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ</div>`;
      console.error("‚ùå loadProduct error:", error);
      return;
    }


    try {
      const { data: seller, error: sellerError } = await supabase
        .from("profiles")
        .select("full_name, store_name, phone")
      .eq("id", data.seller_id)

        .maybeSingle();

      if (seller) {
        document.getElementById("sellerName").textContent =
          seller.store_name || seller.full_name || "ÿ®ÿßÿ¶ÿπ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ";
      } else {
        document.getElementById("sellerName").textContent = "ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±";
        console.warn("‚ö†Ô∏è ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑÿ®ÿßÿ¶ÿπ:", sellerError);
      }
    } catch (e) {
      console.error("‚ö†Ô∏è ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ¨ŸÑÿ® ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ®ÿßÿ¶ÿπ:", e);
      document.getElementById("sellerName").textContent = "ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±";
    }


    const imgs = (data.product_images || []).slice().sort((a,b) => (a.ordering||0) - (b.ordering||0));
    const main = imgs.find(i => i.is_primary) || imgs[0];
    mainImage.src = main?.image_url || '/assets/no-image.png';
    thumbsEl.innerHTML = imgs.map(im => `
      <img src="${im.image_url}"
           class="w-20 h-20 rounded object-cover border cursor-pointer hover:scale-105 transition"
           onclick="mainImage.src='${im.image_url}'" />
    `).join('');

    pName.textContent = data.name ?? '';
    pDesc.textContent = data.description || 'ŸÑÿß ŸäŸàÿ¨ÿØ ŸàÿµŸÅ';
    pStock.textContent = data.stock > 0 ? `ÿßŸÑŸÖÿ™ŸàŸÅÿ±: ${data.stock}` : 'ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±';
    pCategory.textContent = data.category || 'ÿ∫Ÿäÿ± ŸÖÿµŸÜŸÅ';
    pDate.textContent = formatDate(data.created_at);

    const price = Number(data.price || 0);
    const discount = data.discount_price ? Number(data.discount_price) : null;
    const dStart = data.discount_start ? new Date(data.discount_start) : null;
    const dEnd = data.discount_end ? new Date(data.discount_end) : null;
    const now = new Date();

    oldPrice.classList.add("hidden");
    discountBadge.classList.add("hidden");
    discountTimer.classList.add("hidden");

    const discountActive = discount && dEnd && now <= dEnd && (!dStart || now >= dStart);

    if (discountActive) {
      pPrice.innerHTML = `<span class="text-red-600 font-bold text-2xl">${discount.toLocaleString('ar-EG')} ÿ¨.ŸÖ</span>`;

      oldPrice.textContent = `${price.toLocaleString('ar-EG')} ÿ¨.ŸÖ`;
      oldPrice.classList.remove("hidden");

      discountBadge.textContent = "ÿÆÿµŸÖ";
      discountBadge.classList.remove("hidden");
      discountTimer.classList.remove("hidden");

      let timer = setInterval(() => {
        const diff = dEnd - new Date();
        if (diff <= 0) {
          clearInterval(timer);
          location.reload();
        }

        const h = Math.floor(diff / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        const s = Math.floor((diff % 60000) / 1000);

        timerText.textContent = `${h} ÿ≥ ${m} ÿØ ${s} ÿ´`;
      }, 1000);
    } else {
      pPrice.innerHTML = `<span class="text-blue-700 font-bold text-2xl">${price.toLocaleString('ar-EG')} ÿ¨.ŸÖ</span>`;
    }

    let availableCities = Array.isArray(data.available_cities)
      ? data.available_cities.join(", ")
      : (data.available_cities || "ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØÿ©");

    const cityEl = document.createElement('p');
    cityEl.className = "text-gray-600 text-sm mt-2 lv12-city-info";
    cityEl.innerHTML = `üèôÔ∏è ŸÖÿ™ÿßÿ≠ ŸÅŸä: <span class="font-medium">${escapeHtml(availableCities)}</span>`;
    pDate.insertAdjacentElement('afterend', cityEl);

    let deliveryText = "ÿÆŸÑÿßŸÑ 1‚Äì3 ÿ£ŸäÿßŸÖ";
    try {
      const deliveryData = data.delivery_by_city && typeof data.delivery_by_city === "object"
        ? data.delivery_by_city
        : JSON.parse(data.delivery_by_city || "{}");

      if (userCountry?.toLowerCase().includes("egypt")) {
        deliveryText = deliveryData[userCity] 
          ? `ÿßŸÑÿ™ŸàÿµŸäŸÑ ŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ™ŸÉ (${userCity}): ${deliveryData[userCity]}`
          : `ÿßŸÑÿ™ŸàÿµŸäŸÑ ŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ™ŸÉ (${userCity || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØÿ©'}): ÿÆŸÑÿßŸÑ 1‚Äì3 ÿ£ŸäÿßŸÖ`;
      } else {
        deliveryText = "‚ùå ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ± ÿÆÿßÿ±ÿ¨ ŸÖÿµÿ±";
      }

      const deliveryEl = document.createElement('p');
      deliveryEl.className = "text-green-700 text-sm mt-1 lv12-delivery-info";
      deliveryEl.innerHTML = `üöö <span class="font-medium">${escapeHtml(deliveryText)}</span>`;
      cityEl.insertAdjacentElement('afterend', deliveryEl);
    } catch {}

    const insideEgypt = userCountry?.toLowerCase().includes("egypt");

    if (!insideEgypt) {
      addToCartBtn.classList.add("hidden");
      buyNowBtn.classList.add("hidden");
    } else {
   addToCartBtn.onclick = async () => {

  addToCartLocal(
    data.id,
    data.name,
    discount ? discount : data.price,
    data.seller_id || data.owner_id || null  
  );

  await supabase.from('cart_events')
    .insert([{ product_id: data.id }])
    .catch(() => {});

  location.href = "cart.html";
};

      buyNowBtn.onclick = () => {
        addToCartLocal(data.id, data.name, discount ? discount : data.price);
      };
    }

    productSkeleton.classList.add('hidden');
    productContent.classList.remove('hidden');
document.getElementById("sellerProductsBtn").onclick = () => {
  window.location.href = `seller-products.html?seller=${data.seller_id}`;
};

    await logVisit("product", data.id);
    loadProductViews(data.id);
    loadSalesCount(data.id);
    loadRelatedProducts(data.category, data.id);
    subscribeReviewsRealtime();

    try {
      const { data: sessionData } = await supabase.auth.getSession();
      const user = sessionData?.session?.user;
      if (user && data?.id) {
        await supabase
          .from("user_interests")
          .upsert({
            user_id: user.id,
            product_id: data.id
          }, { onConflict: ['user_id', 'product_id'] });
        console.log("üíæ ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸáÿ™ŸÖÿßŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®Ÿáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨:", data.name);
      }
    } catch (err) {
      console.warn("‚ö†Ô∏è ŸÅÿ¥ŸÑ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿßŸáÿ™ŸÖÿßŸÖ:", err.message);
    }

  } catch (err) {
    console.error("‚ö†Ô∏è ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° loadProduct:", err);
    productSkeleton.innerHTML = `<div class="text-red-600 text-center">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨</div>`;
  }
}
async function loadSalesCount(productId) {
  const { data, error } = await supabase
    .from("orders")
    .select("quantity")
    .eq("product_id", productId);

  if (error) return console.error(error);

  const total = (data || []).reduce((t, x) => t + (x.quantity || 0), 0);
  document.getElementById("salesCount").textContent = total;
}

async function saveUserInterest(productId) {
  try {
    const { data: session } = await supabase.auth.getSession();
    const user = session?.session?.user;
    if (!user) return;

    await supabase
      .from("user_interests")
      .upsert([{ user_id: user.id, product_id: productId }], { onConflict: "user_id,product_id" });

  } catch (err) {
    console.warn("‚ö†Ô∏è ŸÑŸÖ Ÿäÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿßŸáÿ™ŸÖÿßŸÖ:", err.message);
  }
}


async function loadProductViews(prodId) {
  if (!supabase || !prodId) return;
  try {
    const { data, error } = await supabase.from('page_visits').select('id').eq('product_id', prodId);
    if (error) return console.warn("‚ö†Ô∏è ÿÆÿ∑ÿ£ ŸÅŸä loadProductViews:", error);
    document.getElementById('viewsNum').textContent = (data || []).length;
  } catch (err) {
    console.error("‚ö†Ô∏è loadProductViews exception:", err);
  }
}
async function loadRelatedProducts(category, currentId) {
  try {
    if (!category) {
      if (relatedProductsEl) relatedProductsEl.innerHTML = `<p class="text-gray-500">ŸÑÿß ŸäŸàÿ¨ÿØ ÿ™ÿµŸÜŸäŸÅ ŸÑŸÑŸÖŸÜÿ™ÿ¨ ÿßŸÑÿ≠ÿßŸÑŸä.</p>`;
      return;
    }

    const { data, error } = await supabase.from("products")
      .select(`
        id, name, price, discount_price, discount_start, discount_end,
        product_images!product_images_product_id_fkey(image_url, is_primary)
      `)
      .eq("category", category)
      .neq("id", currentId)
      .limit(4);

    if (error) throw error;

    if (!data || data.length === 0) {
      relatedProductsEl.innerHTML = `<p class="text-gray-500">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖÿ¥ÿßÿ®Ÿáÿ© ŸÅŸä ŸÜŸÅÿ≥ ÿßŸÑÿ™ÿµŸÜŸäŸÅ.</p>`;
      return;
    }

    relatedProductsEl.innerHTML = data.map(p => {
      const img = p.product_images?.find(i => i.is_primary)?.image_url || "/assets/no-image.png";

      const hasDiscount = p.discount_price && p.discount_price < p.price;
      const discountPercent = hasDiscount ? Math.round((1 - (p.discount_price / p.price)) * 100) : 0;

      return `
        <div onclick="location.href='product.html?id=${p.id}'"
          class="cursor-pointer bg-white rounded-xl shadow-md hover:shadow-lg transition p-3">

          <div class="relative">
            <img src="${img}" class="w-full h-40 object-cover rounded-lg">

            ${hasDiscount ? `
              <span class="absolute top-2 right-2 bg-red-600 text-white text-xs px-2 py-1 rounded">
                ÿÆÿµŸÖ ${discountPercent}%
              </span>
            ` : ""}
          </div>

          <h4 class="font-semibold text-blue-700 truncate mt-2">${escapeHtml(p.name)}</h4>

          <div class="mt-1">
            <span class="text-red-600 font-bold text-lg">${hasDiscount ? p.discount_price : p.price} ÿ¨.ŸÖ</span>
            ${hasDiscount ? `<span class="text-gray-400 line-through text-xs ml-1">${p.price} ÿ¨.ŸÖ</span>` : ""}
          </div>

          ${p.discount_end ? `<div class="text-xs text-red-600 mt-1" id="cd-related-${p.id}">‚è≥ </div>` : ""}
        </div>
      `;
    }).join("");

    data.forEach(p => {
      if (!p.discount_end) return;
      const element = document.getElementById(`cd-related-${p.id}`);
      const endTime = new Date(p.discount_end).getTime();

      setInterval(() => {
        const diff = endTime - Date.now();
        if (diff <= 0) {
          element.innerHTML = "‚õî ÿßŸÜÿ™ŸáŸâ ÿßŸÑÿπÿ±ÿ∂";
          return;
        }
        const h = Math.floor(diff / (1000 * 60 * 60));
        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        element.innerHTML = `‚è≥ ${h} ÿ≥ ${m} ÿØ`;
      }, 1000);
    });

  } catch (err) {
    console.error("‚ö†Ô∏è loadRelatedProducts error:", err);
  }
}




async function loadReviews(initial = true) {
  try {
    if (initial) {
      const { data, error } = await supabase.from('product_reviews')
        .select('*').eq('product_id', productId).order('created_at', { ascending: false });
      if (error) return reviewsList && (reviewsList.innerHTML = `<div class="text-red-500">‚ö†Ô∏è ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÇŸäŸäŸÖÿßÿ™</div>`);
      reviewsData = data || [];
      reviewsShown = 0;
    }

    if (!reviewsData.length) {
      if (reviewsList) reviewsList.innerHTML = `<div class="text-gray-500 text-center">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ™ŸÇŸäŸäŸÖÿßÿ™ ÿ®ÿπÿØ</div>`;
      avgBadge.textContent = ''; ratingSummary.textContent = '';
      return;
    }

    const avg = (reviewsData.reduce((a,b)=>a+Number(b.rating),0) / reviewsData.length).toFixed(1);
    avgBadge.textContent = `${avg} / 5`;
    ratingSummary.innerHTML = `<span class="text-sm text-gray-700">‚≠ê ${avg} ŸÖŸÜ ${reviewsData.length} ÿ™ŸÇŸäŸäŸÖ</span>`;

    reviewsList.innerHTML = reviewsData.map(r=>`
      <div class="border rounded-lg p-3 mb-3 bg-gray-50 shadow-sm hover:shadow-md transition">
        <div class="flex justify-between mb-2">
          <span class="font-semibold">${escapeHtml(r.user_name || 'ŸÖÿ≥ÿ™ÿÆÿØŸÖ')}</span>
          <span class="text-yellow-400">${'‚òÖ'.repeat(r.rating)}${'‚òÜ'.repeat(5-r.rating)}</span>
        </div>
        <p class="text-gray-700 mb-1">${escapeHtml(r.comment || '')}</p>
        <small class="text-gray-400">${new Date(r.created_at).toLocaleString()}</small>
      </div>
    `).join('');
  } catch (err) {
    console.error("‚ö†Ô∏è loadReviews error:", err);
  }
}

reviewForm?.addEventListener('submit', async (e) => {
  e.preventDefault();
  if (!currentUser) { showToast('Ÿäÿ¨ÿ® ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ£ŸàŸÑÿßŸã', false); return; }
  const comment = reviewComment.value.trim();
  if (!comment || !selectedRating) { showToast('ÿßÿÆÿ™ÿ± ÿ™ŸÇŸäŸäŸÖ ŸàÿßŸÉÿ™ÿ® ÿ™ÿπŸÑŸäŸÇŸÉ', false); return; }
  const name = currentUser.user_metadata?.full_name || currentUser.email.split('@')[0];

  try {
    const { data: existing } = await supabase.from('product_reviews')
      .select('id').eq('product_id', productId).eq('user_id', currentUser.id).maybeSingle();
    if (existing) { showToast('ŸÑŸÇÿØ ŸÇŸÖÿ™ ÿ®ÿ™ŸÇŸäŸäŸÖ Ÿáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸÖŸÜ ŸÇÿ®ŸÑ', false); return; }

    const { error } = await supabase.from('product_reviews').insert([{
      product_id: productId, user_id: currentUser.id, user_name: name,
      rating: selectedRating, comment, created_at: new Date().toISOString()
    }]);
    if (error) { showToast('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ŸÇŸäŸäŸÖ', false); return; }

    reviewComment.value = ''; selectedRating = 0; renderStarUI(0);
    showToast('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿ™ŸÇŸäŸäŸÖŸÉ ÿ®ŸÜÿ¨ÿßÿ≠ ‚úÖ');
    await loadReviews();
  } catch (err) {
    console.error("‚ö†Ô∏è add review failed:", err);
    showToast('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£', false);
  }
});

function buildStarInput() {
  if (!starInput) return;
  starInput.innerHTML = '';
  for (let i=1;i<=5;i++){
    const s = document.createElement('span');
    s.textContent = '‚òÜ';
    s.className = 'cursor-pointer text-2xl sm:text-3xl transition-transform hover:scale-125';
    s.onclick = () => { selectedRating = i; renderStarUI(i); };
    starInput.appendChild(s);
  }
  renderStarUI(0);
}
function renderStarUI(n) {
  if (!starInput) return;
  [...starInput.children].forEach((s, idx) => {
    s.textContent = idx < n ? '‚òÖ' : '‚òÜ';
    s.classList.toggle('text-yellow-400', idx < n);
  });
}
clearReviewBtn?.addEventListener('click', ()=> { reviewComment.value=''; selectedRating=0; renderStarUI(0); });

function addToCartLocal(id, name, price, seller_id) {
  const cart = JSON.parse(localStorage.getItem('cart') || '[]');
  const found = cart.find(i => i.id === id);

  if (found) {
    found.quantity = (found.quantity || 0) + 1;
  } else {
    cart.push({
      id,
      name,
      price,
      seller_id,  
      quantity: 1
    });
  }

  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartBadgeUI();
  showToast('ÿ™ŸÖÿ™ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ≥ŸÑÿ©');
}

function updateCartBadgeUI(){
  const cart = JSON.parse(localStorage.getItem('cart') || '[]');
  const count = cart.reduce((a,b)=>a+(b.quantity||0),0);
  if (count>0) { cartBadge.textContent = count; cartBadge.classList.remove('hidden'); }
  else cartBadge.classList.add('hidden');
}

function subscribeReviewsRealtime(){
  if (!supabase || reviewSub) return;
  try {
    reviewSub = supabase.channel('public:product_reviews')
      .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'product_reviews', filter: `product_id=eq.${productId}` },
        () => loadReviews())
      .subscribe();
  } catch (e) { console.warn("‚ö†Ô∏è subscribeReviewsRealtime failed:", e); }
}

async function checkAuth() {
  if (!supabase) return;
  try {
    const { data } = await supabase.auth.getSession();
    currentUser = data?.session?.user || null;
    renderAuthUI();
  } catch (err) {
    console.warn("‚ö†Ô∏è checkAuth error:", err);
  }
}
function renderAuthUI() {
  if (!userArea) return;
  if (currentUser) {
    const name = currentUser.user_metadata?.full_name || currentUser.email.split("@")[0];
    const avatar = currentUser.user_metadata?.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0D8ABC&color=fff`;
    userArea.innerHTML = `<div class="flex items-center gap-2">
      <img src="${avatar}" class="w-8 h-8 rounded-full border border-gray-300" alt="user">
      <span class="text-sm text-gray-700 font-medium">üë§ ${escapeHtml(name)}</span>
      <button id="logoutBtn" class="text-sm text-red-500 ml-2 hover:underline">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆÿ±Ÿàÿ¨</button>
    </div>`;
    reviewForm?.classList.remove('hidden');
    reviewLoginNotice?.classList.add('hidden');
    document.getElementById('logoutBtn').onclick = async () => { await supabase.auth.signOut(); currentUser=null; renderAuthUI(); showToast('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨'); };
  } else {
    userArea.innerHTML = `<a href="shop-login.html" class="text-blue-600 underline text-sm">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</a>`;
    reviewForm?.classList.add('hidden');
    reviewLoginNotice?.classList.remove('hidden');
  }
}
(async function init(){
  try {
    updateCartBadgeUI();
    buildStarInput();
    await detectUserLocation();
    await loadProduct();     
    await loadReviews();
    await checkAuth();

  } catch (err) {
    console.error("‚ùå ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©:", err);
    showToast("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©", false);
  }

})();

</script>
<script>
async function renderUserInterests() {
  const container = document.getElementById("interestProducts");
  if (!container) return;

  try {
    const { data: session } = await supabase.auth.getSession();
    const user = session?.session?.user;

    if (!user) {
      container.innerHTML = `<p class="text-gray-500 text-center py-4">ÿ≥ÿ¨ŸÑ ÿØÿÆŸàŸÑŸÉ ŸÑÿπÿ±ÿ∂ ÿßŸáÿ™ŸÖÿßŸÖÿßÿ™ŸÉ ‚ù§Ô∏è</p>`;
      return;
    }

    const { data: interests, error } = await supabase
      .from("user_interests")
      .select("product_id")
      .eq("user_id", user.id)
      .order("created_at", { ascending: false })
      .limit(12);

    if (error) throw error;

    if (!interests?.length) {
      container.innerHTML = `<p class="text-gray-500 text-center py-4">ŸÑŸÖ ÿ™ŸÇŸÖ ÿ®ÿ≤Ÿäÿßÿ±ÿ© ÿ£Ÿä ŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ®ÿπÿØ üëÄ</p>`;
      return;
    }

    const ids = interests.map(i => i.product_id);

    const { data: products, error: pErr } = await supabase
      .from("products")
      .select(`
        id, name, price, discount_price,
        product_images(image_url, is_primary)
      `)
      .in("id", ids);

    if (pErr) throw pErr;

    if (!products?.length) {
      container.innerHTML = `<p class="text-gray-500 text-center py-4">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖÿ∑ÿßÿ®ŸÇÿ© ÿ®ÿπÿØ</p>`;
      return;
    }

    container.innerHTML = products.map(p => {
      const img =
        (p.product_images?.find(im => im.is_primary)?.image_url) ||
        (p.product_images?.[0]?.image_url) ||
        "/assets/no-image.png";

      const price = p.discount_price ?? p.price;
      return `
        <div class="bg-white rounded-xl shadow hover:shadow-lg transition p-2 cursor-pointer"
             onclick="location.href='product.html?id=${p.id}'">
          <img src="${img}" class="w-full h-40 object-cover rounded-lg mb-2" alt="${p.name}">
          <h3 class="font-semibold text-sm text-gray-800 truncate">${p.name}</h3>
          <p class="text-blue-600 font-bold text-sm">${price} ÿ¨.ŸÖ</p>
        </div>
      `;
    }).join("");

  } catch (err) {
    console.error("‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿπÿ±ÿ∂ ÿßŸÑÿßŸáÿ™ŸÖÿßŸÖÿßÿ™:", err);
    container.innerHTML = `<p class="text-red-500 text-center py-4">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿßŸáÿ™ŸÖÿßŸÖÿßÿ™ üòû</p>`;
  }
}

document.addEventListener("DOMContentLoaded", renderUserInterests);
async function logUserActivity(type) {
  const user = JSON.parse(localStorage.getItem('lv12_user') || '{}');
  await supabase.from('user_activity').insert({
    user_id: user.id || null,
    user_display: user.name || 'ÿ≤ÿßÿ¶ÿ±',
    type
  });
}

logUserActivity('ÿ≤Ÿäÿßÿ±ÿ© ÿßŸÑŸÖÿ™ÿ¨ÿ±');

</script>
<script>
(async () => {
  try {
    const res = await fetch("https://ipwho.is/");
    const data = await res.json();

    const sec = data.security || {};
    const net = data.connection || {};
    const isp = (data.isp || "").toLowerCase();
    const org = (net.org || "").toLowerCase();
    const country = data.country_code || "??";

    const safeCountries = ["EG", "SA", "AE", "KW", "JO", "QA", "OM", "DZ", "MA", "TN", "LY", "BH", "IQ", "SD", "YE", "SY", "PS"];

    const suspicious =
      sec.vpn ||
      sec.proxy ||
      sec.tor ||
      sec.relay ||
      (!isp && !safeCountries.includes(country)) || 
      /vpn|proxy|tor|hosting|cloudflare|aws|azure|google|digitalocean|ovh|linode|hetzner|server/i.test(
        isp + org
      );

    if (suspicious && !safeCountries.includes(country)) {
      document.documentElement.innerHTML = `
        <div style="
          position:fixed;inset:0;background:#0b0f19;
          color:#fff;display:flex;flex-direction:column;
          align-items:center;justify-content:center;
          font-family:'Cairo',sans-serif;text-align:center;
          padding:20px;z-index:999999;
        ">
          <div style="max-width:500px;">
            <h2 style="font-size:26px;margin-bottom:12px;">üö´ ÿ™ŸÖ ÿ≠ÿ∏ÿ± ÿßŸÑŸàÿµŸàŸÑ</h2>
            <p style="font-size:16px;line-height:1.8;">
              ÿ™ŸÖ ÿßŸÉÿ™ÿ¥ÿßŸÅ ÿßÿ™ÿµÿßŸÑ ÿ∫Ÿäÿ± ŸÖŸàÿ´ŸàŸÇ ÿ£Ÿà ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ VPN / Proxy.<br>
              Ÿäÿ±ÿ¨Ÿâ ÿ•ŸäŸÇÿßŸÅŸá ÿ´ŸÖ ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©.<br><br>
              <b>ÿπŸÜŸàÿßŸÜŸÉ ÿßŸÑÿ≠ÿßŸÑŸä:</b> ${data.ip || "ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ"}<br>
              <b>ÿßŸÑÿ®ŸÑÿØ:</b> ${data.country || "ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ"}
            </p>
            <button onclick="location.reload()" style="
              margin-top:25px;background:#2563eb;color:white;
              border:none;padding:10px 20px;border-radius:8px;
              cursor:pointer;font-size:15px;">
              üîÑ ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©
            </button>
          </div>
        </div>
      `;
      throw new Error("Blocked: Suspicious VPN/Proxy connection");
    }

    console.log(
      `‚úÖ VPN check passed | IP: ${data.ip} | Country: ${country} | ISP: ${isp || "unknown"}`
    );
  } catch (err) {
    console.warn("‚ö†Ô∏è VPN check failed:", err);
  }
})();
</script>
<script>
async function renderProductWithSeller(product) {
  const sellerId = product.seller_id || product.seller || null;
  let sellerHtml = '';
  if (sellerId) {
    try {
      const { data: seller, error } = await supabase
        .from('profiles')
        .select('id, full_name, avatar_url, shop_name')
        .eq('id', sellerId)
        .maybeSingle();

      if (!error && seller) {
        sellerHtml = `
          <div id="productSeller" class="flex items-center gap-3 mt-3">
            <img src="${seller.avatar_url || '/lv12.png'}" class="w-10 h-10 rounded-full border" alt="seller">
            <div>
              <div class="text-sm font-semibold text-white">${seller.shop_name || seller.full_name || 'ÿ®ÿßÿ¶ÿπ'}</div>
              <div class="text-xs text-gray-300">ŸÖÿπÿ±ŸëŸÅ ÿßŸÑÿ®ÿßÿ¶ÿπ: <span class="font-mono text-xs">${seller.id}</span></div>
              <div class="mt-1">
                <a href="merchant-dashboard.html?seller=${seller.id}" class="text-xs text-blue-300 hover:underline">ÿ≤Ÿäÿßÿ±ÿ© ŸÖÿ™ÿ¨ÿ± ÿßŸÑÿ®ÿßÿ¶ÿπ</a>
              </div>
            </div>
          </div>
        `;
      }
    } catch (e) {
      console.warn('ÿÆÿ∑ÿ£ ÿ¨ŸÑÿ® ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿßÿ¨ÿ±', e);
    }
  } else {
    sellerHtml = `<div class="text-sm text-gray-400 mt-3">ÿ®ÿßÿ¶ÿπ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ</div>`;
  }

  const sellerContainer = document.getElementById('sellerContainer');
  if (sellerContainer) sellerContainer.innerHTML = sellerHtml;
}

document.addEventListener('DOMContentLoaded', async () => {
  const productId = new URLSearchParams(location.search).get('id');
  if (!productId) return;
  const { data: product, error } = await supabase
    .from('products')
    .select('*')
    .eq('id', productId)
    .maybeSingle();
  if (product) {
   
    renderProductWithSeller(product);
  }
});

</script>

</body>
</html>